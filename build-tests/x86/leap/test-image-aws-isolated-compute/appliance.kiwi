<?xml version="1.0" encoding="utf-8"?>
<image schemaversion="7.5" name="kiwi-test-image-aws-isolated-compute">
    <description type="system">
        <author>SUSE</author>
        <contact>Public Cloud Development Team</contact>
        <specification>Attestable Image Example</specification>
        <license>Apache License 2.0</license>
    </description>
    <preferences>
        <version>1.16.0</version>
        <packagemanager>zypper</packagemanager>
        <locale>en_US</locale>
        <keytable>us</keytable>
        <timezone>UTC</timezone>
        <rpm-check-signatures>false</rpm-check-signatures>
        <type
            image="oem"
            filesystem="xfs"
            kernelcmdline="console=ttyS0 rd.shell=0 systemd.getty_auto=false rd.kiwi.verity_options=panic-on-corruption rd.systemd.verity=1"
            firmware="uefi"
            overlayroot="true"
            overlayroot_write_partition="false"
            overlayroot_readonly_filesystem="squashfs"
            overlayroot_readonly_partsize="2048"
            squashfscompression="lz4"
            eficsm="false"
            verity_blocks="all"
            bootpartition="false"
            efipartsize="200"
            editbootinstall="pcr_measurements.sh"
        >
            <oemconfig>
                <oem-resize>false</oem-resize>
            </oemconfig>
            <bootloader name="systemd_boot" timeout="0"/>
            <initrd action="setup">
                <dracut uefi="true"/>
            </initrd>
            <size unit="G">3</size>
        </type>
    </preferences>
    <users>
        <user
            password="$1$wYJUgpM5$RXMMeASDc035eX.NbYWFl0"
            home="/root"
            name="root"
            groups="root"
            shell="/bin/bash"/>
    </users>
    <users>
        <user
            password="$1$wYJUgpM5$RXMMeASDc035eX.NbYWFl0"
            home="/home/ec2-user"
            name="ec2-user"
            groups="users,root"/>
    </users>
    <repository type="rpm-md">
        <source path="obsrepositories:/"/>
    </repository>
    <packages type="image">
        <package name="squashfs"/>
        <package name="chrony"/>
        <package name="procps"/>
        <package name="systemd"/>
        <package name="systemd-boot"/>
        <package name="iproute2"/>
        <package name="systemd-networkd"/>
        <package name="pciutils"/>
        <package name="gzip"/>
        <package name="tar"/>
        <package name="cryptsetup"/>
        <package name="dracut-kiwi-verity"/>
        <package name="dracut-kiwi-overlay"/>
        <package name="systemd-resolved"/>
        <package name="binutils"/>
        <package name="vim"/>
        <package name="which"/>
        <package name="kernel-default"/>
        <package name="kernel-default-extra"/>
        <package name="kernel-firmware-all"/>
        <package name="timezone"/>
        <package name="aws-nitro-tpm-tools"/>
        <package name="aws-nitro-enclaves-cli"/>
        <package name="tpm2-0-tss"/>
        <package name="tpm2.0-tools"/>
        <package name="tpm2.0-abrmd"/>
        <package name="tpm2-tss-engine"/>
        <package name="python313-cbor2"/>
        <package name="socat"/>
        <package name="flake-pilot"/>
        <package name="flake-pilot-podman"/>
        <package name="amazon-ssm-agent"/>
        <package name="cloud-init"/>
        <package name="cloud-init-config-suse"/>
        <package name="openssh-server"/>
        <package name="openssh-clients"/>
        <file
            name="kiwi-test-image-nitro-enclave.x86_64-1.1.1.eif"
            target="/data/kiwi-test-image-nitro-enclave.x86_64-1.1.1.eif"
        />
    </packages>
    <packages type="bootstrap">
        <package name="gawk"/>
        <package name="grep"/>
        <package name="gzip"/>
        <package name="udev"/>
        <package name="xz"/>
        <package name="diffutils"/>
        <package name="shadow"/>
        <package name="filesystem"/>
        <package name="glibc-locale"/>
        <package name="cracklib-dict-full"/>
        <package name="ca-certificates"/>
        <package name="ca-certificates-mozilla"/>
    </packages>
</image>
