<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.4"/>
    <title>kiwi.runtime_checker API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../kiwi.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;kiwi</a>

            <img src="https://osinside.github.io/kiwi/_static/kiwi-logo.png" class="logo" alt="project logo"/>

            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#dracut_module_type">dracut_module_type</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#dracut_module_type.__init__">dracut_module_type</a>
                        </li>
                        <li>
                                <a class="variable" href="#dracut_module_type.package">package</a>
                        </li>
                        <li>
                                <a class="variable" href="#dracut_module_type.min_version">min_version</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="variable" href="#log">log</a>
            </li>
            <li>
                    <a class="class" href="#RuntimeChecker">RuntimeChecker</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#RuntimeChecker.__init__">RuntimeChecker</a>
                        </li>
                        <li>
                                <a class="variable" href="#RuntimeChecker.xml_state">xml_state</a>
                        </li>
                        <li>
                                <a class="function" href="#RuntimeChecker.check_repositories_configured">check_repositories_configured</a>
                        </li>
                        <li>
                                <a class="function" href="#RuntimeChecker.check_target_dir_on_unsupported_filesystem">check_target_dir_on_unsupported_filesystem</a>
                        </li>
                        <li>
                                <a class="function" href="#RuntimeChecker.check_include_references_unresolvable">check_include_references_unresolvable</a>
                        </li>
                        <li>
                                <a class="function" href="#RuntimeChecker.check_image_include_repos_publicly_resolvable">check_image_include_repos_publicly_resolvable</a>
                        </li>
                        <li>
                                <a class="function" href="#RuntimeChecker.check_target_directory_not_in_shared_cache">check_target_directory_not_in_shared_cache</a>
                        </li>
                        <li>
                                <a class="function" href="#RuntimeChecker.check_volume_label_used_with_lvm">check_volume_label_used_with_lvm</a>
                        </li>
                        <li>
                                <a class="function" href="#RuntimeChecker.check_partuuid_persistency_type_used_with_mbr">check_partuuid_persistency_type_used_with_mbr</a>
                        </li>
                        <li>
                                <a class="function" href="#RuntimeChecker.check_swap_name_used_with_lvm">check_swap_name_used_with_lvm</a>
                        </li>
                        <li>
                                <a class="function" href="#RuntimeChecker.check_volume_setup_defines_reserved_labels">check_volume_setup_defines_reserved_labels</a>
                        </li>
                        <li>
                                <a class="function" href="#RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes">check_volume_setup_defines_multiple_fullsize_volumes</a>
                        </li>
                        <li>
                                <a class="function" href="#RuntimeChecker.check_volume_setup_has_no_root_definition">check_volume_setup_has_no_root_definition</a>
                        </li>
                        <li>
                                <a class="function" href="#RuntimeChecker.check_container_tool_chain_installed">check_container_tool_chain_installed</a>
                        </li>
                        <li>
                                <a class="function" href="#RuntimeChecker.check_luksformat_options_valid">check_luksformat_options_valid</a>
                        </li>
                        <li>
                                <a class="function" href="#RuntimeChecker.check_appx_naming_conventions_valid">check_appx_naming_conventions_valid</a>
                        </li>
                        <li>
                                <a class="function" href="#RuntimeChecker.check_initrd_selection_required">check_initrd_selection_required</a>
                        </li>
                        <li>
                                <a class="function" href="#RuntimeChecker.check_boot_description_exists">check_boot_description_exists</a>
                        </li>
                        <li>
                                <a class="function" href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image">check_consistent_kernel_in_boot_and_system_image</a>
                        </li>
                        <li>
                                <a class="function" href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi">check_dracut_module_versions_compatible_to_kiwi</a>
                        </li>
                        <li>
                                <a class="function" href="#RuntimeChecker.check_dracut_module_for_oem_install_in_package_list">check_dracut_module_for_oem_install_in_package_list</a>
                        </li>
                        <li>
                                <a class="function" href="#RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list">check_dracut_module_for_disk_oem_in_package_list</a>
                        </li>
                        <li>
                                <a class="function" href="#RuntimeChecker.check_dracut_module_for_live_iso_in_package_list">check_dracut_module_for_live_iso_in_package_list</a>
                        </li>
                        <li>
                                <a class="function" href="#RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list">check_dracut_module_for_disk_overlay_in_package_list</a>
                        </li>
                        <li>
                                <a class="function" href="#RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest">check_xen_uniquely_setup_as_server_or_guest</a>
                        </li>
                        <li>
                                <a class="function" href="#RuntimeChecker.check_mediacheck_installed">check_mediacheck_installed</a>
                        </li>
                        <li>
                                <a class="function" href="#RuntimeChecker.check_image_version_provided">check_image_version_provided</a>
                        </li>
                        <li>
                                <a class="function" href="#RuntimeChecker.check_image_type_unique">check_image_type_unique</a>
                        </li>
                        <li>
                                <a class="function" href="#RuntimeChecker.check_efi_fat_image_has_correct_size">check_efi_fat_image_has_correct_size</a>
                        </li>
                        <li>
                                <a class="function" href="#RuntimeChecker.check_bootloader_env_compatible_with_loader">check_bootloader_env_compatible_with_loader</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../kiwi.html">kiwi</a><wbr>.runtime_checker    </h1>

                
                        <input id="mod-runtime_checker-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-runtime_checker-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="c1"># Copyright (c) 2015 SUSE Linux GmbH.  All rights reserved.</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a><span class="c1">#</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a><span class="c1"># This file is part of kiwi.</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="c1">#</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="c1"># kiwi is free software: you can redistribute it and/or modify</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="c1"># it under the terms of the GNU General Public License as published by</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a><span class="c1"># the Free Software Foundation, either version 3 of the License, or</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a><span class="c1"># (at your option) any later version.</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="c1">#</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="c1"># kiwi is distributed in the hope that it will be useful,</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a><span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a><span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a><span class="c1"># GNU General Public License for more details.</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a><span class="c1">#</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a><span class="c1"># You should have received a copy of the GNU General Public License</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a><span class="c1"># along with kiwi.  If not, see &lt;http://www.gnu.org/licenses/&gt;</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a><span class="c1">#</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">textwrap</span><span class="w"> </span><span class="kn">import</span> <span class="n">dedent</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a>    <span class="n">NamedTuple</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Any</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a><span class="p">)</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a><span class="c1"># project</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">kiwi.version</span><span class="w"> </span><span class="kn">import</span> <span class="n">__version__</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">io</span><span class="w"> </span><span class="kn">import</span> <span class="n">StringIO</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">kiwi.xml_description</span><span class="w"> </span><span class="kn">import</span> <span class="n">XMLDescription</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">kiwi.firmware</span><span class="w"> </span><span class="kn">import</span> <span class="n">FirmWare</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">kiwi.xml_state</span><span class="w"> </span><span class="kn">import</span> <span class="n">XMLState</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">kiwi.system.uri</span><span class="w"> </span><span class="kn">import</span> <span class="n">Uri</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">kiwi.defaults</span><span class="w"> </span><span class="kn">import</span> <span class="n">Defaults</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">kiwi.command</span><span class="w"> </span><span class="kn">import</span> <span class="n">Command</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">kiwi.path</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">kiwi.utils.command_capabilities</span><span class="w"> </span><span class="kn">import</span> <span class="n">CommandCapabilities</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">kiwi.runtime_config</span><span class="w"> </span><span class="kn">import</span> <span class="n">RuntimeConfig</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">kiwi.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a>    <span class="n">KiwiRuntimeError</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a><span class="p">)</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">kiwi.defaults</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">defaults</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a><span class="n">dracut_module_type</span> <span class="o">=</span> <span class="n">NamedTuple</span><span class="p">(</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a>    <span class="s1">&#39;dracut_module_type&#39;</span><span class="p">,</span> <span class="p">[</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a>        <span class="p">(</span><span class="s1">&#39;package&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a>        <span class="p">(</span><span class="s1">&#39;min_version&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a>    <span class="p">]</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a><span class="p">)</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a><span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;kiwi&#39;</span><span class="p">)</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a><span class="k">class</span><span class="w"> </span><span class="nc">RuntimeChecker</span><span class="p">:</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a><span class="sd">    **Implements build consistency checks at runtime**</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xml_state</span><span class="p">:</span> <span class="n">XMLState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a><span class="sd">        The schema of an image description covers structure and syntax of</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a><span class="sd">        the provided data. The RuntimeChecker provides methods to perform</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a><span class="sd">        further semantic checks which allows to recognize potential build</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a><span class="sd">        or boot problems early.</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a><span class="sd">        :param object xml_state: Instance of XMLState</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span> <span class="o">=</span> <span class="n">xml_state</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_repositories_configured</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a><span class="sd">        Verify that there are repositories configured</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_repository_sections</span><span class="p">():</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a>            <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a>                <span class="s1">&#39;No repositories configured&#39;</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a>            <span class="p">)</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_target_dir_on_unsupported_filesystem</span><span class="p">(</span><span class="n">target_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a><span class="sd">        Raise if the given target dir does not reside on a</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a><span class="sd">        filesystem that supports all important features like</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a><span class="sd">        extended permissions(fscaps), ACLs or xattrs.</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a><span class="s1">            Target root/image directory is lacking filesystem features</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a><span class="s1">            The filesystem </span><span class="si">{0}</span><span class="s1"> in the target path </span><span class="si">{1}</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a><span class="s1">            does not support important features like extended permissions,</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a><span class="s1">            ACLs or xattrs. The image build may fail or the resulting</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a><span class="s1">            image misbehave.</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a>        <span class="n">target_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">first_exists</span><span class="p">(</span><span class="n">target_dir</span><span class="p">)</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a>        <span class="n">stat</span> <span class="o">=</span> <span class="n">Command</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;stat&#39;</span><span class="p">,</span> <span class="s1">&#39;-f&#39;</span><span class="p">,</span> <span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="s1">&#39;%T&#39;</span><span class="p">,</span> <span class="n">target_dir</span><span class="p">])</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a>        <span class="k">if</span> <span class="n">stat</span><span class="p">:</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a>            <span class="n">target_fs</span> <span class="o">=</span> <span class="n">stat</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a>            <span class="n">supported_target_filesystem</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a>                <span class="s1">&#39;btrfs&#39;</span><span class="p">,</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a>                <span class="s1">&#39;ext2&#39;</span><span class="p">,</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a>                <span class="s1">&#39;ext2/ext3&#39;</span><span class="p">,</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a>                <span class="s1">&#39;ext3&#39;</span><span class="p">,</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a>                <span class="s1">&#39;ext4&#39;</span><span class="p">,</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a>                <span class="s1">&#39;overlayfs&#39;</span><span class="p">,</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a>                <span class="s1">&#39;tmpfs&#39;</span><span class="p">,</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a>                <span class="s1">&#39;xfs&#39;</span><span class="p">,</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a>            <span class="p">)</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a>            <span class="k">if</span> <span class="n">target_fs</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">supported_target_filesystem</span><span class="p">:</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">target_fs</span><span class="p">,</span> <span class="n">target_dir</span><span class="p">))</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_include_references_unresolvable</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a><span class="sd">        Raise for still included &lt;include&gt; statements as not resolvable.</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a><span class="sd">        The KIWI XSLT processing replaces the specified include</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a><span class="sd">        directive(s) with the given file reference(s). If this action</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a><span class="sd">        did not happen for example on nested includes, it can happen</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a><span class="sd">        that they stay in the document as sort of waste.</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a><span class="s1">            One ore more &lt;include&gt; statements are unresolvable</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a><span class="s1">            The following include references could not be resolved.</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a><span class="s1">            Please verify the specified location(s) and/or delete</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a><span class="s1">            the broken include directive(s) from the description.</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a><span class="s1">            Please also note, nested includes from other include</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a><span class="s1">            files are not supported:</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a><span class="s1">            </span><span class="si">{0}</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a>        <span class="n">include_files</span> <span class="o">=</span> \
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_include_section_reference_file_names</span><span class="p">()</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a>        <span class="k">if</span> <span class="n">include_files</span><span class="p">:</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a>            <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a>                <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">include_files</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a>            <span class="p">)</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_image_include_repos_publicly_resolvable</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a><span class="sd">        Verify that all repos marked with the imageinclude attribute</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a><span class="sd">        can be resolved into a http based web URL</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a><span class="s1">            The use of imageinclude=&quot;true&quot; in the repository definition</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a><span class="s1">            for the Repository: </span><span class="si">{0}</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a><span class="s1">            requires the repository to by publicly available. The source</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a><span class="s1">            locator of the repository however indicates it is private to</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a><span class="s1">            your local system. Therefore it can&#39;t be included into the</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a><span class="s1">            system image repository configuration. Please define a publicly</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a><span class="s1">            available repository in your image XML description.</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a>        <span class="n">repository_sections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_repository_sections</span><span class="p">()</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a>        <span class="k">for</span> <span class="n">xml_repo</span> <span class="ow">in</span> <span class="n">repository_sections</span><span class="p">:</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a>            <span class="n">repo_marked_for_image_include</span> <span class="o">=</span> <span class="n">xml_repo</span><span class="o">.</span><span class="n">get_imageinclude</span><span class="p">()</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a>            <span class="k">if</span> <span class="n">repo_marked_for_image_include</span><span class="p">:</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a>                <span class="n">repo_source</span> <span class="o">=</span> <span class="n">xml_repo</span><span class="o">.</span><span class="n">get_source</span><span class="p">()</span><span class="o">.</span><span class="n">get_path</span><span class="p">()</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a>                <span class="n">repo_type</span> <span class="o">=</span> <span class="n">xml_repo</span><span class="o">.</span><span class="n">get_type</span><span class="p">()</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a>                <span class="n">uri</span> <span class="o">=</span> <span class="n">Uri</span><span class="p">(</span><span class="n">repo_source</span><span class="p">,</span> <span class="n">repo_type</span><span class="p">)</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">uri</span><span class="o">.</span><span class="n">is_public</span><span class="p">():</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a>                    <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a>                        <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">repo_source</span><span class="p">)</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a>                    <span class="p">)</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_target_directory_not_in_shared_cache</span><span class="p">(</span><span class="n">target_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a><span class="sd">        The target directory must be outside of the kiwi shared cache</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a><span class="sd">        directory in order to avoid busy mounts because kiwi bind mounts</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a><span class="sd">        the cache directory into the image root tree to access host</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a><span class="sd">        caching information</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a><span class="sd">        :param string target_dir: path name</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a><span class="s1">            Target directory </span><span class="si">%s</span><span class="s1"> conflicts with kiwi&#39;s shared cache</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a><span class="s1">            directory </span><span class="si">%s</span><span class="s1">. This is going to create a busy loop mount.</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a><span class="s1">            Please choose another target directory.</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a>        <span class="n">shared_cache_location</span> <span class="o">=</span> <span class="n">Defaults</span><span class="o">.</span><span class="n">get_shared_cache_location</span><span class="p">()</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a>        <span class="n">target_dir_stack</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">target_dir</span><span class="p">)</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a>        <span class="k">if</span> <span class="n">target_dir_stack</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="n">shared_cache_location</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">):</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a>            <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a>                <span class="n">message</span> <span class="o">%</span> <span class="p">(</span><span class="n">target_dir</span><span class="p">,</span> <span class="n">shared_cache_location</span><span class="p">)</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a>            <span class="p">)</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_volume_label_used_with_lvm</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a><span class="sd">        The optional volume label in a systemdisk setup is only</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a><span class="sd">        effective if the LVM, logical volume manager system is</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a><span class="sd">        used. In any other case where the filesystem itself offers</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a><span class="sd">        volume management capabilities there are no extra filesystem</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a><span class="sd">        labels which can be applied per volume</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a><span class="s1">            Custom volume label setup used without LVM</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a><span class="s1">            The optional volume label in a systemdisk setup is only</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a><span class="s1">            effective if the LVM, logical volume manager system is</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a><span class="s1">            used. Your setup uses the </span><span class="si">{0}</span><span class="s1"> filesystem which itself</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a><span class="s1">            offers volume management capabilities. Extra filesystem</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a><span class="s1">            labels cannot be applied in this case.</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a><span class="s1">            If you want to force LVM over the </span><span class="si">{0}</span><span class="s1"> volume management</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a><span class="s1">            system you can do so by specifying the following in</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a><span class="s1">            your KIWI XML description:</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a><span class="s1">            &lt;systemdisk ... preferlvm=&quot;true&quot;&gt;</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a><span class="s1">                &lt;volume .../&gt;</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a><span class="s1">            &lt;/systemdisk&gt;</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a>        <span class="n">volume_management</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_volume_management</span><span class="p">()</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a>        <span class="k">if</span> <span class="n">volume_management</span> <span class="o">!=</span> <span class="s1">&#39;lvm&#39;</span><span class="p">:</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a>            <span class="k">for</span> <span class="n">volume</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_volumes</span><span class="p">():</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a>                <span class="k">if</span> <span class="n">volume</span><span class="o">.</span><span class="n">label</span> <span class="ow">and</span> <span class="n">volume</span><span class="o">.</span><span class="n">label</span> <span class="o">!=</span> <span class="s1">&#39;SWAP&#39;</span><span class="p">:</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a>                    <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a>                        <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">volume_management</span><span class="p">)</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a>                    <span class="p">)</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_partuuid_persistency_type_used_with_mbr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a><span class="sd">        The devicepersistency setting by-partuuid can only be</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a><span class="sd">        used in combination with a partition table type that</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a><span class="sd">        supports UUIDs. In any other case Linux creates artificial</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a><span class="sd">        values for PTUUID and PARTUUID from the disk signature</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a><span class="sd">        which can change without touching the actual partition</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a><span class="sd">        table. We consider this unsafe and only allow the use</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a><span class="sd">        of by-partuuid in combination with partition tables that</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a><span class="sd">        actually supports it properly.</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a><span class="s1">            devicepersistency=</span><span class="si">{0!r}</span><span class="s1"> used with non UUID capable partition table</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a><span class="s1">            PTUUID and PARTUUID exists in the GUID (GPT) partition table.</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a><span class="s1">            According to the firmware setting: </span><span class="si">{1!r}</span><span class="s1">, the selected partition</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a><span class="s1">            table type is: </span><span class="si">{2!r}</span><span class="s1">. This table type does not natively support</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a><span class="s1">            UUIDs. In such a case Linux creates artificial values for PTUUID</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a><span class="s1">            and PARTUUID from the disk signature which can change without</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a><span class="s1">            touching the actual partition table. This is considered unsafe</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a><span class="s1">            and KIWI only allows the use of by-partuuid in combination with</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a><span class="s1">            partition tables that actually supports UUIDs properly.</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a><span class="s1">            Please make sure to use one of the following firmware settings</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a><span class="s1">            which leads to an image using an UUID capable partition table</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a><span class="s1">            and therefore supporting consistent by-partuuid device names:</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a><span class="s1">            &lt;type ... firmware=&quot;efi|uefi&quot;&gt;</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a>        <span class="n">persistency_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_devicepersistency</span><span class="p">()</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a>        <span class="k">if</span> <span class="n">persistency_type</span> <span class="ow">and</span> <span class="n">persistency_type</span> <span class="o">==</span> <span class="s1">&#39;by-partuuid&#39;</span><span class="p">:</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a>            <span class="n">supported_table_types</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;gpt&#39;</span><span class="p">]</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a>            <span class="n">firmware</span> <span class="o">=</span> <span class="n">FirmWare</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="p">)</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a>            <span class="n">table_type</span> <span class="o">=</span> <span class="n">firmware</span><span class="o">.</span><span class="n">get_partition_table_type</span><span class="p">()</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a>            <span class="k">if</span> <span class="n">table_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">supported_table_types</span><span class="p">:</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a>                    <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a>                        <span class="n">persistency_type</span><span class="p">,</span> <span class="n">firmware</span><span class="o">.</span><span class="n">firmware</span><span class="p">,</span> <span class="n">table_type</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a>                    <span class="p">)</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a>                <span class="p">)</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_swap_name_used_with_lvm</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a><span class="sd">        The optional oem-swapname is only effective if used together</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a><span class="sd">        with the LVM volume manager. A name for the swap space can</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a><span class="sd">        only be set if it is created as a LVM volume. In any other</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a><span class="sd">        case the name does not apply to the system</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a><span class="s1">             Specified swap space name: </span><span class="si">{0}</span><span class="s1"> will not be used</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a><span class="s1">             The specified oem-swapname is used without the LVM volume</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a><span class="s1">             manager. This means the swap space will be created as simple</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a><span class="s1">             partition for which no name assignment can take place.</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a><span class="s1">             The name specified in oem-swapname is used to give the</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a><span class="s1">             LVM swap volume a name. Outside of LVM the setting is</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a><span class="s1">             meaningless and should be removed.</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a><span class="s1">             Please delete the following setting from your image</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a><span class="s1">             description:</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a><span class="s1">             &lt;oem-swapname&gt;</span><span class="si">{0}</span><span class="s1">&lt;/oem-swapname&gt;</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a>        <span class="n">volume_management</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_volume_management</span><span class="p">()</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a>        <span class="k">if</span> <span class="n">volume_management</span> <span class="o">!=</span> <span class="s1">&#39;lvm&#39;</span><span class="p">:</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a>            <span class="n">oemconfig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_build_type_oemconfig_section</span><span class="p">()</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a>            <span class="k">if</span> <span class="n">oemconfig</span> <span class="ow">and</span> <span class="n">oemconfig</span><span class="o">.</span><span class="n">get_oem_swapname</span><span class="p">():</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a>                    <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">oemconfig</span><span class="o">.</span><span class="n">get_oem_swapname</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a>                <span class="p">)</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_volume_setup_defines_reserved_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a><span class="s1">            Reserved label name used in LVM volume setup</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a><span class="s1">            The label setup for volume </span><span class="si">{0}</span><span class="s1"> uses the reserved label </span><span class="si">{1}</span><span class="s1">.</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a><span class="s1">            Reserved labels used by KIWI internally are </span><span class="si">{2}</span><span class="s1">. Please</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a><span class="s1">            choose another label name for this volume.</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a>        <span class="n">reserved_labels</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_rootfs_label</span><span class="p">()</span> <span class="ow">or</span> <span class="s1">&#39;ROOT&#39;</span><span class="p">,</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a>            <span class="s1">&#39;SWAP&#39;</span><span class="p">,</span> <span class="s1">&#39;SPARE&#39;</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a>        <span class="p">]</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a>        <span class="n">volume_management</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_volume_management</span><span class="p">()</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a>        <span class="k">if</span> <span class="n">volume_management</span> <span class="o">==</span> <span class="s1">&#39;lvm&#39;</span><span class="p">:</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a>            <span class="k">for</span> <span class="n">volume</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_volumes</span><span class="p">():</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a>                <span class="c1"># A swap volume is created implicitly if oem-swap is</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a>                <span class="c1"># requested. This volume detected via realpath set to</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a>                <span class="c1"># swap is skipped from the reserved label check as it</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a>                <span class="c1"># intentionally uses the reserved label named SWAP</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a>                <span class="k">if</span> <span class="n">volume</span><span class="o">.</span><span class="n">realpath</span> <span class="o">!=</span> <span class="s1">&#39;swap&#39;</span><span class="p">:</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a>                    <span class="k">if</span> <span class="n">volume</span><span class="o">.</span><span class="n">label</span> <span class="ow">and</span> <span class="n">volume</span><span class="o">.</span><span class="n">label</span> <span class="ow">in</span> <span class="n">reserved_labels</span><span class="p">:</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a>                        <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a>                            <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a>                                <span class="n">volume</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">volume</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">reserved_labels</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a>                            <span class="p">)</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a>                        <span class="p">)</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_volume_setup_defines_multiple_fullsize_volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a><span class="sd">        The volume size specification &#39;all&#39; makes this volume to</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a><span class="sd">        take the rest space available on the system. It&#39;s only</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a><span class="sd">        allowed to specify one all size volume</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a><span class="s1">            Multiple all size volumes found but only one is allowed</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a><span class="s1">            The volume size specification &#39;all&#39; makes this volume to</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a><span class="s1">            take the rest space available on the system. It&#39;s only</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a><span class="s1">            allowed to specify one all size volume</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a>        <span class="n">systemdisk_section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_build_type_system_disk_section</span><span class="p">()</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a>        <span class="k">if</span> <span class="n">systemdisk_section</span><span class="p">:</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a>            <span class="n">all_size_volume_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a>            <span class="n">volumes</span> <span class="o">=</span> <span class="n">systemdisk_section</span><span class="o">.</span><span class="n">get_volume</span><span class="p">()</span> <span class="ow">or</span> <span class="p">[]</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a>            <span class="k">for</span> <span class="n">volume</span> <span class="ow">in</span> <span class="n">volumes</span><span class="p">:</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a>                <span class="n">size</span> <span class="o">=</span> <span class="n">volume</span><span class="o">.</span><span class="n">get_size</span><span class="p">()</span> <span class="ow">or</span> <span class="n">volume</span><span class="o">.</span><span class="n">get_freespace</span><span class="p">()</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a>                <span class="k">if</span> <span class="n">size</span> <span class="ow">and</span> <span class="s1">&#39;all&#39;</span> <span class="ow">in</span> <span class="n">size</span><span class="p">:</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a>                    <span class="n">all_size_volume_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a>            <span class="k">if</span> <span class="n">all_size_volume_count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_volume_setup_has_no_root_definition</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a><span class="sd">        The root volume in a systemdisk setup is handled in a special</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a><span class="sd">        way. It is not allowed to setup a custom name or mountpoint for</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a><span class="sd">        the root volume. Therefore the size of the root volume can be</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a><span class="sd">        setup via the @root volume name. This check looks up the volume</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a><span class="sd">        setup and searches if there is a configuration for the &#39;/&#39;</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a><span class="sd">        mountpoint which would cause the image build to fail</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a><span class="s1">            Volume setup for &quot;/&quot; found. The size of the root volume</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a><span class="s1">            must be specified via the @root volume name like the</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a><span class="s1">            following example shows:</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a><span class="s1">            &lt;volume name=&quot;@root&quot; size=&quot;42G&quot;/&gt;</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a><span class="s1">            A custom name or mountpoint for the root volume is not</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a><span class="s1">            allowed.</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a>        <span class="k">for</span> <span class="n">volume</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_volumes</span><span class="p">():</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a>            <span class="k">if</span> <span class="n">volume</span><span class="o">.</span><span class="n">mountpoint</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_container_tool_chain_installed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a><span class="sd">        When creating container images the specific tools are used in order</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a><span class="sd">        to import and export OCI or Docker compatible images. This check</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a><span class="sd">        searches for those tools to be installed in the build system and</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a><span class="sd">        fails if it can&#39;t find them</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a>        <span class="n">message_tool_not_found</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a><span class="s1">            Required tool </span><span class="si">{name}</span><span class="s1"> not found in caller environment</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a><span class="s1">            Creation of OCI or Docker images requires the tools </span><span class="si">{name}</span><span class="s1"> and</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a><span class="s1">            skopeo to be installed on the build system. For SUSE based systems</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a><span class="s1">            you can find the tools at:</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a><span class="s1">            http://download.opensuse.org/repositories/Virtualization:/containers</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a>        <span class="n">message_version_unsupported</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a><span class="s1">            </span><span class="si">{name}</span><span class="s1"> tool found with unknown version</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a>        <span class="n">message_unknown_tool</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a><span class="s1">            Unknown tool: </span><span class="si">{0}</span><span class="s1">.</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a><span class="s1">            Please configure KIWI with an appropriate value (umoci or buildah).</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a><span class="s1">            Consider this runtime configuration file syntax (/etc/kiwi.yml):</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a><span class="s1">            oci:</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a><span class="s1">                - archive_tool: umoci | buildah</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a>        <span class="n">expected_version</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_build_type_name</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;docker&#39;</span><span class="p">,</span> <span class="s1">&#39;oci&#39;</span><span class="p">]:</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a>            <span class="n">runtime_config</span> <span class="o">=</span> <span class="n">RuntimeConfig</span><span class="p">()</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a>            <span class="n">tool_name</span> <span class="o">=</span> <span class="n">runtime_config</span><span class="o">.</span><span class="n">get_oci_archive_tool</span><span class="p">()</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a>            <span class="k">if</span> <span class="n">tool_name</span> <span class="o">==</span> <span class="s1">&#39;buildah&#39;</span><span class="p">:</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a>                <span class="n">oci_tools</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;buildah&#39;</span><span class="p">,</span> <span class="s1">&#39;skopeo&#39;</span><span class="p">]</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a>            <span class="k">elif</span> <span class="n">tool_name</span> <span class="o">==</span> <span class="s1">&#39;umoci&#39;</span><span class="p">:</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a>                <span class="n">oci_tools</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;umoci&#39;</span><span class="p">,</span> <span class="s1">&#39;skopeo&#39;</span><span class="p">]</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span><span class="n">message_unknown_tool</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tool_name</span><span class="p">))</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a>            <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">oci_tools</span><span class="p">:</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">Path</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">tool</span><span class="p">,</span> <span class="n">access_mode</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">X_OK</span><span class="p">):</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a>                    <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a>                        <span class="n">message_tool_not_found</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">tool</span><span class="p">)</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a>                    <span class="p">)</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a>                <span class="k">elif</span> <span class="ow">not</span> <span class="n">CommandCapabilities</span><span class="o">.</span><span class="n">check_version</span><span class="p">(</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a>                    <span class="n">tool</span><span class="p">,</span> <span class="n">expected_version</span><span class="p">,</span> <span class="n">raise_on_error</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a>                <span class="p">):</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a>                    <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a>                        <span class="n">message_version_unsupported</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">tool</span><span class="p">)</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a>                    <span class="p">)</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_check_multitag_support</span><span class="p">()</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_check_multitag_support</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a><span class="s1">            Using additionaltags attribute requires skopeo tool to be</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a><span class="s1">            capable to handle it, it must include the &#39;--additional-tag&#39;</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a><span class="s1">            option for copy subcommand (check it running &#39;skopeo copy</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a><span class="s1">            --help&#39;).</span><span class="se">\n</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a><span class="s1">            It is known to be present since v0.1.30</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a>        <span class="k">if</span> <span class="s1">&#39;additional_names&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_container_config</span><span class="p">():</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">CommandCapabilities</span><span class="o">.</span><span class="n">has_option_in_help</span><span class="p">(</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a>                <span class="s1">&#39;skopeo&#39;</span><span class="p">,</span> <span class="s1">&#39;--additional-tag&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;copy&#39;</span><span class="p">,</span> <span class="s1">&#39;--help&#39;</span><span class="p">],</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a>                <span class="n">raise_on_error</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a>            <span class="p">):</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_luksformat_options_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a><span class="sd">        Options set via the luksformat element are passed along</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a><span class="sd">        to the cryptsetup tool. Only options that are known to</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a><span class="sd">        the tool should be allowed. Thus this runtime check looks</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a><span class="sd">        up the provided option names if they exist in the cryptsetup</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a><span class="sd">        version used on the build host</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a><span class="s1">            Option </span><span class="si">{0!r}</span><span class="s1"> not found in cryptsetup</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a><span class="s1">            The Option </span><span class="si">{0!r}</span><span class="s1"> could not be found in the help output</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a><span class="s1">            of the cryptsetup tool.</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a>        <span class="n">luksformat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_luksformat</span><span class="p">()</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a>        <span class="k">if</span> <span class="n">luksformat</span><span class="p">:</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a>            <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="n">luksformat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_option</span><span class="p">():</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a>                <span class="n">argument</span> <span class="o">=</span> <span class="n">option</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">CommandCapabilities</span><span class="o">.</span><span class="n">has_option_in_help</span><span class="p">(</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a>                    <span class="s1">&#39;cryptsetup&#39;</span><span class="p">,</span> <span class="n">argument</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;--help&#39;</span><span class="p">],</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a>                    <span class="n">raise_on_error</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a>                <span class="p">):</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a>                    <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">argument</span><span class="p">))</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_appx_naming_conventions_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a><span class="sd">        When building wsl images there are some naming conventions that</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a><span class="sd">        must be fulfilled to run the container on Microsoft Windows</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a>        <span class="n">launcher_pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;[^</span><span class="se">\\</span><span class="s1">]+(\.[Ee][Xx][Ee])$&#39;</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a>        <span class="n">message_container_launcher_invalid</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a><span class="s1">            Invalid WSL launcher name: </span><span class="si">{0}</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a><span class="s1">            WSL launcher name must match the pattern: </span><span class="si">{1}</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a>        <span class="n">id_pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;^[a-zA-Z0-9]+$&#39;</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a>        <span class="n">message_container_id_invalid</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a><span class="s1">            Invalid WSL container application id: </span><span class="si">{0}</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a><span class="s1">            WSL container id must match the pattern: </span><span class="si">{1}</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a>        <span class="n">build_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_build_type_name</span><span class="p">()</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a>        <span class="n">container_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_container_config</span><span class="p">()</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a>        <span class="n">container_history</span> <span class="o">=</span> <span class="n">container_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;history&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a>        <span class="k">if</span> <span class="n">build_type</span> <span class="o">==</span> <span class="s1">&#39;appx&#39;</span> <span class="ow">and</span> <span class="n">container_config</span><span class="p">:</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a>            <span class="n">launcher</span> <span class="o">=</span> <span class="n">container_history</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;launcher&#39;</span><span class="p">)</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a>            <span class="k">if</span> <span class="n">launcher</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">launcher_pattern</span><span class="p">,</span> <span class="n">launcher</span><span class="p">):</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a>                    <span class="n">message_container_launcher_invalid</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a>                        <span class="n">launcher</span><span class="p">,</span> <span class="n">launcher_pattern</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a>                    <span class="p">)</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a>                <span class="p">)</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a>            <span class="n">application_id</span> <span class="o">=</span> <span class="n">container_history</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;application_id&#39;</span><span class="p">)</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a>            <span class="k">if</span> <span class="n">application_id</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">id_pattern</span><span class="p">,</span> <span class="n">application_id</span><span class="p">):</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a>                    <span class="n">message_container_id_invalid</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a>                        <span class="n">application_id</span><span class="p">,</span> <span class="n">id_pattern</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a>                    <span class="p">)</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a>                <span class="p">)</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_initrd_selection_required</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a><span class="sd">        If the boot attribute is used without selecting kiwi</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a><span class="sd">        as the initrd_system, the setting of the boot attribute</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a><span class="sd">        will not have any effect. We assume that configurations</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a><span class="sd">        which explicitly specify the boot attribute wants to use</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a><span class="sd">        the custom kiwi initrd system and not dracut.</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a>        <span class="n">message_kiwi_initrd_system_not_selected</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a><span class="s1">            Missing initrd_system selection for boot attribute</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a><span class="s1">            The selected boot=&quot;&#39;</span><span class="si">{0}</span><span class="s1">&#39;&quot; boot description indicates</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a><span class="s1">            the custom kiwi initrd system should be used instead</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a><span class="s1">            of dracut. If this is correct please explicitly request</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a><span class="s1">            the kiwi initrd system as follows:</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a><span class="s1">            &lt;type initrd_system=&quot;kiwi&quot;/&gt;</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a><span class="s1">            If this is not want you want and dracut should be used</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a><span class="s1">            as initrd system, please delete the boot attribute</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a><span class="s1">            as it is obsolete in this case.</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a>        <span class="n">initrd_system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_initrd_system</span><span class="p">()</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a>        <span class="n">boot_image_reference</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_boot</span><span class="p">()</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a>        <span class="k">if</span> <span class="n">initrd_system</span> <span class="o">!=</span> <span class="s1">&#39;kiwi&#39;</span> <span class="ow">and</span> <span class="n">boot_image_reference</span><span class="p">:</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a>            <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a>                <span class="n">message_kiwi_initrd_system_not_selected</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a>                    <span class="n">boot_image_reference</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a>                <span class="p">)</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a>            <span class="p">)</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_boot_description_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a><span class="sd">        If a kiwi initrd is used, a lookup to the specified boot</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a><span class="sd">        description is done and fails early if it does not exist</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a>        <span class="n">message_no_boot_reference</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a><span class="s1">            Boot description missing for &#39;</span><span class="si">{0}</span><span class="s1">&#39; type</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a><span class="s1">            The selected &#39;</span><span class="si">{1}</span><span class="s1">&#39; initrd_system requires a boot description</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a><span class="s1">            reference. Please update your type setup as follows</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a><span class="s1">            &lt;type image=&quot;</span><span class="si">{0}</span><span class="s1">&quot; boot=&quot;</span><span class="si">{0}</span><span class="s1">boot/...&quot;/&gt;</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a><span class="s1">            A collection of custom boot descriptions can be found</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a><span class="s1">            in the kiwi-boot-descriptions package</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a>        <span class="n">message_boot_description_not_found</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a><span class="s1">            Boot description &#39;</span><span class="si">{0}</span><span class="s1">&#39; not found</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a><span class="s1">            The selected boot description could not be found on</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a><span class="s1">            the build host. A collection of custom boot descriptions</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a><span class="s1">            can be found in the kiwi-boot-descriptions package</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a>        <span class="n">image_types_supporting_custom_boot_description</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;oem&#39;</span><span class="p">,</span> <span class="s1">&#39;pxe&#39;</span><span class="p">]</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a>        <span class="n">build_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_build_type_name</span><span class="p">()</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a>        <span class="n">initrd_system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_initrd_system</span><span class="p">()</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a>        <span class="k">if</span> <span class="n">initrd_system</span> <span class="o">==</span> <span class="s1">&#39;kiwi&#39;</span> <span class="ow">and</span> \
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a>           <span class="n">build_type</span> <span class="ow">in</span> <span class="n">image_types_supporting_custom_boot_description</span><span class="p">:</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a>            <span class="n">boot_image_reference</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_boot</span><span class="p">()</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">boot_image_reference</span><span class="p">:</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a>                    <span class="n">message_no_boot_reference</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">build_type</span><span class="p">,</span> <span class="n">initrd_system</span><span class="p">)</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a>                <span class="p">)</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">boot_image_reference</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">:</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a>                <span class="n">boot_image_reference</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a>                    <span class="p">[</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a>                        <span class="n">Defaults</span><span class="o">.</span><span class="n">get_boot_image_description_path</span><span class="p">(),</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a>                        <span class="n">boot_image_reference</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a>                    <span class="p">]</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a>                <span class="p">)</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">boot_image_reference</span><span class="p">):</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a>                    <span class="n">message_boot_description_not_found</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a>                        <span class="n">boot_image_reference</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a>                    <span class="p">)</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a>                <span class="p">)</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_consistent_kernel_in_boot_and_system_image</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a><span class="sd">        If a kiwi initrd is used, the kernel used to build the kiwi</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a><span class="sd">        initrd and the kernel used in the system image must be the</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a><span class="sd">        same in order to avoid an inconsistent boot setup</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a><span class="s1">            Possible kernel mismatch between kiwi initrd and system image</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a><span class="s1">            The selected &#39;</span><span class="si">{0}</span><span class="s1">&#39; boot image kernel is &#39;</span><span class="si">{1}</span><span class="s1">&#39;. However this</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a><span class="s1">            kernel package was not explicitly listed in the package list</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a><span class="s1">            of the system image. Please fixup your system image</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a><span class="s1">            description:</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a><span class="s1">            1) Add &lt;package name=&quot;</span><span class="si">{1}</span><span class="s1">&quot;/&gt; to your system XML description</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a><span class="s1">            2) Inherit kernel from system description to initrd via</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a><span class="s1">               the custom kernel profile:</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a><span class="s1">               &lt;type ... bootkernel=&quot;custom&quot; .../&gt;</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a><span class="s1">               &lt;packages type=&quot;image&quot;/&gt;</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a><span class="s1">                   &lt;package name=&quot;desired-kernel&quot; bootinclude=&quot;true&quot;/&gt;</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a><span class="s1">               &lt;/packages&gt;</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a>        <span class="n">boot_image_reference</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_boot</span><span class="p">()</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a>        <span class="n">boot_kernel_package_name</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a>        <span class="k">if</span> <span class="n">boot_image_reference</span><span class="p">:</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">boot_image_reference</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a>                <span class="n">boot_image_reference</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a>                    <span class="p">[</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a>                        <span class="n">Defaults</span><span class="o">.</span><span class="n">get_boot_image_description_path</span><span class="p">(),</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a>                        <span class="n">boot_image_reference</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a>                    <span class="p">]</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>                <span class="p">)</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a>            <span class="n">boot_config_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a>                <span class="p">[</span><span class="n">boot_image_reference</span><span class="p">,</span> <span class="s1">&#39;config.xml&#39;</span><span class="p">]</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a>            <span class="p">)</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">boot_config_file</span><span class="p">):</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a>                <span class="n">boot_description</span> <span class="o">=</span> <span class="n">XMLDescription</span><span class="p">(</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a>                    <span class="n">description</span><span class="o">=</span><span class="n">boot_config_file</span><span class="p">,</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a>                    <span class="n">derived_from</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">xml_data</span><span class="o">.</span><span class="n">description_dir</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a>                <span class="p">)</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a>                <span class="n">boot_kernel_profile</span> <span class="o">=</span> \
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_bootkernel</span><span class="p">()</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">boot_kernel_profile</span><span class="p">:</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a>                    <span class="n">boot_kernel_profile</span> <span class="o">=</span> <span class="s1">&#39;std&#39;</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a>                <span class="n">boot_xml_state</span> <span class="o">=</span> <span class="n">XMLState</span><span class="p">(</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a>                    <span class="n">boot_description</span><span class="o">.</span><span class="n">load</span><span class="p">(),</span> <span class="p">[</span><span class="n">boot_kernel_profile</span><span class="p">]</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a>                <span class="p">)</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a>                <span class="n">kernel_package_sections</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a>                <span class="k">for</span> <span class="n">packages_section</span> <span class="ow">in</span> <span class="n">boot_xml_state</span><span class="o">.</span><span class="n">xml_data</span><span class="o">.</span><span class="n">get_packages</span><span class="p">():</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a>                    <span class="c1"># lookup package sections matching kernel profile in kiwi</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a>                    <span class="c1"># boot description. By definition this must be a packages</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a>                    <span class="c1"># section with a single profile name whereas the default</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a>                    <span class="c1"># profile name is &#39;std&#39;. The section itself must contain</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a>                    <span class="c1"># one matching kernel package name for the desired</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a>                    <span class="c1"># architecture</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a>                    <span class="k">if</span> <span class="n">packages_section</span><span class="o">.</span><span class="n">get_profiles</span><span class="p">()</span> <span class="o">==</span> <span class="n">boot_kernel_profile</span><span class="p">:</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a>                        <span class="k">for</span> <span class="n">package</span> <span class="ow">in</span> <span class="n">packages_section</span><span class="o">.</span><span class="n">get_package</span><span class="p">():</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a>                            <span class="n">kernel_package_sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">package</span><span class="p">)</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a>                <span class="k">for</span> <span class="n">package</span> <span class="ow">in</span> <span class="n">kernel_package_sections</span><span class="p">:</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a>                    <span class="k">if</span> <span class="n">boot_xml_state</span><span class="o">.</span><span class="n">package_matches_host_architecture</span><span class="p">(</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a>                            <span class="n">package</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a>                    <span class="p">):</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a>                        <span class="n">boot_kernel_package_name</span> <span class="o">=</span> <span class="n">package</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a>        <span class="k">if</span> <span class="n">boot_kernel_package_name</span><span class="p">:</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a>            <span class="c1"># A kernel package name was found in the kiwi boot image</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a>            <span class="c1"># description. Let&#39;s check if this kernel is also used</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a>            <span class="c1"># in the system image</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a>            <span class="n">image_package_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_system_packages</span><span class="p">()</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a>            <span class="k">if</span> <span class="n">boot_kernel_package_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">image_package_names</span><span class="p">:</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a>                    <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_boot</span><span class="p">(),</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a>                        <span class="n">boot_kernel_package_name</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a>                    <span class="p">)</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a>                <span class="p">)</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_dracut_module_versions_compatible_to_kiwi</span><span class="p">(</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">root_dir</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a><span class="sd">        KIWI images which makes use of kiwi dracut modules</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a><span class="sd">        has to use module versions compatible with the version</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a><span class="sd">        of this KIWI builder code base. This is important to avoid</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a><span class="sd">        inconsistencies between the way how kiwi includes its own</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a><span class="sd">        dracut modules and former version of those dracut modules</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a><span class="sd">        which could be no longer compatible with the builder.</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a><span class="sd">        Therefore this runtime check maintains a min_version constraint</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a><span class="sd">        for which we know this KIWI builder to be compatible with.</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a><span class="s1">            Incompatible dracut-kiwi module(s) found</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a><span class="s1">            The image was build with KIWI version=</span><span class="si">{0}</span><span class="s1">. The system</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a><span class="s1">            root tree has the following dracut-kiwi-* module packages</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a><span class="s1">            installed which are too old to work with this version of KIWI.</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a><span class="s1">            Please make sure to use dracut-kiwi-* module packages</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a><span class="s1">            which are &gt;= than the versions listed below.</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a><span class="s1">            </span><span class="si">{1}</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a>        <span class="n">kiwi_dracut_modules</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a>            <span class="s1">&#39;55kiwi-dump&#39;</span><span class="p">:</span> <span class="n">dracut_module_type</span><span class="p">(</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a>                <span class="s1">&#39;dracut-kiwi-oem-dump&#39;</span><span class="p">,</span> <span class="s1">&#39;9.20.1&#39;</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a>            <span class="p">),</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a>            <span class="s1">&#39;55kiwi-live&#39;</span><span class="p">:</span> <span class="n">dracut_module_type</span><span class="p">(</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a>                <span class="s1">&#39;dracut-kiwi-live&#39;</span><span class="p">,</span> <span class="s1">&#39;9.20.1&#39;</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a>            <span class="p">),</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a>            <span class="s1">&#39;55kiwi-overlay&#39;</span><span class="p">:</span> <span class="n">dracut_module_type</span><span class="p">(</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a>                <span class="s1">&#39;dracut-kiwi-overlay&#39;</span><span class="p">,</span> <span class="s1">&#39;9.20.1&#39;</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a>            <span class="p">),</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a>            <span class="s1">&#39;55kiwi-repart&#39;</span><span class="p">:</span> <span class="n">dracut_module_type</span><span class="p">(</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a>                <span class="s1">&#39;dracut-kiwi-oem-repart&#39;</span><span class="p">,</span> <span class="s1">&#39;9.20.1&#39;</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a>            <span class="p">),</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a>            <span class="s1">&#39;59kiwi-dump-reboot&#39;</span><span class="p">:</span> <span class="n">dracut_module_type</span><span class="p">(</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a>                <span class="s1">&#39;dracut-kiwi-oem-dump&#39;</span><span class="p">,</span> <span class="s1">&#39;9.20.1&#39;</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a>            <span class="p">),</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a>            <span class="s1">&#39;59kiwi-lib&#39;</span><span class="p">:</span> <span class="n">dracut_module_type</span><span class="p">(</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a>                <span class="s1">&#39;dracut-kiwi-lib&#39;</span><span class="p">,</span> <span class="s1">&#39;9.20.1&#39;</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a>            <span class="p">)</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a>        <span class="p">}</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a>        <span class="n">dracut_module_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a>            <span class="p">[</span><span class="n">root_dir</span><span class="p">,</span> <span class="s1">&#39;/usr/lib/dracut/modules.d&#39;</span><span class="p">]</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a>        <span class="p">)</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">dracut_module_dir</span><span class="p">):</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a>            <span class="c1"># no dracut module dir present</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a>            <span class="k">return</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a>        <span class="n">incompatible_modules</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a>        <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dracut_module_dir</span><span class="p">):</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a>            <span class="n">module_meta</span> <span class="o">=</span> <span class="n">kiwi_dracut_modules</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a>            <span class="k">if</span> <span class="n">module_meta</span><span class="p">:</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a>                <span class="n">module_version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dracut_module_version_from_pdb</span><span class="p">(</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_package_manager</span><span class="p">(),</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a>                    <span class="n">module_meta</span><span class="o">.</span><span class="n">package</span><span class="p">,</span> <span class="n">root_dir</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a>                <span class="p">)</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a>                <span class="k">if</span> <span class="n">module_version</span><span class="p">:</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a>                    <span class="n">module_version_nr</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a>                        <span class="nb">int</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">module_version</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a>                    <span class="p">)</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a>                    <span class="n">module_min_version_nr</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a>                        <span class="nb">int</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">module_meta</span><span class="o">.</span><span class="n">min_version</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a>                    <span class="p">)</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a>                    <span class="k">if</span> <span class="n">module_version_nr</span> <span class="o">&lt;</span> <span class="n">module_min_version_nr</span><span class="p">:</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a>                        <span class="n">incompatible_modules</span><span class="p">[</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a>                            <span class="n">module_meta</span><span class="o">.</span><span class="n">package</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;got:</span><span class="si">{0}</span><span class="s1">, need:&gt;=</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a>                            <span class="n">module_version</span><span class="p">,</span> <span class="n">module_meta</span><span class="o">.</span><span class="n">min_version</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a>                        <span class="p">)</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a>        <span class="k">if</span> <span class="n">incompatible_modules</span><span class="p">:</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a>            <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a>                <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">__version__</span><span class="p">,</span> <span class="n">incompatible_modules</span><span class="p">)</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a>            <span class="p">)</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_dracut_module_for_oem_install_in_package_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a><span class="sd">        OEM images if configured to use dracut as initrd system</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a><span class="sd">        and configured with one of the installiso, installstick</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a><span class="sd">        or installpxe attributes requires the KIWI provided</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a><span class="sd">        dracut-kiwi-oem-dump module to be installed at the time</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a><span class="sd">        dracut is called. Thus this runtime check examines if the</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a><span class="sd">        required package is part of the package list in the</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a><span class="sd">        image description.</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a><span class="s1">            Required dracut module package missing in package list</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a><span class="s1">            One of the packages &#39;</span><span class="si">{0}</span><span class="s1">&#39; is required</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a><span class="s1">            to build an installation image for the selected oem image type.</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a><span class="s1">            Depending on your distribution, add the following in the</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a><span class="s1">            &lt;packages type=&quot;image&quot;&gt; section:</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a><span class="s1">            &lt;package name=&quot;ONE_FROM_ABOVE&quot;/&gt;</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a>        <span class="n">meta</span> <span class="o">=</span> <span class="n">Defaults</span><span class="o">.</span><span class="n">get_runtime_checker_metadata</span><span class="p">()</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a>        <span class="n">required_dracut_packages</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;package_names&#39;</span><span class="p">][</span><span class="s1">&#39;dracut_oem_dump&#39;</span><span class="p">]</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a>        <span class="n">initrd_system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_initrd_system</span><span class="p">()</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a>        <span class="n">build_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_build_type_name</span><span class="p">()</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a>        <span class="k">if</span> <span class="n">build_type</span> <span class="o">==</span> <span class="s1">&#39;oem&#39;</span> <span class="ow">and</span> <span class="n">initrd_system</span> <span class="o">==</span> <span class="s1">&#39;dracut&#39;</span><span class="p">:</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a>            <span class="n">install_iso</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_installiso</span><span class="p">()</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a>            <span class="n">install_stick</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_installstick</span><span class="p">()</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a>            <span class="n">install_pxe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_installpxe</span><span class="p">()</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a>            <span class="k">if</span> <span class="n">install_iso</span> <span class="ow">or</span> <span class="n">install_stick</span> <span class="ow">or</span> <span class="n">install_pxe</span><span class="p">:</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a>                <span class="n">package_names</span> <span class="o">=</span> \
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_bootstrap_packages</span><span class="p">()</span> <span class="o">+</span> \
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_system_packages</span><span class="p">()</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">RuntimeChecker</span><span class="o">.</span><span class="n">_package_in_list</span><span class="p">(</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a>                    <span class="n">package_names</span><span class="p">,</span> <span class="n">required_dracut_packages</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a>                <span class="p">):</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a>                    <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a>                        <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">required_dracut_packages</span><span class="p">)</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a>                    <span class="p">)</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_dracut_module_for_disk_oem_in_package_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a><span class="sd">        OEM images if configured to use dracut as initrd system</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a><span class="sd">        requires the KIWI provided dracut-kiwi-oem-repart module</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a><span class="sd">        to be installed at the time dracut is called. Thus this</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a><span class="sd">        runtime check examines if the required package is part of</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a><span class="sd">        the package list in the image description.</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a><span class="s1">            Required dracut module package missing in package list</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a><span class="s1">            One of the packages &#39;</span><span class="si">{0}</span><span class="s1">&#39; is required</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a><span class="s1">            for the selected oem image type. Depending on your distribution,</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a><span class="s1">            add the following in the &lt;packages type=&quot;image&quot;&gt; section:</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a><span class="s1">            &lt;package name=&quot;ONE_FROM_ABOVE&quot;/&gt;</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a>        <span class="n">meta</span> <span class="o">=</span> <span class="n">Defaults</span><span class="o">.</span><span class="n">get_runtime_checker_metadata</span><span class="p">()</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a>        <span class="n">required_dracut_packages</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;package_names&#39;</span><span class="p">][</span><span class="s1">&#39;dracut_oem_repart&#39;</span><span class="p">]</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a>        <span class="n">initrd_system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_initrd_system</span><span class="p">()</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a>        <span class="n">disk_resize_requested</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_oemconfig_oem_resize</span><span class="p">()</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a>        <span class="n">build_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_build_type_name</span><span class="p">()</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a>        <span class="k">if</span> <span class="n">build_type</span> <span class="o">==</span> <span class="s1">&#39;oem&#39;</span> <span class="ow">and</span> <span class="n">initrd_system</span> <span class="o">==</span> <span class="s1">&#39;dracut&#39;</span> <span class="ow">and</span> \
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a>           <span class="n">disk_resize_requested</span><span class="p">:</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a>            <span class="n">package_names</span> <span class="o">=</span> \
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_bootstrap_packages</span><span class="p">()</span> <span class="o">+</span> \
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_system_packages</span><span class="p">()</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">RuntimeChecker</span><span class="o">.</span><span class="n">_package_in_list</span><span class="p">(</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a>                <span class="n">package_names</span><span class="p">,</span> <span class="n">required_dracut_packages</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a>            <span class="p">):</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a>                    <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">required_dracut_packages</span><span class="p">)</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a>                <span class="p">)</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_dracut_module_for_live_iso_in_package_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a><span class="sd">        Live ISO images uses a dracut initrd to boot and requires</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a><span class="sd">        the KIWI provided kiwi-live dracut module to be installed</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a><span class="sd">        at the time dracut is called. Thus this runtime check</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a><span class="sd">        examines if the required package is part of the package</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a><span class="sd">        list in the image description.</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a><span class="s1">            Required dracut module package missing in package list</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a><span class="s1">            One of the packages &#39;</span><span class="si">{0}</span><span class="s1">&#39; is required</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a><span class="s1">            for the selected live iso image type. Depending on your distribution,</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a><span class="s1">            add the following in your &lt;packages type=&quot;image&quot;&gt; section:</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a><span class="s1">            &lt;package name=&quot;ONE_FROM_ABOVE&quot;/&gt;</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a>        <span class="n">meta</span> <span class="o">=</span> <span class="n">Defaults</span><span class="o">.</span><span class="n">get_runtime_checker_metadata</span><span class="p">()</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a>        <span class="n">required_dracut_packages</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;package_names&#39;</span><span class="p">][</span><span class="s1">&#39;dracut_live&#39;</span><span class="p">]</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a>        <span class="n">type_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_build_type_name</span><span class="p">()</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a>        <span class="n">type_flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_flags</span><span class="p">()</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a>        <span class="k">if</span> <span class="n">type_name</span> <span class="o">==</span> <span class="s1">&#39;iso&#39;</span> <span class="ow">and</span> <span class="n">type_flag</span> <span class="o">!=</span> <span class="s1">&#39;dmsquash&#39;</span><span class="p">:</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a>            <span class="n">package_names</span> <span class="o">=</span> \
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_bootstrap_packages</span><span class="p">()</span> <span class="o">+</span> \
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_system_packages</span><span class="p">()</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">RuntimeChecker</span><span class="o">.</span><span class="n">_package_in_list</span><span class="p">(</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a>                <span class="n">package_names</span><span class="p">,</span> <span class="n">required_dracut_packages</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a>            <span class="p">):</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a>                    <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">required_dracut_packages</span><span class="p">)</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a>                <span class="p">)</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_dracut_module_for_disk_overlay_in_package_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a><span class="sd">        Disk images configured to use a root filesystem overlay</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a><span class="sd">        requires the KIWI provided kiwi-overlay dracut module to</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a><span class="sd">        be installed at the time dracut is called. Thus this</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a><span class="sd">        runtime check examines if the required package is part of</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a><span class="sd">        the package list in the image description.</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a><span class="s1">            Required dracut module package missing in package list</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a><span class="s1">            The package &#39;</span><span class="si">{0}</span><span class="s1">&#39; is required</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a><span class="s1">            for the selected overlayroot activated image type.</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a><span class="s1">            Depending on your distribution, add the following in your</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a><span class="s1">            &lt;packages type=&quot;image&quot;&gt; section:</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a><span class="s1">            &lt;package name=&quot;ONE_FROM_ABOVE&quot;/&gt;</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a>        <span class="n">initrd_system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_initrd_system</span><span class="p">()</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a>        <span class="n">meta</span> <span class="o">=</span> <span class="n">Defaults</span><span class="o">.</span><span class="n">get_runtime_checker_metadata</span><span class="p">()</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a>        <span class="n">required_dracut_packages</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;package_names&#39;</span><span class="p">][</span><span class="s1">&#39;dracut_overlay&#39;</span><span class="p">]</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a>        <span class="k">if</span> <span class="n">initrd_system</span> <span class="o">==</span> <span class="s1">&#39;dracut&#39;</span> <span class="ow">and</span> \
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a>           <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_overlayroot</span><span class="p">():</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a>            <span class="n">package_names</span> <span class="o">=</span> \
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_bootstrap_packages</span><span class="p">()</span> <span class="o">+</span> \
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_system_packages</span><span class="p">()</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">RuntimeChecker</span><span class="o">.</span><span class="n">_package_in_list</span><span class="p">(</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a>                <span class="n">package_names</span><span class="p">,</span> <span class="n">required_dracut_packages</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a>            <span class="p">):</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a>                    <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">required_dracut_packages</span><span class="p">)</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a>                <span class="p">)</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_xen_uniquely_setup_as_server_or_guest</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a><span class="sd">        If the image is classified to be used as Xen image, it can</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a><span class="sd">        be either a Xen Server(dom0) or a Xen guest. The image</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a><span class="sd">        configuration is checked if the information uniquely identifies</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a><span class="sd">        the image as such</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a>        <span class="n">xen_message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a><span class="s1">            Inconsistent Xen setup found:</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a><span class="s1">            The use of the &#39;xen_server&#39; or &#39;xen_loader&#39; attributes indicates</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a><span class="s1">            the target system for this image is Xen. However the image</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a><span class="s1">            specifies both attributes at the same time which classifies</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a><span class="s1">            the image to be both, a Xen Server(dom0) and a Xen guest at</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a><span class="s1">            the same time, which is not supported.</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a><span class="s1">            Please cleanup your image description. Setup only one</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a><span class="s1">            of &#39;xen_server&#39; or &#39;xen_loader&#39;.</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a>        <span class="n">ec2_message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a><span class="s1">            Inconsistent Amazon EC2 setup found:</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a><span class="s1">            The firmware setup indicates the target system for this image</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a><span class="s1">            is Amazon EC2, which uses a Xen based virtualisation technology.</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a><span class="s1">            Therefore the image must be classified as a Xen guest and can</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a><span class="s1">            not be a Xen server as indicated by the &#39;xen_server&#39; attribute</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a><span class="s1">            Please cleanup your image description. Delete the &#39;xen_server&#39;</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a><span class="s1">            attribute for images used with Amazon EC2.</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">is_xen_server</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">is_xen_guest</span><span class="p">():</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a>            <span class="n">firmware</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_firmware</span><span class="p">()</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a>            <span class="n">ec2_firmware_names</span> <span class="o">=</span> <span class="n">Defaults</span><span class="o">.</span><span class="n">get_ec2_capable_firmware_names</span><span class="p">()</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a>            <span class="k">if</span> <span class="n">firmware</span> <span class="ow">and</span> <span class="n">firmware</span> <span class="ow">in</span> <span class="n">ec2_firmware_names</span><span class="p">:</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span><span class="n">ec2_message</span><span class="p">)</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span><span class="n">xen_message</span><span class="p">)</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_mediacheck_installed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a><span class="sd">        If the image description enables the mediacheck attribute</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a><span class="sd">        the required tools to run this check must be installed</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a><span class="sd">        on the image build host</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a>        <span class="n">message_tool_not_found</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a><span class="s1">            Required tool </span><span class="si">{name}</span><span class="s1"> not found in caller environment</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a><span class="s1">            The attribute &#39;mediacheck&#39; is set to &#39;true&#39; which requires</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a><span class="s1">            the above tool to be installed on the build system</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_mediacheck</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a>            <span class="n">tool</span> <span class="o">=</span> <span class="s1">&#39;tagmedia&#39;</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a>            <span class="n">media_tagger</span> <span class="o">=</span> <span class="n">RuntimeConfig</span><span class="p">()</span><span class="o">.</span><span class="n">get_iso_media_tag_tool</span><span class="p">()</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a>            <span class="k">if</span> <span class="n">media_tagger</span> <span class="o">==</span> <span class="s1">&#39;checkmedia&#39;</span><span class="p">:</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a>                <span class="n">tool</span> <span class="o">=</span> <span class="s1">&#39;tagmedia&#39;</span>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a>            <span class="k">elif</span> <span class="n">media_tagger</span> <span class="o">==</span> <span class="s1">&#39;isomd5sum&#39;</span><span class="p">:</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a>                <span class="n">tool</span> <span class="o">=</span> <span class="s1">&#39;implantisomd5&#39;</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">Path</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">tool</span><span class="p">,</span> <span class="n">access_mode</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">X_OK</span><span class="p">):</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a>                    <span class="n">message_tool_not_found</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">tool</span><span class="p">)</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a>                <span class="p">)</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_image_version_provided</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a><span class="sd">        Kiwi requires a &lt;version&gt; element to be specified as part</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a><span class="sd">        of at least one &lt;preferences&gt; section.</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a>        <span class="n">message_missing_version</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a><span class="s1">            No version is defined in any of the &lt;preferences&gt;</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a><span class="s1">            sections. Please add</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a><span class="s1">                &lt;version&gt;image_version&lt;version/&gt;</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a><span class="s1">            inside the &lt;preferences&gt; section.</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_image_version</span><span class="p">():</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a>            <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span><span class="n">message_missing_version</span><span class="p">)</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_image_type_unique</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a><span class="sd">        Verify that the selected image type is unique within</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a><span class="sd">        the range of the configured types and profiles.</span>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a><span class="s1">            Conflicting image type setup detected</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a><span class="s1">            The selected image type &#39;</span><span class="si">{0}</span><span class="s1">&#39; in the </span><span class="si">{1}</span><span class="s1"> profile</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a><span class="s1">            selection is not unique. There are the following type</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a><span class="s1">            settings which overrides each other:</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a><span class="s1">            </span><span class="si">{2}</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a><span class="s1">            To solve this conflict please move the image type</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a><span class="s1">            setup into its own profile and select them using</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a><span class="s1">            the --profile option at call time.</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a>        <span class="n">image_type_sections</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a>        <span class="n">type_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a>        <span class="k">for</span> <span class="n">preferences</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_preferences_sections</span><span class="p">():</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a>            <span class="n">image_type_sections</span> <span class="o">+=</span> <span class="n">preferences</span><span class="o">.</span><span class="n">get_type</span><span class="p">()</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a>        <span class="k">for</span> <span class="n">image_type</span> <span class="ow">in</span> <span class="n">image_type_sections</span><span class="p">:</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a>            <span class="n">type_name</span> <span class="o">=</span> <span class="n">image_type</span><span class="o">.</span><span class="n">get_image</span><span class="p">()</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a>            <span class="k">if</span> <span class="n">type_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">type_name</span><span class="p">):</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a>                <span class="n">type_dict</span><span class="p">[</span><span class="n">type_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image_type</span><span class="p">)</span>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a>                <span class="n">type_dict</span><span class="p">[</span><span class="n">type_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">image_type</span><span class="p">]</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a>        <span class="k">for</span> <span class="n">type_name</span><span class="p">,</span> <span class="n">type_list</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">type_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">type_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a>                <span class="n">type_export</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a>                <span class="k">for</span> <span class="n">image_type</span> <span class="ow">in</span> <span class="n">type_list</span><span class="p">:</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a>                    <span class="n">type_export</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">)</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a>                    <span class="n">image_type</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">type_export</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a>                    <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a>                        <span class="n">type_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">profiles</span> <span class="ow">or</span> <span class="p">[</span><span class="s1">&#39;Default&#39;</span><span class="p">],</span>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a>                        <span class="n">type_export</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a>                    <span class="p">)</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a>                <span class="p">)</span>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_efi_fat_image_has_correct_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a><span class="sd">        Verify that the efifatimagesize does not exceed the max</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a><span class="sd">        El Torito load size of 65535 * 512 bytes</span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a><span class="s1">            El Torito max load size exceeded</span>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a><span class="s1">            The configured efifatimagesize of &#39;</span><span class="si">{0}</span><span class="s1">MB&#39; exceeds</span>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a><span class="s1">            the El Torito max load size of 65535 * 512 bytes (~31MB).</span>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a>        <span class="n">fat_image_mbsize</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a>                <span class="o">.</span><span class="n">get_efifatimagesize</span><span class="p">()</span> <span class="ow">or</span> <span class="n">defaults</span><span class="o">.</span><span class="n">EFI_FAT_IMAGE_SIZE</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a>        <span class="p">)</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a>        <span class="k">if</span> <span class="n">fat_image_mbsize</span> <span class="o">&gt;</span> <span class="mi">31</span><span class="p">:</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a>            <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a>                <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fat_image_mbsize</span><span class="p">)</span>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a>            <span class="p">)</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_bootloader_env_compatible_with_loader</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a><span class="sd">        If there is an environment section as part of the bootloader</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a><span class="sd">        section, check if the selected loader supports custom</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a><span class="sd">        environment blobs</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a><span class="s1">            Selected loader does not support custom environments</span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a><span class="s1">            The selected bootloader </span><span class="si">{}</span><span class="s1"> does not support custom</span>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a><span class="s1">            environment settings. Please drop the &lt;environment&gt;</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a><span class="s1">            setting from &lt;bootloadersettings&gt; for this loader</span>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a>        <span class="n">env_supported_loaders</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a>            <span class="s1">&#39;grub2&#39;</span><span class="p">,</span>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a>            <span class="s1">&#39;grub2_s390x_emu&#39;</span><span class="p">,</span>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a>            <span class="s1">&#39;custom&#39;</span>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a>        <span class="p">]</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a>        <span class="n">bootloader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_build_type_bootloader_name</span><span class="p">()</span>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a>        <span class="n">variable_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span>\
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a>            <span class="n">get_build_type_bootloader_environment_variables</span><span class="p">()</span>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a>        <span class="k">if</span> <span class="n">variable_list</span> <span class="ow">and</span> <span class="n">bootloader</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">env_supported_loaders</span><span class="p">:</span>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a>            <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a>                <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bootloader</span><span class="p">)</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a>            <span class="p">)</span>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_package_in_list</span><span class="p">(</span>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a>        <span class="n">package_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">search_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a>        <span class="k">for</span> <span class="n">search</span> <span class="ow">in</span> <span class="n">search_list</span><span class="p">:</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a>            <span class="k">if</span> <span class="n">search</span> <span class="ow">in</span> <span class="n">package_list</span><span class="p">:</span>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="n">search</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a>                <span class="k">break</span>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_dracut_module_version_from_pdb</span><span class="p">(</span>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a>        <span class="n">package_manager</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">package_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">root_dir</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a>        <span class="n">tool</span> <span class="o">=</span> <span class="n">Defaults</span><span class="o">.</span><span class="n">get_default_packager_tool</span><span class="p">(</span><span class="n">package_manager</span><span class="p">)</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a>        <span class="n">package_query</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a>        <span class="n">package_manager_query</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a>        <span class="n">package_version</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a>        <span class="k">if</span> <span class="n">tool</span> <span class="o">==</span> <span class="s1">&#39;rpm&#39;</span><span class="p">:</span>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a>            <span class="n">package_manager_query</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a>                <span class="s1">&#39;chroot&#39;</span><span class="p">,</span> <span class="n">root_dir</span><span class="p">,</span> <span class="n">tool</span><span class="p">,</span> <span class="s1">&#39;-q&#39;</span><span class="p">,</span> <span class="s1">&#39;--qf&#39;</span><span class="p">,</span>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a>                <span class="s1">&#39;%</span><span class="si">{VERSION}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">package_name</span>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a>            <span class="p">]</span>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a>        <span class="k">elif</span> <span class="n">tool</span> <span class="o">==</span> <span class="s1">&#39;dpkg&#39;</span><span class="p">:</span>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a>            <span class="n">package_manager_query</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a>                <span class="s1">&#39;chroot&#39;</span><span class="p">,</span> <span class="n">root_dir</span><span class="p">,</span> <span class="s1">&#39;dpkg-query&#39;</span><span class="p">,</span> <span class="s1">&#39;-W&#39;</span><span class="p">,</span> <span class="s1">&#39;-f&#39;</span><span class="p">,</span>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a>                <span class="s1">&#39;$</span><span class="si">{Version}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">package_name</span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a>            <span class="p">]</span>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a>        <span class="k">if</span> <span class="n">package_manager_query</span><span class="p">:</span>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a>                <span class="n">package_query</span> <span class="o">=</span> <span class="n">Command</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">package_manager_query</span><span class="p">)</span>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a>                <span class="k">if</span> <span class="n">package_query</span><span class="p">:</span>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a>                    <span class="n">package_version</span> <span class="o">=</span> <span class="n">package_query</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">issue</span><span class="p">:</span>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Package manager query failed with: </span><span class="si">{</span><span class="n">issue</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a>        <span class="k">return</span> <span class="n">package_version</span>
</span></pre></div>


            </section>
                <section id="dracut_module_type">
                    <div class="attr class">
            
    <span class="def">class</span>
    <span class="name">dracut_module_type</span><wbr>(<span class="base">builtins.tuple</span>):

        
    </div>
    <a class="headerlink" href="#dracut_module_type"></a>
    
            <div class="docstring"><p>dracut_module_type(package, min_version)</p>
</div>


                            <div id="dracut_module_type.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">dracut_module_type</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">package</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">min_version</span><span class="p">:</span> <span class="nb">str</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#dracut_module_type.__init__"></a>
    
            <div class="docstring"><p>Create new instance of dracut_module_type(package, min_version)</p>
</div>


                            </div>
                            <div id="dracut_module_type.package" class="classattr">
                                <div class="attr variable">
            <span class="name">package</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#dracut_module_type.package"></a>
    
            <div class="docstring"><p>Alias for field number 0</p>
</div>


                            </div>
                            <div id="dracut_module_type.min_version" class="classattr">
                                <div class="attr variable">
            <span class="name">min_version</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#dracut_module_type.min_version"></a>
    
            <div class="docstring"><p>Alias for field number 1</p>
</div>


                            </div>
                </section>
                <section id="log">
                    <div class="attr variable">
            <span class="name">log</span>        =
<span class="default_value">&lt;Logger kiwi (DEBUG)&gt;</span>

        
    </div>
    <a class="headerlink" href="#log"></a>
    
    

                </section>
                <section id="RuntimeChecker">
                            <input id="RuntimeChecker-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">RuntimeChecker</span>:

                <label class="view-source-button" for="RuntimeChecker-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RuntimeChecker"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RuntimeChecker-56"><a href="#RuntimeChecker-56"><span class="linenos">  56</span></a><span class="k">class</span><span class="w"> </span><span class="nc">RuntimeChecker</span><span class="p">:</span>
</span><span id="RuntimeChecker-57"><a href="#RuntimeChecker-57"><span class="linenos">  57</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-58"><a href="#RuntimeChecker-58"><span class="linenos">  58</span></a><span class="sd">    **Implements build consistency checks at runtime**</span>
</span><span id="RuntimeChecker-59"><a href="#RuntimeChecker-59"><span class="linenos">  59</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-60"><a href="#RuntimeChecker-60"><span class="linenos">  60</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xml_state</span><span class="p">:</span> <span class="n">XMLState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker-61"><a href="#RuntimeChecker-61"><span class="linenos">  61</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-62"><a href="#RuntimeChecker-62"><span class="linenos">  62</span></a><span class="sd">        The schema of an image description covers structure and syntax of</span>
</span><span id="RuntimeChecker-63"><a href="#RuntimeChecker-63"><span class="linenos">  63</span></a><span class="sd">        the provided data. The RuntimeChecker provides methods to perform</span>
</span><span id="RuntimeChecker-64"><a href="#RuntimeChecker-64"><span class="linenos">  64</span></a><span class="sd">        further semantic checks which allows to recognize potential build</span>
</span><span id="RuntimeChecker-65"><a href="#RuntimeChecker-65"><span class="linenos">  65</span></a><span class="sd">        or boot problems early.</span>
</span><span id="RuntimeChecker-66"><a href="#RuntimeChecker-66"><span class="linenos">  66</span></a>
</span><span id="RuntimeChecker-67"><a href="#RuntimeChecker-67"><span class="linenos">  67</span></a><span class="sd">        :param object xml_state: Instance of XMLState</span>
</span><span id="RuntimeChecker-68"><a href="#RuntimeChecker-68"><span class="linenos">  68</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-69"><a href="#RuntimeChecker-69"><span class="linenos">  69</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span> <span class="o">=</span> <span class="n">xml_state</span>
</span><span id="RuntimeChecker-70"><a href="#RuntimeChecker-70"><span class="linenos">  70</span></a>
</span><span id="RuntimeChecker-71"><a href="#RuntimeChecker-71"><span class="linenos">  71</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_repositories_configured</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker-72"><a href="#RuntimeChecker-72"><span class="linenos">  72</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-73"><a href="#RuntimeChecker-73"><span class="linenos">  73</span></a><span class="sd">        Verify that there are repositories configured</span>
</span><span id="RuntimeChecker-74"><a href="#RuntimeChecker-74"><span class="linenos">  74</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-75"><a href="#RuntimeChecker-75"><span class="linenos">  75</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_repository_sections</span><span class="p">():</span>
</span><span id="RuntimeChecker-76"><a href="#RuntimeChecker-76"><span class="linenos">  76</span></a>            <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker-77"><a href="#RuntimeChecker-77"><span class="linenos">  77</span></a>                <span class="s1">&#39;No repositories configured&#39;</span>
</span><span id="RuntimeChecker-78"><a href="#RuntimeChecker-78"><span class="linenos">  78</span></a>            <span class="p">)</span>
</span><span id="RuntimeChecker-79"><a href="#RuntimeChecker-79"><span class="linenos">  79</span></a>
</span><span id="RuntimeChecker-80"><a href="#RuntimeChecker-80"><span class="linenos">  80</span></a>    <span class="nd">@staticmethod</span>
</span><span id="RuntimeChecker-81"><a href="#RuntimeChecker-81"><span class="linenos">  81</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_target_dir_on_unsupported_filesystem</span><span class="p">(</span><span class="n">target_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker-82"><a href="#RuntimeChecker-82"><span class="linenos">  82</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-83"><a href="#RuntimeChecker-83"><span class="linenos">  83</span></a><span class="sd">        Raise if the given target dir does not reside on a</span>
</span><span id="RuntimeChecker-84"><a href="#RuntimeChecker-84"><span class="linenos">  84</span></a><span class="sd">        filesystem that supports all important features like</span>
</span><span id="RuntimeChecker-85"><a href="#RuntimeChecker-85"><span class="linenos">  85</span></a><span class="sd">        extended permissions(fscaps), ACLs or xattrs.</span>
</span><span id="RuntimeChecker-86"><a href="#RuntimeChecker-86"><span class="linenos">  86</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-87"><a href="#RuntimeChecker-87"><span class="linenos">  87</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker-88"><a href="#RuntimeChecker-88"><span class="linenos">  88</span></a><span class="s1">            Target root/image directory is lacking filesystem features</span>
</span><span id="RuntimeChecker-89"><a href="#RuntimeChecker-89"><span class="linenos">  89</span></a>
</span><span id="RuntimeChecker-90"><a href="#RuntimeChecker-90"><span class="linenos">  90</span></a><span class="s1">            The filesystem </span><span class="si">{0}</span><span class="s1"> in the target path </span><span class="si">{1}</span>
</span><span id="RuntimeChecker-91"><a href="#RuntimeChecker-91"><span class="linenos">  91</span></a><span class="s1">            does not support important features like extended permissions,</span>
</span><span id="RuntimeChecker-92"><a href="#RuntimeChecker-92"><span class="linenos">  92</span></a><span class="s1">            ACLs or xattrs. The image build may fail or the resulting</span>
</span><span id="RuntimeChecker-93"><a href="#RuntimeChecker-93"><span class="linenos">  93</span></a><span class="s1">            image misbehave.</span>
</span><span id="RuntimeChecker-94"><a href="#RuntimeChecker-94"><span class="linenos">  94</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker-95"><a href="#RuntimeChecker-95"><span class="linenos">  95</span></a>        <span class="n">target_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">first_exists</span><span class="p">(</span><span class="n">target_dir</span><span class="p">)</span>
</span><span id="RuntimeChecker-96"><a href="#RuntimeChecker-96"><span class="linenos">  96</span></a>        <span class="n">stat</span> <span class="o">=</span> <span class="n">Command</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;stat&#39;</span><span class="p">,</span> <span class="s1">&#39;-f&#39;</span><span class="p">,</span> <span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="s1">&#39;%T&#39;</span><span class="p">,</span> <span class="n">target_dir</span><span class="p">])</span>
</span><span id="RuntimeChecker-97"><a href="#RuntimeChecker-97"><span class="linenos">  97</span></a>        <span class="k">if</span> <span class="n">stat</span><span class="p">:</span>
</span><span id="RuntimeChecker-98"><a href="#RuntimeChecker-98"><span class="linenos">  98</span></a>            <span class="n">target_fs</span> <span class="o">=</span> <span class="n">stat</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="RuntimeChecker-99"><a href="#RuntimeChecker-99"><span class="linenos">  99</span></a>            <span class="n">supported_target_filesystem</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="RuntimeChecker-100"><a href="#RuntimeChecker-100"><span class="linenos"> 100</span></a>                <span class="s1">&#39;btrfs&#39;</span><span class="p">,</span>
</span><span id="RuntimeChecker-101"><a href="#RuntimeChecker-101"><span class="linenos"> 101</span></a>                <span class="s1">&#39;ext2&#39;</span><span class="p">,</span>
</span><span id="RuntimeChecker-102"><a href="#RuntimeChecker-102"><span class="linenos"> 102</span></a>                <span class="s1">&#39;ext2/ext3&#39;</span><span class="p">,</span>
</span><span id="RuntimeChecker-103"><a href="#RuntimeChecker-103"><span class="linenos"> 103</span></a>                <span class="s1">&#39;ext3&#39;</span><span class="p">,</span>
</span><span id="RuntimeChecker-104"><a href="#RuntimeChecker-104"><span class="linenos"> 104</span></a>                <span class="s1">&#39;ext4&#39;</span><span class="p">,</span>
</span><span id="RuntimeChecker-105"><a href="#RuntimeChecker-105"><span class="linenos"> 105</span></a>                <span class="s1">&#39;overlayfs&#39;</span><span class="p">,</span>
</span><span id="RuntimeChecker-106"><a href="#RuntimeChecker-106"><span class="linenos"> 106</span></a>                <span class="s1">&#39;tmpfs&#39;</span><span class="p">,</span>
</span><span id="RuntimeChecker-107"><a href="#RuntimeChecker-107"><span class="linenos"> 107</span></a>                <span class="s1">&#39;xfs&#39;</span><span class="p">,</span>
</span><span id="RuntimeChecker-108"><a href="#RuntimeChecker-108"><span class="linenos"> 108</span></a>            <span class="p">)</span>
</span><span id="RuntimeChecker-109"><a href="#RuntimeChecker-109"><span class="linenos"> 109</span></a>            <span class="k">if</span> <span class="n">target_fs</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">supported_target_filesystem</span><span class="p">:</span>
</span><span id="RuntimeChecker-110"><a href="#RuntimeChecker-110"><span class="linenos"> 110</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">target_fs</span><span class="p">,</span> <span class="n">target_dir</span><span class="p">))</span>
</span><span id="RuntimeChecker-111"><a href="#RuntimeChecker-111"><span class="linenos"> 111</span></a>
</span><span id="RuntimeChecker-112"><a href="#RuntimeChecker-112"><span class="linenos"> 112</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_include_references_unresolvable</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker-113"><a href="#RuntimeChecker-113"><span class="linenos"> 113</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-114"><a href="#RuntimeChecker-114"><span class="linenos"> 114</span></a><span class="sd">        Raise for still included &lt;include&gt; statements as not resolvable.</span>
</span><span id="RuntimeChecker-115"><a href="#RuntimeChecker-115"><span class="linenos"> 115</span></a><span class="sd">        The KIWI XSLT processing replaces the specified include</span>
</span><span id="RuntimeChecker-116"><a href="#RuntimeChecker-116"><span class="linenos"> 116</span></a><span class="sd">        directive(s) with the given file reference(s). If this action</span>
</span><span id="RuntimeChecker-117"><a href="#RuntimeChecker-117"><span class="linenos"> 117</span></a><span class="sd">        did not happen for example on nested includes, it can happen</span>
</span><span id="RuntimeChecker-118"><a href="#RuntimeChecker-118"><span class="linenos"> 118</span></a><span class="sd">        that they stay in the document as sort of waste.</span>
</span><span id="RuntimeChecker-119"><a href="#RuntimeChecker-119"><span class="linenos"> 119</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-120"><a href="#RuntimeChecker-120"><span class="linenos"> 120</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker-121"><a href="#RuntimeChecker-121"><span class="linenos"> 121</span></a><span class="s1">            One ore more &lt;include&gt; statements are unresolvable</span>
</span><span id="RuntimeChecker-122"><a href="#RuntimeChecker-122"><span class="linenos"> 122</span></a>
</span><span id="RuntimeChecker-123"><a href="#RuntimeChecker-123"><span class="linenos"> 123</span></a><span class="s1">            The following include references could not be resolved.</span>
</span><span id="RuntimeChecker-124"><a href="#RuntimeChecker-124"><span class="linenos"> 124</span></a><span class="s1">            Please verify the specified location(s) and/or delete</span>
</span><span id="RuntimeChecker-125"><a href="#RuntimeChecker-125"><span class="linenos"> 125</span></a><span class="s1">            the broken include directive(s) from the description.</span>
</span><span id="RuntimeChecker-126"><a href="#RuntimeChecker-126"><span class="linenos"> 126</span></a><span class="s1">            Please also note, nested includes from other include</span>
</span><span id="RuntimeChecker-127"><a href="#RuntimeChecker-127"><span class="linenos"> 127</span></a><span class="s1">            files are not supported:</span>
</span><span id="RuntimeChecker-128"><a href="#RuntimeChecker-128"><span class="linenos"> 128</span></a>
</span><span id="RuntimeChecker-129"><a href="#RuntimeChecker-129"><span class="linenos"> 129</span></a><span class="s1">            </span><span class="si">{0}</span>
</span><span id="RuntimeChecker-130"><a href="#RuntimeChecker-130"><span class="linenos"> 130</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker-131"><a href="#RuntimeChecker-131"><span class="linenos"> 131</span></a>        <span class="n">include_files</span> <span class="o">=</span> \
</span><span id="RuntimeChecker-132"><a href="#RuntimeChecker-132"><span class="linenos"> 132</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_include_section_reference_file_names</span><span class="p">()</span>
</span><span id="RuntimeChecker-133"><a href="#RuntimeChecker-133"><span class="linenos"> 133</span></a>        <span class="k">if</span> <span class="n">include_files</span><span class="p">:</span>
</span><span id="RuntimeChecker-134"><a href="#RuntimeChecker-134"><span class="linenos"> 134</span></a>            <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker-135"><a href="#RuntimeChecker-135"><span class="linenos"> 135</span></a>                <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">include_files</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
</span><span id="RuntimeChecker-136"><a href="#RuntimeChecker-136"><span class="linenos"> 136</span></a>            <span class="p">)</span>
</span><span id="RuntimeChecker-137"><a href="#RuntimeChecker-137"><span class="linenos"> 137</span></a>
</span><span id="RuntimeChecker-138"><a href="#RuntimeChecker-138"><span class="linenos"> 138</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_image_include_repos_publicly_resolvable</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker-139"><a href="#RuntimeChecker-139"><span class="linenos"> 139</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-140"><a href="#RuntimeChecker-140"><span class="linenos"> 140</span></a><span class="sd">        Verify that all repos marked with the imageinclude attribute</span>
</span><span id="RuntimeChecker-141"><a href="#RuntimeChecker-141"><span class="linenos"> 141</span></a><span class="sd">        can be resolved into a http based web URL</span>
</span><span id="RuntimeChecker-142"><a href="#RuntimeChecker-142"><span class="linenos"> 142</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-143"><a href="#RuntimeChecker-143"><span class="linenos"> 143</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker-144"><a href="#RuntimeChecker-144"><span class="linenos"> 144</span></a><span class="s1">            The use of imageinclude=&quot;true&quot; in the repository definition</span>
</span><span id="RuntimeChecker-145"><a href="#RuntimeChecker-145"><span class="linenos"> 145</span></a><span class="s1">            for the Repository: </span><span class="si">{0}</span>
</span><span id="RuntimeChecker-146"><a href="#RuntimeChecker-146"><span class="linenos"> 146</span></a><span class="s1">            requires the repository to by publicly available. The source</span>
</span><span id="RuntimeChecker-147"><a href="#RuntimeChecker-147"><span class="linenos"> 147</span></a><span class="s1">            locator of the repository however indicates it is private to</span>
</span><span id="RuntimeChecker-148"><a href="#RuntimeChecker-148"><span class="linenos"> 148</span></a><span class="s1">            your local system. Therefore it can&#39;t be included into the</span>
</span><span id="RuntimeChecker-149"><a href="#RuntimeChecker-149"><span class="linenos"> 149</span></a><span class="s1">            system image repository configuration. Please define a publicly</span>
</span><span id="RuntimeChecker-150"><a href="#RuntimeChecker-150"><span class="linenos"> 150</span></a><span class="s1">            available repository in your image XML description.</span>
</span><span id="RuntimeChecker-151"><a href="#RuntimeChecker-151"><span class="linenos"> 151</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker-152"><a href="#RuntimeChecker-152"><span class="linenos"> 152</span></a>
</span><span id="RuntimeChecker-153"><a href="#RuntimeChecker-153"><span class="linenos"> 153</span></a>        <span class="n">repository_sections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_repository_sections</span><span class="p">()</span>
</span><span id="RuntimeChecker-154"><a href="#RuntimeChecker-154"><span class="linenos"> 154</span></a>        <span class="k">for</span> <span class="n">xml_repo</span> <span class="ow">in</span> <span class="n">repository_sections</span><span class="p">:</span>
</span><span id="RuntimeChecker-155"><a href="#RuntimeChecker-155"><span class="linenos"> 155</span></a>            <span class="n">repo_marked_for_image_include</span> <span class="o">=</span> <span class="n">xml_repo</span><span class="o">.</span><span class="n">get_imageinclude</span><span class="p">()</span>
</span><span id="RuntimeChecker-156"><a href="#RuntimeChecker-156"><span class="linenos"> 156</span></a>
</span><span id="RuntimeChecker-157"><a href="#RuntimeChecker-157"><span class="linenos"> 157</span></a>            <span class="k">if</span> <span class="n">repo_marked_for_image_include</span><span class="p">:</span>
</span><span id="RuntimeChecker-158"><a href="#RuntimeChecker-158"><span class="linenos"> 158</span></a>                <span class="n">repo_source</span> <span class="o">=</span> <span class="n">xml_repo</span><span class="o">.</span><span class="n">get_source</span><span class="p">()</span><span class="o">.</span><span class="n">get_path</span><span class="p">()</span>
</span><span id="RuntimeChecker-159"><a href="#RuntimeChecker-159"><span class="linenos"> 159</span></a>                <span class="n">repo_type</span> <span class="o">=</span> <span class="n">xml_repo</span><span class="o">.</span><span class="n">get_type</span><span class="p">()</span>
</span><span id="RuntimeChecker-160"><a href="#RuntimeChecker-160"><span class="linenos"> 160</span></a>                <span class="n">uri</span> <span class="o">=</span> <span class="n">Uri</span><span class="p">(</span><span class="n">repo_source</span><span class="p">,</span> <span class="n">repo_type</span><span class="p">)</span>
</span><span id="RuntimeChecker-161"><a href="#RuntimeChecker-161"><span class="linenos"> 161</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">uri</span><span class="o">.</span><span class="n">is_public</span><span class="p">():</span>
</span><span id="RuntimeChecker-162"><a href="#RuntimeChecker-162"><span class="linenos"> 162</span></a>                    <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker-163"><a href="#RuntimeChecker-163"><span class="linenos"> 163</span></a>                        <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">repo_source</span><span class="p">)</span>
</span><span id="RuntimeChecker-164"><a href="#RuntimeChecker-164"><span class="linenos"> 164</span></a>                    <span class="p">)</span>
</span><span id="RuntimeChecker-165"><a href="#RuntimeChecker-165"><span class="linenos"> 165</span></a>
</span><span id="RuntimeChecker-166"><a href="#RuntimeChecker-166"><span class="linenos"> 166</span></a>    <span class="nd">@staticmethod</span>
</span><span id="RuntimeChecker-167"><a href="#RuntimeChecker-167"><span class="linenos"> 167</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_target_directory_not_in_shared_cache</span><span class="p">(</span><span class="n">target_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker-168"><a href="#RuntimeChecker-168"><span class="linenos"> 168</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-169"><a href="#RuntimeChecker-169"><span class="linenos"> 169</span></a><span class="sd">        The target directory must be outside of the kiwi shared cache</span>
</span><span id="RuntimeChecker-170"><a href="#RuntimeChecker-170"><span class="linenos"> 170</span></a><span class="sd">        directory in order to avoid busy mounts because kiwi bind mounts</span>
</span><span id="RuntimeChecker-171"><a href="#RuntimeChecker-171"><span class="linenos"> 171</span></a><span class="sd">        the cache directory into the image root tree to access host</span>
</span><span id="RuntimeChecker-172"><a href="#RuntimeChecker-172"><span class="linenos"> 172</span></a><span class="sd">        caching information</span>
</span><span id="RuntimeChecker-173"><a href="#RuntimeChecker-173"><span class="linenos"> 173</span></a>
</span><span id="RuntimeChecker-174"><a href="#RuntimeChecker-174"><span class="linenos"> 174</span></a><span class="sd">        :param string target_dir: path name</span>
</span><span id="RuntimeChecker-175"><a href="#RuntimeChecker-175"><span class="linenos"> 175</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-176"><a href="#RuntimeChecker-176"><span class="linenos"> 176</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker-177"><a href="#RuntimeChecker-177"><span class="linenos"> 177</span></a><span class="s1">            Target directory </span><span class="si">%s</span><span class="s1"> conflicts with kiwi&#39;s shared cache</span>
</span><span id="RuntimeChecker-178"><a href="#RuntimeChecker-178"><span class="linenos"> 178</span></a><span class="s1">            directory </span><span class="si">%s</span><span class="s1">. This is going to create a busy loop mount.</span>
</span><span id="RuntimeChecker-179"><a href="#RuntimeChecker-179"><span class="linenos"> 179</span></a><span class="s1">            Please choose another target directory.</span>
</span><span id="RuntimeChecker-180"><a href="#RuntimeChecker-180"><span class="linenos"> 180</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker-181"><a href="#RuntimeChecker-181"><span class="linenos"> 181</span></a>
</span><span id="RuntimeChecker-182"><a href="#RuntimeChecker-182"><span class="linenos"> 182</span></a>        <span class="n">shared_cache_location</span> <span class="o">=</span> <span class="n">Defaults</span><span class="o">.</span><span class="n">get_shared_cache_location</span><span class="p">()</span>
</span><span id="RuntimeChecker-183"><a href="#RuntimeChecker-183"><span class="linenos"> 183</span></a>
</span><span id="RuntimeChecker-184"><a href="#RuntimeChecker-184"><span class="linenos"> 184</span></a>        <span class="n">target_dir_stack</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span>
</span><span id="RuntimeChecker-185"><a href="#RuntimeChecker-185"><span class="linenos"> 185</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">target_dir</span><span class="p">)</span>
</span><span id="RuntimeChecker-186"><a href="#RuntimeChecker-186"><span class="linenos"> 186</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="RuntimeChecker-187"><a href="#RuntimeChecker-187"><span class="linenos"> 187</span></a>        <span class="k">if</span> <span class="n">target_dir_stack</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="n">shared_cache_location</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">):</span>
</span><span id="RuntimeChecker-188"><a href="#RuntimeChecker-188"><span class="linenos"> 188</span></a>            <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker-189"><a href="#RuntimeChecker-189"><span class="linenos"> 189</span></a>                <span class="n">message</span> <span class="o">%</span> <span class="p">(</span><span class="n">target_dir</span><span class="p">,</span> <span class="n">shared_cache_location</span><span class="p">)</span>
</span><span id="RuntimeChecker-190"><a href="#RuntimeChecker-190"><span class="linenos"> 190</span></a>            <span class="p">)</span>
</span><span id="RuntimeChecker-191"><a href="#RuntimeChecker-191"><span class="linenos"> 191</span></a>
</span><span id="RuntimeChecker-192"><a href="#RuntimeChecker-192"><span class="linenos"> 192</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_volume_label_used_with_lvm</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker-193"><a href="#RuntimeChecker-193"><span class="linenos"> 193</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-194"><a href="#RuntimeChecker-194"><span class="linenos"> 194</span></a><span class="sd">        The optional volume label in a systemdisk setup is only</span>
</span><span id="RuntimeChecker-195"><a href="#RuntimeChecker-195"><span class="linenos"> 195</span></a><span class="sd">        effective if the LVM, logical volume manager system is</span>
</span><span id="RuntimeChecker-196"><a href="#RuntimeChecker-196"><span class="linenos"> 196</span></a><span class="sd">        used. In any other case where the filesystem itself offers</span>
</span><span id="RuntimeChecker-197"><a href="#RuntimeChecker-197"><span class="linenos"> 197</span></a><span class="sd">        volume management capabilities there are no extra filesystem</span>
</span><span id="RuntimeChecker-198"><a href="#RuntimeChecker-198"><span class="linenos"> 198</span></a><span class="sd">        labels which can be applied per volume</span>
</span><span id="RuntimeChecker-199"><a href="#RuntimeChecker-199"><span class="linenos"> 199</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-200"><a href="#RuntimeChecker-200"><span class="linenos"> 200</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker-201"><a href="#RuntimeChecker-201"><span class="linenos"> 201</span></a><span class="s1">            Custom volume label setup used without LVM</span>
</span><span id="RuntimeChecker-202"><a href="#RuntimeChecker-202"><span class="linenos"> 202</span></a>
</span><span id="RuntimeChecker-203"><a href="#RuntimeChecker-203"><span class="linenos"> 203</span></a><span class="s1">            The optional volume label in a systemdisk setup is only</span>
</span><span id="RuntimeChecker-204"><a href="#RuntimeChecker-204"><span class="linenos"> 204</span></a><span class="s1">            effective if the LVM, logical volume manager system is</span>
</span><span id="RuntimeChecker-205"><a href="#RuntimeChecker-205"><span class="linenos"> 205</span></a><span class="s1">            used. Your setup uses the </span><span class="si">{0}</span><span class="s1"> filesystem which itself</span>
</span><span id="RuntimeChecker-206"><a href="#RuntimeChecker-206"><span class="linenos"> 206</span></a><span class="s1">            offers volume management capabilities. Extra filesystem</span>
</span><span id="RuntimeChecker-207"><a href="#RuntimeChecker-207"><span class="linenos"> 207</span></a><span class="s1">            labels cannot be applied in this case.</span>
</span><span id="RuntimeChecker-208"><a href="#RuntimeChecker-208"><span class="linenos"> 208</span></a>
</span><span id="RuntimeChecker-209"><a href="#RuntimeChecker-209"><span class="linenos"> 209</span></a><span class="s1">            If you want to force LVM over the </span><span class="si">{0}</span><span class="s1"> volume management</span>
</span><span id="RuntimeChecker-210"><a href="#RuntimeChecker-210"><span class="linenos"> 210</span></a><span class="s1">            system you can do so by specifying the following in</span>
</span><span id="RuntimeChecker-211"><a href="#RuntimeChecker-211"><span class="linenos"> 211</span></a><span class="s1">            your KIWI XML description:</span>
</span><span id="RuntimeChecker-212"><a href="#RuntimeChecker-212"><span class="linenos"> 212</span></a>
</span><span id="RuntimeChecker-213"><a href="#RuntimeChecker-213"><span class="linenos"> 213</span></a><span class="s1">            &lt;systemdisk ... preferlvm=&quot;true&quot;&gt;</span>
</span><span id="RuntimeChecker-214"><a href="#RuntimeChecker-214"><span class="linenos"> 214</span></a><span class="s1">                &lt;volume .../&gt;</span>
</span><span id="RuntimeChecker-215"><a href="#RuntimeChecker-215"><span class="linenos"> 215</span></a><span class="s1">            &lt;/systemdisk&gt;</span>
</span><span id="RuntimeChecker-216"><a href="#RuntimeChecker-216"><span class="linenos"> 216</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker-217"><a href="#RuntimeChecker-217"><span class="linenos"> 217</span></a>        <span class="n">volume_management</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_volume_management</span><span class="p">()</span>
</span><span id="RuntimeChecker-218"><a href="#RuntimeChecker-218"><span class="linenos"> 218</span></a>        <span class="k">if</span> <span class="n">volume_management</span> <span class="o">!=</span> <span class="s1">&#39;lvm&#39;</span><span class="p">:</span>
</span><span id="RuntimeChecker-219"><a href="#RuntimeChecker-219"><span class="linenos"> 219</span></a>            <span class="k">for</span> <span class="n">volume</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_volumes</span><span class="p">():</span>
</span><span id="RuntimeChecker-220"><a href="#RuntimeChecker-220"><span class="linenos"> 220</span></a>                <span class="k">if</span> <span class="n">volume</span><span class="o">.</span><span class="n">label</span> <span class="ow">and</span> <span class="n">volume</span><span class="o">.</span><span class="n">label</span> <span class="o">!=</span> <span class="s1">&#39;SWAP&#39;</span><span class="p">:</span>
</span><span id="RuntimeChecker-221"><a href="#RuntimeChecker-221"><span class="linenos"> 221</span></a>                    <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker-222"><a href="#RuntimeChecker-222"><span class="linenos"> 222</span></a>                        <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">volume_management</span><span class="p">)</span>
</span><span id="RuntimeChecker-223"><a href="#RuntimeChecker-223"><span class="linenos"> 223</span></a>                    <span class="p">)</span>
</span><span id="RuntimeChecker-224"><a href="#RuntimeChecker-224"><span class="linenos"> 224</span></a>
</span><span id="RuntimeChecker-225"><a href="#RuntimeChecker-225"><span class="linenos"> 225</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_partuuid_persistency_type_used_with_mbr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker-226"><a href="#RuntimeChecker-226"><span class="linenos"> 226</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-227"><a href="#RuntimeChecker-227"><span class="linenos"> 227</span></a><span class="sd">        The devicepersistency setting by-partuuid can only be</span>
</span><span id="RuntimeChecker-228"><a href="#RuntimeChecker-228"><span class="linenos"> 228</span></a><span class="sd">        used in combination with a partition table type that</span>
</span><span id="RuntimeChecker-229"><a href="#RuntimeChecker-229"><span class="linenos"> 229</span></a><span class="sd">        supports UUIDs. In any other case Linux creates artificial</span>
</span><span id="RuntimeChecker-230"><a href="#RuntimeChecker-230"><span class="linenos"> 230</span></a><span class="sd">        values for PTUUID and PARTUUID from the disk signature</span>
</span><span id="RuntimeChecker-231"><a href="#RuntimeChecker-231"><span class="linenos"> 231</span></a><span class="sd">        which can change without touching the actual partition</span>
</span><span id="RuntimeChecker-232"><a href="#RuntimeChecker-232"><span class="linenos"> 232</span></a><span class="sd">        table. We consider this unsafe and only allow the use</span>
</span><span id="RuntimeChecker-233"><a href="#RuntimeChecker-233"><span class="linenos"> 233</span></a><span class="sd">        of by-partuuid in combination with partition tables that</span>
</span><span id="RuntimeChecker-234"><a href="#RuntimeChecker-234"><span class="linenos"> 234</span></a><span class="sd">        actually supports it properly.</span>
</span><span id="RuntimeChecker-235"><a href="#RuntimeChecker-235"><span class="linenos"> 235</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-236"><a href="#RuntimeChecker-236"><span class="linenos"> 236</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker-237"><a href="#RuntimeChecker-237"><span class="linenos"> 237</span></a><span class="s1">            devicepersistency=</span><span class="si">{0!r}</span><span class="s1"> used with non UUID capable partition table</span>
</span><span id="RuntimeChecker-238"><a href="#RuntimeChecker-238"><span class="linenos"> 238</span></a>
</span><span id="RuntimeChecker-239"><a href="#RuntimeChecker-239"><span class="linenos"> 239</span></a><span class="s1">            PTUUID and PARTUUID exists in the GUID (GPT) partition table.</span>
</span><span id="RuntimeChecker-240"><a href="#RuntimeChecker-240"><span class="linenos"> 240</span></a><span class="s1">            According to the firmware setting: </span><span class="si">{1!r}</span><span class="s1">, the selected partition</span>
</span><span id="RuntimeChecker-241"><a href="#RuntimeChecker-241"><span class="linenos"> 241</span></a><span class="s1">            table type is: </span><span class="si">{2!r}</span><span class="s1">. This table type does not natively support</span>
</span><span id="RuntimeChecker-242"><a href="#RuntimeChecker-242"><span class="linenos"> 242</span></a><span class="s1">            UUIDs. In such a case Linux creates artificial values for PTUUID</span>
</span><span id="RuntimeChecker-243"><a href="#RuntimeChecker-243"><span class="linenos"> 243</span></a><span class="s1">            and PARTUUID from the disk signature which can change without</span>
</span><span id="RuntimeChecker-244"><a href="#RuntimeChecker-244"><span class="linenos"> 244</span></a><span class="s1">            touching the actual partition table. This is considered unsafe</span>
</span><span id="RuntimeChecker-245"><a href="#RuntimeChecker-245"><span class="linenos"> 245</span></a><span class="s1">            and KIWI only allows the use of by-partuuid in combination with</span>
</span><span id="RuntimeChecker-246"><a href="#RuntimeChecker-246"><span class="linenos"> 246</span></a><span class="s1">            partition tables that actually supports UUIDs properly.</span>
</span><span id="RuntimeChecker-247"><a href="#RuntimeChecker-247"><span class="linenos"> 247</span></a>
</span><span id="RuntimeChecker-248"><a href="#RuntimeChecker-248"><span class="linenos"> 248</span></a><span class="s1">            Please make sure to use one of the following firmware settings</span>
</span><span id="RuntimeChecker-249"><a href="#RuntimeChecker-249"><span class="linenos"> 249</span></a><span class="s1">            which leads to an image using an UUID capable partition table</span>
</span><span id="RuntimeChecker-250"><a href="#RuntimeChecker-250"><span class="linenos"> 250</span></a><span class="s1">            and therefore supporting consistent by-partuuid device names:</span>
</span><span id="RuntimeChecker-251"><a href="#RuntimeChecker-251"><span class="linenos"> 251</span></a>
</span><span id="RuntimeChecker-252"><a href="#RuntimeChecker-252"><span class="linenos"> 252</span></a><span class="s1">            &lt;type ... firmware=&quot;efi|uefi&quot;&gt;</span>
</span><span id="RuntimeChecker-253"><a href="#RuntimeChecker-253"><span class="linenos"> 253</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker-254"><a href="#RuntimeChecker-254"><span class="linenos"> 254</span></a>        <span class="n">persistency_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_devicepersistency</span><span class="p">()</span>
</span><span id="RuntimeChecker-255"><a href="#RuntimeChecker-255"><span class="linenos"> 255</span></a>        <span class="k">if</span> <span class="n">persistency_type</span> <span class="ow">and</span> <span class="n">persistency_type</span> <span class="o">==</span> <span class="s1">&#39;by-partuuid&#39;</span><span class="p">:</span>
</span><span id="RuntimeChecker-256"><a href="#RuntimeChecker-256"><span class="linenos"> 256</span></a>            <span class="n">supported_table_types</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;gpt&#39;</span><span class="p">]</span>
</span><span id="RuntimeChecker-257"><a href="#RuntimeChecker-257"><span class="linenos"> 257</span></a>            <span class="n">firmware</span> <span class="o">=</span> <span class="n">FirmWare</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="p">)</span>
</span><span id="RuntimeChecker-258"><a href="#RuntimeChecker-258"><span class="linenos"> 258</span></a>            <span class="n">table_type</span> <span class="o">=</span> <span class="n">firmware</span><span class="o">.</span><span class="n">get_partition_table_type</span><span class="p">()</span>
</span><span id="RuntimeChecker-259"><a href="#RuntimeChecker-259"><span class="linenos"> 259</span></a>            <span class="k">if</span> <span class="n">table_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">supported_table_types</span><span class="p">:</span>
</span><span id="RuntimeChecker-260"><a href="#RuntimeChecker-260"><span class="linenos"> 260</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker-261"><a href="#RuntimeChecker-261"><span class="linenos"> 261</span></a>                    <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="RuntimeChecker-262"><a href="#RuntimeChecker-262"><span class="linenos"> 262</span></a>                        <span class="n">persistency_type</span><span class="p">,</span> <span class="n">firmware</span><span class="o">.</span><span class="n">firmware</span><span class="p">,</span> <span class="n">table_type</span>
</span><span id="RuntimeChecker-263"><a href="#RuntimeChecker-263"><span class="linenos"> 263</span></a>                    <span class="p">)</span>
</span><span id="RuntimeChecker-264"><a href="#RuntimeChecker-264"><span class="linenos"> 264</span></a>                <span class="p">)</span>
</span><span id="RuntimeChecker-265"><a href="#RuntimeChecker-265"><span class="linenos"> 265</span></a>
</span><span id="RuntimeChecker-266"><a href="#RuntimeChecker-266"><span class="linenos"> 266</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_swap_name_used_with_lvm</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker-267"><a href="#RuntimeChecker-267"><span class="linenos"> 267</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-268"><a href="#RuntimeChecker-268"><span class="linenos"> 268</span></a><span class="sd">        The optional oem-swapname is only effective if used together</span>
</span><span id="RuntimeChecker-269"><a href="#RuntimeChecker-269"><span class="linenos"> 269</span></a><span class="sd">        with the LVM volume manager. A name for the swap space can</span>
</span><span id="RuntimeChecker-270"><a href="#RuntimeChecker-270"><span class="linenos"> 270</span></a><span class="sd">        only be set if it is created as a LVM volume. In any other</span>
</span><span id="RuntimeChecker-271"><a href="#RuntimeChecker-271"><span class="linenos"> 271</span></a><span class="sd">        case the name does not apply to the system</span>
</span><span id="RuntimeChecker-272"><a href="#RuntimeChecker-272"><span class="linenos"> 272</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-273"><a href="#RuntimeChecker-273"><span class="linenos"> 273</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker-274"><a href="#RuntimeChecker-274"><span class="linenos"> 274</span></a><span class="s1">             Specified swap space name: </span><span class="si">{0}</span><span class="s1"> will not be used</span>
</span><span id="RuntimeChecker-275"><a href="#RuntimeChecker-275"><span class="linenos"> 275</span></a>
</span><span id="RuntimeChecker-276"><a href="#RuntimeChecker-276"><span class="linenos"> 276</span></a><span class="s1">             The specified oem-swapname is used without the LVM volume</span>
</span><span id="RuntimeChecker-277"><a href="#RuntimeChecker-277"><span class="linenos"> 277</span></a><span class="s1">             manager. This means the swap space will be created as simple</span>
</span><span id="RuntimeChecker-278"><a href="#RuntimeChecker-278"><span class="linenos"> 278</span></a><span class="s1">             partition for which no name assignment can take place.</span>
</span><span id="RuntimeChecker-279"><a href="#RuntimeChecker-279"><span class="linenos"> 279</span></a><span class="s1">             The name specified in oem-swapname is used to give the</span>
</span><span id="RuntimeChecker-280"><a href="#RuntimeChecker-280"><span class="linenos"> 280</span></a><span class="s1">             LVM swap volume a name. Outside of LVM the setting is</span>
</span><span id="RuntimeChecker-281"><a href="#RuntimeChecker-281"><span class="linenos"> 281</span></a><span class="s1">             meaningless and should be removed.</span>
</span><span id="RuntimeChecker-282"><a href="#RuntimeChecker-282"><span class="linenos"> 282</span></a>
</span><span id="RuntimeChecker-283"><a href="#RuntimeChecker-283"><span class="linenos"> 283</span></a><span class="s1">             Please delete the following setting from your image</span>
</span><span id="RuntimeChecker-284"><a href="#RuntimeChecker-284"><span class="linenos"> 284</span></a><span class="s1">             description:</span>
</span><span id="RuntimeChecker-285"><a href="#RuntimeChecker-285"><span class="linenos"> 285</span></a>
</span><span id="RuntimeChecker-286"><a href="#RuntimeChecker-286"><span class="linenos"> 286</span></a><span class="s1">             &lt;oem-swapname&gt;</span><span class="si">{0}</span><span class="s1">&lt;/oem-swapname&gt;</span>
</span><span id="RuntimeChecker-287"><a href="#RuntimeChecker-287"><span class="linenos"> 287</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker-288"><a href="#RuntimeChecker-288"><span class="linenos"> 288</span></a>        <span class="n">volume_management</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_volume_management</span><span class="p">()</span>
</span><span id="RuntimeChecker-289"><a href="#RuntimeChecker-289"><span class="linenos"> 289</span></a>        <span class="k">if</span> <span class="n">volume_management</span> <span class="o">!=</span> <span class="s1">&#39;lvm&#39;</span><span class="p">:</span>
</span><span id="RuntimeChecker-290"><a href="#RuntimeChecker-290"><span class="linenos"> 290</span></a>            <span class="n">oemconfig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_build_type_oemconfig_section</span><span class="p">()</span>
</span><span id="RuntimeChecker-291"><a href="#RuntimeChecker-291"><span class="linenos"> 291</span></a>            <span class="k">if</span> <span class="n">oemconfig</span> <span class="ow">and</span> <span class="n">oemconfig</span><span class="o">.</span><span class="n">get_oem_swapname</span><span class="p">():</span>
</span><span id="RuntimeChecker-292"><a href="#RuntimeChecker-292"><span class="linenos"> 292</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker-293"><a href="#RuntimeChecker-293"><span class="linenos"> 293</span></a>                    <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">oemconfig</span><span class="o">.</span><span class="n">get_oem_swapname</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="RuntimeChecker-294"><a href="#RuntimeChecker-294"><span class="linenos"> 294</span></a>                <span class="p">)</span>
</span><span id="RuntimeChecker-295"><a href="#RuntimeChecker-295"><span class="linenos"> 295</span></a>
</span><span id="RuntimeChecker-296"><a href="#RuntimeChecker-296"><span class="linenos"> 296</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_volume_setup_defines_reserved_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker-297"><a href="#RuntimeChecker-297"><span class="linenos"> 297</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker-298"><a href="#RuntimeChecker-298"><span class="linenos"> 298</span></a><span class="s1">            Reserved label name used in LVM volume setup</span>
</span><span id="RuntimeChecker-299"><a href="#RuntimeChecker-299"><span class="linenos"> 299</span></a>
</span><span id="RuntimeChecker-300"><a href="#RuntimeChecker-300"><span class="linenos"> 300</span></a><span class="s1">            The label setup for volume </span><span class="si">{0}</span><span class="s1"> uses the reserved label </span><span class="si">{1}</span><span class="s1">.</span>
</span><span id="RuntimeChecker-301"><a href="#RuntimeChecker-301"><span class="linenos"> 301</span></a><span class="s1">            Reserved labels used by KIWI internally are </span><span class="si">{2}</span><span class="s1">. Please</span>
</span><span id="RuntimeChecker-302"><a href="#RuntimeChecker-302"><span class="linenos"> 302</span></a><span class="s1">            choose another label name for this volume.</span>
</span><span id="RuntimeChecker-303"><a href="#RuntimeChecker-303"><span class="linenos"> 303</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker-304"><a href="#RuntimeChecker-304"><span class="linenos"> 304</span></a>        <span class="n">reserved_labels</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="RuntimeChecker-305"><a href="#RuntimeChecker-305"><span class="linenos"> 305</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_rootfs_label</span><span class="p">()</span> <span class="ow">or</span> <span class="s1">&#39;ROOT&#39;</span><span class="p">,</span>
</span><span id="RuntimeChecker-306"><a href="#RuntimeChecker-306"><span class="linenos"> 306</span></a>            <span class="s1">&#39;SWAP&#39;</span><span class="p">,</span> <span class="s1">&#39;SPARE&#39;</span>
</span><span id="RuntimeChecker-307"><a href="#RuntimeChecker-307"><span class="linenos"> 307</span></a>        <span class="p">]</span>
</span><span id="RuntimeChecker-308"><a href="#RuntimeChecker-308"><span class="linenos"> 308</span></a>        <span class="n">volume_management</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_volume_management</span><span class="p">()</span>
</span><span id="RuntimeChecker-309"><a href="#RuntimeChecker-309"><span class="linenos"> 309</span></a>        <span class="k">if</span> <span class="n">volume_management</span> <span class="o">==</span> <span class="s1">&#39;lvm&#39;</span><span class="p">:</span>
</span><span id="RuntimeChecker-310"><a href="#RuntimeChecker-310"><span class="linenos"> 310</span></a>            <span class="k">for</span> <span class="n">volume</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_volumes</span><span class="p">():</span>
</span><span id="RuntimeChecker-311"><a href="#RuntimeChecker-311"><span class="linenos"> 311</span></a>                <span class="c1"># A swap volume is created implicitly if oem-swap is</span>
</span><span id="RuntimeChecker-312"><a href="#RuntimeChecker-312"><span class="linenos"> 312</span></a>                <span class="c1"># requested. This volume detected via realpath set to</span>
</span><span id="RuntimeChecker-313"><a href="#RuntimeChecker-313"><span class="linenos"> 313</span></a>                <span class="c1"># swap is skipped from the reserved label check as it</span>
</span><span id="RuntimeChecker-314"><a href="#RuntimeChecker-314"><span class="linenos"> 314</span></a>                <span class="c1"># intentionally uses the reserved label named SWAP</span>
</span><span id="RuntimeChecker-315"><a href="#RuntimeChecker-315"><span class="linenos"> 315</span></a>                <span class="k">if</span> <span class="n">volume</span><span class="o">.</span><span class="n">realpath</span> <span class="o">!=</span> <span class="s1">&#39;swap&#39;</span><span class="p">:</span>
</span><span id="RuntimeChecker-316"><a href="#RuntimeChecker-316"><span class="linenos"> 316</span></a>                    <span class="k">if</span> <span class="n">volume</span><span class="o">.</span><span class="n">label</span> <span class="ow">and</span> <span class="n">volume</span><span class="o">.</span><span class="n">label</span> <span class="ow">in</span> <span class="n">reserved_labels</span><span class="p">:</span>
</span><span id="RuntimeChecker-317"><a href="#RuntimeChecker-317"><span class="linenos"> 317</span></a>                        <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker-318"><a href="#RuntimeChecker-318"><span class="linenos"> 318</span></a>                            <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="RuntimeChecker-319"><a href="#RuntimeChecker-319"><span class="linenos"> 319</span></a>                                <span class="n">volume</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">volume</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">reserved_labels</span>
</span><span id="RuntimeChecker-320"><a href="#RuntimeChecker-320"><span class="linenos"> 320</span></a>                            <span class="p">)</span>
</span><span id="RuntimeChecker-321"><a href="#RuntimeChecker-321"><span class="linenos"> 321</span></a>                        <span class="p">)</span>
</span><span id="RuntimeChecker-322"><a href="#RuntimeChecker-322"><span class="linenos"> 322</span></a>
</span><span id="RuntimeChecker-323"><a href="#RuntimeChecker-323"><span class="linenos"> 323</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_volume_setup_defines_multiple_fullsize_volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker-324"><a href="#RuntimeChecker-324"><span class="linenos"> 324</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-325"><a href="#RuntimeChecker-325"><span class="linenos"> 325</span></a><span class="sd">        The volume size specification &#39;all&#39; makes this volume to</span>
</span><span id="RuntimeChecker-326"><a href="#RuntimeChecker-326"><span class="linenos"> 326</span></a><span class="sd">        take the rest space available on the system. It&#39;s only</span>
</span><span id="RuntimeChecker-327"><a href="#RuntimeChecker-327"><span class="linenos"> 327</span></a><span class="sd">        allowed to specify one all size volume</span>
</span><span id="RuntimeChecker-328"><a href="#RuntimeChecker-328"><span class="linenos"> 328</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-329"><a href="#RuntimeChecker-329"><span class="linenos"> 329</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker-330"><a href="#RuntimeChecker-330"><span class="linenos"> 330</span></a><span class="s1">            Multiple all size volumes found but only one is allowed</span>
</span><span id="RuntimeChecker-331"><a href="#RuntimeChecker-331"><span class="linenos"> 331</span></a>
</span><span id="RuntimeChecker-332"><a href="#RuntimeChecker-332"><span class="linenos"> 332</span></a><span class="s1">            The volume size specification &#39;all&#39; makes this volume to</span>
</span><span id="RuntimeChecker-333"><a href="#RuntimeChecker-333"><span class="linenos"> 333</span></a><span class="s1">            take the rest space available on the system. It&#39;s only</span>
</span><span id="RuntimeChecker-334"><a href="#RuntimeChecker-334"><span class="linenos"> 334</span></a><span class="s1">            allowed to specify one all size volume</span>
</span><span id="RuntimeChecker-335"><a href="#RuntimeChecker-335"><span class="linenos"> 335</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker-336"><a href="#RuntimeChecker-336"><span class="linenos"> 336</span></a>        <span class="n">systemdisk_section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_build_type_system_disk_section</span><span class="p">()</span>
</span><span id="RuntimeChecker-337"><a href="#RuntimeChecker-337"><span class="linenos"> 337</span></a>        <span class="k">if</span> <span class="n">systemdisk_section</span><span class="p">:</span>
</span><span id="RuntimeChecker-338"><a href="#RuntimeChecker-338"><span class="linenos"> 338</span></a>            <span class="n">all_size_volume_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="RuntimeChecker-339"><a href="#RuntimeChecker-339"><span class="linenos"> 339</span></a>            <span class="n">volumes</span> <span class="o">=</span> <span class="n">systemdisk_section</span><span class="o">.</span><span class="n">get_volume</span><span class="p">()</span> <span class="ow">or</span> <span class="p">[]</span>
</span><span id="RuntimeChecker-340"><a href="#RuntimeChecker-340"><span class="linenos"> 340</span></a>            <span class="k">for</span> <span class="n">volume</span> <span class="ow">in</span> <span class="n">volumes</span><span class="p">:</span>
</span><span id="RuntimeChecker-341"><a href="#RuntimeChecker-341"><span class="linenos"> 341</span></a>                <span class="n">size</span> <span class="o">=</span> <span class="n">volume</span><span class="o">.</span><span class="n">get_size</span><span class="p">()</span> <span class="ow">or</span> <span class="n">volume</span><span class="o">.</span><span class="n">get_freespace</span><span class="p">()</span>
</span><span id="RuntimeChecker-342"><a href="#RuntimeChecker-342"><span class="linenos"> 342</span></a>                <span class="k">if</span> <span class="n">size</span> <span class="ow">and</span> <span class="s1">&#39;all&#39;</span> <span class="ow">in</span> <span class="n">size</span><span class="p">:</span>
</span><span id="RuntimeChecker-343"><a href="#RuntimeChecker-343"><span class="linenos"> 343</span></a>                    <span class="n">all_size_volume_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="RuntimeChecker-344"><a href="#RuntimeChecker-344"><span class="linenos"> 344</span></a>            <span class="k">if</span> <span class="n">all_size_volume_count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="RuntimeChecker-345"><a href="#RuntimeChecker-345"><span class="linenos"> 345</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span id="RuntimeChecker-346"><a href="#RuntimeChecker-346"><span class="linenos"> 346</span></a>
</span><span id="RuntimeChecker-347"><a href="#RuntimeChecker-347"><span class="linenos"> 347</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_volume_setup_has_no_root_definition</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker-348"><a href="#RuntimeChecker-348"><span class="linenos"> 348</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-349"><a href="#RuntimeChecker-349"><span class="linenos"> 349</span></a><span class="sd">        The root volume in a systemdisk setup is handled in a special</span>
</span><span id="RuntimeChecker-350"><a href="#RuntimeChecker-350"><span class="linenos"> 350</span></a><span class="sd">        way. It is not allowed to setup a custom name or mountpoint for</span>
</span><span id="RuntimeChecker-351"><a href="#RuntimeChecker-351"><span class="linenos"> 351</span></a><span class="sd">        the root volume. Therefore the size of the root volume can be</span>
</span><span id="RuntimeChecker-352"><a href="#RuntimeChecker-352"><span class="linenos"> 352</span></a><span class="sd">        setup via the @root volume name. This check looks up the volume</span>
</span><span id="RuntimeChecker-353"><a href="#RuntimeChecker-353"><span class="linenos"> 353</span></a><span class="sd">        setup and searches if there is a configuration for the &#39;/&#39;</span>
</span><span id="RuntimeChecker-354"><a href="#RuntimeChecker-354"><span class="linenos"> 354</span></a><span class="sd">        mountpoint which would cause the image build to fail</span>
</span><span id="RuntimeChecker-355"><a href="#RuntimeChecker-355"><span class="linenos"> 355</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-356"><a href="#RuntimeChecker-356"><span class="linenos"> 356</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker-357"><a href="#RuntimeChecker-357"><span class="linenos"> 357</span></a><span class="s1">            Volume setup for &quot;/&quot; found. The size of the root volume</span>
</span><span id="RuntimeChecker-358"><a href="#RuntimeChecker-358"><span class="linenos"> 358</span></a><span class="s1">            must be specified via the @root volume name like the</span>
</span><span id="RuntimeChecker-359"><a href="#RuntimeChecker-359"><span class="linenos"> 359</span></a><span class="s1">            following example shows:</span>
</span><span id="RuntimeChecker-360"><a href="#RuntimeChecker-360"><span class="linenos"> 360</span></a>
</span><span id="RuntimeChecker-361"><a href="#RuntimeChecker-361"><span class="linenos"> 361</span></a><span class="s1">            &lt;volume name=&quot;@root&quot; size=&quot;42G&quot;/&gt;</span>
</span><span id="RuntimeChecker-362"><a href="#RuntimeChecker-362"><span class="linenos"> 362</span></a>
</span><span id="RuntimeChecker-363"><a href="#RuntimeChecker-363"><span class="linenos"> 363</span></a><span class="s1">            A custom name or mountpoint for the root volume is not</span>
</span><span id="RuntimeChecker-364"><a href="#RuntimeChecker-364"><span class="linenos"> 364</span></a><span class="s1">            allowed.</span>
</span><span id="RuntimeChecker-365"><a href="#RuntimeChecker-365"><span class="linenos"> 365</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker-366"><a href="#RuntimeChecker-366"><span class="linenos"> 366</span></a>        <span class="k">for</span> <span class="n">volume</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_volumes</span><span class="p">():</span>
</span><span id="RuntimeChecker-367"><a href="#RuntimeChecker-367"><span class="linenos"> 367</span></a>            <span class="k">if</span> <span class="n">volume</span><span class="o">.</span><span class="n">mountpoint</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
</span><span id="RuntimeChecker-368"><a href="#RuntimeChecker-368"><span class="linenos"> 368</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span id="RuntimeChecker-369"><a href="#RuntimeChecker-369"><span class="linenos"> 369</span></a>
</span><span id="RuntimeChecker-370"><a href="#RuntimeChecker-370"><span class="linenos"> 370</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_container_tool_chain_installed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker-371"><a href="#RuntimeChecker-371"><span class="linenos"> 371</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-372"><a href="#RuntimeChecker-372"><span class="linenos"> 372</span></a><span class="sd">        When creating container images the specific tools are used in order</span>
</span><span id="RuntimeChecker-373"><a href="#RuntimeChecker-373"><span class="linenos"> 373</span></a><span class="sd">        to import and export OCI or Docker compatible images. This check</span>
</span><span id="RuntimeChecker-374"><a href="#RuntimeChecker-374"><span class="linenos"> 374</span></a><span class="sd">        searches for those tools to be installed in the build system and</span>
</span><span id="RuntimeChecker-375"><a href="#RuntimeChecker-375"><span class="linenos"> 375</span></a><span class="sd">        fails if it can&#39;t find them</span>
</span><span id="RuntimeChecker-376"><a href="#RuntimeChecker-376"><span class="linenos"> 376</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-377"><a href="#RuntimeChecker-377"><span class="linenos"> 377</span></a>        <span class="n">message_tool_not_found</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker-378"><a href="#RuntimeChecker-378"><span class="linenos"> 378</span></a><span class="s1">            Required tool </span><span class="si">{name}</span><span class="s1"> not found in caller environment</span>
</span><span id="RuntimeChecker-379"><a href="#RuntimeChecker-379"><span class="linenos"> 379</span></a>
</span><span id="RuntimeChecker-380"><a href="#RuntimeChecker-380"><span class="linenos"> 380</span></a><span class="s1">            Creation of OCI or Docker images requires the tools </span><span class="si">{name}</span><span class="s1"> and</span>
</span><span id="RuntimeChecker-381"><a href="#RuntimeChecker-381"><span class="linenos"> 381</span></a><span class="s1">            skopeo to be installed on the build system. For SUSE based systems</span>
</span><span id="RuntimeChecker-382"><a href="#RuntimeChecker-382"><span class="linenos"> 382</span></a><span class="s1">            you can find the tools at:</span>
</span><span id="RuntimeChecker-383"><a href="#RuntimeChecker-383"><span class="linenos"> 383</span></a>
</span><span id="RuntimeChecker-384"><a href="#RuntimeChecker-384"><span class="linenos"> 384</span></a><span class="s1">            http://download.opensuse.org/repositories/Virtualization:/containers</span>
</span><span id="RuntimeChecker-385"><a href="#RuntimeChecker-385"><span class="linenos"> 385</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker-386"><a href="#RuntimeChecker-386"><span class="linenos"> 386</span></a>        <span class="n">message_version_unsupported</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker-387"><a href="#RuntimeChecker-387"><span class="linenos"> 387</span></a><span class="s1">            </span><span class="si">{name}</span><span class="s1"> tool found with unknown version</span>
</span><span id="RuntimeChecker-388"><a href="#RuntimeChecker-388"><span class="linenos"> 388</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker-389"><a href="#RuntimeChecker-389"><span class="linenos"> 389</span></a>        <span class="n">message_unknown_tool</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker-390"><a href="#RuntimeChecker-390"><span class="linenos"> 390</span></a><span class="s1">            Unknown tool: </span><span class="si">{0}</span><span class="s1">.</span>
</span><span id="RuntimeChecker-391"><a href="#RuntimeChecker-391"><span class="linenos"> 391</span></a>
</span><span id="RuntimeChecker-392"><a href="#RuntimeChecker-392"><span class="linenos"> 392</span></a><span class="s1">            Please configure KIWI with an appropriate value (umoci or buildah).</span>
</span><span id="RuntimeChecker-393"><a href="#RuntimeChecker-393"><span class="linenos"> 393</span></a><span class="s1">            Consider this runtime configuration file syntax (/etc/kiwi.yml):</span>
</span><span id="RuntimeChecker-394"><a href="#RuntimeChecker-394"><span class="linenos"> 394</span></a>
</span><span id="RuntimeChecker-395"><a href="#RuntimeChecker-395"><span class="linenos"> 395</span></a><span class="s1">            oci:</span>
</span><span id="RuntimeChecker-396"><a href="#RuntimeChecker-396"><span class="linenos"> 396</span></a><span class="s1">                - archive_tool: umoci | buildah</span>
</span><span id="RuntimeChecker-397"><a href="#RuntimeChecker-397"><span class="linenos"> 397</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker-398"><a href="#RuntimeChecker-398"><span class="linenos"> 398</span></a>
</span><span id="RuntimeChecker-399"><a href="#RuntimeChecker-399"><span class="linenos"> 399</span></a>        <span class="n">expected_version</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="RuntimeChecker-400"><a href="#RuntimeChecker-400"><span class="linenos"> 400</span></a>
</span><span id="RuntimeChecker-401"><a href="#RuntimeChecker-401"><span class="linenos"> 401</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_build_type_name</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;docker&#39;</span><span class="p">,</span> <span class="s1">&#39;oci&#39;</span><span class="p">]:</span>
</span><span id="RuntimeChecker-402"><a href="#RuntimeChecker-402"><span class="linenos"> 402</span></a>            <span class="n">runtime_config</span> <span class="o">=</span> <span class="n">RuntimeConfig</span><span class="p">()</span>
</span><span id="RuntimeChecker-403"><a href="#RuntimeChecker-403"><span class="linenos"> 403</span></a>            <span class="n">tool_name</span> <span class="o">=</span> <span class="n">runtime_config</span><span class="o">.</span><span class="n">get_oci_archive_tool</span><span class="p">()</span>
</span><span id="RuntimeChecker-404"><a href="#RuntimeChecker-404"><span class="linenos"> 404</span></a>            <span class="k">if</span> <span class="n">tool_name</span> <span class="o">==</span> <span class="s1">&#39;buildah&#39;</span><span class="p">:</span>
</span><span id="RuntimeChecker-405"><a href="#RuntimeChecker-405"><span class="linenos"> 405</span></a>                <span class="n">oci_tools</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;buildah&#39;</span><span class="p">,</span> <span class="s1">&#39;skopeo&#39;</span><span class="p">]</span>
</span><span id="RuntimeChecker-406"><a href="#RuntimeChecker-406"><span class="linenos"> 406</span></a>            <span class="k">elif</span> <span class="n">tool_name</span> <span class="o">==</span> <span class="s1">&#39;umoci&#39;</span><span class="p">:</span>
</span><span id="RuntimeChecker-407"><a href="#RuntimeChecker-407"><span class="linenos"> 407</span></a>                <span class="n">oci_tools</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;umoci&#39;</span><span class="p">,</span> <span class="s1">&#39;skopeo&#39;</span><span class="p">]</span>
</span><span id="RuntimeChecker-408"><a href="#RuntimeChecker-408"><span class="linenos"> 408</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="RuntimeChecker-409"><a href="#RuntimeChecker-409"><span class="linenos"> 409</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span><span class="n">message_unknown_tool</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tool_name</span><span class="p">))</span>
</span><span id="RuntimeChecker-410"><a href="#RuntimeChecker-410"><span class="linenos"> 410</span></a>            <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">oci_tools</span><span class="p">:</span>
</span><span id="RuntimeChecker-411"><a href="#RuntimeChecker-411"><span class="linenos"> 411</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">Path</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">tool</span><span class="p">,</span> <span class="n">access_mode</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">X_OK</span><span class="p">):</span>
</span><span id="RuntimeChecker-412"><a href="#RuntimeChecker-412"><span class="linenos"> 412</span></a>                    <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker-413"><a href="#RuntimeChecker-413"><span class="linenos"> 413</span></a>                        <span class="n">message_tool_not_found</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">tool</span><span class="p">)</span>
</span><span id="RuntimeChecker-414"><a href="#RuntimeChecker-414"><span class="linenos"> 414</span></a>                    <span class="p">)</span>
</span><span id="RuntimeChecker-415"><a href="#RuntimeChecker-415"><span class="linenos"> 415</span></a>                <span class="k">elif</span> <span class="ow">not</span> <span class="n">CommandCapabilities</span><span class="o">.</span><span class="n">check_version</span><span class="p">(</span>
</span><span id="RuntimeChecker-416"><a href="#RuntimeChecker-416"><span class="linenos"> 416</span></a>                    <span class="n">tool</span><span class="p">,</span> <span class="n">expected_version</span><span class="p">,</span> <span class="n">raise_on_error</span><span class="o">=</span><span class="kc">False</span>
</span><span id="RuntimeChecker-417"><a href="#RuntimeChecker-417"><span class="linenos"> 417</span></a>                <span class="p">):</span>
</span><span id="RuntimeChecker-418"><a href="#RuntimeChecker-418"><span class="linenos"> 418</span></a>                    <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker-419"><a href="#RuntimeChecker-419"><span class="linenos"> 419</span></a>                        <span class="n">message_version_unsupported</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">tool</span><span class="p">)</span>
</span><span id="RuntimeChecker-420"><a href="#RuntimeChecker-420"><span class="linenos"> 420</span></a>                    <span class="p">)</span>
</span><span id="RuntimeChecker-421"><a href="#RuntimeChecker-421"><span class="linenos"> 421</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_check_multitag_support</span><span class="p">()</span>
</span><span id="RuntimeChecker-422"><a href="#RuntimeChecker-422"><span class="linenos"> 422</span></a>
</span><span id="RuntimeChecker-423"><a href="#RuntimeChecker-423"><span class="linenos"> 423</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_check_multitag_support</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker-424"><a href="#RuntimeChecker-424"><span class="linenos"> 424</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker-425"><a href="#RuntimeChecker-425"><span class="linenos"> 425</span></a><span class="s1">            Using additionaltags attribute requires skopeo tool to be</span>
</span><span id="RuntimeChecker-426"><a href="#RuntimeChecker-426"><span class="linenos"> 426</span></a><span class="s1">            capable to handle it, it must include the &#39;--additional-tag&#39;</span>
</span><span id="RuntimeChecker-427"><a href="#RuntimeChecker-427"><span class="linenos"> 427</span></a><span class="s1">            option for copy subcommand (check it running &#39;skopeo copy</span>
</span><span id="RuntimeChecker-428"><a href="#RuntimeChecker-428"><span class="linenos"> 428</span></a><span class="s1">            --help&#39;).</span><span class="se">\n</span>
</span><span id="RuntimeChecker-429"><a href="#RuntimeChecker-429"><span class="linenos"> 429</span></a><span class="s1">            It is known to be present since v0.1.30</span>
</span><span id="RuntimeChecker-430"><a href="#RuntimeChecker-430"><span class="linenos"> 430</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker-431"><a href="#RuntimeChecker-431"><span class="linenos"> 431</span></a>        <span class="k">if</span> <span class="s1">&#39;additional_names&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_container_config</span><span class="p">():</span>
</span><span id="RuntimeChecker-432"><a href="#RuntimeChecker-432"><span class="linenos"> 432</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">CommandCapabilities</span><span class="o">.</span><span class="n">has_option_in_help</span><span class="p">(</span>
</span><span id="RuntimeChecker-433"><a href="#RuntimeChecker-433"><span class="linenos"> 433</span></a>                <span class="s1">&#39;skopeo&#39;</span><span class="p">,</span> <span class="s1">&#39;--additional-tag&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;copy&#39;</span><span class="p">,</span> <span class="s1">&#39;--help&#39;</span><span class="p">],</span>
</span><span id="RuntimeChecker-434"><a href="#RuntimeChecker-434"><span class="linenos"> 434</span></a>                <span class="n">raise_on_error</span><span class="o">=</span><span class="kc">False</span>
</span><span id="RuntimeChecker-435"><a href="#RuntimeChecker-435"><span class="linenos"> 435</span></a>            <span class="p">):</span>
</span><span id="RuntimeChecker-436"><a href="#RuntimeChecker-436"><span class="linenos"> 436</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span id="RuntimeChecker-437"><a href="#RuntimeChecker-437"><span class="linenos"> 437</span></a>
</span><span id="RuntimeChecker-438"><a href="#RuntimeChecker-438"><span class="linenos"> 438</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_luksformat_options_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker-439"><a href="#RuntimeChecker-439"><span class="linenos"> 439</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-440"><a href="#RuntimeChecker-440"><span class="linenos"> 440</span></a><span class="sd">        Options set via the luksformat element are passed along</span>
</span><span id="RuntimeChecker-441"><a href="#RuntimeChecker-441"><span class="linenos"> 441</span></a><span class="sd">        to the cryptsetup tool. Only options that are known to</span>
</span><span id="RuntimeChecker-442"><a href="#RuntimeChecker-442"><span class="linenos"> 442</span></a><span class="sd">        the tool should be allowed. Thus this runtime check looks</span>
</span><span id="RuntimeChecker-443"><a href="#RuntimeChecker-443"><span class="linenos"> 443</span></a><span class="sd">        up the provided option names if they exist in the cryptsetup</span>
</span><span id="RuntimeChecker-444"><a href="#RuntimeChecker-444"><span class="linenos"> 444</span></a><span class="sd">        version used on the build host</span>
</span><span id="RuntimeChecker-445"><a href="#RuntimeChecker-445"><span class="linenos"> 445</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-446"><a href="#RuntimeChecker-446"><span class="linenos"> 446</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker-447"><a href="#RuntimeChecker-447"><span class="linenos"> 447</span></a><span class="s1">            Option </span><span class="si">{0!r}</span><span class="s1"> not found in cryptsetup</span>
</span><span id="RuntimeChecker-448"><a href="#RuntimeChecker-448"><span class="linenos"> 448</span></a>
</span><span id="RuntimeChecker-449"><a href="#RuntimeChecker-449"><span class="linenos"> 449</span></a><span class="s1">            The Option </span><span class="si">{0!r}</span><span class="s1"> could not be found in the help output</span>
</span><span id="RuntimeChecker-450"><a href="#RuntimeChecker-450"><span class="linenos"> 450</span></a><span class="s1">            of the cryptsetup tool.</span>
</span><span id="RuntimeChecker-451"><a href="#RuntimeChecker-451"><span class="linenos"> 451</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker-452"><a href="#RuntimeChecker-452"><span class="linenos"> 452</span></a>        <span class="n">luksformat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_luksformat</span><span class="p">()</span>
</span><span id="RuntimeChecker-453"><a href="#RuntimeChecker-453"><span class="linenos"> 453</span></a>        <span class="k">if</span> <span class="n">luksformat</span><span class="p">:</span>
</span><span id="RuntimeChecker-454"><a href="#RuntimeChecker-454"><span class="linenos"> 454</span></a>            <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="n">luksformat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_option</span><span class="p">():</span>
</span><span id="RuntimeChecker-455"><a href="#RuntimeChecker-455"><span class="linenos"> 455</span></a>                <span class="n">argument</span> <span class="o">=</span> <span class="n">option</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
</span><span id="RuntimeChecker-456"><a href="#RuntimeChecker-456"><span class="linenos"> 456</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">CommandCapabilities</span><span class="o">.</span><span class="n">has_option_in_help</span><span class="p">(</span>
</span><span id="RuntimeChecker-457"><a href="#RuntimeChecker-457"><span class="linenos"> 457</span></a>                    <span class="s1">&#39;cryptsetup&#39;</span><span class="p">,</span> <span class="n">argument</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;--help&#39;</span><span class="p">],</span>
</span><span id="RuntimeChecker-458"><a href="#RuntimeChecker-458"><span class="linenos"> 458</span></a>                    <span class="n">raise_on_error</span><span class="o">=</span><span class="kc">False</span>
</span><span id="RuntimeChecker-459"><a href="#RuntimeChecker-459"><span class="linenos"> 459</span></a>                <span class="p">):</span>
</span><span id="RuntimeChecker-460"><a href="#RuntimeChecker-460"><span class="linenos"> 460</span></a>                    <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">argument</span><span class="p">))</span>
</span><span id="RuntimeChecker-461"><a href="#RuntimeChecker-461"><span class="linenos"> 461</span></a>
</span><span id="RuntimeChecker-462"><a href="#RuntimeChecker-462"><span class="linenos"> 462</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_appx_naming_conventions_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker-463"><a href="#RuntimeChecker-463"><span class="linenos"> 463</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-464"><a href="#RuntimeChecker-464"><span class="linenos"> 464</span></a><span class="sd">        When building wsl images there are some naming conventions that</span>
</span><span id="RuntimeChecker-465"><a href="#RuntimeChecker-465"><span class="linenos"> 465</span></a><span class="sd">        must be fulfilled to run the container on Microsoft Windows</span>
</span><span id="RuntimeChecker-466"><a href="#RuntimeChecker-466"><span class="linenos"> 466</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-467"><a href="#RuntimeChecker-467"><span class="linenos"> 467</span></a>        <span class="n">launcher_pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;[^</span><span class="se">\\</span><span class="s1">]+(\.[Ee][Xx][Ee])$&#39;</span>
</span><span id="RuntimeChecker-468"><a href="#RuntimeChecker-468"><span class="linenos"> 468</span></a>        <span class="n">message_container_launcher_invalid</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker-469"><a href="#RuntimeChecker-469"><span class="linenos"> 469</span></a><span class="s1">            Invalid WSL launcher name: </span><span class="si">{0}</span>
</span><span id="RuntimeChecker-470"><a href="#RuntimeChecker-470"><span class="linenos"> 470</span></a>
</span><span id="RuntimeChecker-471"><a href="#RuntimeChecker-471"><span class="linenos"> 471</span></a><span class="s1">            WSL launcher name must match the pattern: </span><span class="si">{1}</span>
</span><span id="RuntimeChecker-472"><a href="#RuntimeChecker-472"><span class="linenos"> 472</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker-473"><a href="#RuntimeChecker-473"><span class="linenos"> 473</span></a>        <span class="n">id_pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;^[a-zA-Z0-9]+$&#39;</span>
</span><span id="RuntimeChecker-474"><a href="#RuntimeChecker-474"><span class="linenos"> 474</span></a>        <span class="n">message_container_id_invalid</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker-475"><a href="#RuntimeChecker-475"><span class="linenos"> 475</span></a><span class="s1">            Invalid WSL container application id: </span><span class="si">{0}</span>
</span><span id="RuntimeChecker-476"><a href="#RuntimeChecker-476"><span class="linenos"> 476</span></a>
</span><span id="RuntimeChecker-477"><a href="#RuntimeChecker-477"><span class="linenos"> 477</span></a><span class="s1">            WSL container id must match the pattern: </span><span class="si">{1}</span>
</span><span id="RuntimeChecker-478"><a href="#RuntimeChecker-478"><span class="linenos"> 478</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker-479"><a href="#RuntimeChecker-479"><span class="linenos"> 479</span></a>        <span class="n">build_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_build_type_name</span><span class="p">()</span>
</span><span id="RuntimeChecker-480"><a href="#RuntimeChecker-480"><span class="linenos"> 480</span></a>        <span class="n">container_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_container_config</span><span class="p">()</span>
</span><span id="RuntimeChecker-481"><a href="#RuntimeChecker-481"><span class="linenos"> 481</span></a>        <span class="n">container_history</span> <span class="o">=</span> <span class="n">container_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;history&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
</span><span id="RuntimeChecker-482"><a href="#RuntimeChecker-482"><span class="linenos"> 482</span></a>        <span class="k">if</span> <span class="n">build_type</span> <span class="o">==</span> <span class="s1">&#39;appx&#39;</span> <span class="ow">and</span> <span class="n">container_config</span><span class="p">:</span>
</span><span id="RuntimeChecker-483"><a href="#RuntimeChecker-483"><span class="linenos"> 483</span></a>            <span class="n">launcher</span> <span class="o">=</span> <span class="n">container_history</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;launcher&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker-484"><a href="#RuntimeChecker-484"><span class="linenos"> 484</span></a>            <span class="k">if</span> <span class="n">launcher</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">launcher_pattern</span><span class="p">,</span> <span class="n">launcher</span><span class="p">):</span>
</span><span id="RuntimeChecker-485"><a href="#RuntimeChecker-485"><span class="linenos"> 485</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker-486"><a href="#RuntimeChecker-486"><span class="linenos"> 486</span></a>                    <span class="n">message_container_launcher_invalid</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="RuntimeChecker-487"><a href="#RuntimeChecker-487"><span class="linenos"> 487</span></a>                        <span class="n">launcher</span><span class="p">,</span> <span class="n">launcher_pattern</span>
</span><span id="RuntimeChecker-488"><a href="#RuntimeChecker-488"><span class="linenos"> 488</span></a>                    <span class="p">)</span>
</span><span id="RuntimeChecker-489"><a href="#RuntimeChecker-489"><span class="linenos"> 489</span></a>                <span class="p">)</span>
</span><span id="RuntimeChecker-490"><a href="#RuntimeChecker-490"><span class="linenos"> 490</span></a>            <span class="n">application_id</span> <span class="o">=</span> <span class="n">container_history</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;application_id&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker-491"><a href="#RuntimeChecker-491"><span class="linenos"> 491</span></a>            <span class="k">if</span> <span class="n">application_id</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">id_pattern</span><span class="p">,</span> <span class="n">application_id</span><span class="p">):</span>
</span><span id="RuntimeChecker-492"><a href="#RuntimeChecker-492"><span class="linenos"> 492</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker-493"><a href="#RuntimeChecker-493"><span class="linenos"> 493</span></a>                    <span class="n">message_container_id_invalid</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="RuntimeChecker-494"><a href="#RuntimeChecker-494"><span class="linenos"> 494</span></a>                        <span class="n">application_id</span><span class="p">,</span> <span class="n">id_pattern</span>
</span><span id="RuntimeChecker-495"><a href="#RuntimeChecker-495"><span class="linenos"> 495</span></a>                    <span class="p">)</span>
</span><span id="RuntimeChecker-496"><a href="#RuntimeChecker-496"><span class="linenos"> 496</span></a>                <span class="p">)</span>
</span><span id="RuntimeChecker-497"><a href="#RuntimeChecker-497"><span class="linenos"> 497</span></a>
</span><span id="RuntimeChecker-498"><a href="#RuntimeChecker-498"><span class="linenos"> 498</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_initrd_selection_required</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker-499"><a href="#RuntimeChecker-499"><span class="linenos"> 499</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-500"><a href="#RuntimeChecker-500"><span class="linenos"> 500</span></a><span class="sd">        If the boot attribute is used without selecting kiwi</span>
</span><span id="RuntimeChecker-501"><a href="#RuntimeChecker-501"><span class="linenos"> 501</span></a><span class="sd">        as the initrd_system, the setting of the boot attribute</span>
</span><span id="RuntimeChecker-502"><a href="#RuntimeChecker-502"><span class="linenos"> 502</span></a><span class="sd">        will not have any effect. We assume that configurations</span>
</span><span id="RuntimeChecker-503"><a href="#RuntimeChecker-503"><span class="linenos"> 503</span></a><span class="sd">        which explicitly specify the boot attribute wants to use</span>
</span><span id="RuntimeChecker-504"><a href="#RuntimeChecker-504"><span class="linenos"> 504</span></a><span class="sd">        the custom kiwi initrd system and not dracut.</span>
</span><span id="RuntimeChecker-505"><a href="#RuntimeChecker-505"><span class="linenos"> 505</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-506"><a href="#RuntimeChecker-506"><span class="linenos"> 506</span></a>        <span class="n">message_kiwi_initrd_system_not_selected</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker-507"><a href="#RuntimeChecker-507"><span class="linenos"> 507</span></a><span class="s1">            Missing initrd_system selection for boot attribute</span>
</span><span id="RuntimeChecker-508"><a href="#RuntimeChecker-508"><span class="linenos"> 508</span></a>
</span><span id="RuntimeChecker-509"><a href="#RuntimeChecker-509"><span class="linenos"> 509</span></a><span class="s1">            The selected boot=&quot;&#39;</span><span class="si">{0}</span><span class="s1">&#39;&quot; boot description indicates</span>
</span><span id="RuntimeChecker-510"><a href="#RuntimeChecker-510"><span class="linenos"> 510</span></a><span class="s1">            the custom kiwi initrd system should be used instead</span>
</span><span id="RuntimeChecker-511"><a href="#RuntimeChecker-511"><span class="linenos"> 511</span></a><span class="s1">            of dracut. If this is correct please explicitly request</span>
</span><span id="RuntimeChecker-512"><a href="#RuntimeChecker-512"><span class="linenos"> 512</span></a><span class="s1">            the kiwi initrd system as follows:</span>
</span><span id="RuntimeChecker-513"><a href="#RuntimeChecker-513"><span class="linenos"> 513</span></a>
</span><span id="RuntimeChecker-514"><a href="#RuntimeChecker-514"><span class="linenos"> 514</span></a><span class="s1">            &lt;type initrd_system=&quot;kiwi&quot;/&gt;</span>
</span><span id="RuntimeChecker-515"><a href="#RuntimeChecker-515"><span class="linenos"> 515</span></a>
</span><span id="RuntimeChecker-516"><a href="#RuntimeChecker-516"><span class="linenos"> 516</span></a><span class="s1">            If this is not want you want and dracut should be used</span>
</span><span id="RuntimeChecker-517"><a href="#RuntimeChecker-517"><span class="linenos"> 517</span></a><span class="s1">            as initrd system, please delete the boot attribute</span>
</span><span id="RuntimeChecker-518"><a href="#RuntimeChecker-518"><span class="linenos"> 518</span></a><span class="s1">            as it is obsolete in this case.</span>
</span><span id="RuntimeChecker-519"><a href="#RuntimeChecker-519"><span class="linenos"> 519</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker-520"><a href="#RuntimeChecker-520"><span class="linenos"> 520</span></a>        <span class="n">initrd_system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_initrd_system</span><span class="p">()</span>
</span><span id="RuntimeChecker-521"><a href="#RuntimeChecker-521"><span class="linenos"> 521</span></a>        <span class="n">boot_image_reference</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_boot</span><span class="p">()</span>
</span><span id="RuntimeChecker-522"><a href="#RuntimeChecker-522"><span class="linenos"> 522</span></a>        <span class="k">if</span> <span class="n">initrd_system</span> <span class="o">!=</span> <span class="s1">&#39;kiwi&#39;</span> <span class="ow">and</span> <span class="n">boot_image_reference</span><span class="p">:</span>
</span><span id="RuntimeChecker-523"><a href="#RuntimeChecker-523"><span class="linenos"> 523</span></a>            <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker-524"><a href="#RuntimeChecker-524"><span class="linenos"> 524</span></a>                <span class="n">message_kiwi_initrd_system_not_selected</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="RuntimeChecker-525"><a href="#RuntimeChecker-525"><span class="linenos"> 525</span></a>                    <span class="n">boot_image_reference</span>
</span><span id="RuntimeChecker-526"><a href="#RuntimeChecker-526"><span class="linenos"> 526</span></a>                <span class="p">)</span>
</span><span id="RuntimeChecker-527"><a href="#RuntimeChecker-527"><span class="linenos"> 527</span></a>            <span class="p">)</span>
</span><span id="RuntimeChecker-528"><a href="#RuntimeChecker-528"><span class="linenos"> 528</span></a>
</span><span id="RuntimeChecker-529"><a href="#RuntimeChecker-529"><span class="linenos"> 529</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_boot_description_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker-530"><a href="#RuntimeChecker-530"><span class="linenos"> 530</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-531"><a href="#RuntimeChecker-531"><span class="linenos"> 531</span></a><span class="sd">        If a kiwi initrd is used, a lookup to the specified boot</span>
</span><span id="RuntimeChecker-532"><a href="#RuntimeChecker-532"><span class="linenos"> 532</span></a><span class="sd">        description is done and fails early if it does not exist</span>
</span><span id="RuntimeChecker-533"><a href="#RuntimeChecker-533"><span class="linenos"> 533</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-534"><a href="#RuntimeChecker-534"><span class="linenos"> 534</span></a>        <span class="n">message_no_boot_reference</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker-535"><a href="#RuntimeChecker-535"><span class="linenos"> 535</span></a><span class="s1">            Boot description missing for &#39;</span><span class="si">{0}</span><span class="s1">&#39; type</span>
</span><span id="RuntimeChecker-536"><a href="#RuntimeChecker-536"><span class="linenos"> 536</span></a>
</span><span id="RuntimeChecker-537"><a href="#RuntimeChecker-537"><span class="linenos"> 537</span></a><span class="s1">            The selected &#39;</span><span class="si">{1}</span><span class="s1">&#39; initrd_system requires a boot description</span>
</span><span id="RuntimeChecker-538"><a href="#RuntimeChecker-538"><span class="linenos"> 538</span></a><span class="s1">            reference. Please update your type setup as follows</span>
</span><span id="RuntimeChecker-539"><a href="#RuntimeChecker-539"><span class="linenos"> 539</span></a>
</span><span id="RuntimeChecker-540"><a href="#RuntimeChecker-540"><span class="linenos"> 540</span></a><span class="s1">            &lt;type image=&quot;</span><span class="si">{0}</span><span class="s1">&quot; boot=&quot;</span><span class="si">{0}</span><span class="s1">boot/...&quot;/&gt;</span>
</span><span id="RuntimeChecker-541"><a href="#RuntimeChecker-541"><span class="linenos"> 541</span></a>
</span><span id="RuntimeChecker-542"><a href="#RuntimeChecker-542"><span class="linenos"> 542</span></a><span class="s1">            A collection of custom boot descriptions can be found</span>
</span><span id="RuntimeChecker-543"><a href="#RuntimeChecker-543"><span class="linenos"> 543</span></a><span class="s1">            in the kiwi-boot-descriptions package</span>
</span><span id="RuntimeChecker-544"><a href="#RuntimeChecker-544"><span class="linenos"> 544</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker-545"><a href="#RuntimeChecker-545"><span class="linenos"> 545</span></a>        <span class="n">message_boot_description_not_found</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker-546"><a href="#RuntimeChecker-546"><span class="linenos"> 546</span></a><span class="s1">            Boot description &#39;</span><span class="si">{0}</span><span class="s1">&#39; not found</span>
</span><span id="RuntimeChecker-547"><a href="#RuntimeChecker-547"><span class="linenos"> 547</span></a>
</span><span id="RuntimeChecker-548"><a href="#RuntimeChecker-548"><span class="linenos"> 548</span></a><span class="s1">            The selected boot description could not be found on</span>
</span><span id="RuntimeChecker-549"><a href="#RuntimeChecker-549"><span class="linenos"> 549</span></a><span class="s1">            the build host. A collection of custom boot descriptions</span>
</span><span id="RuntimeChecker-550"><a href="#RuntimeChecker-550"><span class="linenos"> 550</span></a><span class="s1">            can be found in the kiwi-boot-descriptions package</span>
</span><span id="RuntimeChecker-551"><a href="#RuntimeChecker-551"><span class="linenos"> 551</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker-552"><a href="#RuntimeChecker-552"><span class="linenos"> 552</span></a>        <span class="n">image_types_supporting_custom_boot_description</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;oem&#39;</span><span class="p">,</span> <span class="s1">&#39;pxe&#39;</span><span class="p">]</span>
</span><span id="RuntimeChecker-553"><a href="#RuntimeChecker-553"><span class="linenos"> 553</span></a>        <span class="n">build_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_build_type_name</span><span class="p">()</span>
</span><span id="RuntimeChecker-554"><a href="#RuntimeChecker-554"><span class="linenos"> 554</span></a>        <span class="n">initrd_system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_initrd_system</span><span class="p">()</span>
</span><span id="RuntimeChecker-555"><a href="#RuntimeChecker-555"><span class="linenos"> 555</span></a>        <span class="k">if</span> <span class="n">initrd_system</span> <span class="o">==</span> <span class="s1">&#39;kiwi&#39;</span> <span class="ow">and</span> \
</span><span id="RuntimeChecker-556"><a href="#RuntimeChecker-556"><span class="linenos"> 556</span></a>           <span class="n">build_type</span> <span class="ow">in</span> <span class="n">image_types_supporting_custom_boot_description</span><span class="p">:</span>
</span><span id="RuntimeChecker-557"><a href="#RuntimeChecker-557"><span class="linenos"> 557</span></a>
</span><span id="RuntimeChecker-558"><a href="#RuntimeChecker-558"><span class="linenos"> 558</span></a>            <span class="n">boot_image_reference</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_boot</span><span class="p">()</span>
</span><span id="RuntimeChecker-559"><a href="#RuntimeChecker-559"><span class="linenos"> 559</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">boot_image_reference</span><span class="p">:</span>
</span><span id="RuntimeChecker-560"><a href="#RuntimeChecker-560"><span class="linenos"> 560</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker-561"><a href="#RuntimeChecker-561"><span class="linenos"> 561</span></a>                    <span class="n">message_no_boot_reference</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">build_type</span><span class="p">,</span> <span class="n">initrd_system</span><span class="p">)</span>
</span><span id="RuntimeChecker-562"><a href="#RuntimeChecker-562"><span class="linenos"> 562</span></a>                <span class="p">)</span>
</span><span id="RuntimeChecker-563"><a href="#RuntimeChecker-563"><span class="linenos"> 563</span></a>
</span><span id="RuntimeChecker-564"><a href="#RuntimeChecker-564"><span class="linenos"> 564</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">boot_image_reference</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">:</span>
</span><span id="RuntimeChecker-565"><a href="#RuntimeChecker-565"><span class="linenos"> 565</span></a>                <span class="n">boot_image_reference</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="RuntimeChecker-566"><a href="#RuntimeChecker-566"><span class="linenos"> 566</span></a>                    <span class="p">[</span>
</span><span id="RuntimeChecker-567"><a href="#RuntimeChecker-567"><span class="linenos"> 567</span></a>                        <span class="n">Defaults</span><span class="o">.</span><span class="n">get_boot_image_description_path</span><span class="p">(),</span>
</span><span id="RuntimeChecker-568"><a href="#RuntimeChecker-568"><span class="linenos"> 568</span></a>                        <span class="n">boot_image_reference</span>
</span><span id="RuntimeChecker-569"><a href="#RuntimeChecker-569"><span class="linenos"> 569</span></a>                    <span class="p">]</span>
</span><span id="RuntimeChecker-570"><a href="#RuntimeChecker-570"><span class="linenos"> 570</span></a>                <span class="p">)</span>
</span><span id="RuntimeChecker-571"><a href="#RuntimeChecker-571"><span class="linenos"> 571</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">boot_image_reference</span><span class="p">):</span>
</span><span id="RuntimeChecker-572"><a href="#RuntimeChecker-572"><span class="linenos"> 572</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker-573"><a href="#RuntimeChecker-573"><span class="linenos"> 573</span></a>                    <span class="n">message_boot_description_not_found</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="RuntimeChecker-574"><a href="#RuntimeChecker-574"><span class="linenos"> 574</span></a>                        <span class="n">boot_image_reference</span>
</span><span id="RuntimeChecker-575"><a href="#RuntimeChecker-575"><span class="linenos"> 575</span></a>                    <span class="p">)</span>
</span><span id="RuntimeChecker-576"><a href="#RuntimeChecker-576"><span class="linenos"> 576</span></a>                <span class="p">)</span>
</span><span id="RuntimeChecker-577"><a href="#RuntimeChecker-577"><span class="linenos"> 577</span></a>
</span><span id="RuntimeChecker-578"><a href="#RuntimeChecker-578"><span class="linenos"> 578</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_consistent_kernel_in_boot_and_system_image</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker-579"><a href="#RuntimeChecker-579"><span class="linenos"> 579</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-580"><a href="#RuntimeChecker-580"><span class="linenos"> 580</span></a><span class="sd">        If a kiwi initrd is used, the kernel used to build the kiwi</span>
</span><span id="RuntimeChecker-581"><a href="#RuntimeChecker-581"><span class="linenos"> 581</span></a><span class="sd">        initrd and the kernel used in the system image must be the</span>
</span><span id="RuntimeChecker-582"><a href="#RuntimeChecker-582"><span class="linenos"> 582</span></a><span class="sd">        same in order to avoid an inconsistent boot setup</span>
</span><span id="RuntimeChecker-583"><a href="#RuntimeChecker-583"><span class="linenos"> 583</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-584"><a href="#RuntimeChecker-584"><span class="linenos"> 584</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker-585"><a href="#RuntimeChecker-585"><span class="linenos"> 585</span></a><span class="s1">            Possible kernel mismatch between kiwi initrd and system image</span>
</span><span id="RuntimeChecker-586"><a href="#RuntimeChecker-586"><span class="linenos"> 586</span></a>
</span><span id="RuntimeChecker-587"><a href="#RuntimeChecker-587"><span class="linenos"> 587</span></a><span class="s1">            The selected &#39;</span><span class="si">{0}</span><span class="s1">&#39; boot image kernel is &#39;</span><span class="si">{1}</span><span class="s1">&#39;. However this</span>
</span><span id="RuntimeChecker-588"><a href="#RuntimeChecker-588"><span class="linenos"> 588</span></a><span class="s1">            kernel package was not explicitly listed in the package list</span>
</span><span id="RuntimeChecker-589"><a href="#RuntimeChecker-589"><span class="linenos"> 589</span></a><span class="s1">            of the system image. Please fixup your system image</span>
</span><span id="RuntimeChecker-590"><a href="#RuntimeChecker-590"><span class="linenos"> 590</span></a><span class="s1">            description:</span>
</span><span id="RuntimeChecker-591"><a href="#RuntimeChecker-591"><span class="linenos"> 591</span></a>
</span><span id="RuntimeChecker-592"><a href="#RuntimeChecker-592"><span class="linenos"> 592</span></a><span class="s1">            1) Add &lt;package name=&quot;</span><span class="si">{1}</span><span class="s1">&quot;/&gt; to your system XML description</span>
</span><span id="RuntimeChecker-593"><a href="#RuntimeChecker-593"><span class="linenos"> 593</span></a>
</span><span id="RuntimeChecker-594"><a href="#RuntimeChecker-594"><span class="linenos"> 594</span></a><span class="s1">            2) Inherit kernel from system description to initrd via</span>
</span><span id="RuntimeChecker-595"><a href="#RuntimeChecker-595"><span class="linenos"> 595</span></a><span class="s1">               the custom kernel profile:</span>
</span><span id="RuntimeChecker-596"><a href="#RuntimeChecker-596"><span class="linenos"> 596</span></a>
</span><span id="RuntimeChecker-597"><a href="#RuntimeChecker-597"><span class="linenos"> 597</span></a><span class="s1">               &lt;type ... bootkernel=&quot;custom&quot; .../&gt;</span>
</span><span id="RuntimeChecker-598"><a href="#RuntimeChecker-598"><span class="linenos"> 598</span></a>
</span><span id="RuntimeChecker-599"><a href="#RuntimeChecker-599"><span class="linenos"> 599</span></a><span class="s1">               &lt;packages type=&quot;image&quot;/&gt;</span>
</span><span id="RuntimeChecker-600"><a href="#RuntimeChecker-600"><span class="linenos"> 600</span></a><span class="s1">                   &lt;package name=&quot;desired-kernel&quot; bootinclude=&quot;true&quot;/&gt;</span>
</span><span id="RuntimeChecker-601"><a href="#RuntimeChecker-601"><span class="linenos"> 601</span></a><span class="s1">               &lt;/packages&gt;</span>
</span><span id="RuntimeChecker-602"><a href="#RuntimeChecker-602"><span class="linenos"> 602</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker-603"><a href="#RuntimeChecker-603"><span class="linenos"> 603</span></a>        <span class="n">boot_image_reference</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_boot</span><span class="p">()</span>
</span><span id="RuntimeChecker-604"><a href="#RuntimeChecker-604"><span class="linenos"> 604</span></a>        <span class="n">boot_kernel_package_name</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="RuntimeChecker-605"><a href="#RuntimeChecker-605"><span class="linenos"> 605</span></a>        <span class="k">if</span> <span class="n">boot_image_reference</span><span class="p">:</span>
</span><span id="RuntimeChecker-606"><a href="#RuntimeChecker-606"><span class="linenos"> 606</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">boot_image_reference</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
</span><span id="RuntimeChecker-607"><a href="#RuntimeChecker-607"><span class="linenos"> 607</span></a>                <span class="n">boot_image_reference</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="RuntimeChecker-608"><a href="#RuntimeChecker-608"><span class="linenos"> 608</span></a>                    <span class="p">[</span>
</span><span id="RuntimeChecker-609"><a href="#RuntimeChecker-609"><span class="linenos"> 609</span></a>                        <span class="n">Defaults</span><span class="o">.</span><span class="n">get_boot_image_description_path</span><span class="p">(),</span>
</span><span id="RuntimeChecker-610"><a href="#RuntimeChecker-610"><span class="linenos"> 610</span></a>                        <span class="n">boot_image_reference</span>
</span><span id="RuntimeChecker-611"><a href="#RuntimeChecker-611"><span class="linenos"> 611</span></a>                    <span class="p">]</span>
</span><span id="RuntimeChecker-612"><a href="#RuntimeChecker-612"><span class="linenos"> 612</span></a>                <span class="p">)</span>
</span><span id="RuntimeChecker-613"><a href="#RuntimeChecker-613"><span class="linenos"> 613</span></a>            <span class="n">boot_config_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="RuntimeChecker-614"><a href="#RuntimeChecker-614"><span class="linenos"> 614</span></a>                <span class="p">[</span><span class="n">boot_image_reference</span><span class="p">,</span> <span class="s1">&#39;config.xml&#39;</span><span class="p">]</span>
</span><span id="RuntimeChecker-615"><a href="#RuntimeChecker-615"><span class="linenos"> 615</span></a>            <span class="p">)</span>
</span><span id="RuntimeChecker-616"><a href="#RuntimeChecker-616"><span class="linenos"> 616</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">boot_config_file</span><span class="p">):</span>
</span><span id="RuntimeChecker-617"><a href="#RuntimeChecker-617"><span class="linenos"> 617</span></a>                <span class="n">boot_description</span> <span class="o">=</span> <span class="n">XMLDescription</span><span class="p">(</span>
</span><span id="RuntimeChecker-618"><a href="#RuntimeChecker-618"><span class="linenos"> 618</span></a>                    <span class="n">description</span><span class="o">=</span><span class="n">boot_config_file</span><span class="p">,</span>
</span><span id="RuntimeChecker-619"><a href="#RuntimeChecker-619"><span class="linenos"> 619</span></a>                    <span class="n">derived_from</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">xml_data</span><span class="o">.</span><span class="n">description_dir</span>
</span><span id="RuntimeChecker-620"><a href="#RuntimeChecker-620"><span class="linenos"> 620</span></a>                <span class="p">)</span>
</span><span id="RuntimeChecker-621"><a href="#RuntimeChecker-621"><span class="linenos"> 621</span></a>                <span class="n">boot_kernel_profile</span> <span class="o">=</span> \
</span><span id="RuntimeChecker-622"><a href="#RuntimeChecker-622"><span class="linenos"> 622</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_bootkernel</span><span class="p">()</span>
</span><span id="RuntimeChecker-623"><a href="#RuntimeChecker-623"><span class="linenos"> 623</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">boot_kernel_profile</span><span class="p">:</span>
</span><span id="RuntimeChecker-624"><a href="#RuntimeChecker-624"><span class="linenos"> 624</span></a>                    <span class="n">boot_kernel_profile</span> <span class="o">=</span> <span class="s1">&#39;std&#39;</span>
</span><span id="RuntimeChecker-625"><a href="#RuntimeChecker-625"><span class="linenos"> 625</span></a>                <span class="n">boot_xml_state</span> <span class="o">=</span> <span class="n">XMLState</span><span class="p">(</span>
</span><span id="RuntimeChecker-626"><a href="#RuntimeChecker-626"><span class="linenos"> 626</span></a>                    <span class="n">boot_description</span><span class="o">.</span><span class="n">load</span><span class="p">(),</span> <span class="p">[</span><span class="n">boot_kernel_profile</span><span class="p">]</span>
</span><span id="RuntimeChecker-627"><a href="#RuntimeChecker-627"><span class="linenos"> 627</span></a>                <span class="p">)</span>
</span><span id="RuntimeChecker-628"><a href="#RuntimeChecker-628"><span class="linenos"> 628</span></a>                <span class="n">kernel_package_sections</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="RuntimeChecker-629"><a href="#RuntimeChecker-629"><span class="linenos"> 629</span></a>                <span class="k">for</span> <span class="n">packages_section</span> <span class="ow">in</span> <span class="n">boot_xml_state</span><span class="o">.</span><span class="n">xml_data</span><span class="o">.</span><span class="n">get_packages</span><span class="p">():</span>
</span><span id="RuntimeChecker-630"><a href="#RuntimeChecker-630"><span class="linenos"> 630</span></a>                    <span class="c1"># lookup package sections matching kernel profile in kiwi</span>
</span><span id="RuntimeChecker-631"><a href="#RuntimeChecker-631"><span class="linenos"> 631</span></a>                    <span class="c1"># boot description. By definition this must be a packages</span>
</span><span id="RuntimeChecker-632"><a href="#RuntimeChecker-632"><span class="linenos"> 632</span></a>                    <span class="c1"># section with a single profile name whereas the default</span>
</span><span id="RuntimeChecker-633"><a href="#RuntimeChecker-633"><span class="linenos"> 633</span></a>                    <span class="c1"># profile name is &#39;std&#39;. The section itself must contain</span>
</span><span id="RuntimeChecker-634"><a href="#RuntimeChecker-634"><span class="linenos"> 634</span></a>                    <span class="c1"># one matching kernel package name for the desired</span>
</span><span id="RuntimeChecker-635"><a href="#RuntimeChecker-635"><span class="linenos"> 635</span></a>                    <span class="c1"># architecture</span>
</span><span id="RuntimeChecker-636"><a href="#RuntimeChecker-636"><span class="linenos"> 636</span></a>                    <span class="k">if</span> <span class="n">packages_section</span><span class="o">.</span><span class="n">get_profiles</span><span class="p">()</span> <span class="o">==</span> <span class="n">boot_kernel_profile</span><span class="p">:</span>
</span><span id="RuntimeChecker-637"><a href="#RuntimeChecker-637"><span class="linenos"> 637</span></a>                        <span class="k">for</span> <span class="n">package</span> <span class="ow">in</span> <span class="n">packages_section</span><span class="o">.</span><span class="n">get_package</span><span class="p">():</span>
</span><span id="RuntimeChecker-638"><a href="#RuntimeChecker-638"><span class="linenos"> 638</span></a>                            <span class="n">kernel_package_sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">package</span><span class="p">)</span>
</span><span id="RuntimeChecker-639"><a href="#RuntimeChecker-639"><span class="linenos"> 639</span></a>
</span><span id="RuntimeChecker-640"><a href="#RuntimeChecker-640"><span class="linenos"> 640</span></a>                <span class="k">for</span> <span class="n">package</span> <span class="ow">in</span> <span class="n">kernel_package_sections</span><span class="p">:</span>
</span><span id="RuntimeChecker-641"><a href="#RuntimeChecker-641"><span class="linenos"> 641</span></a>                    <span class="k">if</span> <span class="n">boot_xml_state</span><span class="o">.</span><span class="n">package_matches_host_architecture</span><span class="p">(</span>
</span><span id="RuntimeChecker-642"><a href="#RuntimeChecker-642"><span class="linenos"> 642</span></a>                            <span class="n">package</span>
</span><span id="RuntimeChecker-643"><a href="#RuntimeChecker-643"><span class="linenos"> 643</span></a>                    <span class="p">):</span>
</span><span id="RuntimeChecker-644"><a href="#RuntimeChecker-644"><span class="linenos"> 644</span></a>                        <span class="n">boot_kernel_package_name</span> <span class="o">=</span> <span class="n">package</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
</span><span id="RuntimeChecker-645"><a href="#RuntimeChecker-645"><span class="linenos"> 645</span></a>
</span><span id="RuntimeChecker-646"><a href="#RuntimeChecker-646"><span class="linenos"> 646</span></a>        <span class="k">if</span> <span class="n">boot_kernel_package_name</span><span class="p">:</span>
</span><span id="RuntimeChecker-647"><a href="#RuntimeChecker-647"><span class="linenos"> 647</span></a>            <span class="c1"># A kernel package name was found in the kiwi boot image</span>
</span><span id="RuntimeChecker-648"><a href="#RuntimeChecker-648"><span class="linenos"> 648</span></a>            <span class="c1"># description. Let&#39;s check if this kernel is also used</span>
</span><span id="RuntimeChecker-649"><a href="#RuntimeChecker-649"><span class="linenos"> 649</span></a>            <span class="c1"># in the system image</span>
</span><span id="RuntimeChecker-650"><a href="#RuntimeChecker-650"><span class="linenos"> 650</span></a>            <span class="n">image_package_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_system_packages</span><span class="p">()</span>
</span><span id="RuntimeChecker-651"><a href="#RuntimeChecker-651"><span class="linenos"> 651</span></a>            <span class="k">if</span> <span class="n">boot_kernel_package_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">image_package_names</span><span class="p">:</span>
</span><span id="RuntimeChecker-652"><a href="#RuntimeChecker-652"><span class="linenos"> 652</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker-653"><a href="#RuntimeChecker-653"><span class="linenos"> 653</span></a>                    <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="RuntimeChecker-654"><a href="#RuntimeChecker-654"><span class="linenos"> 654</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_boot</span><span class="p">(),</span>
</span><span id="RuntimeChecker-655"><a href="#RuntimeChecker-655"><span class="linenos"> 655</span></a>                        <span class="n">boot_kernel_package_name</span>
</span><span id="RuntimeChecker-656"><a href="#RuntimeChecker-656"><span class="linenos"> 656</span></a>                    <span class="p">)</span>
</span><span id="RuntimeChecker-657"><a href="#RuntimeChecker-657"><span class="linenos"> 657</span></a>                <span class="p">)</span>
</span><span id="RuntimeChecker-658"><a href="#RuntimeChecker-658"><span class="linenos"> 658</span></a>
</span><span id="RuntimeChecker-659"><a href="#RuntimeChecker-659"><span class="linenos"> 659</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_dracut_module_versions_compatible_to_kiwi</span><span class="p">(</span>
</span><span id="RuntimeChecker-660"><a href="#RuntimeChecker-660"><span class="linenos"> 660</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">root_dir</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="RuntimeChecker-661"><a href="#RuntimeChecker-661"><span class="linenos"> 661</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker-662"><a href="#RuntimeChecker-662"><span class="linenos"> 662</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-663"><a href="#RuntimeChecker-663"><span class="linenos"> 663</span></a><span class="sd">        KIWI images which makes use of kiwi dracut modules</span>
</span><span id="RuntimeChecker-664"><a href="#RuntimeChecker-664"><span class="linenos"> 664</span></a><span class="sd">        has to use module versions compatible with the version</span>
</span><span id="RuntimeChecker-665"><a href="#RuntimeChecker-665"><span class="linenos"> 665</span></a><span class="sd">        of this KIWI builder code base. This is important to avoid</span>
</span><span id="RuntimeChecker-666"><a href="#RuntimeChecker-666"><span class="linenos"> 666</span></a><span class="sd">        inconsistencies between the way how kiwi includes its own</span>
</span><span id="RuntimeChecker-667"><a href="#RuntimeChecker-667"><span class="linenos"> 667</span></a><span class="sd">        dracut modules and former version of those dracut modules</span>
</span><span id="RuntimeChecker-668"><a href="#RuntimeChecker-668"><span class="linenos"> 668</span></a><span class="sd">        which could be no longer compatible with the builder.</span>
</span><span id="RuntimeChecker-669"><a href="#RuntimeChecker-669"><span class="linenos"> 669</span></a><span class="sd">        Therefore this runtime check maintains a min_version constraint</span>
</span><span id="RuntimeChecker-670"><a href="#RuntimeChecker-670"><span class="linenos"> 670</span></a><span class="sd">        for which we know this KIWI builder to be compatible with.</span>
</span><span id="RuntimeChecker-671"><a href="#RuntimeChecker-671"><span class="linenos"> 671</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-672"><a href="#RuntimeChecker-672"><span class="linenos"> 672</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker-673"><a href="#RuntimeChecker-673"><span class="linenos"> 673</span></a><span class="s1">            Incompatible dracut-kiwi module(s) found</span>
</span><span id="RuntimeChecker-674"><a href="#RuntimeChecker-674"><span class="linenos"> 674</span></a>
</span><span id="RuntimeChecker-675"><a href="#RuntimeChecker-675"><span class="linenos"> 675</span></a><span class="s1">            The image was build with KIWI version=</span><span class="si">{0}</span><span class="s1">. The system</span>
</span><span id="RuntimeChecker-676"><a href="#RuntimeChecker-676"><span class="linenos"> 676</span></a><span class="s1">            root tree has the following dracut-kiwi-* module packages</span>
</span><span id="RuntimeChecker-677"><a href="#RuntimeChecker-677"><span class="linenos"> 677</span></a><span class="s1">            installed which are too old to work with this version of KIWI.</span>
</span><span id="RuntimeChecker-678"><a href="#RuntimeChecker-678"><span class="linenos"> 678</span></a><span class="s1">            Please make sure to use dracut-kiwi-* module packages</span>
</span><span id="RuntimeChecker-679"><a href="#RuntimeChecker-679"><span class="linenos"> 679</span></a><span class="s1">            which are &gt;= than the versions listed below.</span>
</span><span id="RuntimeChecker-680"><a href="#RuntimeChecker-680"><span class="linenos"> 680</span></a>
</span><span id="RuntimeChecker-681"><a href="#RuntimeChecker-681"><span class="linenos"> 681</span></a><span class="s1">            </span><span class="si">{1}</span>
</span><span id="RuntimeChecker-682"><a href="#RuntimeChecker-682"><span class="linenos"> 682</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker-683"><a href="#RuntimeChecker-683"><span class="linenos"> 683</span></a>        <span class="n">kiwi_dracut_modules</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="RuntimeChecker-684"><a href="#RuntimeChecker-684"><span class="linenos"> 684</span></a>            <span class="s1">&#39;55kiwi-dump&#39;</span><span class="p">:</span> <span class="n">dracut_module_type</span><span class="p">(</span>
</span><span id="RuntimeChecker-685"><a href="#RuntimeChecker-685"><span class="linenos"> 685</span></a>                <span class="s1">&#39;dracut-kiwi-oem-dump&#39;</span><span class="p">,</span> <span class="s1">&#39;9.20.1&#39;</span>
</span><span id="RuntimeChecker-686"><a href="#RuntimeChecker-686"><span class="linenos"> 686</span></a>            <span class="p">),</span>
</span><span id="RuntimeChecker-687"><a href="#RuntimeChecker-687"><span class="linenos"> 687</span></a>            <span class="s1">&#39;55kiwi-live&#39;</span><span class="p">:</span> <span class="n">dracut_module_type</span><span class="p">(</span>
</span><span id="RuntimeChecker-688"><a href="#RuntimeChecker-688"><span class="linenos"> 688</span></a>                <span class="s1">&#39;dracut-kiwi-live&#39;</span><span class="p">,</span> <span class="s1">&#39;9.20.1&#39;</span>
</span><span id="RuntimeChecker-689"><a href="#RuntimeChecker-689"><span class="linenos"> 689</span></a>            <span class="p">),</span>
</span><span id="RuntimeChecker-690"><a href="#RuntimeChecker-690"><span class="linenos"> 690</span></a>            <span class="s1">&#39;55kiwi-overlay&#39;</span><span class="p">:</span> <span class="n">dracut_module_type</span><span class="p">(</span>
</span><span id="RuntimeChecker-691"><a href="#RuntimeChecker-691"><span class="linenos"> 691</span></a>                <span class="s1">&#39;dracut-kiwi-overlay&#39;</span><span class="p">,</span> <span class="s1">&#39;9.20.1&#39;</span>
</span><span id="RuntimeChecker-692"><a href="#RuntimeChecker-692"><span class="linenos"> 692</span></a>            <span class="p">),</span>
</span><span id="RuntimeChecker-693"><a href="#RuntimeChecker-693"><span class="linenos"> 693</span></a>            <span class="s1">&#39;55kiwi-repart&#39;</span><span class="p">:</span> <span class="n">dracut_module_type</span><span class="p">(</span>
</span><span id="RuntimeChecker-694"><a href="#RuntimeChecker-694"><span class="linenos"> 694</span></a>                <span class="s1">&#39;dracut-kiwi-oem-repart&#39;</span><span class="p">,</span> <span class="s1">&#39;9.20.1&#39;</span>
</span><span id="RuntimeChecker-695"><a href="#RuntimeChecker-695"><span class="linenos"> 695</span></a>            <span class="p">),</span>
</span><span id="RuntimeChecker-696"><a href="#RuntimeChecker-696"><span class="linenos"> 696</span></a>            <span class="s1">&#39;59kiwi-dump-reboot&#39;</span><span class="p">:</span> <span class="n">dracut_module_type</span><span class="p">(</span>
</span><span id="RuntimeChecker-697"><a href="#RuntimeChecker-697"><span class="linenos"> 697</span></a>                <span class="s1">&#39;dracut-kiwi-oem-dump&#39;</span><span class="p">,</span> <span class="s1">&#39;9.20.1&#39;</span>
</span><span id="RuntimeChecker-698"><a href="#RuntimeChecker-698"><span class="linenos"> 698</span></a>            <span class="p">),</span>
</span><span id="RuntimeChecker-699"><a href="#RuntimeChecker-699"><span class="linenos"> 699</span></a>            <span class="s1">&#39;59kiwi-lib&#39;</span><span class="p">:</span> <span class="n">dracut_module_type</span><span class="p">(</span>
</span><span id="RuntimeChecker-700"><a href="#RuntimeChecker-700"><span class="linenos"> 700</span></a>                <span class="s1">&#39;dracut-kiwi-lib&#39;</span><span class="p">,</span> <span class="s1">&#39;9.20.1&#39;</span>
</span><span id="RuntimeChecker-701"><a href="#RuntimeChecker-701"><span class="linenos"> 701</span></a>            <span class="p">)</span>
</span><span id="RuntimeChecker-702"><a href="#RuntimeChecker-702"><span class="linenos"> 702</span></a>        <span class="p">}</span>
</span><span id="RuntimeChecker-703"><a href="#RuntimeChecker-703"><span class="linenos"> 703</span></a>        <span class="n">dracut_module_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="RuntimeChecker-704"><a href="#RuntimeChecker-704"><span class="linenos"> 704</span></a>            <span class="p">[</span><span class="n">root_dir</span><span class="p">,</span> <span class="s1">&#39;/usr/lib/dracut/modules.d&#39;</span><span class="p">]</span>
</span><span id="RuntimeChecker-705"><a href="#RuntimeChecker-705"><span class="linenos"> 705</span></a>        <span class="p">)</span>
</span><span id="RuntimeChecker-706"><a href="#RuntimeChecker-706"><span class="linenos"> 706</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">dracut_module_dir</span><span class="p">):</span>
</span><span id="RuntimeChecker-707"><a href="#RuntimeChecker-707"><span class="linenos"> 707</span></a>            <span class="c1"># no dracut module dir present</span>
</span><span id="RuntimeChecker-708"><a href="#RuntimeChecker-708"><span class="linenos"> 708</span></a>            <span class="k">return</span>
</span><span id="RuntimeChecker-709"><a href="#RuntimeChecker-709"><span class="linenos"> 709</span></a>
</span><span id="RuntimeChecker-710"><a href="#RuntimeChecker-710"><span class="linenos"> 710</span></a>        <span class="n">incompatible_modules</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="RuntimeChecker-711"><a href="#RuntimeChecker-711"><span class="linenos"> 711</span></a>        <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dracut_module_dir</span><span class="p">):</span>
</span><span id="RuntimeChecker-712"><a href="#RuntimeChecker-712"><span class="linenos"> 712</span></a>            <span class="n">module_meta</span> <span class="o">=</span> <span class="n">kiwi_dracut_modules</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>
</span><span id="RuntimeChecker-713"><a href="#RuntimeChecker-713"><span class="linenos"> 713</span></a>            <span class="k">if</span> <span class="n">module_meta</span><span class="p">:</span>
</span><span id="RuntimeChecker-714"><a href="#RuntimeChecker-714"><span class="linenos"> 714</span></a>                <span class="n">module_version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dracut_module_version_from_pdb</span><span class="p">(</span>
</span><span id="RuntimeChecker-715"><a href="#RuntimeChecker-715"><span class="linenos"> 715</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_package_manager</span><span class="p">(),</span>
</span><span id="RuntimeChecker-716"><a href="#RuntimeChecker-716"><span class="linenos"> 716</span></a>                    <span class="n">module_meta</span><span class="o">.</span><span class="n">package</span><span class="p">,</span> <span class="n">root_dir</span>
</span><span id="RuntimeChecker-717"><a href="#RuntimeChecker-717"><span class="linenos"> 717</span></a>                <span class="p">)</span>
</span><span id="RuntimeChecker-718"><a href="#RuntimeChecker-718"><span class="linenos"> 718</span></a>                <span class="k">if</span> <span class="n">module_version</span><span class="p">:</span>
</span><span id="RuntimeChecker-719"><a href="#RuntimeChecker-719"><span class="linenos"> 719</span></a>                    <span class="n">module_version_nr</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="RuntimeChecker-720"><a href="#RuntimeChecker-720"><span class="linenos"> 720</span></a>                        <span class="nb">int</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">module_version</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker-721"><a href="#RuntimeChecker-721"><span class="linenos"> 721</span></a>                    <span class="p">)</span>
</span><span id="RuntimeChecker-722"><a href="#RuntimeChecker-722"><span class="linenos"> 722</span></a>                    <span class="n">module_min_version_nr</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="RuntimeChecker-723"><a href="#RuntimeChecker-723"><span class="linenos"> 723</span></a>                        <span class="nb">int</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">module_meta</span><span class="o">.</span><span class="n">min_version</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker-724"><a href="#RuntimeChecker-724"><span class="linenos"> 724</span></a>                    <span class="p">)</span>
</span><span id="RuntimeChecker-725"><a href="#RuntimeChecker-725"><span class="linenos"> 725</span></a>                    <span class="k">if</span> <span class="n">module_version_nr</span> <span class="o">&lt;</span> <span class="n">module_min_version_nr</span><span class="p">:</span>
</span><span id="RuntimeChecker-726"><a href="#RuntimeChecker-726"><span class="linenos"> 726</span></a>                        <span class="n">incompatible_modules</span><span class="p">[</span>
</span><span id="RuntimeChecker-727"><a href="#RuntimeChecker-727"><span class="linenos"> 727</span></a>                            <span class="n">module_meta</span><span class="o">.</span><span class="n">package</span>
</span><span id="RuntimeChecker-728"><a href="#RuntimeChecker-728"><span class="linenos"> 728</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;got:</span><span class="si">{0}</span><span class="s1">, need:&gt;=</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="RuntimeChecker-729"><a href="#RuntimeChecker-729"><span class="linenos"> 729</span></a>                            <span class="n">module_version</span><span class="p">,</span> <span class="n">module_meta</span><span class="o">.</span><span class="n">min_version</span>
</span><span id="RuntimeChecker-730"><a href="#RuntimeChecker-730"><span class="linenos"> 730</span></a>                        <span class="p">)</span>
</span><span id="RuntimeChecker-731"><a href="#RuntimeChecker-731"><span class="linenos"> 731</span></a>        <span class="k">if</span> <span class="n">incompatible_modules</span><span class="p">:</span>
</span><span id="RuntimeChecker-732"><a href="#RuntimeChecker-732"><span class="linenos"> 732</span></a>            <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker-733"><a href="#RuntimeChecker-733"><span class="linenos"> 733</span></a>                <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">__version__</span><span class="p">,</span> <span class="n">incompatible_modules</span><span class="p">)</span>
</span><span id="RuntimeChecker-734"><a href="#RuntimeChecker-734"><span class="linenos"> 734</span></a>            <span class="p">)</span>
</span><span id="RuntimeChecker-735"><a href="#RuntimeChecker-735"><span class="linenos"> 735</span></a>
</span><span id="RuntimeChecker-736"><a href="#RuntimeChecker-736"><span class="linenos"> 736</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_dracut_module_for_oem_install_in_package_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker-737"><a href="#RuntimeChecker-737"><span class="linenos"> 737</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-738"><a href="#RuntimeChecker-738"><span class="linenos"> 738</span></a><span class="sd">        OEM images if configured to use dracut as initrd system</span>
</span><span id="RuntimeChecker-739"><a href="#RuntimeChecker-739"><span class="linenos"> 739</span></a><span class="sd">        and configured with one of the installiso, installstick</span>
</span><span id="RuntimeChecker-740"><a href="#RuntimeChecker-740"><span class="linenos"> 740</span></a><span class="sd">        or installpxe attributes requires the KIWI provided</span>
</span><span id="RuntimeChecker-741"><a href="#RuntimeChecker-741"><span class="linenos"> 741</span></a><span class="sd">        dracut-kiwi-oem-dump module to be installed at the time</span>
</span><span id="RuntimeChecker-742"><a href="#RuntimeChecker-742"><span class="linenos"> 742</span></a><span class="sd">        dracut is called. Thus this runtime check examines if the</span>
</span><span id="RuntimeChecker-743"><a href="#RuntimeChecker-743"><span class="linenos"> 743</span></a><span class="sd">        required package is part of the package list in the</span>
</span><span id="RuntimeChecker-744"><a href="#RuntimeChecker-744"><span class="linenos"> 744</span></a><span class="sd">        image description.</span>
</span><span id="RuntimeChecker-745"><a href="#RuntimeChecker-745"><span class="linenos"> 745</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-746"><a href="#RuntimeChecker-746"><span class="linenos"> 746</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker-747"><a href="#RuntimeChecker-747"><span class="linenos"> 747</span></a><span class="s1">            Required dracut module package missing in package list</span>
</span><span id="RuntimeChecker-748"><a href="#RuntimeChecker-748"><span class="linenos"> 748</span></a>
</span><span id="RuntimeChecker-749"><a href="#RuntimeChecker-749"><span class="linenos"> 749</span></a><span class="s1">            One of the packages &#39;</span><span class="si">{0}</span><span class="s1">&#39; is required</span>
</span><span id="RuntimeChecker-750"><a href="#RuntimeChecker-750"><span class="linenos"> 750</span></a><span class="s1">            to build an installation image for the selected oem image type.</span>
</span><span id="RuntimeChecker-751"><a href="#RuntimeChecker-751"><span class="linenos"> 751</span></a><span class="s1">            Depending on your distribution, add the following in the</span>
</span><span id="RuntimeChecker-752"><a href="#RuntimeChecker-752"><span class="linenos"> 752</span></a><span class="s1">            &lt;packages type=&quot;image&quot;&gt; section:</span>
</span><span id="RuntimeChecker-753"><a href="#RuntimeChecker-753"><span class="linenos"> 753</span></a>
</span><span id="RuntimeChecker-754"><a href="#RuntimeChecker-754"><span class="linenos"> 754</span></a><span class="s1">            &lt;package name=&quot;ONE_FROM_ABOVE&quot;/&gt;</span>
</span><span id="RuntimeChecker-755"><a href="#RuntimeChecker-755"><span class="linenos"> 755</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker-756"><a href="#RuntimeChecker-756"><span class="linenos"> 756</span></a>        <span class="n">meta</span> <span class="o">=</span> <span class="n">Defaults</span><span class="o">.</span><span class="n">get_runtime_checker_metadata</span><span class="p">()</span>
</span><span id="RuntimeChecker-757"><a href="#RuntimeChecker-757"><span class="linenos"> 757</span></a>        <span class="n">required_dracut_packages</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;package_names&#39;</span><span class="p">][</span><span class="s1">&#39;dracut_oem_dump&#39;</span><span class="p">]</span>
</span><span id="RuntimeChecker-758"><a href="#RuntimeChecker-758"><span class="linenos"> 758</span></a>        <span class="n">initrd_system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_initrd_system</span><span class="p">()</span>
</span><span id="RuntimeChecker-759"><a href="#RuntimeChecker-759"><span class="linenos"> 759</span></a>        <span class="n">build_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_build_type_name</span><span class="p">()</span>
</span><span id="RuntimeChecker-760"><a href="#RuntimeChecker-760"><span class="linenos"> 760</span></a>        <span class="k">if</span> <span class="n">build_type</span> <span class="o">==</span> <span class="s1">&#39;oem&#39;</span> <span class="ow">and</span> <span class="n">initrd_system</span> <span class="o">==</span> <span class="s1">&#39;dracut&#39;</span><span class="p">:</span>
</span><span id="RuntimeChecker-761"><a href="#RuntimeChecker-761"><span class="linenos"> 761</span></a>            <span class="n">install_iso</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_installiso</span><span class="p">()</span>
</span><span id="RuntimeChecker-762"><a href="#RuntimeChecker-762"><span class="linenos"> 762</span></a>            <span class="n">install_stick</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_installstick</span><span class="p">()</span>
</span><span id="RuntimeChecker-763"><a href="#RuntimeChecker-763"><span class="linenos"> 763</span></a>            <span class="n">install_pxe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_installpxe</span><span class="p">()</span>
</span><span id="RuntimeChecker-764"><a href="#RuntimeChecker-764"><span class="linenos"> 764</span></a>            <span class="k">if</span> <span class="n">install_iso</span> <span class="ow">or</span> <span class="n">install_stick</span> <span class="ow">or</span> <span class="n">install_pxe</span><span class="p">:</span>
</span><span id="RuntimeChecker-765"><a href="#RuntimeChecker-765"><span class="linenos"> 765</span></a>                <span class="n">package_names</span> <span class="o">=</span> \
</span><span id="RuntimeChecker-766"><a href="#RuntimeChecker-766"><span class="linenos"> 766</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_bootstrap_packages</span><span class="p">()</span> <span class="o">+</span> \
</span><span id="RuntimeChecker-767"><a href="#RuntimeChecker-767"><span class="linenos"> 767</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_system_packages</span><span class="p">()</span>
</span><span id="RuntimeChecker-768"><a href="#RuntimeChecker-768"><span class="linenos"> 768</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">RuntimeChecker</span><span class="o">.</span><span class="n">_package_in_list</span><span class="p">(</span>
</span><span id="RuntimeChecker-769"><a href="#RuntimeChecker-769"><span class="linenos"> 769</span></a>                    <span class="n">package_names</span><span class="p">,</span> <span class="n">required_dracut_packages</span>
</span><span id="RuntimeChecker-770"><a href="#RuntimeChecker-770"><span class="linenos"> 770</span></a>                <span class="p">):</span>
</span><span id="RuntimeChecker-771"><a href="#RuntimeChecker-771"><span class="linenos"> 771</span></a>                    <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker-772"><a href="#RuntimeChecker-772"><span class="linenos"> 772</span></a>                        <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">required_dracut_packages</span><span class="p">)</span>
</span><span id="RuntimeChecker-773"><a href="#RuntimeChecker-773"><span class="linenos"> 773</span></a>                    <span class="p">)</span>
</span><span id="RuntimeChecker-774"><a href="#RuntimeChecker-774"><span class="linenos"> 774</span></a>
</span><span id="RuntimeChecker-775"><a href="#RuntimeChecker-775"><span class="linenos"> 775</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_dracut_module_for_disk_oem_in_package_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker-776"><a href="#RuntimeChecker-776"><span class="linenos"> 776</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-777"><a href="#RuntimeChecker-777"><span class="linenos"> 777</span></a><span class="sd">        OEM images if configured to use dracut as initrd system</span>
</span><span id="RuntimeChecker-778"><a href="#RuntimeChecker-778"><span class="linenos"> 778</span></a><span class="sd">        requires the KIWI provided dracut-kiwi-oem-repart module</span>
</span><span id="RuntimeChecker-779"><a href="#RuntimeChecker-779"><span class="linenos"> 779</span></a><span class="sd">        to be installed at the time dracut is called. Thus this</span>
</span><span id="RuntimeChecker-780"><a href="#RuntimeChecker-780"><span class="linenos"> 780</span></a><span class="sd">        runtime check examines if the required package is part of</span>
</span><span id="RuntimeChecker-781"><a href="#RuntimeChecker-781"><span class="linenos"> 781</span></a><span class="sd">        the package list in the image description.</span>
</span><span id="RuntimeChecker-782"><a href="#RuntimeChecker-782"><span class="linenos"> 782</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-783"><a href="#RuntimeChecker-783"><span class="linenos"> 783</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker-784"><a href="#RuntimeChecker-784"><span class="linenos"> 784</span></a><span class="s1">            Required dracut module package missing in package list</span>
</span><span id="RuntimeChecker-785"><a href="#RuntimeChecker-785"><span class="linenos"> 785</span></a>
</span><span id="RuntimeChecker-786"><a href="#RuntimeChecker-786"><span class="linenos"> 786</span></a><span class="s1">            One of the packages &#39;</span><span class="si">{0}</span><span class="s1">&#39; is required</span>
</span><span id="RuntimeChecker-787"><a href="#RuntimeChecker-787"><span class="linenos"> 787</span></a><span class="s1">            for the selected oem image type. Depending on your distribution,</span>
</span><span id="RuntimeChecker-788"><a href="#RuntimeChecker-788"><span class="linenos"> 788</span></a><span class="s1">            add the following in the &lt;packages type=&quot;image&quot;&gt; section:</span>
</span><span id="RuntimeChecker-789"><a href="#RuntimeChecker-789"><span class="linenos"> 789</span></a>
</span><span id="RuntimeChecker-790"><a href="#RuntimeChecker-790"><span class="linenos"> 790</span></a><span class="s1">            &lt;package name=&quot;ONE_FROM_ABOVE&quot;/&gt;</span>
</span><span id="RuntimeChecker-791"><a href="#RuntimeChecker-791"><span class="linenos"> 791</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker-792"><a href="#RuntimeChecker-792"><span class="linenos"> 792</span></a>        <span class="n">meta</span> <span class="o">=</span> <span class="n">Defaults</span><span class="o">.</span><span class="n">get_runtime_checker_metadata</span><span class="p">()</span>
</span><span id="RuntimeChecker-793"><a href="#RuntimeChecker-793"><span class="linenos"> 793</span></a>        <span class="n">required_dracut_packages</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;package_names&#39;</span><span class="p">][</span><span class="s1">&#39;dracut_oem_repart&#39;</span><span class="p">]</span>
</span><span id="RuntimeChecker-794"><a href="#RuntimeChecker-794"><span class="linenos"> 794</span></a>        <span class="n">initrd_system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_initrd_system</span><span class="p">()</span>
</span><span id="RuntimeChecker-795"><a href="#RuntimeChecker-795"><span class="linenos"> 795</span></a>        <span class="n">disk_resize_requested</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_oemconfig_oem_resize</span><span class="p">()</span>
</span><span id="RuntimeChecker-796"><a href="#RuntimeChecker-796"><span class="linenos"> 796</span></a>        <span class="n">build_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_build_type_name</span><span class="p">()</span>
</span><span id="RuntimeChecker-797"><a href="#RuntimeChecker-797"><span class="linenos"> 797</span></a>        <span class="k">if</span> <span class="n">build_type</span> <span class="o">==</span> <span class="s1">&#39;oem&#39;</span> <span class="ow">and</span> <span class="n">initrd_system</span> <span class="o">==</span> <span class="s1">&#39;dracut&#39;</span> <span class="ow">and</span> \
</span><span id="RuntimeChecker-798"><a href="#RuntimeChecker-798"><span class="linenos"> 798</span></a>           <span class="n">disk_resize_requested</span><span class="p">:</span>
</span><span id="RuntimeChecker-799"><a href="#RuntimeChecker-799"><span class="linenos"> 799</span></a>            <span class="n">package_names</span> <span class="o">=</span> \
</span><span id="RuntimeChecker-800"><a href="#RuntimeChecker-800"><span class="linenos"> 800</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_bootstrap_packages</span><span class="p">()</span> <span class="o">+</span> \
</span><span id="RuntimeChecker-801"><a href="#RuntimeChecker-801"><span class="linenos"> 801</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_system_packages</span><span class="p">()</span>
</span><span id="RuntimeChecker-802"><a href="#RuntimeChecker-802"><span class="linenos"> 802</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">RuntimeChecker</span><span class="o">.</span><span class="n">_package_in_list</span><span class="p">(</span>
</span><span id="RuntimeChecker-803"><a href="#RuntimeChecker-803"><span class="linenos"> 803</span></a>                <span class="n">package_names</span><span class="p">,</span> <span class="n">required_dracut_packages</span>
</span><span id="RuntimeChecker-804"><a href="#RuntimeChecker-804"><span class="linenos"> 804</span></a>            <span class="p">):</span>
</span><span id="RuntimeChecker-805"><a href="#RuntimeChecker-805"><span class="linenos"> 805</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker-806"><a href="#RuntimeChecker-806"><span class="linenos"> 806</span></a>                    <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">required_dracut_packages</span><span class="p">)</span>
</span><span id="RuntimeChecker-807"><a href="#RuntimeChecker-807"><span class="linenos"> 807</span></a>                <span class="p">)</span>
</span><span id="RuntimeChecker-808"><a href="#RuntimeChecker-808"><span class="linenos"> 808</span></a>
</span><span id="RuntimeChecker-809"><a href="#RuntimeChecker-809"><span class="linenos"> 809</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_dracut_module_for_live_iso_in_package_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker-810"><a href="#RuntimeChecker-810"><span class="linenos"> 810</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-811"><a href="#RuntimeChecker-811"><span class="linenos"> 811</span></a><span class="sd">        Live ISO images uses a dracut initrd to boot and requires</span>
</span><span id="RuntimeChecker-812"><a href="#RuntimeChecker-812"><span class="linenos"> 812</span></a><span class="sd">        the KIWI provided kiwi-live dracut module to be installed</span>
</span><span id="RuntimeChecker-813"><a href="#RuntimeChecker-813"><span class="linenos"> 813</span></a><span class="sd">        at the time dracut is called. Thus this runtime check</span>
</span><span id="RuntimeChecker-814"><a href="#RuntimeChecker-814"><span class="linenos"> 814</span></a><span class="sd">        examines if the required package is part of the package</span>
</span><span id="RuntimeChecker-815"><a href="#RuntimeChecker-815"><span class="linenos"> 815</span></a><span class="sd">        list in the image description.</span>
</span><span id="RuntimeChecker-816"><a href="#RuntimeChecker-816"><span class="linenos"> 816</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-817"><a href="#RuntimeChecker-817"><span class="linenos"> 817</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker-818"><a href="#RuntimeChecker-818"><span class="linenos"> 818</span></a><span class="s1">            Required dracut module package missing in package list</span>
</span><span id="RuntimeChecker-819"><a href="#RuntimeChecker-819"><span class="linenos"> 819</span></a>
</span><span id="RuntimeChecker-820"><a href="#RuntimeChecker-820"><span class="linenos"> 820</span></a><span class="s1">            One of the packages &#39;</span><span class="si">{0}</span><span class="s1">&#39; is required</span>
</span><span id="RuntimeChecker-821"><a href="#RuntimeChecker-821"><span class="linenos"> 821</span></a><span class="s1">            for the selected live iso image type. Depending on your distribution,</span>
</span><span id="RuntimeChecker-822"><a href="#RuntimeChecker-822"><span class="linenos"> 822</span></a><span class="s1">            add the following in your &lt;packages type=&quot;image&quot;&gt; section:</span>
</span><span id="RuntimeChecker-823"><a href="#RuntimeChecker-823"><span class="linenos"> 823</span></a>
</span><span id="RuntimeChecker-824"><a href="#RuntimeChecker-824"><span class="linenos"> 824</span></a><span class="s1">            &lt;package name=&quot;ONE_FROM_ABOVE&quot;/&gt;</span>
</span><span id="RuntimeChecker-825"><a href="#RuntimeChecker-825"><span class="linenos"> 825</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker-826"><a href="#RuntimeChecker-826"><span class="linenos"> 826</span></a>        <span class="n">meta</span> <span class="o">=</span> <span class="n">Defaults</span><span class="o">.</span><span class="n">get_runtime_checker_metadata</span><span class="p">()</span>
</span><span id="RuntimeChecker-827"><a href="#RuntimeChecker-827"><span class="linenos"> 827</span></a>        <span class="n">required_dracut_packages</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;package_names&#39;</span><span class="p">][</span><span class="s1">&#39;dracut_live&#39;</span><span class="p">]</span>
</span><span id="RuntimeChecker-828"><a href="#RuntimeChecker-828"><span class="linenos"> 828</span></a>        <span class="n">type_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_build_type_name</span><span class="p">()</span>
</span><span id="RuntimeChecker-829"><a href="#RuntimeChecker-829"><span class="linenos"> 829</span></a>        <span class="n">type_flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_flags</span><span class="p">()</span>
</span><span id="RuntimeChecker-830"><a href="#RuntimeChecker-830"><span class="linenos"> 830</span></a>        <span class="k">if</span> <span class="n">type_name</span> <span class="o">==</span> <span class="s1">&#39;iso&#39;</span> <span class="ow">and</span> <span class="n">type_flag</span> <span class="o">!=</span> <span class="s1">&#39;dmsquash&#39;</span><span class="p">:</span>
</span><span id="RuntimeChecker-831"><a href="#RuntimeChecker-831"><span class="linenos"> 831</span></a>            <span class="n">package_names</span> <span class="o">=</span> \
</span><span id="RuntimeChecker-832"><a href="#RuntimeChecker-832"><span class="linenos"> 832</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_bootstrap_packages</span><span class="p">()</span> <span class="o">+</span> \
</span><span id="RuntimeChecker-833"><a href="#RuntimeChecker-833"><span class="linenos"> 833</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_system_packages</span><span class="p">()</span>
</span><span id="RuntimeChecker-834"><a href="#RuntimeChecker-834"><span class="linenos"> 834</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">RuntimeChecker</span><span class="o">.</span><span class="n">_package_in_list</span><span class="p">(</span>
</span><span id="RuntimeChecker-835"><a href="#RuntimeChecker-835"><span class="linenos"> 835</span></a>                <span class="n">package_names</span><span class="p">,</span> <span class="n">required_dracut_packages</span>
</span><span id="RuntimeChecker-836"><a href="#RuntimeChecker-836"><span class="linenos"> 836</span></a>            <span class="p">):</span>
</span><span id="RuntimeChecker-837"><a href="#RuntimeChecker-837"><span class="linenos"> 837</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker-838"><a href="#RuntimeChecker-838"><span class="linenos"> 838</span></a>                    <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">required_dracut_packages</span><span class="p">)</span>
</span><span id="RuntimeChecker-839"><a href="#RuntimeChecker-839"><span class="linenos"> 839</span></a>                <span class="p">)</span>
</span><span id="RuntimeChecker-840"><a href="#RuntimeChecker-840"><span class="linenos"> 840</span></a>
</span><span id="RuntimeChecker-841"><a href="#RuntimeChecker-841"><span class="linenos"> 841</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_dracut_module_for_disk_overlay_in_package_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker-842"><a href="#RuntimeChecker-842"><span class="linenos"> 842</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-843"><a href="#RuntimeChecker-843"><span class="linenos"> 843</span></a><span class="sd">        Disk images configured to use a root filesystem overlay</span>
</span><span id="RuntimeChecker-844"><a href="#RuntimeChecker-844"><span class="linenos"> 844</span></a><span class="sd">        requires the KIWI provided kiwi-overlay dracut module to</span>
</span><span id="RuntimeChecker-845"><a href="#RuntimeChecker-845"><span class="linenos"> 845</span></a><span class="sd">        be installed at the time dracut is called. Thus this</span>
</span><span id="RuntimeChecker-846"><a href="#RuntimeChecker-846"><span class="linenos"> 846</span></a><span class="sd">        runtime check examines if the required package is part of</span>
</span><span id="RuntimeChecker-847"><a href="#RuntimeChecker-847"><span class="linenos"> 847</span></a><span class="sd">        the package list in the image description.</span>
</span><span id="RuntimeChecker-848"><a href="#RuntimeChecker-848"><span class="linenos"> 848</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-849"><a href="#RuntimeChecker-849"><span class="linenos"> 849</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker-850"><a href="#RuntimeChecker-850"><span class="linenos"> 850</span></a><span class="s1">            Required dracut module package missing in package list</span>
</span><span id="RuntimeChecker-851"><a href="#RuntimeChecker-851"><span class="linenos"> 851</span></a>
</span><span id="RuntimeChecker-852"><a href="#RuntimeChecker-852"><span class="linenos"> 852</span></a><span class="s1">            The package &#39;</span><span class="si">{0}</span><span class="s1">&#39; is required</span>
</span><span id="RuntimeChecker-853"><a href="#RuntimeChecker-853"><span class="linenos"> 853</span></a><span class="s1">            for the selected overlayroot activated image type.</span>
</span><span id="RuntimeChecker-854"><a href="#RuntimeChecker-854"><span class="linenos"> 854</span></a><span class="s1">            Depending on your distribution, add the following in your</span>
</span><span id="RuntimeChecker-855"><a href="#RuntimeChecker-855"><span class="linenos"> 855</span></a><span class="s1">            &lt;packages type=&quot;image&quot;&gt; section:</span>
</span><span id="RuntimeChecker-856"><a href="#RuntimeChecker-856"><span class="linenos"> 856</span></a>
</span><span id="RuntimeChecker-857"><a href="#RuntimeChecker-857"><span class="linenos"> 857</span></a><span class="s1">            &lt;package name=&quot;ONE_FROM_ABOVE&quot;/&gt;</span>
</span><span id="RuntimeChecker-858"><a href="#RuntimeChecker-858"><span class="linenos"> 858</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker-859"><a href="#RuntimeChecker-859"><span class="linenos"> 859</span></a>        <span class="n">initrd_system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_initrd_system</span><span class="p">()</span>
</span><span id="RuntimeChecker-860"><a href="#RuntimeChecker-860"><span class="linenos"> 860</span></a>        <span class="n">meta</span> <span class="o">=</span> <span class="n">Defaults</span><span class="o">.</span><span class="n">get_runtime_checker_metadata</span><span class="p">()</span>
</span><span id="RuntimeChecker-861"><a href="#RuntimeChecker-861"><span class="linenos"> 861</span></a>        <span class="n">required_dracut_packages</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;package_names&#39;</span><span class="p">][</span><span class="s1">&#39;dracut_overlay&#39;</span><span class="p">]</span>
</span><span id="RuntimeChecker-862"><a href="#RuntimeChecker-862"><span class="linenos"> 862</span></a>        <span class="k">if</span> <span class="n">initrd_system</span> <span class="o">==</span> <span class="s1">&#39;dracut&#39;</span> <span class="ow">and</span> \
</span><span id="RuntimeChecker-863"><a href="#RuntimeChecker-863"><span class="linenos"> 863</span></a>           <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_overlayroot</span><span class="p">():</span>
</span><span id="RuntimeChecker-864"><a href="#RuntimeChecker-864"><span class="linenos"> 864</span></a>            <span class="n">package_names</span> <span class="o">=</span> \
</span><span id="RuntimeChecker-865"><a href="#RuntimeChecker-865"><span class="linenos"> 865</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_bootstrap_packages</span><span class="p">()</span> <span class="o">+</span> \
</span><span id="RuntimeChecker-866"><a href="#RuntimeChecker-866"><span class="linenos"> 866</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_system_packages</span><span class="p">()</span>
</span><span id="RuntimeChecker-867"><a href="#RuntimeChecker-867"><span class="linenos"> 867</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">RuntimeChecker</span><span class="o">.</span><span class="n">_package_in_list</span><span class="p">(</span>
</span><span id="RuntimeChecker-868"><a href="#RuntimeChecker-868"><span class="linenos"> 868</span></a>                <span class="n">package_names</span><span class="p">,</span> <span class="n">required_dracut_packages</span>
</span><span id="RuntimeChecker-869"><a href="#RuntimeChecker-869"><span class="linenos"> 869</span></a>            <span class="p">):</span>
</span><span id="RuntimeChecker-870"><a href="#RuntimeChecker-870"><span class="linenos"> 870</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker-871"><a href="#RuntimeChecker-871"><span class="linenos"> 871</span></a>                    <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">required_dracut_packages</span><span class="p">)</span>
</span><span id="RuntimeChecker-872"><a href="#RuntimeChecker-872"><span class="linenos"> 872</span></a>                <span class="p">)</span>
</span><span id="RuntimeChecker-873"><a href="#RuntimeChecker-873"><span class="linenos"> 873</span></a>
</span><span id="RuntimeChecker-874"><a href="#RuntimeChecker-874"><span class="linenos"> 874</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_xen_uniquely_setup_as_server_or_guest</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker-875"><a href="#RuntimeChecker-875"><span class="linenos"> 875</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-876"><a href="#RuntimeChecker-876"><span class="linenos"> 876</span></a><span class="sd">        If the image is classified to be used as Xen image, it can</span>
</span><span id="RuntimeChecker-877"><a href="#RuntimeChecker-877"><span class="linenos"> 877</span></a><span class="sd">        be either a Xen Server(dom0) or a Xen guest. The image</span>
</span><span id="RuntimeChecker-878"><a href="#RuntimeChecker-878"><span class="linenos"> 878</span></a><span class="sd">        configuration is checked if the information uniquely identifies</span>
</span><span id="RuntimeChecker-879"><a href="#RuntimeChecker-879"><span class="linenos"> 879</span></a><span class="sd">        the image as such</span>
</span><span id="RuntimeChecker-880"><a href="#RuntimeChecker-880"><span class="linenos"> 880</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-881"><a href="#RuntimeChecker-881"><span class="linenos"> 881</span></a>        <span class="n">xen_message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker-882"><a href="#RuntimeChecker-882"><span class="linenos"> 882</span></a><span class="s1">            Inconsistent Xen setup found:</span>
</span><span id="RuntimeChecker-883"><a href="#RuntimeChecker-883"><span class="linenos"> 883</span></a>
</span><span id="RuntimeChecker-884"><a href="#RuntimeChecker-884"><span class="linenos"> 884</span></a><span class="s1">            The use of the &#39;xen_server&#39; or &#39;xen_loader&#39; attributes indicates</span>
</span><span id="RuntimeChecker-885"><a href="#RuntimeChecker-885"><span class="linenos"> 885</span></a><span class="s1">            the target system for this image is Xen. However the image</span>
</span><span id="RuntimeChecker-886"><a href="#RuntimeChecker-886"><span class="linenos"> 886</span></a><span class="s1">            specifies both attributes at the same time which classifies</span>
</span><span id="RuntimeChecker-887"><a href="#RuntimeChecker-887"><span class="linenos"> 887</span></a><span class="s1">            the image to be both, a Xen Server(dom0) and a Xen guest at</span>
</span><span id="RuntimeChecker-888"><a href="#RuntimeChecker-888"><span class="linenos"> 888</span></a><span class="s1">            the same time, which is not supported.</span>
</span><span id="RuntimeChecker-889"><a href="#RuntimeChecker-889"><span class="linenos"> 889</span></a>
</span><span id="RuntimeChecker-890"><a href="#RuntimeChecker-890"><span class="linenos"> 890</span></a><span class="s1">            Please cleanup your image description. Setup only one</span>
</span><span id="RuntimeChecker-891"><a href="#RuntimeChecker-891"><span class="linenos"> 891</span></a><span class="s1">            of &#39;xen_server&#39; or &#39;xen_loader&#39;.</span>
</span><span id="RuntimeChecker-892"><a href="#RuntimeChecker-892"><span class="linenos"> 892</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker-893"><a href="#RuntimeChecker-893"><span class="linenos"> 893</span></a>        <span class="n">ec2_message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker-894"><a href="#RuntimeChecker-894"><span class="linenos"> 894</span></a><span class="s1">            Inconsistent Amazon EC2 setup found:</span>
</span><span id="RuntimeChecker-895"><a href="#RuntimeChecker-895"><span class="linenos"> 895</span></a>
</span><span id="RuntimeChecker-896"><a href="#RuntimeChecker-896"><span class="linenos"> 896</span></a><span class="s1">            The firmware setup indicates the target system for this image</span>
</span><span id="RuntimeChecker-897"><a href="#RuntimeChecker-897"><span class="linenos"> 897</span></a><span class="s1">            is Amazon EC2, which uses a Xen based virtualisation technology.</span>
</span><span id="RuntimeChecker-898"><a href="#RuntimeChecker-898"><span class="linenos"> 898</span></a><span class="s1">            Therefore the image must be classified as a Xen guest and can</span>
</span><span id="RuntimeChecker-899"><a href="#RuntimeChecker-899"><span class="linenos"> 899</span></a><span class="s1">            not be a Xen server as indicated by the &#39;xen_server&#39; attribute</span>
</span><span id="RuntimeChecker-900"><a href="#RuntimeChecker-900"><span class="linenos"> 900</span></a>
</span><span id="RuntimeChecker-901"><a href="#RuntimeChecker-901"><span class="linenos"> 901</span></a><span class="s1">            Please cleanup your image description. Delete the &#39;xen_server&#39;</span>
</span><span id="RuntimeChecker-902"><a href="#RuntimeChecker-902"><span class="linenos"> 902</span></a><span class="s1">            attribute for images used with Amazon EC2.</span>
</span><span id="RuntimeChecker-903"><a href="#RuntimeChecker-903"><span class="linenos"> 903</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker-904"><a href="#RuntimeChecker-904"><span class="linenos"> 904</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">is_xen_server</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">is_xen_guest</span><span class="p">():</span>
</span><span id="RuntimeChecker-905"><a href="#RuntimeChecker-905"><span class="linenos"> 905</span></a>            <span class="n">firmware</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_firmware</span><span class="p">()</span>
</span><span id="RuntimeChecker-906"><a href="#RuntimeChecker-906"><span class="linenos"> 906</span></a>            <span class="n">ec2_firmware_names</span> <span class="o">=</span> <span class="n">Defaults</span><span class="o">.</span><span class="n">get_ec2_capable_firmware_names</span><span class="p">()</span>
</span><span id="RuntimeChecker-907"><a href="#RuntimeChecker-907"><span class="linenos"> 907</span></a>            <span class="k">if</span> <span class="n">firmware</span> <span class="ow">and</span> <span class="n">firmware</span> <span class="ow">in</span> <span class="n">ec2_firmware_names</span><span class="p">:</span>
</span><span id="RuntimeChecker-908"><a href="#RuntimeChecker-908"><span class="linenos"> 908</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span><span class="n">ec2_message</span><span class="p">)</span>
</span><span id="RuntimeChecker-909"><a href="#RuntimeChecker-909"><span class="linenos"> 909</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="RuntimeChecker-910"><a href="#RuntimeChecker-910"><span class="linenos"> 910</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span><span class="n">xen_message</span><span class="p">)</span>
</span><span id="RuntimeChecker-911"><a href="#RuntimeChecker-911"><span class="linenos"> 911</span></a>
</span><span id="RuntimeChecker-912"><a href="#RuntimeChecker-912"><span class="linenos"> 912</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_mediacheck_installed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker-913"><a href="#RuntimeChecker-913"><span class="linenos"> 913</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-914"><a href="#RuntimeChecker-914"><span class="linenos"> 914</span></a><span class="sd">        If the image description enables the mediacheck attribute</span>
</span><span id="RuntimeChecker-915"><a href="#RuntimeChecker-915"><span class="linenos"> 915</span></a><span class="sd">        the required tools to run this check must be installed</span>
</span><span id="RuntimeChecker-916"><a href="#RuntimeChecker-916"><span class="linenos"> 916</span></a><span class="sd">        on the image build host</span>
</span><span id="RuntimeChecker-917"><a href="#RuntimeChecker-917"><span class="linenos"> 917</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-918"><a href="#RuntimeChecker-918"><span class="linenos"> 918</span></a>        <span class="n">message_tool_not_found</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker-919"><a href="#RuntimeChecker-919"><span class="linenos"> 919</span></a><span class="s1">            Required tool </span><span class="si">{name}</span><span class="s1"> not found in caller environment</span>
</span><span id="RuntimeChecker-920"><a href="#RuntimeChecker-920"><span class="linenos"> 920</span></a>
</span><span id="RuntimeChecker-921"><a href="#RuntimeChecker-921"><span class="linenos"> 921</span></a><span class="s1">            The attribute &#39;mediacheck&#39; is set to &#39;true&#39; which requires</span>
</span><span id="RuntimeChecker-922"><a href="#RuntimeChecker-922"><span class="linenos"> 922</span></a><span class="s1">            the above tool to be installed on the build system</span>
</span><span id="RuntimeChecker-923"><a href="#RuntimeChecker-923"><span class="linenos"> 923</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker-924"><a href="#RuntimeChecker-924"><span class="linenos"> 924</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_mediacheck</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="RuntimeChecker-925"><a href="#RuntimeChecker-925"><span class="linenos"> 925</span></a>            <span class="n">tool</span> <span class="o">=</span> <span class="s1">&#39;tagmedia&#39;</span>
</span><span id="RuntimeChecker-926"><a href="#RuntimeChecker-926"><span class="linenos"> 926</span></a>            <span class="n">media_tagger</span> <span class="o">=</span> <span class="n">RuntimeConfig</span><span class="p">()</span><span class="o">.</span><span class="n">get_iso_media_tag_tool</span><span class="p">()</span>
</span><span id="RuntimeChecker-927"><a href="#RuntimeChecker-927"><span class="linenos"> 927</span></a>            <span class="k">if</span> <span class="n">media_tagger</span> <span class="o">==</span> <span class="s1">&#39;checkmedia&#39;</span><span class="p">:</span>
</span><span id="RuntimeChecker-928"><a href="#RuntimeChecker-928"><span class="linenos"> 928</span></a>                <span class="n">tool</span> <span class="o">=</span> <span class="s1">&#39;tagmedia&#39;</span>
</span><span id="RuntimeChecker-929"><a href="#RuntimeChecker-929"><span class="linenos"> 929</span></a>            <span class="k">elif</span> <span class="n">media_tagger</span> <span class="o">==</span> <span class="s1">&#39;isomd5sum&#39;</span><span class="p">:</span>
</span><span id="RuntimeChecker-930"><a href="#RuntimeChecker-930"><span class="linenos"> 930</span></a>                <span class="n">tool</span> <span class="o">=</span> <span class="s1">&#39;implantisomd5&#39;</span>
</span><span id="RuntimeChecker-931"><a href="#RuntimeChecker-931"><span class="linenos"> 931</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">Path</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">tool</span><span class="p">,</span> <span class="n">access_mode</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">X_OK</span><span class="p">):</span>
</span><span id="RuntimeChecker-932"><a href="#RuntimeChecker-932"><span class="linenos"> 932</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker-933"><a href="#RuntimeChecker-933"><span class="linenos"> 933</span></a>                    <span class="n">message_tool_not_found</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">tool</span><span class="p">)</span>
</span><span id="RuntimeChecker-934"><a href="#RuntimeChecker-934"><span class="linenos"> 934</span></a>                <span class="p">)</span>
</span><span id="RuntimeChecker-935"><a href="#RuntimeChecker-935"><span class="linenos"> 935</span></a>
</span><span id="RuntimeChecker-936"><a href="#RuntimeChecker-936"><span class="linenos"> 936</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_image_version_provided</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker-937"><a href="#RuntimeChecker-937"><span class="linenos"> 937</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-938"><a href="#RuntimeChecker-938"><span class="linenos"> 938</span></a><span class="sd">        Kiwi requires a &lt;version&gt; element to be specified as part</span>
</span><span id="RuntimeChecker-939"><a href="#RuntimeChecker-939"><span class="linenos"> 939</span></a><span class="sd">        of at least one &lt;preferences&gt; section.</span>
</span><span id="RuntimeChecker-940"><a href="#RuntimeChecker-940"><span class="linenos"> 940</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-941"><a href="#RuntimeChecker-941"><span class="linenos"> 941</span></a>        <span class="n">message_missing_version</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker-942"><a href="#RuntimeChecker-942"><span class="linenos"> 942</span></a><span class="s1">            No version is defined in any of the &lt;preferences&gt;</span>
</span><span id="RuntimeChecker-943"><a href="#RuntimeChecker-943"><span class="linenos"> 943</span></a><span class="s1">            sections. Please add</span>
</span><span id="RuntimeChecker-944"><a href="#RuntimeChecker-944"><span class="linenos"> 944</span></a>
</span><span id="RuntimeChecker-945"><a href="#RuntimeChecker-945"><span class="linenos"> 945</span></a><span class="s1">                &lt;version&gt;image_version&lt;version/&gt;</span>
</span><span id="RuntimeChecker-946"><a href="#RuntimeChecker-946"><span class="linenos"> 946</span></a>
</span><span id="RuntimeChecker-947"><a href="#RuntimeChecker-947"><span class="linenos"> 947</span></a><span class="s1">            inside the &lt;preferences&gt; section.</span>
</span><span id="RuntimeChecker-948"><a href="#RuntimeChecker-948"><span class="linenos"> 948</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker-949"><a href="#RuntimeChecker-949"><span class="linenos"> 949</span></a>
</span><span id="RuntimeChecker-950"><a href="#RuntimeChecker-950"><span class="linenos"> 950</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_image_version</span><span class="p">():</span>
</span><span id="RuntimeChecker-951"><a href="#RuntimeChecker-951"><span class="linenos"> 951</span></a>            <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span><span class="n">message_missing_version</span><span class="p">)</span>
</span><span id="RuntimeChecker-952"><a href="#RuntimeChecker-952"><span class="linenos"> 952</span></a>
</span><span id="RuntimeChecker-953"><a href="#RuntimeChecker-953"><span class="linenos"> 953</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_image_type_unique</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker-954"><a href="#RuntimeChecker-954"><span class="linenos"> 954</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-955"><a href="#RuntimeChecker-955"><span class="linenos"> 955</span></a><span class="sd">        Verify that the selected image type is unique within</span>
</span><span id="RuntimeChecker-956"><a href="#RuntimeChecker-956"><span class="linenos"> 956</span></a><span class="sd">        the range of the configured types and profiles.</span>
</span><span id="RuntimeChecker-957"><a href="#RuntimeChecker-957"><span class="linenos"> 957</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-958"><a href="#RuntimeChecker-958"><span class="linenos"> 958</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker-959"><a href="#RuntimeChecker-959"><span class="linenos"> 959</span></a><span class="s1">            Conflicting image type setup detected</span>
</span><span id="RuntimeChecker-960"><a href="#RuntimeChecker-960"><span class="linenos"> 960</span></a>
</span><span id="RuntimeChecker-961"><a href="#RuntimeChecker-961"><span class="linenos"> 961</span></a><span class="s1">            The selected image type &#39;</span><span class="si">{0}</span><span class="s1">&#39; in the </span><span class="si">{1}</span><span class="s1"> profile</span>
</span><span id="RuntimeChecker-962"><a href="#RuntimeChecker-962"><span class="linenos"> 962</span></a><span class="s1">            selection is not unique. There are the following type</span>
</span><span id="RuntimeChecker-963"><a href="#RuntimeChecker-963"><span class="linenos"> 963</span></a><span class="s1">            settings which overrides each other:</span>
</span><span id="RuntimeChecker-964"><a href="#RuntimeChecker-964"><span class="linenos"> 964</span></a><span class="s1">            </span><span class="si">{2}</span>
</span><span id="RuntimeChecker-965"><a href="#RuntimeChecker-965"><span class="linenos"> 965</span></a><span class="s1">            To solve this conflict please move the image type</span>
</span><span id="RuntimeChecker-966"><a href="#RuntimeChecker-966"><span class="linenos"> 966</span></a><span class="s1">            setup into its own profile and select them using</span>
</span><span id="RuntimeChecker-967"><a href="#RuntimeChecker-967"><span class="linenos"> 967</span></a><span class="s1">            the --profile option at call time.</span>
</span><span id="RuntimeChecker-968"><a href="#RuntimeChecker-968"><span class="linenos"> 968</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker-969"><a href="#RuntimeChecker-969"><span class="linenos"> 969</span></a>        <span class="n">image_type_sections</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="RuntimeChecker-970"><a href="#RuntimeChecker-970"><span class="linenos"> 970</span></a>        <span class="n">type_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="RuntimeChecker-971"><a href="#RuntimeChecker-971"><span class="linenos"> 971</span></a>        <span class="k">for</span> <span class="n">preferences</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_preferences_sections</span><span class="p">():</span>
</span><span id="RuntimeChecker-972"><a href="#RuntimeChecker-972"><span class="linenos"> 972</span></a>            <span class="n">image_type_sections</span> <span class="o">+=</span> <span class="n">preferences</span><span class="o">.</span><span class="n">get_type</span><span class="p">()</span>
</span><span id="RuntimeChecker-973"><a href="#RuntimeChecker-973"><span class="linenos"> 973</span></a>
</span><span id="RuntimeChecker-974"><a href="#RuntimeChecker-974"><span class="linenos"> 974</span></a>        <span class="k">for</span> <span class="n">image_type</span> <span class="ow">in</span> <span class="n">image_type_sections</span><span class="p">:</span>
</span><span id="RuntimeChecker-975"><a href="#RuntimeChecker-975"><span class="linenos"> 975</span></a>            <span class="n">type_name</span> <span class="o">=</span> <span class="n">image_type</span><span class="o">.</span><span class="n">get_image</span><span class="p">()</span>
</span><span id="RuntimeChecker-976"><a href="#RuntimeChecker-976"><span class="linenos"> 976</span></a>            <span class="k">if</span> <span class="n">type_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">type_name</span><span class="p">):</span>
</span><span id="RuntimeChecker-977"><a href="#RuntimeChecker-977"><span class="linenos"> 977</span></a>                <span class="n">type_dict</span><span class="p">[</span><span class="n">type_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image_type</span><span class="p">)</span>
</span><span id="RuntimeChecker-978"><a href="#RuntimeChecker-978"><span class="linenos"> 978</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="RuntimeChecker-979"><a href="#RuntimeChecker-979"><span class="linenos"> 979</span></a>                <span class="n">type_dict</span><span class="p">[</span><span class="n">type_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">image_type</span><span class="p">]</span>
</span><span id="RuntimeChecker-980"><a href="#RuntimeChecker-980"><span class="linenos"> 980</span></a>
</span><span id="RuntimeChecker-981"><a href="#RuntimeChecker-981"><span class="linenos"> 981</span></a>        <span class="k">for</span> <span class="n">type_name</span><span class="p">,</span> <span class="n">type_list</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">type_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
</span><span id="RuntimeChecker-982"><a href="#RuntimeChecker-982"><span class="linenos"> 982</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">type_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="RuntimeChecker-983"><a href="#RuntimeChecker-983"><span class="linenos"> 983</span></a>                <span class="n">type_export</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
</span><span id="RuntimeChecker-984"><a href="#RuntimeChecker-984"><span class="linenos"> 984</span></a>                <span class="k">for</span> <span class="n">image_type</span> <span class="ow">in</span> <span class="n">type_list</span><span class="p">:</span>
</span><span id="RuntimeChecker-985"><a href="#RuntimeChecker-985"><span class="linenos"> 985</span></a>                    <span class="n">type_export</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">)</span>
</span><span id="RuntimeChecker-986"><a href="#RuntimeChecker-986"><span class="linenos"> 986</span></a>                    <span class="n">image_type</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">type_export</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="RuntimeChecker-987"><a href="#RuntimeChecker-987"><span class="linenos"> 987</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker-988"><a href="#RuntimeChecker-988"><span class="linenos"> 988</span></a>                    <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="RuntimeChecker-989"><a href="#RuntimeChecker-989"><span class="linenos"> 989</span></a>                        <span class="n">type_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">profiles</span> <span class="ow">or</span> <span class="p">[</span><span class="s1">&#39;Default&#39;</span><span class="p">],</span>
</span><span id="RuntimeChecker-990"><a href="#RuntimeChecker-990"><span class="linenos"> 990</span></a>                        <span class="n">type_export</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
</span><span id="RuntimeChecker-991"><a href="#RuntimeChecker-991"><span class="linenos"> 991</span></a>                    <span class="p">)</span>
</span><span id="RuntimeChecker-992"><a href="#RuntimeChecker-992"><span class="linenos"> 992</span></a>                <span class="p">)</span>
</span><span id="RuntimeChecker-993"><a href="#RuntimeChecker-993"><span class="linenos"> 993</span></a>
</span><span id="RuntimeChecker-994"><a href="#RuntimeChecker-994"><span class="linenos"> 994</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_efi_fat_image_has_correct_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker-995"><a href="#RuntimeChecker-995"><span class="linenos"> 995</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-996"><a href="#RuntimeChecker-996"><span class="linenos"> 996</span></a><span class="sd">        Verify that the efifatimagesize does not exceed the max</span>
</span><span id="RuntimeChecker-997"><a href="#RuntimeChecker-997"><span class="linenos"> 997</span></a><span class="sd">        El Torito load size of 65535 * 512 bytes</span>
</span><span id="RuntimeChecker-998"><a href="#RuntimeChecker-998"><span class="linenos"> 998</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-999"><a href="#RuntimeChecker-999"><span class="linenos"> 999</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker-1000"><a href="#RuntimeChecker-1000"><span class="linenos">1000</span></a><span class="s1">            El Torito max load size exceeded</span>
</span><span id="RuntimeChecker-1001"><a href="#RuntimeChecker-1001"><span class="linenos">1001</span></a>
</span><span id="RuntimeChecker-1002"><a href="#RuntimeChecker-1002"><span class="linenos">1002</span></a><span class="s1">            The configured efifatimagesize of &#39;</span><span class="si">{0}</span><span class="s1">MB&#39; exceeds</span>
</span><span id="RuntimeChecker-1003"><a href="#RuntimeChecker-1003"><span class="linenos">1003</span></a><span class="s1">            the El Torito max load size of 65535 * 512 bytes (~31MB).</span>
</span><span id="RuntimeChecker-1004"><a href="#RuntimeChecker-1004"><span class="linenos">1004</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker-1005"><a href="#RuntimeChecker-1005"><span class="linenos">1005</span></a>        <span class="n">fat_image_mbsize</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
</span><span id="RuntimeChecker-1006"><a href="#RuntimeChecker-1006"><span class="linenos">1006</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span>
</span><span id="RuntimeChecker-1007"><a href="#RuntimeChecker-1007"><span class="linenos">1007</span></a>                <span class="o">.</span><span class="n">get_efifatimagesize</span><span class="p">()</span> <span class="ow">or</span> <span class="n">defaults</span><span class="o">.</span><span class="n">EFI_FAT_IMAGE_SIZE</span>
</span><span id="RuntimeChecker-1008"><a href="#RuntimeChecker-1008"><span class="linenos">1008</span></a>        <span class="p">)</span>
</span><span id="RuntimeChecker-1009"><a href="#RuntimeChecker-1009"><span class="linenos">1009</span></a>        <span class="k">if</span> <span class="n">fat_image_mbsize</span> <span class="o">&gt;</span> <span class="mi">31</span><span class="p">:</span>
</span><span id="RuntimeChecker-1010"><a href="#RuntimeChecker-1010"><span class="linenos">1010</span></a>            <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker-1011"><a href="#RuntimeChecker-1011"><span class="linenos">1011</span></a>                <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fat_image_mbsize</span><span class="p">)</span>
</span><span id="RuntimeChecker-1012"><a href="#RuntimeChecker-1012"><span class="linenos">1012</span></a>            <span class="p">)</span>
</span><span id="RuntimeChecker-1013"><a href="#RuntimeChecker-1013"><span class="linenos">1013</span></a>
</span><span id="RuntimeChecker-1014"><a href="#RuntimeChecker-1014"><span class="linenos">1014</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_bootloader_env_compatible_with_loader</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker-1015"><a href="#RuntimeChecker-1015"><span class="linenos">1015</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-1016"><a href="#RuntimeChecker-1016"><span class="linenos">1016</span></a><span class="sd">        If there is an environment section as part of the bootloader</span>
</span><span id="RuntimeChecker-1017"><a href="#RuntimeChecker-1017"><span class="linenos">1017</span></a><span class="sd">        section, check if the selected loader supports custom</span>
</span><span id="RuntimeChecker-1018"><a href="#RuntimeChecker-1018"><span class="linenos">1018</span></a><span class="sd">        environment blobs</span>
</span><span id="RuntimeChecker-1019"><a href="#RuntimeChecker-1019"><span class="linenos">1019</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker-1020"><a href="#RuntimeChecker-1020"><span class="linenos">1020</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker-1021"><a href="#RuntimeChecker-1021"><span class="linenos">1021</span></a><span class="s1">            Selected loader does not support custom environments</span>
</span><span id="RuntimeChecker-1022"><a href="#RuntimeChecker-1022"><span class="linenos">1022</span></a>
</span><span id="RuntimeChecker-1023"><a href="#RuntimeChecker-1023"><span class="linenos">1023</span></a><span class="s1">            The selected bootloader </span><span class="si">{}</span><span class="s1"> does not support custom</span>
</span><span id="RuntimeChecker-1024"><a href="#RuntimeChecker-1024"><span class="linenos">1024</span></a><span class="s1">            environment settings. Please drop the &lt;environment&gt;</span>
</span><span id="RuntimeChecker-1025"><a href="#RuntimeChecker-1025"><span class="linenos">1025</span></a><span class="s1">            setting from &lt;bootloadersettings&gt; for this loader</span>
</span><span id="RuntimeChecker-1026"><a href="#RuntimeChecker-1026"><span class="linenos">1026</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker-1027"><a href="#RuntimeChecker-1027"><span class="linenos">1027</span></a>        <span class="n">env_supported_loaders</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="RuntimeChecker-1028"><a href="#RuntimeChecker-1028"><span class="linenos">1028</span></a>            <span class="s1">&#39;grub2&#39;</span><span class="p">,</span>
</span><span id="RuntimeChecker-1029"><a href="#RuntimeChecker-1029"><span class="linenos">1029</span></a>            <span class="s1">&#39;grub2_s390x_emu&#39;</span><span class="p">,</span>
</span><span id="RuntimeChecker-1030"><a href="#RuntimeChecker-1030"><span class="linenos">1030</span></a>            <span class="s1">&#39;custom&#39;</span>
</span><span id="RuntimeChecker-1031"><a href="#RuntimeChecker-1031"><span class="linenos">1031</span></a>        <span class="p">]</span>
</span><span id="RuntimeChecker-1032"><a href="#RuntimeChecker-1032"><span class="linenos">1032</span></a>        <span class="n">bootloader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_build_type_bootloader_name</span><span class="p">()</span>
</span><span id="RuntimeChecker-1033"><a href="#RuntimeChecker-1033"><span class="linenos">1033</span></a>        <span class="n">variable_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span>\
</span><span id="RuntimeChecker-1034"><a href="#RuntimeChecker-1034"><span class="linenos">1034</span></a>            <span class="n">get_build_type_bootloader_environment_variables</span><span class="p">()</span>
</span><span id="RuntimeChecker-1035"><a href="#RuntimeChecker-1035"><span class="linenos">1035</span></a>        <span class="k">if</span> <span class="n">variable_list</span> <span class="ow">and</span> <span class="n">bootloader</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">env_supported_loaders</span><span class="p">:</span>
</span><span id="RuntimeChecker-1036"><a href="#RuntimeChecker-1036"><span class="linenos">1036</span></a>            <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker-1037"><a href="#RuntimeChecker-1037"><span class="linenos">1037</span></a>                <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bootloader</span><span class="p">)</span>
</span><span id="RuntimeChecker-1038"><a href="#RuntimeChecker-1038"><span class="linenos">1038</span></a>            <span class="p">)</span>
</span><span id="RuntimeChecker-1039"><a href="#RuntimeChecker-1039"><span class="linenos">1039</span></a>
</span><span id="RuntimeChecker-1040"><a href="#RuntimeChecker-1040"><span class="linenos">1040</span></a>    <span class="nd">@staticmethod</span>
</span><span id="RuntimeChecker-1041"><a href="#RuntimeChecker-1041"><span class="linenos">1041</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_package_in_list</span><span class="p">(</span>
</span><span id="RuntimeChecker-1042"><a href="#RuntimeChecker-1042"><span class="linenos">1042</span></a>        <span class="n">package_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">search_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span><span id="RuntimeChecker-1043"><a href="#RuntimeChecker-1043"><span class="linenos">1043</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="RuntimeChecker-1044"><a href="#RuntimeChecker-1044"><span class="linenos">1044</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="RuntimeChecker-1045"><a href="#RuntimeChecker-1045"><span class="linenos">1045</span></a>        <span class="k">for</span> <span class="n">search</span> <span class="ow">in</span> <span class="n">search_list</span><span class="p">:</span>
</span><span id="RuntimeChecker-1046"><a href="#RuntimeChecker-1046"><span class="linenos">1046</span></a>            <span class="k">if</span> <span class="n">search</span> <span class="ow">in</span> <span class="n">package_list</span><span class="p">:</span>
</span><span id="RuntimeChecker-1047"><a href="#RuntimeChecker-1047"><span class="linenos">1047</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="n">search</span>
</span><span id="RuntimeChecker-1048"><a href="#RuntimeChecker-1048"><span class="linenos">1048</span></a>                <span class="k">break</span>
</span><span id="RuntimeChecker-1049"><a href="#RuntimeChecker-1049"><span class="linenos">1049</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="RuntimeChecker-1050"><a href="#RuntimeChecker-1050"><span class="linenos">1050</span></a>
</span><span id="RuntimeChecker-1051"><a href="#RuntimeChecker-1051"><span class="linenos">1051</span></a>    <span class="nd">@staticmethod</span>
</span><span id="RuntimeChecker-1052"><a href="#RuntimeChecker-1052"><span class="linenos">1052</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_dracut_module_version_from_pdb</span><span class="p">(</span>
</span><span id="RuntimeChecker-1053"><a href="#RuntimeChecker-1053"><span class="linenos">1053</span></a>        <span class="n">package_manager</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">package_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">root_dir</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="RuntimeChecker-1054"><a href="#RuntimeChecker-1054"><span class="linenos">1054</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="RuntimeChecker-1055"><a href="#RuntimeChecker-1055"><span class="linenos">1055</span></a>        <span class="n">tool</span> <span class="o">=</span> <span class="n">Defaults</span><span class="o">.</span><span class="n">get_default_packager_tool</span><span class="p">(</span><span class="n">package_manager</span><span class="p">)</span>
</span><span id="RuntimeChecker-1056"><a href="#RuntimeChecker-1056"><span class="linenos">1056</span></a>        <span class="n">package_query</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="RuntimeChecker-1057"><a href="#RuntimeChecker-1057"><span class="linenos">1057</span></a>        <span class="n">package_manager_query</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="RuntimeChecker-1058"><a href="#RuntimeChecker-1058"><span class="linenos">1058</span></a>        <span class="n">package_version</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="RuntimeChecker-1059"><a href="#RuntimeChecker-1059"><span class="linenos">1059</span></a>        <span class="k">if</span> <span class="n">tool</span> <span class="o">==</span> <span class="s1">&#39;rpm&#39;</span><span class="p">:</span>
</span><span id="RuntimeChecker-1060"><a href="#RuntimeChecker-1060"><span class="linenos">1060</span></a>            <span class="n">package_manager_query</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="RuntimeChecker-1061"><a href="#RuntimeChecker-1061"><span class="linenos">1061</span></a>                <span class="s1">&#39;chroot&#39;</span><span class="p">,</span> <span class="n">root_dir</span><span class="p">,</span> <span class="n">tool</span><span class="p">,</span> <span class="s1">&#39;-q&#39;</span><span class="p">,</span> <span class="s1">&#39;--qf&#39;</span><span class="p">,</span>
</span><span id="RuntimeChecker-1062"><a href="#RuntimeChecker-1062"><span class="linenos">1062</span></a>                <span class="s1">&#39;%</span><span class="si">{VERSION}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">package_name</span>
</span><span id="RuntimeChecker-1063"><a href="#RuntimeChecker-1063"><span class="linenos">1063</span></a>            <span class="p">]</span>
</span><span id="RuntimeChecker-1064"><a href="#RuntimeChecker-1064"><span class="linenos">1064</span></a>        <span class="k">elif</span> <span class="n">tool</span> <span class="o">==</span> <span class="s1">&#39;dpkg&#39;</span><span class="p">:</span>
</span><span id="RuntimeChecker-1065"><a href="#RuntimeChecker-1065"><span class="linenos">1065</span></a>            <span class="n">package_manager_query</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="RuntimeChecker-1066"><a href="#RuntimeChecker-1066"><span class="linenos">1066</span></a>                <span class="s1">&#39;chroot&#39;</span><span class="p">,</span> <span class="n">root_dir</span><span class="p">,</span> <span class="s1">&#39;dpkg-query&#39;</span><span class="p">,</span> <span class="s1">&#39;-W&#39;</span><span class="p">,</span> <span class="s1">&#39;-f&#39;</span><span class="p">,</span>
</span><span id="RuntimeChecker-1067"><a href="#RuntimeChecker-1067"><span class="linenos">1067</span></a>                <span class="s1">&#39;$</span><span class="si">{Version}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">package_name</span>
</span><span id="RuntimeChecker-1068"><a href="#RuntimeChecker-1068"><span class="linenos">1068</span></a>            <span class="p">]</span>
</span><span id="RuntimeChecker-1069"><a href="#RuntimeChecker-1069"><span class="linenos">1069</span></a>        <span class="k">if</span> <span class="n">package_manager_query</span><span class="p">:</span>
</span><span id="RuntimeChecker-1070"><a href="#RuntimeChecker-1070"><span class="linenos">1070</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="RuntimeChecker-1071"><a href="#RuntimeChecker-1071"><span class="linenos">1071</span></a>                <span class="n">package_query</span> <span class="o">=</span> <span class="n">Command</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">package_manager_query</span><span class="p">)</span>
</span><span id="RuntimeChecker-1072"><a href="#RuntimeChecker-1072"><span class="linenos">1072</span></a>                <span class="k">if</span> <span class="n">package_query</span><span class="p">:</span>
</span><span id="RuntimeChecker-1073"><a href="#RuntimeChecker-1073"><span class="linenos">1073</span></a>                    <span class="n">package_version</span> <span class="o">=</span> <span class="n">package_query</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="RuntimeChecker-1074"><a href="#RuntimeChecker-1074"><span class="linenos">1074</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">issue</span><span class="p">:</span>
</span><span id="RuntimeChecker-1075"><a href="#RuntimeChecker-1075"><span class="linenos">1075</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Package manager query failed with: </span><span class="si">{</span><span class="n">issue</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker-1076"><a href="#RuntimeChecker-1076"><span class="linenos">1076</span></a>        <span class="k">return</span> <span class="n">package_version</span>
</span></pre></div>


            <div class="docstring"><p><strong>Implements build consistency checks at runtime</strong></p>
</div>


                            <div id="RuntimeChecker.__init__" class="classattr">
                                        <input id="RuntimeChecker.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">RuntimeChecker</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">xml_state</span><span class="p">:</span> <span class="n"><a href="xml_state.html#XMLState">kiwi.xml_state.XMLState</a></span></span>)</span>

                <label class="view-source-button" for="RuntimeChecker.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RuntimeChecker.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RuntimeChecker.__init__-60"><a href="#RuntimeChecker.__init__-60"><span class="linenos">60</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xml_state</span><span class="p">:</span> <span class="n">XMLState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker.__init__-61"><a href="#RuntimeChecker.__init__-61"><span class="linenos">61</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.__init__-62"><a href="#RuntimeChecker.__init__-62"><span class="linenos">62</span></a><span class="sd">        The schema of an image description covers structure and syntax of</span>
</span><span id="RuntimeChecker.__init__-63"><a href="#RuntimeChecker.__init__-63"><span class="linenos">63</span></a><span class="sd">        the provided data. The RuntimeChecker provides methods to perform</span>
</span><span id="RuntimeChecker.__init__-64"><a href="#RuntimeChecker.__init__-64"><span class="linenos">64</span></a><span class="sd">        further semantic checks which allows to recognize potential build</span>
</span><span id="RuntimeChecker.__init__-65"><a href="#RuntimeChecker.__init__-65"><span class="linenos">65</span></a><span class="sd">        or boot problems early.</span>
</span><span id="RuntimeChecker.__init__-66"><a href="#RuntimeChecker.__init__-66"><span class="linenos">66</span></a>
</span><span id="RuntimeChecker.__init__-67"><a href="#RuntimeChecker.__init__-67"><span class="linenos">67</span></a><span class="sd">        :param object xml_state: Instance of XMLState</span>
</span><span id="RuntimeChecker.__init__-68"><a href="#RuntimeChecker.__init__-68"><span class="linenos">68</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.__init__-69"><a href="#RuntimeChecker.__init__-69"><span class="linenos">69</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span> <span class="o">=</span> <span class="n">xml_state</span>
</span></pre></div>


            <div class="docstring"><p>The schema of an image description covers structure and syntax of
the provided data. The RuntimeChecker provides methods to perform
further semantic checks which allows to recognize potential build
or boot problems early.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>object xml_state</strong>:  Instance of XMLState</li>
</ul>
</div>


                            </div>
                            <div id="RuntimeChecker.xml_state" class="classattr">
                                <div class="attr variable">
            <span class="name">xml_state</span>

        
    </div>
    <a class="headerlink" href="#RuntimeChecker.xml_state"></a>
    
    

                            </div>
                            <div id="RuntimeChecker.check_repositories_configured" class="classattr">
                                        <input id="RuntimeChecker.check_repositories_configured-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">check_repositories_configured</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="RuntimeChecker.check_repositories_configured-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RuntimeChecker.check_repositories_configured"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RuntimeChecker.check_repositories_configured-71"><a href="#RuntimeChecker.check_repositories_configured-71"><span class="linenos">71</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_repositories_configured</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_repositories_configured-72"><a href="#RuntimeChecker.check_repositories_configured-72"><span class="linenos">72</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_repositories_configured-73"><a href="#RuntimeChecker.check_repositories_configured-73"><span class="linenos">73</span></a><span class="sd">        Verify that there are repositories configured</span>
</span><span id="RuntimeChecker.check_repositories_configured-74"><a href="#RuntimeChecker.check_repositories_configured-74"><span class="linenos">74</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_repositories_configured-75"><a href="#RuntimeChecker.check_repositories_configured-75"><span class="linenos">75</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_repository_sections</span><span class="p">():</span>
</span><span id="RuntimeChecker.check_repositories_configured-76"><a href="#RuntimeChecker.check_repositories_configured-76"><span class="linenos">76</span></a>            <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_repositories_configured-77"><a href="#RuntimeChecker.check_repositories_configured-77"><span class="linenos">77</span></a>                <span class="s1">&#39;No repositories configured&#39;</span>
</span><span id="RuntimeChecker.check_repositories_configured-78"><a href="#RuntimeChecker.check_repositories_configured-78"><span class="linenos">78</span></a>            <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Verify that there are repositories configured</p>
</div>


                            </div>
                            <div id="RuntimeChecker.check_target_dir_on_unsupported_filesystem" class="classattr">
                                        <input id="RuntimeChecker.check_target_dir_on_unsupported_filesystem-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">check_target_dir_on_unsupported_filesystem</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">target_dir</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="RuntimeChecker.check_target_dir_on_unsupported_filesystem-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RuntimeChecker.check_target_dir_on_unsupported_filesystem"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RuntimeChecker.check_target_dir_on_unsupported_filesystem-80"><a href="#RuntimeChecker.check_target_dir_on_unsupported_filesystem-80"><span class="linenos"> 80</span></a>    <span class="nd">@staticmethod</span>
</span><span id="RuntimeChecker.check_target_dir_on_unsupported_filesystem-81"><a href="#RuntimeChecker.check_target_dir_on_unsupported_filesystem-81"><span class="linenos"> 81</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_target_dir_on_unsupported_filesystem</span><span class="p">(</span><span class="n">target_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_target_dir_on_unsupported_filesystem-82"><a href="#RuntimeChecker.check_target_dir_on_unsupported_filesystem-82"><span class="linenos"> 82</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_target_dir_on_unsupported_filesystem-83"><a href="#RuntimeChecker.check_target_dir_on_unsupported_filesystem-83"><span class="linenos"> 83</span></a><span class="sd">        Raise if the given target dir does not reside on a</span>
</span><span id="RuntimeChecker.check_target_dir_on_unsupported_filesystem-84"><a href="#RuntimeChecker.check_target_dir_on_unsupported_filesystem-84"><span class="linenos"> 84</span></a><span class="sd">        filesystem that supports all important features like</span>
</span><span id="RuntimeChecker.check_target_dir_on_unsupported_filesystem-85"><a href="#RuntimeChecker.check_target_dir_on_unsupported_filesystem-85"><span class="linenos"> 85</span></a><span class="sd">        extended permissions(fscaps), ACLs or xattrs.</span>
</span><span id="RuntimeChecker.check_target_dir_on_unsupported_filesystem-86"><a href="#RuntimeChecker.check_target_dir_on_unsupported_filesystem-86"><span class="linenos"> 86</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_target_dir_on_unsupported_filesystem-87"><a href="#RuntimeChecker.check_target_dir_on_unsupported_filesystem-87"><span class="linenos"> 87</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker.check_target_dir_on_unsupported_filesystem-88"><a href="#RuntimeChecker.check_target_dir_on_unsupported_filesystem-88"><span class="linenos"> 88</span></a><span class="s1">            Target root/image directory is lacking filesystem features</span>
</span><span id="RuntimeChecker.check_target_dir_on_unsupported_filesystem-89"><a href="#RuntimeChecker.check_target_dir_on_unsupported_filesystem-89"><span class="linenos"> 89</span></a>
</span><span id="RuntimeChecker.check_target_dir_on_unsupported_filesystem-90"><a href="#RuntimeChecker.check_target_dir_on_unsupported_filesystem-90"><span class="linenos"> 90</span></a><span class="s1">            The filesystem </span><span class="si">{0}</span><span class="s1"> in the target path </span><span class="si">{1}</span>
</span><span id="RuntimeChecker.check_target_dir_on_unsupported_filesystem-91"><a href="#RuntimeChecker.check_target_dir_on_unsupported_filesystem-91"><span class="linenos"> 91</span></a><span class="s1">            does not support important features like extended permissions,</span>
</span><span id="RuntimeChecker.check_target_dir_on_unsupported_filesystem-92"><a href="#RuntimeChecker.check_target_dir_on_unsupported_filesystem-92"><span class="linenos"> 92</span></a><span class="s1">            ACLs or xattrs. The image build may fail or the resulting</span>
</span><span id="RuntimeChecker.check_target_dir_on_unsupported_filesystem-93"><a href="#RuntimeChecker.check_target_dir_on_unsupported_filesystem-93"><span class="linenos"> 93</span></a><span class="s1">            image misbehave.</span>
</span><span id="RuntimeChecker.check_target_dir_on_unsupported_filesystem-94"><a href="#RuntimeChecker.check_target_dir_on_unsupported_filesystem-94"><span class="linenos"> 94</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_target_dir_on_unsupported_filesystem-95"><a href="#RuntimeChecker.check_target_dir_on_unsupported_filesystem-95"><span class="linenos"> 95</span></a>        <span class="n">target_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">first_exists</span><span class="p">(</span><span class="n">target_dir</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_target_dir_on_unsupported_filesystem-96"><a href="#RuntimeChecker.check_target_dir_on_unsupported_filesystem-96"><span class="linenos"> 96</span></a>        <span class="n">stat</span> <span class="o">=</span> <span class="n">Command</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;stat&#39;</span><span class="p">,</span> <span class="s1">&#39;-f&#39;</span><span class="p">,</span> <span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="s1">&#39;%T&#39;</span><span class="p">,</span> <span class="n">target_dir</span><span class="p">])</span>
</span><span id="RuntimeChecker.check_target_dir_on_unsupported_filesystem-97"><a href="#RuntimeChecker.check_target_dir_on_unsupported_filesystem-97"><span class="linenos"> 97</span></a>        <span class="k">if</span> <span class="n">stat</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_target_dir_on_unsupported_filesystem-98"><a href="#RuntimeChecker.check_target_dir_on_unsupported_filesystem-98"><span class="linenos"> 98</span></a>            <span class="n">target_fs</span> <span class="o">=</span> <span class="n">stat</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_target_dir_on_unsupported_filesystem-99"><a href="#RuntimeChecker.check_target_dir_on_unsupported_filesystem-99"><span class="linenos"> 99</span></a>            <span class="n">supported_target_filesystem</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="RuntimeChecker.check_target_dir_on_unsupported_filesystem-100"><a href="#RuntimeChecker.check_target_dir_on_unsupported_filesystem-100"><span class="linenos">100</span></a>                <span class="s1">&#39;btrfs&#39;</span><span class="p">,</span>
</span><span id="RuntimeChecker.check_target_dir_on_unsupported_filesystem-101"><a href="#RuntimeChecker.check_target_dir_on_unsupported_filesystem-101"><span class="linenos">101</span></a>                <span class="s1">&#39;ext2&#39;</span><span class="p">,</span>
</span><span id="RuntimeChecker.check_target_dir_on_unsupported_filesystem-102"><a href="#RuntimeChecker.check_target_dir_on_unsupported_filesystem-102"><span class="linenos">102</span></a>                <span class="s1">&#39;ext2/ext3&#39;</span><span class="p">,</span>
</span><span id="RuntimeChecker.check_target_dir_on_unsupported_filesystem-103"><a href="#RuntimeChecker.check_target_dir_on_unsupported_filesystem-103"><span class="linenos">103</span></a>                <span class="s1">&#39;ext3&#39;</span><span class="p">,</span>
</span><span id="RuntimeChecker.check_target_dir_on_unsupported_filesystem-104"><a href="#RuntimeChecker.check_target_dir_on_unsupported_filesystem-104"><span class="linenos">104</span></a>                <span class="s1">&#39;ext4&#39;</span><span class="p">,</span>
</span><span id="RuntimeChecker.check_target_dir_on_unsupported_filesystem-105"><a href="#RuntimeChecker.check_target_dir_on_unsupported_filesystem-105"><span class="linenos">105</span></a>                <span class="s1">&#39;overlayfs&#39;</span><span class="p">,</span>
</span><span id="RuntimeChecker.check_target_dir_on_unsupported_filesystem-106"><a href="#RuntimeChecker.check_target_dir_on_unsupported_filesystem-106"><span class="linenos">106</span></a>                <span class="s1">&#39;tmpfs&#39;</span><span class="p">,</span>
</span><span id="RuntimeChecker.check_target_dir_on_unsupported_filesystem-107"><a href="#RuntimeChecker.check_target_dir_on_unsupported_filesystem-107"><span class="linenos">107</span></a>                <span class="s1">&#39;xfs&#39;</span><span class="p">,</span>
</span><span id="RuntimeChecker.check_target_dir_on_unsupported_filesystem-108"><a href="#RuntimeChecker.check_target_dir_on_unsupported_filesystem-108"><span class="linenos">108</span></a>            <span class="p">)</span>
</span><span id="RuntimeChecker.check_target_dir_on_unsupported_filesystem-109"><a href="#RuntimeChecker.check_target_dir_on_unsupported_filesystem-109"><span class="linenos">109</span></a>            <span class="k">if</span> <span class="n">target_fs</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">supported_target_filesystem</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_target_dir_on_unsupported_filesystem-110"><a href="#RuntimeChecker.check_target_dir_on_unsupported_filesystem-110"><span class="linenos">110</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">target_fs</span><span class="p">,</span> <span class="n">target_dir</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Raise if the given target dir does not reside on a
filesystem that supports all important features like
extended permissions(fscaps), ACLs or xattrs.</p>
</div>


                            </div>
                            <div id="RuntimeChecker.check_include_references_unresolvable" class="classattr">
                                        <input id="RuntimeChecker.check_include_references_unresolvable-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">check_include_references_unresolvable</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="RuntimeChecker.check_include_references_unresolvable-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RuntimeChecker.check_include_references_unresolvable"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RuntimeChecker.check_include_references_unresolvable-112"><a href="#RuntimeChecker.check_include_references_unresolvable-112"><span class="linenos">112</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_include_references_unresolvable</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_include_references_unresolvable-113"><a href="#RuntimeChecker.check_include_references_unresolvable-113"><span class="linenos">113</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_include_references_unresolvable-114"><a href="#RuntimeChecker.check_include_references_unresolvable-114"><span class="linenos">114</span></a><span class="sd">        Raise for still included &lt;include&gt; statements as not resolvable.</span>
</span><span id="RuntimeChecker.check_include_references_unresolvable-115"><a href="#RuntimeChecker.check_include_references_unresolvable-115"><span class="linenos">115</span></a><span class="sd">        The KIWI XSLT processing replaces the specified include</span>
</span><span id="RuntimeChecker.check_include_references_unresolvable-116"><a href="#RuntimeChecker.check_include_references_unresolvable-116"><span class="linenos">116</span></a><span class="sd">        directive(s) with the given file reference(s). If this action</span>
</span><span id="RuntimeChecker.check_include_references_unresolvable-117"><a href="#RuntimeChecker.check_include_references_unresolvable-117"><span class="linenos">117</span></a><span class="sd">        did not happen for example on nested includes, it can happen</span>
</span><span id="RuntimeChecker.check_include_references_unresolvable-118"><a href="#RuntimeChecker.check_include_references_unresolvable-118"><span class="linenos">118</span></a><span class="sd">        that they stay in the document as sort of waste.</span>
</span><span id="RuntimeChecker.check_include_references_unresolvable-119"><a href="#RuntimeChecker.check_include_references_unresolvable-119"><span class="linenos">119</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_include_references_unresolvable-120"><a href="#RuntimeChecker.check_include_references_unresolvable-120"><span class="linenos">120</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker.check_include_references_unresolvable-121"><a href="#RuntimeChecker.check_include_references_unresolvable-121"><span class="linenos">121</span></a><span class="s1">            One ore more &lt;include&gt; statements are unresolvable</span>
</span><span id="RuntimeChecker.check_include_references_unresolvable-122"><a href="#RuntimeChecker.check_include_references_unresolvable-122"><span class="linenos">122</span></a>
</span><span id="RuntimeChecker.check_include_references_unresolvable-123"><a href="#RuntimeChecker.check_include_references_unresolvable-123"><span class="linenos">123</span></a><span class="s1">            The following include references could not be resolved.</span>
</span><span id="RuntimeChecker.check_include_references_unresolvable-124"><a href="#RuntimeChecker.check_include_references_unresolvable-124"><span class="linenos">124</span></a><span class="s1">            Please verify the specified location(s) and/or delete</span>
</span><span id="RuntimeChecker.check_include_references_unresolvable-125"><a href="#RuntimeChecker.check_include_references_unresolvable-125"><span class="linenos">125</span></a><span class="s1">            the broken include directive(s) from the description.</span>
</span><span id="RuntimeChecker.check_include_references_unresolvable-126"><a href="#RuntimeChecker.check_include_references_unresolvable-126"><span class="linenos">126</span></a><span class="s1">            Please also note, nested includes from other include</span>
</span><span id="RuntimeChecker.check_include_references_unresolvable-127"><a href="#RuntimeChecker.check_include_references_unresolvable-127"><span class="linenos">127</span></a><span class="s1">            files are not supported:</span>
</span><span id="RuntimeChecker.check_include_references_unresolvable-128"><a href="#RuntimeChecker.check_include_references_unresolvable-128"><span class="linenos">128</span></a>
</span><span id="RuntimeChecker.check_include_references_unresolvable-129"><a href="#RuntimeChecker.check_include_references_unresolvable-129"><span class="linenos">129</span></a><span class="s1">            </span><span class="si">{0}</span>
</span><span id="RuntimeChecker.check_include_references_unresolvable-130"><a href="#RuntimeChecker.check_include_references_unresolvable-130"><span class="linenos">130</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_include_references_unresolvable-131"><a href="#RuntimeChecker.check_include_references_unresolvable-131"><span class="linenos">131</span></a>        <span class="n">include_files</span> <span class="o">=</span> \
</span><span id="RuntimeChecker.check_include_references_unresolvable-132"><a href="#RuntimeChecker.check_include_references_unresolvable-132"><span class="linenos">132</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_include_section_reference_file_names</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_include_references_unresolvable-133"><a href="#RuntimeChecker.check_include_references_unresolvable-133"><span class="linenos">133</span></a>        <span class="k">if</span> <span class="n">include_files</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_include_references_unresolvable-134"><a href="#RuntimeChecker.check_include_references_unresolvable-134"><span class="linenos">134</span></a>            <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_include_references_unresolvable-135"><a href="#RuntimeChecker.check_include_references_unresolvable-135"><span class="linenos">135</span></a>                <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">include_files</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
</span><span id="RuntimeChecker.check_include_references_unresolvable-136"><a href="#RuntimeChecker.check_include_references_unresolvable-136"><span class="linenos">136</span></a>            <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Raise for still included <include> statements as not resolvable.
The KIWI XSLT processing replaces the specified include
directive(s) with the given file reference(s). If this action
did not happen for example on nested includes, it can happen
that they stay in the document as sort of waste.</p>
</div>


                            </div>
                            <div id="RuntimeChecker.check_image_include_repos_publicly_resolvable" class="classattr">
                                        <input id="RuntimeChecker.check_image_include_repos_publicly_resolvable-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">check_image_include_repos_publicly_resolvable</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="RuntimeChecker.check_image_include_repos_publicly_resolvable-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RuntimeChecker.check_image_include_repos_publicly_resolvable"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RuntimeChecker.check_image_include_repos_publicly_resolvable-138"><a href="#RuntimeChecker.check_image_include_repos_publicly_resolvable-138"><span class="linenos">138</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_image_include_repos_publicly_resolvable</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_image_include_repos_publicly_resolvable-139"><a href="#RuntimeChecker.check_image_include_repos_publicly_resolvable-139"><span class="linenos">139</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_image_include_repos_publicly_resolvable-140"><a href="#RuntimeChecker.check_image_include_repos_publicly_resolvable-140"><span class="linenos">140</span></a><span class="sd">        Verify that all repos marked with the imageinclude attribute</span>
</span><span id="RuntimeChecker.check_image_include_repos_publicly_resolvable-141"><a href="#RuntimeChecker.check_image_include_repos_publicly_resolvable-141"><span class="linenos">141</span></a><span class="sd">        can be resolved into a http based web URL</span>
</span><span id="RuntimeChecker.check_image_include_repos_publicly_resolvable-142"><a href="#RuntimeChecker.check_image_include_repos_publicly_resolvable-142"><span class="linenos">142</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_image_include_repos_publicly_resolvable-143"><a href="#RuntimeChecker.check_image_include_repos_publicly_resolvable-143"><span class="linenos">143</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker.check_image_include_repos_publicly_resolvable-144"><a href="#RuntimeChecker.check_image_include_repos_publicly_resolvable-144"><span class="linenos">144</span></a><span class="s1">            The use of imageinclude=&quot;true&quot; in the repository definition</span>
</span><span id="RuntimeChecker.check_image_include_repos_publicly_resolvable-145"><a href="#RuntimeChecker.check_image_include_repos_publicly_resolvable-145"><span class="linenos">145</span></a><span class="s1">            for the Repository: </span><span class="si">{0}</span>
</span><span id="RuntimeChecker.check_image_include_repos_publicly_resolvable-146"><a href="#RuntimeChecker.check_image_include_repos_publicly_resolvable-146"><span class="linenos">146</span></a><span class="s1">            requires the repository to by publicly available. The source</span>
</span><span id="RuntimeChecker.check_image_include_repos_publicly_resolvable-147"><a href="#RuntimeChecker.check_image_include_repos_publicly_resolvable-147"><span class="linenos">147</span></a><span class="s1">            locator of the repository however indicates it is private to</span>
</span><span id="RuntimeChecker.check_image_include_repos_publicly_resolvable-148"><a href="#RuntimeChecker.check_image_include_repos_publicly_resolvable-148"><span class="linenos">148</span></a><span class="s1">            your local system. Therefore it can&#39;t be included into the</span>
</span><span id="RuntimeChecker.check_image_include_repos_publicly_resolvable-149"><a href="#RuntimeChecker.check_image_include_repos_publicly_resolvable-149"><span class="linenos">149</span></a><span class="s1">            system image repository configuration. Please define a publicly</span>
</span><span id="RuntimeChecker.check_image_include_repos_publicly_resolvable-150"><a href="#RuntimeChecker.check_image_include_repos_publicly_resolvable-150"><span class="linenos">150</span></a><span class="s1">            available repository in your image XML description.</span>
</span><span id="RuntimeChecker.check_image_include_repos_publicly_resolvable-151"><a href="#RuntimeChecker.check_image_include_repos_publicly_resolvable-151"><span class="linenos">151</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_image_include_repos_publicly_resolvable-152"><a href="#RuntimeChecker.check_image_include_repos_publicly_resolvable-152"><span class="linenos">152</span></a>
</span><span id="RuntimeChecker.check_image_include_repos_publicly_resolvable-153"><a href="#RuntimeChecker.check_image_include_repos_publicly_resolvable-153"><span class="linenos">153</span></a>        <span class="n">repository_sections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_repository_sections</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_image_include_repos_publicly_resolvable-154"><a href="#RuntimeChecker.check_image_include_repos_publicly_resolvable-154"><span class="linenos">154</span></a>        <span class="k">for</span> <span class="n">xml_repo</span> <span class="ow">in</span> <span class="n">repository_sections</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_image_include_repos_publicly_resolvable-155"><a href="#RuntimeChecker.check_image_include_repos_publicly_resolvable-155"><span class="linenos">155</span></a>            <span class="n">repo_marked_for_image_include</span> <span class="o">=</span> <span class="n">xml_repo</span><span class="o">.</span><span class="n">get_imageinclude</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_image_include_repos_publicly_resolvable-156"><a href="#RuntimeChecker.check_image_include_repos_publicly_resolvable-156"><span class="linenos">156</span></a>
</span><span id="RuntimeChecker.check_image_include_repos_publicly_resolvable-157"><a href="#RuntimeChecker.check_image_include_repos_publicly_resolvable-157"><span class="linenos">157</span></a>            <span class="k">if</span> <span class="n">repo_marked_for_image_include</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_image_include_repos_publicly_resolvable-158"><a href="#RuntimeChecker.check_image_include_repos_publicly_resolvable-158"><span class="linenos">158</span></a>                <span class="n">repo_source</span> <span class="o">=</span> <span class="n">xml_repo</span><span class="o">.</span><span class="n">get_source</span><span class="p">()</span><span class="o">.</span><span class="n">get_path</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_image_include_repos_publicly_resolvable-159"><a href="#RuntimeChecker.check_image_include_repos_publicly_resolvable-159"><span class="linenos">159</span></a>                <span class="n">repo_type</span> <span class="o">=</span> <span class="n">xml_repo</span><span class="o">.</span><span class="n">get_type</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_image_include_repos_publicly_resolvable-160"><a href="#RuntimeChecker.check_image_include_repos_publicly_resolvable-160"><span class="linenos">160</span></a>                <span class="n">uri</span> <span class="o">=</span> <span class="n">Uri</span><span class="p">(</span><span class="n">repo_source</span><span class="p">,</span> <span class="n">repo_type</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_image_include_repos_publicly_resolvable-161"><a href="#RuntimeChecker.check_image_include_repos_publicly_resolvable-161"><span class="linenos">161</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">uri</span><span class="o">.</span><span class="n">is_public</span><span class="p">():</span>
</span><span id="RuntimeChecker.check_image_include_repos_publicly_resolvable-162"><a href="#RuntimeChecker.check_image_include_repos_publicly_resolvable-162"><span class="linenos">162</span></a>                    <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_image_include_repos_publicly_resolvable-163"><a href="#RuntimeChecker.check_image_include_repos_publicly_resolvable-163"><span class="linenos">163</span></a>                        <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">repo_source</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_image_include_repos_publicly_resolvable-164"><a href="#RuntimeChecker.check_image_include_repos_publicly_resolvable-164"><span class="linenos">164</span></a>                    <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Verify that all repos marked with the imageinclude attribute
can be resolved into a http based web URL</p>
</div>


                            </div>
                            <div id="RuntimeChecker.check_target_directory_not_in_shared_cache" class="classattr">
                                        <input id="RuntimeChecker.check_target_directory_not_in_shared_cache-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">check_target_directory_not_in_shared_cache</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">target_dir</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="RuntimeChecker.check_target_directory_not_in_shared_cache-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RuntimeChecker.check_target_directory_not_in_shared_cache"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RuntimeChecker.check_target_directory_not_in_shared_cache-166"><a href="#RuntimeChecker.check_target_directory_not_in_shared_cache-166"><span class="linenos">166</span></a>    <span class="nd">@staticmethod</span>
</span><span id="RuntimeChecker.check_target_directory_not_in_shared_cache-167"><a href="#RuntimeChecker.check_target_directory_not_in_shared_cache-167"><span class="linenos">167</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_target_directory_not_in_shared_cache</span><span class="p">(</span><span class="n">target_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_target_directory_not_in_shared_cache-168"><a href="#RuntimeChecker.check_target_directory_not_in_shared_cache-168"><span class="linenos">168</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_target_directory_not_in_shared_cache-169"><a href="#RuntimeChecker.check_target_directory_not_in_shared_cache-169"><span class="linenos">169</span></a><span class="sd">        The target directory must be outside of the kiwi shared cache</span>
</span><span id="RuntimeChecker.check_target_directory_not_in_shared_cache-170"><a href="#RuntimeChecker.check_target_directory_not_in_shared_cache-170"><span class="linenos">170</span></a><span class="sd">        directory in order to avoid busy mounts because kiwi bind mounts</span>
</span><span id="RuntimeChecker.check_target_directory_not_in_shared_cache-171"><a href="#RuntimeChecker.check_target_directory_not_in_shared_cache-171"><span class="linenos">171</span></a><span class="sd">        the cache directory into the image root tree to access host</span>
</span><span id="RuntimeChecker.check_target_directory_not_in_shared_cache-172"><a href="#RuntimeChecker.check_target_directory_not_in_shared_cache-172"><span class="linenos">172</span></a><span class="sd">        caching information</span>
</span><span id="RuntimeChecker.check_target_directory_not_in_shared_cache-173"><a href="#RuntimeChecker.check_target_directory_not_in_shared_cache-173"><span class="linenos">173</span></a>
</span><span id="RuntimeChecker.check_target_directory_not_in_shared_cache-174"><a href="#RuntimeChecker.check_target_directory_not_in_shared_cache-174"><span class="linenos">174</span></a><span class="sd">        :param string target_dir: path name</span>
</span><span id="RuntimeChecker.check_target_directory_not_in_shared_cache-175"><a href="#RuntimeChecker.check_target_directory_not_in_shared_cache-175"><span class="linenos">175</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_target_directory_not_in_shared_cache-176"><a href="#RuntimeChecker.check_target_directory_not_in_shared_cache-176"><span class="linenos">176</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker.check_target_directory_not_in_shared_cache-177"><a href="#RuntimeChecker.check_target_directory_not_in_shared_cache-177"><span class="linenos">177</span></a><span class="s1">            Target directory </span><span class="si">%s</span><span class="s1"> conflicts with kiwi&#39;s shared cache</span>
</span><span id="RuntimeChecker.check_target_directory_not_in_shared_cache-178"><a href="#RuntimeChecker.check_target_directory_not_in_shared_cache-178"><span class="linenos">178</span></a><span class="s1">            directory </span><span class="si">%s</span><span class="s1">. This is going to create a busy loop mount.</span>
</span><span id="RuntimeChecker.check_target_directory_not_in_shared_cache-179"><a href="#RuntimeChecker.check_target_directory_not_in_shared_cache-179"><span class="linenos">179</span></a><span class="s1">            Please choose another target directory.</span>
</span><span id="RuntimeChecker.check_target_directory_not_in_shared_cache-180"><a href="#RuntimeChecker.check_target_directory_not_in_shared_cache-180"><span class="linenos">180</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_target_directory_not_in_shared_cache-181"><a href="#RuntimeChecker.check_target_directory_not_in_shared_cache-181"><span class="linenos">181</span></a>
</span><span id="RuntimeChecker.check_target_directory_not_in_shared_cache-182"><a href="#RuntimeChecker.check_target_directory_not_in_shared_cache-182"><span class="linenos">182</span></a>        <span class="n">shared_cache_location</span> <span class="o">=</span> <span class="n">Defaults</span><span class="o">.</span><span class="n">get_shared_cache_location</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_target_directory_not_in_shared_cache-183"><a href="#RuntimeChecker.check_target_directory_not_in_shared_cache-183"><span class="linenos">183</span></a>
</span><span id="RuntimeChecker.check_target_directory_not_in_shared_cache-184"><a href="#RuntimeChecker.check_target_directory_not_in_shared_cache-184"><span class="linenos">184</span></a>        <span class="n">target_dir_stack</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_target_directory_not_in_shared_cache-185"><a href="#RuntimeChecker.check_target_directory_not_in_shared_cache-185"><span class="linenos">185</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">target_dir</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_target_directory_not_in_shared_cache-186"><a href="#RuntimeChecker.check_target_directory_not_in_shared_cache-186"><span class="linenos">186</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_target_directory_not_in_shared_cache-187"><a href="#RuntimeChecker.check_target_directory_not_in_shared_cache-187"><span class="linenos">187</span></a>        <span class="k">if</span> <span class="n">target_dir_stack</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="n">shared_cache_location</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">):</span>
</span><span id="RuntimeChecker.check_target_directory_not_in_shared_cache-188"><a href="#RuntimeChecker.check_target_directory_not_in_shared_cache-188"><span class="linenos">188</span></a>            <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_target_directory_not_in_shared_cache-189"><a href="#RuntimeChecker.check_target_directory_not_in_shared_cache-189"><span class="linenos">189</span></a>                <span class="n">message</span> <span class="o">%</span> <span class="p">(</span><span class="n">target_dir</span><span class="p">,</span> <span class="n">shared_cache_location</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_target_directory_not_in_shared_cache-190"><a href="#RuntimeChecker.check_target_directory_not_in_shared_cache-190"><span class="linenos">190</span></a>            <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The target directory must be outside of the kiwi shared cache
directory in order to avoid busy mounts because kiwi bind mounts
the cache directory into the image root tree to access host
caching information</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>string target_dir</strong>:  path name</li>
</ul>
</div>


                            </div>
                            <div id="RuntimeChecker.check_volume_label_used_with_lvm" class="classattr">
                                        <input id="RuntimeChecker.check_volume_label_used_with_lvm-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">check_volume_label_used_with_lvm</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="RuntimeChecker.check_volume_label_used_with_lvm-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RuntimeChecker.check_volume_label_used_with_lvm"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RuntimeChecker.check_volume_label_used_with_lvm-192"><a href="#RuntimeChecker.check_volume_label_used_with_lvm-192"><span class="linenos">192</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_volume_label_used_with_lvm</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_volume_label_used_with_lvm-193"><a href="#RuntimeChecker.check_volume_label_used_with_lvm-193"><span class="linenos">193</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_volume_label_used_with_lvm-194"><a href="#RuntimeChecker.check_volume_label_used_with_lvm-194"><span class="linenos">194</span></a><span class="sd">        The optional volume label in a systemdisk setup is only</span>
</span><span id="RuntimeChecker.check_volume_label_used_with_lvm-195"><a href="#RuntimeChecker.check_volume_label_used_with_lvm-195"><span class="linenos">195</span></a><span class="sd">        effective if the LVM, logical volume manager system is</span>
</span><span id="RuntimeChecker.check_volume_label_used_with_lvm-196"><a href="#RuntimeChecker.check_volume_label_used_with_lvm-196"><span class="linenos">196</span></a><span class="sd">        used. In any other case where the filesystem itself offers</span>
</span><span id="RuntimeChecker.check_volume_label_used_with_lvm-197"><a href="#RuntimeChecker.check_volume_label_used_with_lvm-197"><span class="linenos">197</span></a><span class="sd">        volume management capabilities there are no extra filesystem</span>
</span><span id="RuntimeChecker.check_volume_label_used_with_lvm-198"><a href="#RuntimeChecker.check_volume_label_used_with_lvm-198"><span class="linenos">198</span></a><span class="sd">        labels which can be applied per volume</span>
</span><span id="RuntimeChecker.check_volume_label_used_with_lvm-199"><a href="#RuntimeChecker.check_volume_label_used_with_lvm-199"><span class="linenos">199</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_volume_label_used_with_lvm-200"><a href="#RuntimeChecker.check_volume_label_used_with_lvm-200"><span class="linenos">200</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker.check_volume_label_used_with_lvm-201"><a href="#RuntimeChecker.check_volume_label_used_with_lvm-201"><span class="linenos">201</span></a><span class="s1">            Custom volume label setup used without LVM</span>
</span><span id="RuntimeChecker.check_volume_label_used_with_lvm-202"><a href="#RuntimeChecker.check_volume_label_used_with_lvm-202"><span class="linenos">202</span></a>
</span><span id="RuntimeChecker.check_volume_label_used_with_lvm-203"><a href="#RuntimeChecker.check_volume_label_used_with_lvm-203"><span class="linenos">203</span></a><span class="s1">            The optional volume label in a systemdisk setup is only</span>
</span><span id="RuntimeChecker.check_volume_label_used_with_lvm-204"><a href="#RuntimeChecker.check_volume_label_used_with_lvm-204"><span class="linenos">204</span></a><span class="s1">            effective if the LVM, logical volume manager system is</span>
</span><span id="RuntimeChecker.check_volume_label_used_with_lvm-205"><a href="#RuntimeChecker.check_volume_label_used_with_lvm-205"><span class="linenos">205</span></a><span class="s1">            used. Your setup uses the </span><span class="si">{0}</span><span class="s1"> filesystem which itself</span>
</span><span id="RuntimeChecker.check_volume_label_used_with_lvm-206"><a href="#RuntimeChecker.check_volume_label_used_with_lvm-206"><span class="linenos">206</span></a><span class="s1">            offers volume management capabilities. Extra filesystem</span>
</span><span id="RuntimeChecker.check_volume_label_used_with_lvm-207"><a href="#RuntimeChecker.check_volume_label_used_with_lvm-207"><span class="linenos">207</span></a><span class="s1">            labels cannot be applied in this case.</span>
</span><span id="RuntimeChecker.check_volume_label_used_with_lvm-208"><a href="#RuntimeChecker.check_volume_label_used_with_lvm-208"><span class="linenos">208</span></a>
</span><span id="RuntimeChecker.check_volume_label_used_with_lvm-209"><a href="#RuntimeChecker.check_volume_label_used_with_lvm-209"><span class="linenos">209</span></a><span class="s1">            If you want to force LVM over the </span><span class="si">{0}</span><span class="s1"> volume management</span>
</span><span id="RuntimeChecker.check_volume_label_used_with_lvm-210"><a href="#RuntimeChecker.check_volume_label_used_with_lvm-210"><span class="linenos">210</span></a><span class="s1">            system you can do so by specifying the following in</span>
</span><span id="RuntimeChecker.check_volume_label_used_with_lvm-211"><a href="#RuntimeChecker.check_volume_label_used_with_lvm-211"><span class="linenos">211</span></a><span class="s1">            your KIWI XML description:</span>
</span><span id="RuntimeChecker.check_volume_label_used_with_lvm-212"><a href="#RuntimeChecker.check_volume_label_used_with_lvm-212"><span class="linenos">212</span></a>
</span><span id="RuntimeChecker.check_volume_label_used_with_lvm-213"><a href="#RuntimeChecker.check_volume_label_used_with_lvm-213"><span class="linenos">213</span></a><span class="s1">            &lt;systemdisk ... preferlvm=&quot;true&quot;&gt;</span>
</span><span id="RuntimeChecker.check_volume_label_used_with_lvm-214"><a href="#RuntimeChecker.check_volume_label_used_with_lvm-214"><span class="linenos">214</span></a><span class="s1">                &lt;volume .../&gt;</span>
</span><span id="RuntimeChecker.check_volume_label_used_with_lvm-215"><a href="#RuntimeChecker.check_volume_label_used_with_lvm-215"><span class="linenos">215</span></a><span class="s1">            &lt;/systemdisk&gt;</span>
</span><span id="RuntimeChecker.check_volume_label_used_with_lvm-216"><a href="#RuntimeChecker.check_volume_label_used_with_lvm-216"><span class="linenos">216</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_volume_label_used_with_lvm-217"><a href="#RuntimeChecker.check_volume_label_used_with_lvm-217"><span class="linenos">217</span></a>        <span class="n">volume_management</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_volume_management</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_volume_label_used_with_lvm-218"><a href="#RuntimeChecker.check_volume_label_used_with_lvm-218"><span class="linenos">218</span></a>        <span class="k">if</span> <span class="n">volume_management</span> <span class="o">!=</span> <span class="s1">&#39;lvm&#39;</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_volume_label_used_with_lvm-219"><a href="#RuntimeChecker.check_volume_label_used_with_lvm-219"><span class="linenos">219</span></a>            <span class="k">for</span> <span class="n">volume</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_volumes</span><span class="p">():</span>
</span><span id="RuntimeChecker.check_volume_label_used_with_lvm-220"><a href="#RuntimeChecker.check_volume_label_used_with_lvm-220"><span class="linenos">220</span></a>                <span class="k">if</span> <span class="n">volume</span><span class="o">.</span><span class="n">label</span> <span class="ow">and</span> <span class="n">volume</span><span class="o">.</span><span class="n">label</span> <span class="o">!=</span> <span class="s1">&#39;SWAP&#39;</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_volume_label_used_with_lvm-221"><a href="#RuntimeChecker.check_volume_label_used_with_lvm-221"><span class="linenos">221</span></a>                    <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_volume_label_used_with_lvm-222"><a href="#RuntimeChecker.check_volume_label_used_with_lvm-222"><span class="linenos">222</span></a>                        <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">volume_management</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_volume_label_used_with_lvm-223"><a href="#RuntimeChecker.check_volume_label_used_with_lvm-223"><span class="linenos">223</span></a>                    <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The optional volume label in a systemdisk setup is only
effective if the LVM, logical volume manager system is
used. In any other case where the filesystem itself offers
volume management capabilities there are no extra filesystem
labels which can be applied per volume</p>
</div>


                            </div>
                            <div id="RuntimeChecker.check_partuuid_persistency_type_used_with_mbr" class="classattr">
                                        <input id="RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">check_partuuid_persistency_type_used_with_mbr</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RuntimeChecker.check_partuuid_persistency_type_used_with_mbr"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-225"><a href="#RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-225"><span class="linenos">225</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_partuuid_persistency_type_used_with_mbr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-226"><a href="#RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-226"><span class="linenos">226</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-227"><a href="#RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-227"><span class="linenos">227</span></a><span class="sd">        The devicepersistency setting by-partuuid can only be</span>
</span><span id="RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-228"><a href="#RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-228"><span class="linenos">228</span></a><span class="sd">        used in combination with a partition table type that</span>
</span><span id="RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-229"><a href="#RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-229"><span class="linenos">229</span></a><span class="sd">        supports UUIDs. In any other case Linux creates artificial</span>
</span><span id="RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-230"><a href="#RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-230"><span class="linenos">230</span></a><span class="sd">        values for PTUUID and PARTUUID from the disk signature</span>
</span><span id="RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-231"><a href="#RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-231"><span class="linenos">231</span></a><span class="sd">        which can change without touching the actual partition</span>
</span><span id="RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-232"><a href="#RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-232"><span class="linenos">232</span></a><span class="sd">        table. We consider this unsafe and only allow the use</span>
</span><span id="RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-233"><a href="#RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-233"><span class="linenos">233</span></a><span class="sd">        of by-partuuid in combination with partition tables that</span>
</span><span id="RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-234"><a href="#RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-234"><span class="linenos">234</span></a><span class="sd">        actually supports it properly.</span>
</span><span id="RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-235"><a href="#RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-235"><span class="linenos">235</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-236"><a href="#RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-236"><span class="linenos">236</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-237"><a href="#RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-237"><span class="linenos">237</span></a><span class="s1">            devicepersistency=</span><span class="si">{0!r}</span><span class="s1"> used with non UUID capable partition table</span>
</span><span id="RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-238"><a href="#RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-238"><span class="linenos">238</span></a>
</span><span id="RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-239"><a href="#RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-239"><span class="linenos">239</span></a><span class="s1">            PTUUID and PARTUUID exists in the GUID (GPT) partition table.</span>
</span><span id="RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-240"><a href="#RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-240"><span class="linenos">240</span></a><span class="s1">            According to the firmware setting: </span><span class="si">{1!r}</span><span class="s1">, the selected partition</span>
</span><span id="RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-241"><a href="#RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-241"><span class="linenos">241</span></a><span class="s1">            table type is: </span><span class="si">{2!r}</span><span class="s1">. This table type does not natively support</span>
</span><span id="RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-242"><a href="#RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-242"><span class="linenos">242</span></a><span class="s1">            UUIDs. In such a case Linux creates artificial values for PTUUID</span>
</span><span id="RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-243"><a href="#RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-243"><span class="linenos">243</span></a><span class="s1">            and PARTUUID from the disk signature which can change without</span>
</span><span id="RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-244"><a href="#RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-244"><span class="linenos">244</span></a><span class="s1">            touching the actual partition table. This is considered unsafe</span>
</span><span id="RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-245"><a href="#RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-245"><span class="linenos">245</span></a><span class="s1">            and KIWI only allows the use of by-partuuid in combination with</span>
</span><span id="RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-246"><a href="#RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-246"><span class="linenos">246</span></a><span class="s1">            partition tables that actually supports UUIDs properly.</span>
</span><span id="RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-247"><a href="#RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-247"><span class="linenos">247</span></a>
</span><span id="RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-248"><a href="#RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-248"><span class="linenos">248</span></a><span class="s1">            Please make sure to use one of the following firmware settings</span>
</span><span id="RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-249"><a href="#RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-249"><span class="linenos">249</span></a><span class="s1">            which leads to an image using an UUID capable partition table</span>
</span><span id="RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-250"><a href="#RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-250"><span class="linenos">250</span></a><span class="s1">            and therefore supporting consistent by-partuuid device names:</span>
</span><span id="RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-251"><a href="#RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-251"><span class="linenos">251</span></a>
</span><span id="RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-252"><a href="#RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-252"><span class="linenos">252</span></a><span class="s1">            &lt;type ... firmware=&quot;efi|uefi&quot;&gt;</span>
</span><span id="RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-253"><a href="#RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-253"><span class="linenos">253</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-254"><a href="#RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-254"><span class="linenos">254</span></a>        <span class="n">persistency_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_devicepersistency</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-255"><a href="#RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-255"><span class="linenos">255</span></a>        <span class="k">if</span> <span class="n">persistency_type</span> <span class="ow">and</span> <span class="n">persistency_type</span> <span class="o">==</span> <span class="s1">&#39;by-partuuid&#39;</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-256"><a href="#RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-256"><span class="linenos">256</span></a>            <span class="n">supported_table_types</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;gpt&#39;</span><span class="p">]</span>
</span><span id="RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-257"><a href="#RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-257"><span class="linenos">257</span></a>            <span class="n">firmware</span> <span class="o">=</span> <span class="n">FirmWare</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-258"><a href="#RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-258"><span class="linenos">258</span></a>            <span class="n">table_type</span> <span class="o">=</span> <span class="n">firmware</span><span class="o">.</span><span class="n">get_partition_table_type</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-259"><a href="#RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-259"><span class="linenos">259</span></a>            <span class="k">if</span> <span class="n">table_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">supported_table_types</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-260"><a href="#RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-260"><span class="linenos">260</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-261"><a href="#RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-261"><span class="linenos">261</span></a>                    <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-262"><a href="#RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-262"><span class="linenos">262</span></a>                        <span class="n">persistency_type</span><span class="p">,</span> <span class="n">firmware</span><span class="o">.</span><span class="n">firmware</span><span class="p">,</span> <span class="n">table_type</span>
</span><span id="RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-263"><a href="#RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-263"><span class="linenos">263</span></a>                    <span class="p">)</span>
</span><span id="RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-264"><a href="#RuntimeChecker.check_partuuid_persistency_type_used_with_mbr-264"><span class="linenos">264</span></a>                <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The devicepersistency setting by-partuuid can only be
used in combination with a partition table type that
supports UUIDs. In any other case Linux creates artificial
values for PTUUID and PARTUUID from the disk signature
which can change without touching the actual partition
table. We consider this unsafe and only allow the use
of by-partuuid in combination with partition tables that
actually supports it properly.</p>
</div>


                            </div>
                            <div id="RuntimeChecker.check_swap_name_used_with_lvm" class="classattr">
                                        <input id="RuntimeChecker.check_swap_name_used_with_lvm-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">check_swap_name_used_with_lvm</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="RuntimeChecker.check_swap_name_used_with_lvm-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RuntimeChecker.check_swap_name_used_with_lvm"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RuntimeChecker.check_swap_name_used_with_lvm-266"><a href="#RuntimeChecker.check_swap_name_used_with_lvm-266"><span class="linenos">266</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_swap_name_used_with_lvm</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_swap_name_used_with_lvm-267"><a href="#RuntimeChecker.check_swap_name_used_with_lvm-267"><span class="linenos">267</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_swap_name_used_with_lvm-268"><a href="#RuntimeChecker.check_swap_name_used_with_lvm-268"><span class="linenos">268</span></a><span class="sd">        The optional oem-swapname is only effective if used together</span>
</span><span id="RuntimeChecker.check_swap_name_used_with_lvm-269"><a href="#RuntimeChecker.check_swap_name_used_with_lvm-269"><span class="linenos">269</span></a><span class="sd">        with the LVM volume manager. A name for the swap space can</span>
</span><span id="RuntimeChecker.check_swap_name_used_with_lvm-270"><a href="#RuntimeChecker.check_swap_name_used_with_lvm-270"><span class="linenos">270</span></a><span class="sd">        only be set if it is created as a LVM volume. In any other</span>
</span><span id="RuntimeChecker.check_swap_name_used_with_lvm-271"><a href="#RuntimeChecker.check_swap_name_used_with_lvm-271"><span class="linenos">271</span></a><span class="sd">        case the name does not apply to the system</span>
</span><span id="RuntimeChecker.check_swap_name_used_with_lvm-272"><a href="#RuntimeChecker.check_swap_name_used_with_lvm-272"><span class="linenos">272</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_swap_name_used_with_lvm-273"><a href="#RuntimeChecker.check_swap_name_used_with_lvm-273"><span class="linenos">273</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker.check_swap_name_used_with_lvm-274"><a href="#RuntimeChecker.check_swap_name_used_with_lvm-274"><span class="linenos">274</span></a><span class="s1">             Specified swap space name: </span><span class="si">{0}</span><span class="s1"> will not be used</span>
</span><span id="RuntimeChecker.check_swap_name_used_with_lvm-275"><a href="#RuntimeChecker.check_swap_name_used_with_lvm-275"><span class="linenos">275</span></a>
</span><span id="RuntimeChecker.check_swap_name_used_with_lvm-276"><a href="#RuntimeChecker.check_swap_name_used_with_lvm-276"><span class="linenos">276</span></a><span class="s1">             The specified oem-swapname is used without the LVM volume</span>
</span><span id="RuntimeChecker.check_swap_name_used_with_lvm-277"><a href="#RuntimeChecker.check_swap_name_used_with_lvm-277"><span class="linenos">277</span></a><span class="s1">             manager. This means the swap space will be created as simple</span>
</span><span id="RuntimeChecker.check_swap_name_used_with_lvm-278"><a href="#RuntimeChecker.check_swap_name_used_with_lvm-278"><span class="linenos">278</span></a><span class="s1">             partition for which no name assignment can take place.</span>
</span><span id="RuntimeChecker.check_swap_name_used_with_lvm-279"><a href="#RuntimeChecker.check_swap_name_used_with_lvm-279"><span class="linenos">279</span></a><span class="s1">             The name specified in oem-swapname is used to give the</span>
</span><span id="RuntimeChecker.check_swap_name_used_with_lvm-280"><a href="#RuntimeChecker.check_swap_name_used_with_lvm-280"><span class="linenos">280</span></a><span class="s1">             LVM swap volume a name. Outside of LVM the setting is</span>
</span><span id="RuntimeChecker.check_swap_name_used_with_lvm-281"><a href="#RuntimeChecker.check_swap_name_used_with_lvm-281"><span class="linenos">281</span></a><span class="s1">             meaningless and should be removed.</span>
</span><span id="RuntimeChecker.check_swap_name_used_with_lvm-282"><a href="#RuntimeChecker.check_swap_name_used_with_lvm-282"><span class="linenos">282</span></a>
</span><span id="RuntimeChecker.check_swap_name_used_with_lvm-283"><a href="#RuntimeChecker.check_swap_name_used_with_lvm-283"><span class="linenos">283</span></a><span class="s1">             Please delete the following setting from your image</span>
</span><span id="RuntimeChecker.check_swap_name_used_with_lvm-284"><a href="#RuntimeChecker.check_swap_name_used_with_lvm-284"><span class="linenos">284</span></a><span class="s1">             description:</span>
</span><span id="RuntimeChecker.check_swap_name_used_with_lvm-285"><a href="#RuntimeChecker.check_swap_name_used_with_lvm-285"><span class="linenos">285</span></a>
</span><span id="RuntimeChecker.check_swap_name_used_with_lvm-286"><a href="#RuntimeChecker.check_swap_name_used_with_lvm-286"><span class="linenos">286</span></a><span class="s1">             &lt;oem-swapname&gt;</span><span class="si">{0}</span><span class="s1">&lt;/oem-swapname&gt;</span>
</span><span id="RuntimeChecker.check_swap_name_used_with_lvm-287"><a href="#RuntimeChecker.check_swap_name_used_with_lvm-287"><span class="linenos">287</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_swap_name_used_with_lvm-288"><a href="#RuntimeChecker.check_swap_name_used_with_lvm-288"><span class="linenos">288</span></a>        <span class="n">volume_management</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_volume_management</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_swap_name_used_with_lvm-289"><a href="#RuntimeChecker.check_swap_name_used_with_lvm-289"><span class="linenos">289</span></a>        <span class="k">if</span> <span class="n">volume_management</span> <span class="o">!=</span> <span class="s1">&#39;lvm&#39;</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_swap_name_used_with_lvm-290"><a href="#RuntimeChecker.check_swap_name_used_with_lvm-290"><span class="linenos">290</span></a>            <span class="n">oemconfig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_build_type_oemconfig_section</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_swap_name_used_with_lvm-291"><a href="#RuntimeChecker.check_swap_name_used_with_lvm-291"><span class="linenos">291</span></a>            <span class="k">if</span> <span class="n">oemconfig</span> <span class="ow">and</span> <span class="n">oemconfig</span><span class="o">.</span><span class="n">get_oem_swapname</span><span class="p">():</span>
</span><span id="RuntimeChecker.check_swap_name_used_with_lvm-292"><a href="#RuntimeChecker.check_swap_name_used_with_lvm-292"><span class="linenos">292</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_swap_name_used_with_lvm-293"><a href="#RuntimeChecker.check_swap_name_used_with_lvm-293"><span class="linenos">293</span></a>                    <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">oemconfig</span><span class="o">.</span><span class="n">get_oem_swapname</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="RuntimeChecker.check_swap_name_used_with_lvm-294"><a href="#RuntimeChecker.check_swap_name_used_with_lvm-294"><span class="linenos">294</span></a>                <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The optional oem-swapname is only effective if used together
with the LVM volume manager. A name for the swap space can
only be set if it is created as a LVM volume. In any other
case the name does not apply to the system</p>
</div>


                            </div>
                            <div id="RuntimeChecker.check_volume_setup_defines_reserved_labels" class="classattr">
                                        <input id="RuntimeChecker.check_volume_setup_defines_reserved_labels-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">check_volume_setup_defines_reserved_labels</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="RuntimeChecker.check_volume_setup_defines_reserved_labels-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RuntimeChecker.check_volume_setup_defines_reserved_labels"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RuntimeChecker.check_volume_setup_defines_reserved_labels-296"><a href="#RuntimeChecker.check_volume_setup_defines_reserved_labels-296"><span class="linenos">296</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_volume_setup_defines_reserved_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_volume_setup_defines_reserved_labels-297"><a href="#RuntimeChecker.check_volume_setup_defines_reserved_labels-297"><span class="linenos">297</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker.check_volume_setup_defines_reserved_labels-298"><a href="#RuntimeChecker.check_volume_setup_defines_reserved_labels-298"><span class="linenos">298</span></a><span class="s1">            Reserved label name used in LVM volume setup</span>
</span><span id="RuntimeChecker.check_volume_setup_defines_reserved_labels-299"><a href="#RuntimeChecker.check_volume_setup_defines_reserved_labels-299"><span class="linenos">299</span></a>
</span><span id="RuntimeChecker.check_volume_setup_defines_reserved_labels-300"><a href="#RuntimeChecker.check_volume_setup_defines_reserved_labels-300"><span class="linenos">300</span></a><span class="s1">            The label setup for volume </span><span class="si">{0}</span><span class="s1"> uses the reserved label </span><span class="si">{1}</span><span class="s1">.</span>
</span><span id="RuntimeChecker.check_volume_setup_defines_reserved_labels-301"><a href="#RuntimeChecker.check_volume_setup_defines_reserved_labels-301"><span class="linenos">301</span></a><span class="s1">            Reserved labels used by KIWI internally are </span><span class="si">{2}</span><span class="s1">. Please</span>
</span><span id="RuntimeChecker.check_volume_setup_defines_reserved_labels-302"><a href="#RuntimeChecker.check_volume_setup_defines_reserved_labels-302"><span class="linenos">302</span></a><span class="s1">            choose another label name for this volume.</span>
</span><span id="RuntimeChecker.check_volume_setup_defines_reserved_labels-303"><a href="#RuntimeChecker.check_volume_setup_defines_reserved_labels-303"><span class="linenos">303</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_volume_setup_defines_reserved_labels-304"><a href="#RuntimeChecker.check_volume_setup_defines_reserved_labels-304"><span class="linenos">304</span></a>        <span class="n">reserved_labels</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="RuntimeChecker.check_volume_setup_defines_reserved_labels-305"><a href="#RuntimeChecker.check_volume_setup_defines_reserved_labels-305"><span class="linenos">305</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_rootfs_label</span><span class="p">()</span> <span class="ow">or</span> <span class="s1">&#39;ROOT&#39;</span><span class="p">,</span>
</span><span id="RuntimeChecker.check_volume_setup_defines_reserved_labels-306"><a href="#RuntimeChecker.check_volume_setup_defines_reserved_labels-306"><span class="linenos">306</span></a>            <span class="s1">&#39;SWAP&#39;</span><span class="p">,</span> <span class="s1">&#39;SPARE&#39;</span>
</span><span id="RuntimeChecker.check_volume_setup_defines_reserved_labels-307"><a href="#RuntimeChecker.check_volume_setup_defines_reserved_labels-307"><span class="linenos">307</span></a>        <span class="p">]</span>
</span><span id="RuntimeChecker.check_volume_setup_defines_reserved_labels-308"><a href="#RuntimeChecker.check_volume_setup_defines_reserved_labels-308"><span class="linenos">308</span></a>        <span class="n">volume_management</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_volume_management</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_volume_setup_defines_reserved_labels-309"><a href="#RuntimeChecker.check_volume_setup_defines_reserved_labels-309"><span class="linenos">309</span></a>        <span class="k">if</span> <span class="n">volume_management</span> <span class="o">==</span> <span class="s1">&#39;lvm&#39;</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_volume_setup_defines_reserved_labels-310"><a href="#RuntimeChecker.check_volume_setup_defines_reserved_labels-310"><span class="linenos">310</span></a>            <span class="k">for</span> <span class="n">volume</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_volumes</span><span class="p">():</span>
</span><span id="RuntimeChecker.check_volume_setup_defines_reserved_labels-311"><a href="#RuntimeChecker.check_volume_setup_defines_reserved_labels-311"><span class="linenos">311</span></a>                <span class="c1"># A swap volume is created implicitly if oem-swap is</span>
</span><span id="RuntimeChecker.check_volume_setup_defines_reserved_labels-312"><a href="#RuntimeChecker.check_volume_setup_defines_reserved_labels-312"><span class="linenos">312</span></a>                <span class="c1"># requested. This volume detected via realpath set to</span>
</span><span id="RuntimeChecker.check_volume_setup_defines_reserved_labels-313"><a href="#RuntimeChecker.check_volume_setup_defines_reserved_labels-313"><span class="linenos">313</span></a>                <span class="c1"># swap is skipped from the reserved label check as it</span>
</span><span id="RuntimeChecker.check_volume_setup_defines_reserved_labels-314"><a href="#RuntimeChecker.check_volume_setup_defines_reserved_labels-314"><span class="linenos">314</span></a>                <span class="c1"># intentionally uses the reserved label named SWAP</span>
</span><span id="RuntimeChecker.check_volume_setup_defines_reserved_labels-315"><a href="#RuntimeChecker.check_volume_setup_defines_reserved_labels-315"><span class="linenos">315</span></a>                <span class="k">if</span> <span class="n">volume</span><span class="o">.</span><span class="n">realpath</span> <span class="o">!=</span> <span class="s1">&#39;swap&#39;</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_volume_setup_defines_reserved_labels-316"><a href="#RuntimeChecker.check_volume_setup_defines_reserved_labels-316"><span class="linenos">316</span></a>                    <span class="k">if</span> <span class="n">volume</span><span class="o">.</span><span class="n">label</span> <span class="ow">and</span> <span class="n">volume</span><span class="o">.</span><span class="n">label</span> <span class="ow">in</span> <span class="n">reserved_labels</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_volume_setup_defines_reserved_labels-317"><a href="#RuntimeChecker.check_volume_setup_defines_reserved_labels-317"><span class="linenos">317</span></a>                        <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_volume_setup_defines_reserved_labels-318"><a href="#RuntimeChecker.check_volume_setup_defines_reserved_labels-318"><span class="linenos">318</span></a>                            <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_volume_setup_defines_reserved_labels-319"><a href="#RuntimeChecker.check_volume_setup_defines_reserved_labels-319"><span class="linenos">319</span></a>                                <span class="n">volume</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">volume</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">reserved_labels</span>
</span><span id="RuntimeChecker.check_volume_setup_defines_reserved_labels-320"><a href="#RuntimeChecker.check_volume_setup_defines_reserved_labels-320"><span class="linenos">320</span></a>                            <span class="p">)</span>
</span><span id="RuntimeChecker.check_volume_setup_defines_reserved_labels-321"><a href="#RuntimeChecker.check_volume_setup_defines_reserved_labels-321"><span class="linenos">321</span></a>                        <span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes" class="classattr">
                                        <input id="RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">check_volume_setup_defines_multiple_fullsize_volumes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-323"><a href="#RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-323"><span class="linenos">323</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_volume_setup_defines_multiple_fullsize_volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-324"><a href="#RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-324"><span class="linenos">324</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-325"><a href="#RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-325"><span class="linenos">325</span></a><span class="sd">        The volume size specification &#39;all&#39; makes this volume to</span>
</span><span id="RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-326"><a href="#RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-326"><span class="linenos">326</span></a><span class="sd">        take the rest space available on the system. It&#39;s only</span>
</span><span id="RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-327"><a href="#RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-327"><span class="linenos">327</span></a><span class="sd">        allowed to specify one all size volume</span>
</span><span id="RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-328"><a href="#RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-328"><span class="linenos">328</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-329"><a href="#RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-329"><span class="linenos">329</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-330"><a href="#RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-330"><span class="linenos">330</span></a><span class="s1">            Multiple all size volumes found but only one is allowed</span>
</span><span id="RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-331"><a href="#RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-331"><span class="linenos">331</span></a>
</span><span id="RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-332"><a href="#RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-332"><span class="linenos">332</span></a><span class="s1">            The volume size specification &#39;all&#39; makes this volume to</span>
</span><span id="RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-333"><a href="#RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-333"><span class="linenos">333</span></a><span class="s1">            take the rest space available on the system. It&#39;s only</span>
</span><span id="RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-334"><a href="#RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-334"><span class="linenos">334</span></a><span class="s1">            allowed to specify one all size volume</span>
</span><span id="RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-335"><a href="#RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-335"><span class="linenos">335</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-336"><a href="#RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-336"><span class="linenos">336</span></a>        <span class="n">systemdisk_section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_build_type_system_disk_section</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-337"><a href="#RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-337"><span class="linenos">337</span></a>        <span class="k">if</span> <span class="n">systemdisk_section</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-338"><a href="#RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-338"><span class="linenos">338</span></a>            <span class="n">all_size_volume_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-339"><a href="#RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-339"><span class="linenos">339</span></a>            <span class="n">volumes</span> <span class="o">=</span> <span class="n">systemdisk_section</span><span class="o">.</span><span class="n">get_volume</span><span class="p">()</span> <span class="ow">or</span> <span class="p">[]</span>
</span><span id="RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-340"><a href="#RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-340"><span class="linenos">340</span></a>            <span class="k">for</span> <span class="n">volume</span> <span class="ow">in</span> <span class="n">volumes</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-341"><a href="#RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-341"><span class="linenos">341</span></a>                <span class="n">size</span> <span class="o">=</span> <span class="n">volume</span><span class="o">.</span><span class="n">get_size</span><span class="p">()</span> <span class="ow">or</span> <span class="n">volume</span><span class="o">.</span><span class="n">get_freespace</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-342"><a href="#RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-342"><span class="linenos">342</span></a>                <span class="k">if</span> <span class="n">size</span> <span class="ow">and</span> <span class="s1">&#39;all&#39;</span> <span class="ow">in</span> <span class="n">size</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-343"><a href="#RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-343"><span class="linenos">343</span></a>                    <span class="n">all_size_volume_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-344"><a href="#RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-344"><span class="linenos">344</span></a>            <span class="k">if</span> <span class="n">all_size_volume_count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-345"><a href="#RuntimeChecker.check_volume_setup_defines_multiple_fullsize_volumes-345"><span class="linenos">345</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The volume size specification 'all' makes this volume to
take the rest space available on the system. It's only
allowed to specify one all size volume</p>
</div>


                            </div>
                            <div id="RuntimeChecker.check_volume_setup_has_no_root_definition" class="classattr">
                                        <input id="RuntimeChecker.check_volume_setup_has_no_root_definition-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">check_volume_setup_has_no_root_definition</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="RuntimeChecker.check_volume_setup_has_no_root_definition-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RuntimeChecker.check_volume_setup_has_no_root_definition"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RuntimeChecker.check_volume_setup_has_no_root_definition-347"><a href="#RuntimeChecker.check_volume_setup_has_no_root_definition-347"><span class="linenos">347</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_volume_setup_has_no_root_definition</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_volume_setup_has_no_root_definition-348"><a href="#RuntimeChecker.check_volume_setup_has_no_root_definition-348"><span class="linenos">348</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_volume_setup_has_no_root_definition-349"><a href="#RuntimeChecker.check_volume_setup_has_no_root_definition-349"><span class="linenos">349</span></a><span class="sd">        The root volume in a systemdisk setup is handled in a special</span>
</span><span id="RuntimeChecker.check_volume_setup_has_no_root_definition-350"><a href="#RuntimeChecker.check_volume_setup_has_no_root_definition-350"><span class="linenos">350</span></a><span class="sd">        way. It is not allowed to setup a custom name or mountpoint for</span>
</span><span id="RuntimeChecker.check_volume_setup_has_no_root_definition-351"><a href="#RuntimeChecker.check_volume_setup_has_no_root_definition-351"><span class="linenos">351</span></a><span class="sd">        the root volume. Therefore the size of the root volume can be</span>
</span><span id="RuntimeChecker.check_volume_setup_has_no_root_definition-352"><a href="#RuntimeChecker.check_volume_setup_has_no_root_definition-352"><span class="linenos">352</span></a><span class="sd">        setup via the @root volume name. This check looks up the volume</span>
</span><span id="RuntimeChecker.check_volume_setup_has_no_root_definition-353"><a href="#RuntimeChecker.check_volume_setup_has_no_root_definition-353"><span class="linenos">353</span></a><span class="sd">        setup and searches if there is a configuration for the &#39;/&#39;</span>
</span><span id="RuntimeChecker.check_volume_setup_has_no_root_definition-354"><a href="#RuntimeChecker.check_volume_setup_has_no_root_definition-354"><span class="linenos">354</span></a><span class="sd">        mountpoint which would cause the image build to fail</span>
</span><span id="RuntimeChecker.check_volume_setup_has_no_root_definition-355"><a href="#RuntimeChecker.check_volume_setup_has_no_root_definition-355"><span class="linenos">355</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_volume_setup_has_no_root_definition-356"><a href="#RuntimeChecker.check_volume_setup_has_no_root_definition-356"><span class="linenos">356</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker.check_volume_setup_has_no_root_definition-357"><a href="#RuntimeChecker.check_volume_setup_has_no_root_definition-357"><span class="linenos">357</span></a><span class="s1">            Volume setup for &quot;/&quot; found. The size of the root volume</span>
</span><span id="RuntimeChecker.check_volume_setup_has_no_root_definition-358"><a href="#RuntimeChecker.check_volume_setup_has_no_root_definition-358"><span class="linenos">358</span></a><span class="s1">            must be specified via the @root volume name like the</span>
</span><span id="RuntimeChecker.check_volume_setup_has_no_root_definition-359"><a href="#RuntimeChecker.check_volume_setup_has_no_root_definition-359"><span class="linenos">359</span></a><span class="s1">            following example shows:</span>
</span><span id="RuntimeChecker.check_volume_setup_has_no_root_definition-360"><a href="#RuntimeChecker.check_volume_setup_has_no_root_definition-360"><span class="linenos">360</span></a>
</span><span id="RuntimeChecker.check_volume_setup_has_no_root_definition-361"><a href="#RuntimeChecker.check_volume_setup_has_no_root_definition-361"><span class="linenos">361</span></a><span class="s1">            &lt;volume name=&quot;@root&quot; size=&quot;42G&quot;/&gt;</span>
</span><span id="RuntimeChecker.check_volume_setup_has_no_root_definition-362"><a href="#RuntimeChecker.check_volume_setup_has_no_root_definition-362"><span class="linenos">362</span></a>
</span><span id="RuntimeChecker.check_volume_setup_has_no_root_definition-363"><a href="#RuntimeChecker.check_volume_setup_has_no_root_definition-363"><span class="linenos">363</span></a><span class="s1">            A custom name or mountpoint for the root volume is not</span>
</span><span id="RuntimeChecker.check_volume_setup_has_no_root_definition-364"><a href="#RuntimeChecker.check_volume_setup_has_no_root_definition-364"><span class="linenos">364</span></a><span class="s1">            allowed.</span>
</span><span id="RuntimeChecker.check_volume_setup_has_no_root_definition-365"><a href="#RuntimeChecker.check_volume_setup_has_no_root_definition-365"><span class="linenos">365</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_volume_setup_has_no_root_definition-366"><a href="#RuntimeChecker.check_volume_setup_has_no_root_definition-366"><span class="linenos">366</span></a>        <span class="k">for</span> <span class="n">volume</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_volumes</span><span class="p">():</span>
</span><span id="RuntimeChecker.check_volume_setup_has_no_root_definition-367"><a href="#RuntimeChecker.check_volume_setup_has_no_root_definition-367"><span class="linenos">367</span></a>            <span class="k">if</span> <span class="n">volume</span><span class="o">.</span><span class="n">mountpoint</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_volume_setup_has_no_root_definition-368"><a href="#RuntimeChecker.check_volume_setup_has_no_root_definition-368"><span class="linenos">368</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The root volume in a systemdisk setup is handled in a special
way. It is not allowed to setup a custom name or mountpoint for
the root volume. Therefore the size of the root volume can be
setup via the @root volume name. This check looks up the volume
setup and searches if there is a configuration for the '/'
mountpoint which would cause the image build to fail</p>
</div>


                            </div>
                            <div id="RuntimeChecker.check_container_tool_chain_installed" class="classattr">
                                        <input id="RuntimeChecker.check_container_tool_chain_installed-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">check_container_tool_chain_installed</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="RuntimeChecker.check_container_tool_chain_installed-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RuntimeChecker.check_container_tool_chain_installed"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RuntimeChecker.check_container_tool_chain_installed-370"><a href="#RuntimeChecker.check_container_tool_chain_installed-370"><span class="linenos">370</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_container_tool_chain_installed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-371"><a href="#RuntimeChecker.check_container_tool_chain_installed-371"><span class="linenos">371</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-372"><a href="#RuntimeChecker.check_container_tool_chain_installed-372"><span class="linenos">372</span></a><span class="sd">        When creating container images the specific tools are used in order</span>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-373"><a href="#RuntimeChecker.check_container_tool_chain_installed-373"><span class="linenos">373</span></a><span class="sd">        to import and export OCI or Docker compatible images. This check</span>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-374"><a href="#RuntimeChecker.check_container_tool_chain_installed-374"><span class="linenos">374</span></a><span class="sd">        searches for those tools to be installed in the build system and</span>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-375"><a href="#RuntimeChecker.check_container_tool_chain_installed-375"><span class="linenos">375</span></a><span class="sd">        fails if it can&#39;t find them</span>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-376"><a href="#RuntimeChecker.check_container_tool_chain_installed-376"><span class="linenos">376</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-377"><a href="#RuntimeChecker.check_container_tool_chain_installed-377"><span class="linenos">377</span></a>        <span class="n">message_tool_not_found</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-378"><a href="#RuntimeChecker.check_container_tool_chain_installed-378"><span class="linenos">378</span></a><span class="s1">            Required tool </span><span class="si">{name}</span><span class="s1"> not found in caller environment</span>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-379"><a href="#RuntimeChecker.check_container_tool_chain_installed-379"><span class="linenos">379</span></a>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-380"><a href="#RuntimeChecker.check_container_tool_chain_installed-380"><span class="linenos">380</span></a><span class="s1">            Creation of OCI or Docker images requires the tools </span><span class="si">{name}</span><span class="s1"> and</span>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-381"><a href="#RuntimeChecker.check_container_tool_chain_installed-381"><span class="linenos">381</span></a><span class="s1">            skopeo to be installed on the build system. For SUSE based systems</span>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-382"><a href="#RuntimeChecker.check_container_tool_chain_installed-382"><span class="linenos">382</span></a><span class="s1">            you can find the tools at:</span>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-383"><a href="#RuntimeChecker.check_container_tool_chain_installed-383"><span class="linenos">383</span></a>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-384"><a href="#RuntimeChecker.check_container_tool_chain_installed-384"><span class="linenos">384</span></a><span class="s1">            http://download.opensuse.org/repositories/Virtualization:/containers</span>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-385"><a href="#RuntimeChecker.check_container_tool_chain_installed-385"><span class="linenos">385</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-386"><a href="#RuntimeChecker.check_container_tool_chain_installed-386"><span class="linenos">386</span></a>        <span class="n">message_version_unsupported</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-387"><a href="#RuntimeChecker.check_container_tool_chain_installed-387"><span class="linenos">387</span></a><span class="s1">            </span><span class="si">{name}</span><span class="s1"> tool found with unknown version</span>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-388"><a href="#RuntimeChecker.check_container_tool_chain_installed-388"><span class="linenos">388</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-389"><a href="#RuntimeChecker.check_container_tool_chain_installed-389"><span class="linenos">389</span></a>        <span class="n">message_unknown_tool</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-390"><a href="#RuntimeChecker.check_container_tool_chain_installed-390"><span class="linenos">390</span></a><span class="s1">            Unknown tool: </span><span class="si">{0}</span><span class="s1">.</span>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-391"><a href="#RuntimeChecker.check_container_tool_chain_installed-391"><span class="linenos">391</span></a>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-392"><a href="#RuntimeChecker.check_container_tool_chain_installed-392"><span class="linenos">392</span></a><span class="s1">            Please configure KIWI with an appropriate value (umoci or buildah).</span>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-393"><a href="#RuntimeChecker.check_container_tool_chain_installed-393"><span class="linenos">393</span></a><span class="s1">            Consider this runtime configuration file syntax (/etc/kiwi.yml):</span>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-394"><a href="#RuntimeChecker.check_container_tool_chain_installed-394"><span class="linenos">394</span></a>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-395"><a href="#RuntimeChecker.check_container_tool_chain_installed-395"><span class="linenos">395</span></a><span class="s1">            oci:</span>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-396"><a href="#RuntimeChecker.check_container_tool_chain_installed-396"><span class="linenos">396</span></a><span class="s1">                - archive_tool: umoci | buildah</span>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-397"><a href="#RuntimeChecker.check_container_tool_chain_installed-397"><span class="linenos">397</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-398"><a href="#RuntimeChecker.check_container_tool_chain_installed-398"><span class="linenos">398</span></a>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-399"><a href="#RuntimeChecker.check_container_tool_chain_installed-399"><span class="linenos">399</span></a>        <span class="n">expected_version</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-400"><a href="#RuntimeChecker.check_container_tool_chain_installed-400"><span class="linenos">400</span></a>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-401"><a href="#RuntimeChecker.check_container_tool_chain_installed-401"><span class="linenos">401</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_build_type_name</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;docker&#39;</span><span class="p">,</span> <span class="s1">&#39;oci&#39;</span><span class="p">]:</span>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-402"><a href="#RuntimeChecker.check_container_tool_chain_installed-402"><span class="linenos">402</span></a>            <span class="n">runtime_config</span> <span class="o">=</span> <span class="n">RuntimeConfig</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-403"><a href="#RuntimeChecker.check_container_tool_chain_installed-403"><span class="linenos">403</span></a>            <span class="n">tool_name</span> <span class="o">=</span> <span class="n">runtime_config</span><span class="o">.</span><span class="n">get_oci_archive_tool</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-404"><a href="#RuntimeChecker.check_container_tool_chain_installed-404"><span class="linenos">404</span></a>            <span class="k">if</span> <span class="n">tool_name</span> <span class="o">==</span> <span class="s1">&#39;buildah&#39;</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-405"><a href="#RuntimeChecker.check_container_tool_chain_installed-405"><span class="linenos">405</span></a>                <span class="n">oci_tools</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;buildah&#39;</span><span class="p">,</span> <span class="s1">&#39;skopeo&#39;</span><span class="p">]</span>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-406"><a href="#RuntimeChecker.check_container_tool_chain_installed-406"><span class="linenos">406</span></a>            <span class="k">elif</span> <span class="n">tool_name</span> <span class="o">==</span> <span class="s1">&#39;umoci&#39;</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-407"><a href="#RuntimeChecker.check_container_tool_chain_installed-407"><span class="linenos">407</span></a>                <span class="n">oci_tools</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;umoci&#39;</span><span class="p">,</span> <span class="s1">&#39;skopeo&#39;</span><span class="p">]</span>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-408"><a href="#RuntimeChecker.check_container_tool_chain_installed-408"><span class="linenos">408</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-409"><a href="#RuntimeChecker.check_container_tool_chain_installed-409"><span class="linenos">409</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span><span class="n">message_unknown_tool</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tool_name</span><span class="p">))</span>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-410"><a href="#RuntimeChecker.check_container_tool_chain_installed-410"><span class="linenos">410</span></a>            <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">oci_tools</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-411"><a href="#RuntimeChecker.check_container_tool_chain_installed-411"><span class="linenos">411</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">Path</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">tool</span><span class="p">,</span> <span class="n">access_mode</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">X_OK</span><span class="p">):</span>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-412"><a href="#RuntimeChecker.check_container_tool_chain_installed-412"><span class="linenos">412</span></a>                    <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-413"><a href="#RuntimeChecker.check_container_tool_chain_installed-413"><span class="linenos">413</span></a>                        <span class="n">message_tool_not_found</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">tool</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-414"><a href="#RuntimeChecker.check_container_tool_chain_installed-414"><span class="linenos">414</span></a>                    <span class="p">)</span>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-415"><a href="#RuntimeChecker.check_container_tool_chain_installed-415"><span class="linenos">415</span></a>                <span class="k">elif</span> <span class="ow">not</span> <span class="n">CommandCapabilities</span><span class="o">.</span><span class="n">check_version</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-416"><a href="#RuntimeChecker.check_container_tool_chain_installed-416"><span class="linenos">416</span></a>                    <span class="n">tool</span><span class="p">,</span> <span class="n">expected_version</span><span class="p">,</span> <span class="n">raise_on_error</span><span class="o">=</span><span class="kc">False</span>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-417"><a href="#RuntimeChecker.check_container_tool_chain_installed-417"><span class="linenos">417</span></a>                <span class="p">):</span>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-418"><a href="#RuntimeChecker.check_container_tool_chain_installed-418"><span class="linenos">418</span></a>                    <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-419"><a href="#RuntimeChecker.check_container_tool_chain_installed-419"><span class="linenos">419</span></a>                        <span class="n">message_version_unsupported</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">tool</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-420"><a href="#RuntimeChecker.check_container_tool_chain_installed-420"><span class="linenos">420</span></a>                    <span class="p">)</span>
</span><span id="RuntimeChecker.check_container_tool_chain_installed-421"><a href="#RuntimeChecker.check_container_tool_chain_installed-421"><span class="linenos">421</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_check_multitag_support</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>When creating container images the specific tools are used in order
to import and export OCI or Docker compatible images. This check
searches for those tools to be installed in the build system and
fails if it can't find them</p>
</div>


                            </div>
                            <div id="RuntimeChecker.check_luksformat_options_valid" class="classattr">
                                        <input id="RuntimeChecker.check_luksformat_options_valid-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">check_luksformat_options_valid</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="RuntimeChecker.check_luksformat_options_valid-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RuntimeChecker.check_luksformat_options_valid"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RuntimeChecker.check_luksformat_options_valid-438"><a href="#RuntimeChecker.check_luksformat_options_valid-438"><span class="linenos">438</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_luksformat_options_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_luksformat_options_valid-439"><a href="#RuntimeChecker.check_luksformat_options_valid-439"><span class="linenos">439</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_luksformat_options_valid-440"><a href="#RuntimeChecker.check_luksformat_options_valid-440"><span class="linenos">440</span></a><span class="sd">        Options set via the luksformat element are passed along</span>
</span><span id="RuntimeChecker.check_luksformat_options_valid-441"><a href="#RuntimeChecker.check_luksformat_options_valid-441"><span class="linenos">441</span></a><span class="sd">        to the cryptsetup tool. Only options that are known to</span>
</span><span id="RuntimeChecker.check_luksformat_options_valid-442"><a href="#RuntimeChecker.check_luksformat_options_valid-442"><span class="linenos">442</span></a><span class="sd">        the tool should be allowed. Thus this runtime check looks</span>
</span><span id="RuntimeChecker.check_luksformat_options_valid-443"><a href="#RuntimeChecker.check_luksformat_options_valid-443"><span class="linenos">443</span></a><span class="sd">        up the provided option names if they exist in the cryptsetup</span>
</span><span id="RuntimeChecker.check_luksformat_options_valid-444"><a href="#RuntimeChecker.check_luksformat_options_valid-444"><span class="linenos">444</span></a><span class="sd">        version used on the build host</span>
</span><span id="RuntimeChecker.check_luksformat_options_valid-445"><a href="#RuntimeChecker.check_luksformat_options_valid-445"><span class="linenos">445</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_luksformat_options_valid-446"><a href="#RuntimeChecker.check_luksformat_options_valid-446"><span class="linenos">446</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker.check_luksformat_options_valid-447"><a href="#RuntimeChecker.check_luksformat_options_valid-447"><span class="linenos">447</span></a><span class="s1">            Option </span><span class="si">{0!r}</span><span class="s1"> not found in cryptsetup</span>
</span><span id="RuntimeChecker.check_luksformat_options_valid-448"><a href="#RuntimeChecker.check_luksformat_options_valid-448"><span class="linenos">448</span></a>
</span><span id="RuntimeChecker.check_luksformat_options_valid-449"><a href="#RuntimeChecker.check_luksformat_options_valid-449"><span class="linenos">449</span></a><span class="s1">            The Option </span><span class="si">{0!r}</span><span class="s1"> could not be found in the help output</span>
</span><span id="RuntimeChecker.check_luksformat_options_valid-450"><a href="#RuntimeChecker.check_luksformat_options_valid-450"><span class="linenos">450</span></a><span class="s1">            of the cryptsetup tool.</span>
</span><span id="RuntimeChecker.check_luksformat_options_valid-451"><a href="#RuntimeChecker.check_luksformat_options_valid-451"><span class="linenos">451</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_luksformat_options_valid-452"><a href="#RuntimeChecker.check_luksformat_options_valid-452"><span class="linenos">452</span></a>        <span class="n">luksformat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_luksformat</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_luksformat_options_valid-453"><a href="#RuntimeChecker.check_luksformat_options_valid-453"><span class="linenos">453</span></a>        <span class="k">if</span> <span class="n">luksformat</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_luksformat_options_valid-454"><a href="#RuntimeChecker.check_luksformat_options_valid-454"><span class="linenos">454</span></a>            <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="n">luksformat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_option</span><span class="p">():</span>
</span><span id="RuntimeChecker.check_luksformat_options_valid-455"><a href="#RuntimeChecker.check_luksformat_options_valid-455"><span class="linenos">455</span></a>                <span class="n">argument</span> <span class="o">=</span> <span class="n">option</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_luksformat_options_valid-456"><a href="#RuntimeChecker.check_luksformat_options_valid-456"><span class="linenos">456</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">CommandCapabilities</span><span class="o">.</span><span class="n">has_option_in_help</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_luksformat_options_valid-457"><a href="#RuntimeChecker.check_luksformat_options_valid-457"><span class="linenos">457</span></a>                    <span class="s1">&#39;cryptsetup&#39;</span><span class="p">,</span> <span class="n">argument</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;--help&#39;</span><span class="p">],</span>
</span><span id="RuntimeChecker.check_luksformat_options_valid-458"><a href="#RuntimeChecker.check_luksformat_options_valid-458"><span class="linenos">458</span></a>                    <span class="n">raise_on_error</span><span class="o">=</span><span class="kc">False</span>
</span><span id="RuntimeChecker.check_luksformat_options_valid-459"><a href="#RuntimeChecker.check_luksformat_options_valid-459"><span class="linenos">459</span></a>                <span class="p">):</span>
</span><span id="RuntimeChecker.check_luksformat_options_valid-460"><a href="#RuntimeChecker.check_luksformat_options_valid-460"><span class="linenos">460</span></a>                    <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">argument</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Options set via the luksformat element are passed along
to the cryptsetup tool. Only options that are known to
the tool should be allowed. Thus this runtime check looks
up the provided option names if they exist in the cryptsetup
version used on the build host</p>
</div>


                            </div>
                            <div id="RuntimeChecker.check_appx_naming_conventions_valid" class="classattr">
                                        <input id="RuntimeChecker.check_appx_naming_conventions_valid-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">check_appx_naming_conventions_valid</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="RuntimeChecker.check_appx_naming_conventions_valid-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RuntimeChecker.check_appx_naming_conventions_valid"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RuntimeChecker.check_appx_naming_conventions_valid-462"><a href="#RuntimeChecker.check_appx_naming_conventions_valid-462"><span class="linenos">462</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_appx_naming_conventions_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_appx_naming_conventions_valid-463"><a href="#RuntimeChecker.check_appx_naming_conventions_valid-463"><span class="linenos">463</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_appx_naming_conventions_valid-464"><a href="#RuntimeChecker.check_appx_naming_conventions_valid-464"><span class="linenos">464</span></a><span class="sd">        When building wsl images there are some naming conventions that</span>
</span><span id="RuntimeChecker.check_appx_naming_conventions_valid-465"><a href="#RuntimeChecker.check_appx_naming_conventions_valid-465"><span class="linenos">465</span></a><span class="sd">        must be fulfilled to run the container on Microsoft Windows</span>
</span><span id="RuntimeChecker.check_appx_naming_conventions_valid-466"><a href="#RuntimeChecker.check_appx_naming_conventions_valid-466"><span class="linenos">466</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_appx_naming_conventions_valid-467"><a href="#RuntimeChecker.check_appx_naming_conventions_valid-467"><span class="linenos">467</span></a>        <span class="n">launcher_pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;[^</span><span class="se">\\</span><span class="s1">]+(\.[Ee][Xx][Ee])$&#39;</span>
</span><span id="RuntimeChecker.check_appx_naming_conventions_valid-468"><a href="#RuntimeChecker.check_appx_naming_conventions_valid-468"><span class="linenos">468</span></a>        <span class="n">message_container_launcher_invalid</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker.check_appx_naming_conventions_valid-469"><a href="#RuntimeChecker.check_appx_naming_conventions_valid-469"><span class="linenos">469</span></a><span class="s1">            Invalid WSL launcher name: </span><span class="si">{0}</span>
</span><span id="RuntimeChecker.check_appx_naming_conventions_valid-470"><a href="#RuntimeChecker.check_appx_naming_conventions_valid-470"><span class="linenos">470</span></a>
</span><span id="RuntimeChecker.check_appx_naming_conventions_valid-471"><a href="#RuntimeChecker.check_appx_naming_conventions_valid-471"><span class="linenos">471</span></a><span class="s1">            WSL launcher name must match the pattern: </span><span class="si">{1}</span>
</span><span id="RuntimeChecker.check_appx_naming_conventions_valid-472"><a href="#RuntimeChecker.check_appx_naming_conventions_valid-472"><span class="linenos">472</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_appx_naming_conventions_valid-473"><a href="#RuntimeChecker.check_appx_naming_conventions_valid-473"><span class="linenos">473</span></a>        <span class="n">id_pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;^[a-zA-Z0-9]+$&#39;</span>
</span><span id="RuntimeChecker.check_appx_naming_conventions_valid-474"><a href="#RuntimeChecker.check_appx_naming_conventions_valid-474"><span class="linenos">474</span></a>        <span class="n">message_container_id_invalid</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker.check_appx_naming_conventions_valid-475"><a href="#RuntimeChecker.check_appx_naming_conventions_valid-475"><span class="linenos">475</span></a><span class="s1">            Invalid WSL container application id: </span><span class="si">{0}</span>
</span><span id="RuntimeChecker.check_appx_naming_conventions_valid-476"><a href="#RuntimeChecker.check_appx_naming_conventions_valid-476"><span class="linenos">476</span></a>
</span><span id="RuntimeChecker.check_appx_naming_conventions_valid-477"><a href="#RuntimeChecker.check_appx_naming_conventions_valid-477"><span class="linenos">477</span></a><span class="s1">            WSL container id must match the pattern: </span><span class="si">{1}</span>
</span><span id="RuntimeChecker.check_appx_naming_conventions_valid-478"><a href="#RuntimeChecker.check_appx_naming_conventions_valid-478"><span class="linenos">478</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_appx_naming_conventions_valid-479"><a href="#RuntimeChecker.check_appx_naming_conventions_valid-479"><span class="linenos">479</span></a>        <span class="n">build_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_build_type_name</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_appx_naming_conventions_valid-480"><a href="#RuntimeChecker.check_appx_naming_conventions_valid-480"><span class="linenos">480</span></a>        <span class="n">container_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_container_config</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_appx_naming_conventions_valid-481"><a href="#RuntimeChecker.check_appx_naming_conventions_valid-481"><span class="linenos">481</span></a>        <span class="n">container_history</span> <span class="o">=</span> <span class="n">container_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;history&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
</span><span id="RuntimeChecker.check_appx_naming_conventions_valid-482"><a href="#RuntimeChecker.check_appx_naming_conventions_valid-482"><span class="linenos">482</span></a>        <span class="k">if</span> <span class="n">build_type</span> <span class="o">==</span> <span class="s1">&#39;appx&#39;</span> <span class="ow">and</span> <span class="n">container_config</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_appx_naming_conventions_valid-483"><a href="#RuntimeChecker.check_appx_naming_conventions_valid-483"><span class="linenos">483</span></a>            <span class="n">launcher</span> <span class="o">=</span> <span class="n">container_history</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;launcher&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_appx_naming_conventions_valid-484"><a href="#RuntimeChecker.check_appx_naming_conventions_valid-484"><span class="linenos">484</span></a>            <span class="k">if</span> <span class="n">launcher</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">launcher_pattern</span><span class="p">,</span> <span class="n">launcher</span><span class="p">):</span>
</span><span id="RuntimeChecker.check_appx_naming_conventions_valid-485"><a href="#RuntimeChecker.check_appx_naming_conventions_valid-485"><span class="linenos">485</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_appx_naming_conventions_valid-486"><a href="#RuntimeChecker.check_appx_naming_conventions_valid-486"><span class="linenos">486</span></a>                    <span class="n">message_container_launcher_invalid</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_appx_naming_conventions_valid-487"><a href="#RuntimeChecker.check_appx_naming_conventions_valid-487"><span class="linenos">487</span></a>                        <span class="n">launcher</span><span class="p">,</span> <span class="n">launcher_pattern</span>
</span><span id="RuntimeChecker.check_appx_naming_conventions_valid-488"><a href="#RuntimeChecker.check_appx_naming_conventions_valid-488"><span class="linenos">488</span></a>                    <span class="p">)</span>
</span><span id="RuntimeChecker.check_appx_naming_conventions_valid-489"><a href="#RuntimeChecker.check_appx_naming_conventions_valid-489"><span class="linenos">489</span></a>                <span class="p">)</span>
</span><span id="RuntimeChecker.check_appx_naming_conventions_valid-490"><a href="#RuntimeChecker.check_appx_naming_conventions_valid-490"><span class="linenos">490</span></a>            <span class="n">application_id</span> <span class="o">=</span> <span class="n">container_history</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;application_id&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_appx_naming_conventions_valid-491"><a href="#RuntimeChecker.check_appx_naming_conventions_valid-491"><span class="linenos">491</span></a>            <span class="k">if</span> <span class="n">application_id</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">id_pattern</span><span class="p">,</span> <span class="n">application_id</span><span class="p">):</span>
</span><span id="RuntimeChecker.check_appx_naming_conventions_valid-492"><a href="#RuntimeChecker.check_appx_naming_conventions_valid-492"><span class="linenos">492</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_appx_naming_conventions_valid-493"><a href="#RuntimeChecker.check_appx_naming_conventions_valid-493"><span class="linenos">493</span></a>                    <span class="n">message_container_id_invalid</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_appx_naming_conventions_valid-494"><a href="#RuntimeChecker.check_appx_naming_conventions_valid-494"><span class="linenos">494</span></a>                        <span class="n">application_id</span><span class="p">,</span> <span class="n">id_pattern</span>
</span><span id="RuntimeChecker.check_appx_naming_conventions_valid-495"><a href="#RuntimeChecker.check_appx_naming_conventions_valid-495"><span class="linenos">495</span></a>                    <span class="p">)</span>
</span><span id="RuntimeChecker.check_appx_naming_conventions_valid-496"><a href="#RuntimeChecker.check_appx_naming_conventions_valid-496"><span class="linenos">496</span></a>                <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>When building wsl images there are some naming conventions that
must be fulfilled to run the container on Microsoft Windows</p>
</div>


                            </div>
                            <div id="RuntimeChecker.check_initrd_selection_required" class="classattr">
                                        <input id="RuntimeChecker.check_initrd_selection_required-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">check_initrd_selection_required</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="RuntimeChecker.check_initrd_selection_required-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RuntimeChecker.check_initrd_selection_required"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RuntimeChecker.check_initrd_selection_required-498"><a href="#RuntimeChecker.check_initrd_selection_required-498"><span class="linenos">498</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_initrd_selection_required</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_initrd_selection_required-499"><a href="#RuntimeChecker.check_initrd_selection_required-499"><span class="linenos">499</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_initrd_selection_required-500"><a href="#RuntimeChecker.check_initrd_selection_required-500"><span class="linenos">500</span></a><span class="sd">        If the boot attribute is used without selecting kiwi</span>
</span><span id="RuntimeChecker.check_initrd_selection_required-501"><a href="#RuntimeChecker.check_initrd_selection_required-501"><span class="linenos">501</span></a><span class="sd">        as the initrd_system, the setting of the boot attribute</span>
</span><span id="RuntimeChecker.check_initrd_selection_required-502"><a href="#RuntimeChecker.check_initrd_selection_required-502"><span class="linenos">502</span></a><span class="sd">        will not have any effect. We assume that configurations</span>
</span><span id="RuntimeChecker.check_initrd_selection_required-503"><a href="#RuntimeChecker.check_initrd_selection_required-503"><span class="linenos">503</span></a><span class="sd">        which explicitly specify the boot attribute wants to use</span>
</span><span id="RuntimeChecker.check_initrd_selection_required-504"><a href="#RuntimeChecker.check_initrd_selection_required-504"><span class="linenos">504</span></a><span class="sd">        the custom kiwi initrd system and not dracut.</span>
</span><span id="RuntimeChecker.check_initrd_selection_required-505"><a href="#RuntimeChecker.check_initrd_selection_required-505"><span class="linenos">505</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_initrd_selection_required-506"><a href="#RuntimeChecker.check_initrd_selection_required-506"><span class="linenos">506</span></a>        <span class="n">message_kiwi_initrd_system_not_selected</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker.check_initrd_selection_required-507"><a href="#RuntimeChecker.check_initrd_selection_required-507"><span class="linenos">507</span></a><span class="s1">            Missing initrd_system selection for boot attribute</span>
</span><span id="RuntimeChecker.check_initrd_selection_required-508"><a href="#RuntimeChecker.check_initrd_selection_required-508"><span class="linenos">508</span></a>
</span><span id="RuntimeChecker.check_initrd_selection_required-509"><a href="#RuntimeChecker.check_initrd_selection_required-509"><span class="linenos">509</span></a><span class="s1">            The selected boot=&quot;&#39;</span><span class="si">{0}</span><span class="s1">&#39;&quot; boot description indicates</span>
</span><span id="RuntimeChecker.check_initrd_selection_required-510"><a href="#RuntimeChecker.check_initrd_selection_required-510"><span class="linenos">510</span></a><span class="s1">            the custom kiwi initrd system should be used instead</span>
</span><span id="RuntimeChecker.check_initrd_selection_required-511"><a href="#RuntimeChecker.check_initrd_selection_required-511"><span class="linenos">511</span></a><span class="s1">            of dracut. If this is correct please explicitly request</span>
</span><span id="RuntimeChecker.check_initrd_selection_required-512"><a href="#RuntimeChecker.check_initrd_selection_required-512"><span class="linenos">512</span></a><span class="s1">            the kiwi initrd system as follows:</span>
</span><span id="RuntimeChecker.check_initrd_selection_required-513"><a href="#RuntimeChecker.check_initrd_selection_required-513"><span class="linenos">513</span></a>
</span><span id="RuntimeChecker.check_initrd_selection_required-514"><a href="#RuntimeChecker.check_initrd_selection_required-514"><span class="linenos">514</span></a><span class="s1">            &lt;type initrd_system=&quot;kiwi&quot;/&gt;</span>
</span><span id="RuntimeChecker.check_initrd_selection_required-515"><a href="#RuntimeChecker.check_initrd_selection_required-515"><span class="linenos">515</span></a>
</span><span id="RuntimeChecker.check_initrd_selection_required-516"><a href="#RuntimeChecker.check_initrd_selection_required-516"><span class="linenos">516</span></a><span class="s1">            If this is not want you want and dracut should be used</span>
</span><span id="RuntimeChecker.check_initrd_selection_required-517"><a href="#RuntimeChecker.check_initrd_selection_required-517"><span class="linenos">517</span></a><span class="s1">            as initrd system, please delete the boot attribute</span>
</span><span id="RuntimeChecker.check_initrd_selection_required-518"><a href="#RuntimeChecker.check_initrd_selection_required-518"><span class="linenos">518</span></a><span class="s1">            as it is obsolete in this case.</span>
</span><span id="RuntimeChecker.check_initrd_selection_required-519"><a href="#RuntimeChecker.check_initrd_selection_required-519"><span class="linenos">519</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_initrd_selection_required-520"><a href="#RuntimeChecker.check_initrd_selection_required-520"><span class="linenos">520</span></a>        <span class="n">initrd_system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_initrd_system</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_initrd_selection_required-521"><a href="#RuntimeChecker.check_initrd_selection_required-521"><span class="linenos">521</span></a>        <span class="n">boot_image_reference</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_boot</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_initrd_selection_required-522"><a href="#RuntimeChecker.check_initrd_selection_required-522"><span class="linenos">522</span></a>        <span class="k">if</span> <span class="n">initrd_system</span> <span class="o">!=</span> <span class="s1">&#39;kiwi&#39;</span> <span class="ow">and</span> <span class="n">boot_image_reference</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_initrd_selection_required-523"><a href="#RuntimeChecker.check_initrd_selection_required-523"><span class="linenos">523</span></a>            <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_initrd_selection_required-524"><a href="#RuntimeChecker.check_initrd_selection_required-524"><span class="linenos">524</span></a>                <span class="n">message_kiwi_initrd_system_not_selected</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_initrd_selection_required-525"><a href="#RuntimeChecker.check_initrd_selection_required-525"><span class="linenos">525</span></a>                    <span class="n">boot_image_reference</span>
</span><span id="RuntimeChecker.check_initrd_selection_required-526"><a href="#RuntimeChecker.check_initrd_selection_required-526"><span class="linenos">526</span></a>                <span class="p">)</span>
</span><span id="RuntimeChecker.check_initrd_selection_required-527"><a href="#RuntimeChecker.check_initrd_selection_required-527"><span class="linenos">527</span></a>            <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>If the boot attribute is used without selecting kiwi
as the initrd_system, the setting of the boot attribute
will not have any effect. We assume that configurations
which explicitly specify the boot attribute wants to use
the custom kiwi initrd system and not dracut.</p>
</div>


                            </div>
                            <div id="RuntimeChecker.check_boot_description_exists" class="classattr">
                                        <input id="RuntimeChecker.check_boot_description_exists-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">check_boot_description_exists</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="RuntimeChecker.check_boot_description_exists-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RuntimeChecker.check_boot_description_exists"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RuntimeChecker.check_boot_description_exists-529"><a href="#RuntimeChecker.check_boot_description_exists-529"><span class="linenos">529</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_boot_description_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_boot_description_exists-530"><a href="#RuntimeChecker.check_boot_description_exists-530"><span class="linenos">530</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_boot_description_exists-531"><a href="#RuntimeChecker.check_boot_description_exists-531"><span class="linenos">531</span></a><span class="sd">        If a kiwi initrd is used, a lookup to the specified boot</span>
</span><span id="RuntimeChecker.check_boot_description_exists-532"><a href="#RuntimeChecker.check_boot_description_exists-532"><span class="linenos">532</span></a><span class="sd">        description is done and fails early if it does not exist</span>
</span><span id="RuntimeChecker.check_boot_description_exists-533"><a href="#RuntimeChecker.check_boot_description_exists-533"><span class="linenos">533</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_boot_description_exists-534"><a href="#RuntimeChecker.check_boot_description_exists-534"><span class="linenos">534</span></a>        <span class="n">message_no_boot_reference</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker.check_boot_description_exists-535"><a href="#RuntimeChecker.check_boot_description_exists-535"><span class="linenos">535</span></a><span class="s1">            Boot description missing for &#39;</span><span class="si">{0}</span><span class="s1">&#39; type</span>
</span><span id="RuntimeChecker.check_boot_description_exists-536"><a href="#RuntimeChecker.check_boot_description_exists-536"><span class="linenos">536</span></a>
</span><span id="RuntimeChecker.check_boot_description_exists-537"><a href="#RuntimeChecker.check_boot_description_exists-537"><span class="linenos">537</span></a><span class="s1">            The selected &#39;</span><span class="si">{1}</span><span class="s1">&#39; initrd_system requires a boot description</span>
</span><span id="RuntimeChecker.check_boot_description_exists-538"><a href="#RuntimeChecker.check_boot_description_exists-538"><span class="linenos">538</span></a><span class="s1">            reference. Please update your type setup as follows</span>
</span><span id="RuntimeChecker.check_boot_description_exists-539"><a href="#RuntimeChecker.check_boot_description_exists-539"><span class="linenos">539</span></a>
</span><span id="RuntimeChecker.check_boot_description_exists-540"><a href="#RuntimeChecker.check_boot_description_exists-540"><span class="linenos">540</span></a><span class="s1">            &lt;type image=&quot;</span><span class="si">{0}</span><span class="s1">&quot; boot=&quot;</span><span class="si">{0}</span><span class="s1">boot/...&quot;/&gt;</span>
</span><span id="RuntimeChecker.check_boot_description_exists-541"><a href="#RuntimeChecker.check_boot_description_exists-541"><span class="linenos">541</span></a>
</span><span id="RuntimeChecker.check_boot_description_exists-542"><a href="#RuntimeChecker.check_boot_description_exists-542"><span class="linenos">542</span></a><span class="s1">            A collection of custom boot descriptions can be found</span>
</span><span id="RuntimeChecker.check_boot_description_exists-543"><a href="#RuntimeChecker.check_boot_description_exists-543"><span class="linenos">543</span></a><span class="s1">            in the kiwi-boot-descriptions package</span>
</span><span id="RuntimeChecker.check_boot_description_exists-544"><a href="#RuntimeChecker.check_boot_description_exists-544"><span class="linenos">544</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_boot_description_exists-545"><a href="#RuntimeChecker.check_boot_description_exists-545"><span class="linenos">545</span></a>        <span class="n">message_boot_description_not_found</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker.check_boot_description_exists-546"><a href="#RuntimeChecker.check_boot_description_exists-546"><span class="linenos">546</span></a><span class="s1">            Boot description &#39;</span><span class="si">{0}</span><span class="s1">&#39; not found</span>
</span><span id="RuntimeChecker.check_boot_description_exists-547"><a href="#RuntimeChecker.check_boot_description_exists-547"><span class="linenos">547</span></a>
</span><span id="RuntimeChecker.check_boot_description_exists-548"><a href="#RuntimeChecker.check_boot_description_exists-548"><span class="linenos">548</span></a><span class="s1">            The selected boot description could not be found on</span>
</span><span id="RuntimeChecker.check_boot_description_exists-549"><a href="#RuntimeChecker.check_boot_description_exists-549"><span class="linenos">549</span></a><span class="s1">            the build host. A collection of custom boot descriptions</span>
</span><span id="RuntimeChecker.check_boot_description_exists-550"><a href="#RuntimeChecker.check_boot_description_exists-550"><span class="linenos">550</span></a><span class="s1">            can be found in the kiwi-boot-descriptions package</span>
</span><span id="RuntimeChecker.check_boot_description_exists-551"><a href="#RuntimeChecker.check_boot_description_exists-551"><span class="linenos">551</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_boot_description_exists-552"><a href="#RuntimeChecker.check_boot_description_exists-552"><span class="linenos">552</span></a>        <span class="n">image_types_supporting_custom_boot_description</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;oem&#39;</span><span class="p">,</span> <span class="s1">&#39;pxe&#39;</span><span class="p">]</span>
</span><span id="RuntimeChecker.check_boot_description_exists-553"><a href="#RuntimeChecker.check_boot_description_exists-553"><span class="linenos">553</span></a>        <span class="n">build_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_build_type_name</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_boot_description_exists-554"><a href="#RuntimeChecker.check_boot_description_exists-554"><span class="linenos">554</span></a>        <span class="n">initrd_system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_initrd_system</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_boot_description_exists-555"><a href="#RuntimeChecker.check_boot_description_exists-555"><span class="linenos">555</span></a>        <span class="k">if</span> <span class="n">initrd_system</span> <span class="o">==</span> <span class="s1">&#39;kiwi&#39;</span> <span class="ow">and</span> \
</span><span id="RuntimeChecker.check_boot_description_exists-556"><a href="#RuntimeChecker.check_boot_description_exists-556"><span class="linenos">556</span></a>           <span class="n">build_type</span> <span class="ow">in</span> <span class="n">image_types_supporting_custom_boot_description</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_boot_description_exists-557"><a href="#RuntimeChecker.check_boot_description_exists-557"><span class="linenos">557</span></a>
</span><span id="RuntimeChecker.check_boot_description_exists-558"><a href="#RuntimeChecker.check_boot_description_exists-558"><span class="linenos">558</span></a>            <span class="n">boot_image_reference</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_boot</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_boot_description_exists-559"><a href="#RuntimeChecker.check_boot_description_exists-559"><span class="linenos">559</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">boot_image_reference</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_boot_description_exists-560"><a href="#RuntimeChecker.check_boot_description_exists-560"><span class="linenos">560</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_boot_description_exists-561"><a href="#RuntimeChecker.check_boot_description_exists-561"><span class="linenos">561</span></a>                    <span class="n">message_no_boot_reference</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">build_type</span><span class="p">,</span> <span class="n">initrd_system</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_boot_description_exists-562"><a href="#RuntimeChecker.check_boot_description_exists-562"><span class="linenos">562</span></a>                <span class="p">)</span>
</span><span id="RuntimeChecker.check_boot_description_exists-563"><a href="#RuntimeChecker.check_boot_description_exists-563"><span class="linenos">563</span></a>
</span><span id="RuntimeChecker.check_boot_description_exists-564"><a href="#RuntimeChecker.check_boot_description_exists-564"><span class="linenos">564</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">boot_image_reference</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_boot_description_exists-565"><a href="#RuntimeChecker.check_boot_description_exists-565"><span class="linenos">565</span></a>                <span class="n">boot_image_reference</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_boot_description_exists-566"><a href="#RuntimeChecker.check_boot_description_exists-566"><span class="linenos">566</span></a>                    <span class="p">[</span>
</span><span id="RuntimeChecker.check_boot_description_exists-567"><a href="#RuntimeChecker.check_boot_description_exists-567"><span class="linenos">567</span></a>                        <span class="n">Defaults</span><span class="o">.</span><span class="n">get_boot_image_description_path</span><span class="p">(),</span>
</span><span id="RuntimeChecker.check_boot_description_exists-568"><a href="#RuntimeChecker.check_boot_description_exists-568"><span class="linenos">568</span></a>                        <span class="n">boot_image_reference</span>
</span><span id="RuntimeChecker.check_boot_description_exists-569"><a href="#RuntimeChecker.check_boot_description_exists-569"><span class="linenos">569</span></a>                    <span class="p">]</span>
</span><span id="RuntimeChecker.check_boot_description_exists-570"><a href="#RuntimeChecker.check_boot_description_exists-570"><span class="linenos">570</span></a>                <span class="p">)</span>
</span><span id="RuntimeChecker.check_boot_description_exists-571"><a href="#RuntimeChecker.check_boot_description_exists-571"><span class="linenos">571</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">boot_image_reference</span><span class="p">):</span>
</span><span id="RuntimeChecker.check_boot_description_exists-572"><a href="#RuntimeChecker.check_boot_description_exists-572"><span class="linenos">572</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_boot_description_exists-573"><a href="#RuntimeChecker.check_boot_description_exists-573"><span class="linenos">573</span></a>                    <span class="n">message_boot_description_not_found</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_boot_description_exists-574"><a href="#RuntimeChecker.check_boot_description_exists-574"><span class="linenos">574</span></a>                        <span class="n">boot_image_reference</span>
</span><span id="RuntimeChecker.check_boot_description_exists-575"><a href="#RuntimeChecker.check_boot_description_exists-575"><span class="linenos">575</span></a>                    <span class="p">)</span>
</span><span id="RuntimeChecker.check_boot_description_exists-576"><a href="#RuntimeChecker.check_boot_description_exists-576"><span class="linenos">576</span></a>                <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>If a kiwi initrd is used, a lookup to the specified boot
description is done and fails early if it does not exist</p>
</div>


                            </div>
                            <div id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image" class="classattr">
                                        <input id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">check_consistent_kernel_in_boot_and_system_image</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-578"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-578"><span class="linenos">578</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_consistent_kernel_in_boot_and_system_image</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-579"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-579"><span class="linenos">579</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-580"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-580"><span class="linenos">580</span></a><span class="sd">        If a kiwi initrd is used, the kernel used to build the kiwi</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-581"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-581"><span class="linenos">581</span></a><span class="sd">        initrd and the kernel used in the system image must be the</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-582"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-582"><span class="linenos">582</span></a><span class="sd">        same in order to avoid an inconsistent boot setup</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-583"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-583"><span class="linenos">583</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-584"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-584"><span class="linenos">584</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-585"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-585"><span class="linenos">585</span></a><span class="s1">            Possible kernel mismatch between kiwi initrd and system image</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-586"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-586"><span class="linenos">586</span></a>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-587"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-587"><span class="linenos">587</span></a><span class="s1">            The selected &#39;</span><span class="si">{0}</span><span class="s1">&#39; boot image kernel is &#39;</span><span class="si">{1}</span><span class="s1">&#39;. However this</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-588"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-588"><span class="linenos">588</span></a><span class="s1">            kernel package was not explicitly listed in the package list</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-589"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-589"><span class="linenos">589</span></a><span class="s1">            of the system image. Please fixup your system image</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-590"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-590"><span class="linenos">590</span></a><span class="s1">            description:</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-591"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-591"><span class="linenos">591</span></a>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-592"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-592"><span class="linenos">592</span></a><span class="s1">            1) Add &lt;package name=&quot;</span><span class="si">{1}</span><span class="s1">&quot;/&gt; to your system XML description</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-593"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-593"><span class="linenos">593</span></a>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-594"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-594"><span class="linenos">594</span></a><span class="s1">            2) Inherit kernel from system description to initrd via</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-595"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-595"><span class="linenos">595</span></a><span class="s1">               the custom kernel profile:</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-596"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-596"><span class="linenos">596</span></a>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-597"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-597"><span class="linenos">597</span></a><span class="s1">               &lt;type ... bootkernel=&quot;custom&quot; .../&gt;</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-598"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-598"><span class="linenos">598</span></a>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-599"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-599"><span class="linenos">599</span></a><span class="s1">               &lt;packages type=&quot;image&quot;/&gt;</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-600"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-600"><span class="linenos">600</span></a><span class="s1">                   &lt;package name=&quot;desired-kernel&quot; bootinclude=&quot;true&quot;/&gt;</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-601"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-601"><span class="linenos">601</span></a><span class="s1">               &lt;/packages&gt;</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-602"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-602"><span class="linenos">602</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-603"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-603"><span class="linenos">603</span></a>        <span class="n">boot_image_reference</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_boot</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-604"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-604"><span class="linenos">604</span></a>        <span class="n">boot_kernel_package_name</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-605"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-605"><span class="linenos">605</span></a>        <span class="k">if</span> <span class="n">boot_image_reference</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-606"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-606"><span class="linenos">606</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">boot_image_reference</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-607"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-607"><span class="linenos">607</span></a>                <span class="n">boot_image_reference</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-608"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-608"><span class="linenos">608</span></a>                    <span class="p">[</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-609"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-609"><span class="linenos">609</span></a>                        <span class="n">Defaults</span><span class="o">.</span><span class="n">get_boot_image_description_path</span><span class="p">(),</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-610"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-610"><span class="linenos">610</span></a>                        <span class="n">boot_image_reference</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-611"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-611"><span class="linenos">611</span></a>                    <span class="p">]</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-612"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-612"><span class="linenos">612</span></a>                <span class="p">)</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-613"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-613"><span class="linenos">613</span></a>            <span class="n">boot_config_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-614"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-614"><span class="linenos">614</span></a>                <span class="p">[</span><span class="n">boot_image_reference</span><span class="p">,</span> <span class="s1">&#39;config.xml&#39;</span><span class="p">]</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-615"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-615"><span class="linenos">615</span></a>            <span class="p">)</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-616"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-616"><span class="linenos">616</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">boot_config_file</span><span class="p">):</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-617"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-617"><span class="linenos">617</span></a>                <span class="n">boot_description</span> <span class="o">=</span> <span class="n">XMLDescription</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-618"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-618"><span class="linenos">618</span></a>                    <span class="n">description</span><span class="o">=</span><span class="n">boot_config_file</span><span class="p">,</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-619"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-619"><span class="linenos">619</span></a>                    <span class="n">derived_from</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">xml_data</span><span class="o">.</span><span class="n">description_dir</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-620"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-620"><span class="linenos">620</span></a>                <span class="p">)</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-621"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-621"><span class="linenos">621</span></a>                <span class="n">boot_kernel_profile</span> <span class="o">=</span> \
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-622"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-622"><span class="linenos">622</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_bootkernel</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-623"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-623"><span class="linenos">623</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">boot_kernel_profile</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-624"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-624"><span class="linenos">624</span></a>                    <span class="n">boot_kernel_profile</span> <span class="o">=</span> <span class="s1">&#39;std&#39;</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-625"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-625"><span class="linenos">625</span></a>                <span class="n">boot_xml_state</span> <span class="o">=</span> <span class="n">XMLState</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-626"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-626"><span class="linenos">626</span></a>                    <span class="n">boot_description</span><span class="o">.</span><span class="n">load</span><span class="p">(),</span> <span class="p">[</span><span class="n">boot_kernel_profile</span><span class="p">]</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-627"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-627"><span class="linenos">627</span></a>                <span class="p">)</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-628"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-628"><span class="linenos">628</span></a>                <span class="n">kernel_package_sections</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-629"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-629"><span class="linenos">629</span></a>                <span class="k">for</span> <span class="n">packages_section</span> <span class="ow">in</span> <span class="n">boot_xml_state</span><span class="o">.</span><span class="n">xml_data</span><span class="o">.</span><span class="n">get_packages</span><span class="p">():</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-630"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-630"><span class="linenos">630</span></a>                    <span class="c1"># lookup package sections matching kernel profile in kiwi</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-631"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-631"><span class="linenos">631</span></a>                    <span class="c1"># boot description. By definition this must be a packages</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-632"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-632"><span class="linenos">632</span></a>                    <span class="c1"># section with a single profile name whereas the default</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-633"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-633"><span class="linenos">633</span></a>                    <span class="c1"># profile name is &#39;std&#39;. The section itself must contain</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-634"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-634"><span class="linenos">634</span></a>                    <span class="c1"># one matching kernel package name for the desired</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-635"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-635"><span class="linenos">635</span></a>                    <span class="c1"># architecture</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-636"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-636"><span class="linenos">636</span></a>                    <span class="k">if</span> <span class="n">packages_section</span><span class="o">.</span><span class="n">get_profiles</span><span class="p">()</span> <span class="o">==</span> <span class="n">boot_kernel_profile</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-637"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-637"><span class="linenos">637</span></a>                        <span class="k">for</span> <span class="n">package</span> <span class="ow">in</span> <span class="n">packages_section</span><span class="o">.</span><span class="n">get_package</span><span class="p">():</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-638"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-638"><span class="linenos">638</span></a>                            <span class="n">kernel_package_sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">package</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-639"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-639"><span class="linenos">639</span></a>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-640"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-640"><span class="linenos">640</span></a>                <span class="k">for</span> <span class="n">package</span> <span class="ow">in</span> <span class="n">kernel_package_sections</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-641"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-641"><span class="linenos">641</span></a>                    <span class="k">if</span> <span class="n">boot_xml_state</span><span class="o">.</span><span class="n">package_matches_host_architecture</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-642"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-642"><span class="linenos">642</span></a>                            <span class="n">package</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-643"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-643"><span class="linenos">643</span></a>                    <span class="p">):</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-644"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-644"><span class="linenos">644</span></a>                        <span class="n">boot_kernel_package_name</span> <span class="o">=</span> <span class="n">package</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-645"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-645"><span class="linenos">645</span></a>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-646"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-646"><span class="linenos">646</span></a>        <span class="k">if</span> <span class="n">boot_kernel_package_name</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-647"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-647"><span class="linenos">647</span></a>            <span class="c1"># A kernel package name was found in the kiwi boot image</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-648"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-648"><span class="linenos">648</span></a>            <span class="c1"># description. Let&#39;s check if this kernel is also used</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-649"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-649"><span class="linenos">649</span></a>            <span class="c1"># in the system image</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-650"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-650"><span class="linenos">650</span></a>            <span class="n">image_package_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_system_packages</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-651"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-651"><span class="linenos">651</span></a>            <span class="k">if</span> <span class="n">boot_kernel_package_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">image_package_names</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-652"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-652"><span class="linenos">652</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-653"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-653"><span class="linenos">653</span></a>                    <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-654"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-654"><span class="linenos">654</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_boot</span><span class="p">(),</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-655"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-655"><span class="linenos">655</span></a>                        <span class="n">boot_kernel_package_name</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-656"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-656"><span class="linenos">656</span></a>                    <span class="p">)</span>
</span><span id="RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-657"><a href="#RuntimeChecker.check_consistent_kernel_in_boot_and_system_image-657"><span class="linenos">657</span></a>                <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>If a kiwi initrd is used, the kernel used to build the kiwi
initrd and the kernel used in the system image must be the
same in order to avoid an inconsistent boot setup</p>
</div>


                            </div>
                            <div id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi" class="classattr">
                                        <input id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">check_dracut_module_versions_compatible_to_kiwi</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">root_dir</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-659"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-659"><span class="linenos">659</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_dracut_module_versions_compatible_to_kiwi</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-660"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-660"><span class="linenos">660</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">root_dir</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-661"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-661"><span class="linenos">661</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-662"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-662"><span class="linenos">662</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-663"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-663"><span class="linenos">663</span></a><span class="sd">        KIWI images which makes use of kiwi dracut modules</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-664"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-664"><span class="linenos">664</span></a><span class="sd">        has to use module versions compatible with the version</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-665"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-665"><span class="linenos">665</span></a><span class="sd">        of this KIWI builder code base. This is important to avoid</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-666"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-666"><span class="linenos">666</span></a><span class="sd">        inconsistencies between the way how kiwi includes its own</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-667"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-667"><span class="linenos">667</span></a><span class="sd">        dracut modules and former version of those dracut modules</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-668"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-668"><span class="linenos">668</span></a><span class="sd">        which could be no longer compatible with the builder.</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-669"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-669"><span class="linenos">669</span></a><span class="sd">        Therefore this runtime check maintains a min_version constraint</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-670"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-670"><span class="linenos">670</span></a><span class="sd">        for which we know this KIWI builder to be compatible with.</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-671"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-671"><span class="linenos">671</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-672"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-672"><span class="linenos">672</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-673"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-673"><span class="linenos">673</span></a><span class="s1">            Incompatible dracut-kiwi module(s) found</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-674"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-674"><span class="linenos">674</span></a>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-675"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-675"><span class="linenos">675</span></a><span class="s1">            The image was build with KIWI version=</span><span class="si">{0}</span><span class="s1">. The system</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-676"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-676"><span class="linenos">676</span></a><span class="s1">            root tree has the following dracut-kiwi-* module packages</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-677"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-677"><span class="linenos">677</span></a><span class="s1">            installed which are too old to work with this version of KIWI.</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-678"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-678"><span class="linenos">678</span></a><span class="s1">            Please make sure to use dracut-kiwi-* module packages</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-679"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-679"><span class="linenos">679</span></a><span class="s1">            which are &gt;= than the versions listed below.</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-680"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-680"><span class="linenos">680</span></a>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-681"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-681"><span class="linenos">681</span></a><span class="s1">            </span><span class="si">{1}</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-682"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-682"><span class="linenos">682</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-683"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-683"><span class="linenos">683</span></a>        <span class="n">kiwi_dracut_modules</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-684"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-684"><span class="linenos">684</span></a>            <span class="s1">&#39;55kiwi-dump&#39;</span><span class="p">:</span> <span class="n">dracut_module_type</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-685"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-685"><span class="linenos">685</span></a>                <span class="s1">&#39;dracut-kiwi-oem-dump&#39;</span><span class="p">,</span> <span class="s1">&#39;9.20.1&#39;</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-686"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-686"><span class="linenos">686</span></a>            <span class="p">),</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-687"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-687"><span class="linenos">687</span></a>            <span class="s1">&#39;55kiwi-live&#39;</span><span class="p">:</span> <span class="n">dracut_module_type</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-688"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-688"><span class="linenos">688</span></a>                <span class="s1">&#39;dracut-kiwi-live&#39;</span><span class="p">,</span> <span class="s1">&#39;9.20.1&#39;</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-689"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-689"><span class="linenos">689</span></a>            <span class="p">),</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-690"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-690"><span class="linenos">690</span></a>            <span class="s1">&#39;55kiwi-overlay&#39;</span><span class="p">:</span> <span class="n">dracut_module_type</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-691"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-691"><span class="linenos">691</span></a>                <span class="s1">&#39;dracut-kiwi-overlay&#39;</span><span class="p">,</span> <span class="s1">&#39;9.20.1&#39;</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-692"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-692"><span class="linenos">692</span></a>            <span class="p">),</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-693"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-693"><span class="linenos">693</span></a>            <span class="s1">&#39;55kiwi-repart&#39;</span><span class="p">:</span> <span class="n">dracut_module_type</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-694"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-694"><span class="linenos">694</span></a>                <span class="s1">&#39;dracut-kiwi-oem-repart&#39;</span><span class="p">,</span> <span class="s1">&#39;9.20.1&#39;</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-695"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-695"><span class="linenos">695</span></a>            <span class="p">),</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-696"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-696"><span class="linenos">696</span></a>            <span class="s1">&#39;59kiwi-dump-reboot&#39;</span><span class="p">:</span> <span class="n">dracut_module_type</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-697"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-697"><span class="linenos">697</span></a>                <span class="s1">&#39;dracut-kiwi-oem-dump&#39;</span><span class="p">,</span> <span class="s1">&#39;9.20.1&#39;</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-698"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-698"><span class="linenos">698</span></a>            <span class="p">),</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-699"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-699"><span class="linenos">699</span></a>            <span class="s1">&#39;59kiwi-lib&#39;</span><span class="p">:</span> <span class="n">dracut_module_type</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-700"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-700"><span class="linenos">700</span></a>                <span class="s1">&#39;dracut-kiwi-lib&#39;</span><span class="p">,</span> <span class="s1">&#39;9.20.1&#39;</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-701"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-701"><span class="linenos">701</span></a>            <span class="p">)</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-702"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-702"><span class="linenos">702</span></a>        <span class="p">}</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-703"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-703"><span class="linenos">703</span></a>        <span class="n">dracut_module_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-704"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-704"><span class="linenos">704</span></a>            <span class="p">[</span><span class="n">root_dir</span><span class="p">,</span> <span class="s1">&#39;/usr/lib/dracut/modules.d&#39;</span><span class="p">]</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-705"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-705"><span class="linenos">705</span></a>        <span class="p">)</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-706"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-706"><span class="linenos">706</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">dracut_module_dir</span><span class="p">):</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-707"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-707"><span class="linenos">707</span></a>            <span class="c1"># no dracut module dir present</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-708"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-708"><span class="linenos">708</span></a>            <span class="k">return</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-709"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-709"><span class="linenos">709</span></a>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-710"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-710"><span class="linenos">710</span></a>        <span class="n">incompatible_modules</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-711"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-711"><span class="linenos">711</span></a>        <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dracut_module_dir</span><span class="p">):</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-712"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-712"><span class="linenos">712</span></a>            <span class="n">module_meta</span> <span class="o">=</span> <span class="n">kiwi_dracut_modules</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-713"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-713"><span class="linenos">713</span></a>            <span class="k">if</span> <span class="n">module_meta</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-714"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-714"><span class="linenos">714</span></a>                <span class="n">module_version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dracut_module_version_from_pdb</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-715"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-715"><span class="linenos">715</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_package_manager</span><span class="p">(),</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-716"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-716"><span class="linenos">716</span></a>                    <span class="n">module_meta</span><span class="o">.</span><span class="n">package</span><span class="p">,</span> <span class="n">root_dir</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-717"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-717"><span class="linenos">717</span></a>                <span class="p">)</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-718"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-718"><span class="linenos">718</span></a>                <span class="k">if</span> <span class="n">module_version</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-719"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-719"><span class="linenos">719</span></a>                    <span class="n">module_version_nr</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-720"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-720"><span class="linenos">720</span></a>                        <span class="nb">int</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">module_version</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-721"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-721"><span class="linenos">721</span></a>                    <span class="p">)</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-722"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-722"><span class="linenos">722</span></a>                    <span class="n">module_min_version_nr</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-723"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-723"><span class="linenos">723</span></a>                        <span class="nb">int</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">module_meta</span><span class="o">.</span><span class="n">min_version</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-724"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-724"><span class="linenos">724</span></a>                    <span class="p">)</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-725"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-725"><span class="linenos">725</span></a>                    <span class="k">if</span> <span class="n">module_version_nr</span> <span class="o">&lt;</span> <span class="n">module_min_version_nr</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-726"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-726"><span class="linenos">726</span></a>                        <span class="n">incompatible_modules</span><span class="p">[</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-727"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-727"><span class="linenos">727</span></a>                            <span class="n">module_meta</span><span class="o">.</span><span class="n">package</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-728"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-728"><span class="linenos">728</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;got:</span><span class="si">{0}</span><span class="s1">, need:&gt;=</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-729"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-729"><span class="linenos">729</span></a>                            <span class="n">module_version</span><span class="p">,</span> <span class="n">module_meta</span><span class="o">.</span><span class="n">min_version</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-730"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-730"><span class="linenos">730</span></a>                        <span class="p">)</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-731"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-731"><span class="linenos">731</span></a>        <span class="k">if</span> <span class="n">incompatible_modules</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-732"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-732"><span class="linenos">732</span></a>            <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-733"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-733"><span class="linenos">733</span></a>                <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">__version__</span><span class="p">,</span> <span class="n">incompatible_modules</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-734"><a href="#RuntimeChecker.check_dracut_module_versions_compatible_to_kiwi-734"><span class="linenos">734</span></a>            <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>KIWI images which makes use of kiwi dracut modules
has to use module versions compatible with the version
of this KIWI builder code base. This is important to avoid
inconsistencies between the way how kiwi includes its own
dracut modules and former version of those dracut modules
which could be no longer compatible with the builder.
Therefore this runtime check maintains a min_version constraint
for which we know this KIWI builder to be compatible with.</p>
</div>


                            </div>
                            <div id="RuntimeChecker.check_dracut_module_for_oem_install_in_package_list" class="classattr">
                                        <input id="RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">check_dracut_module_for_oem_install_in_package_list</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RuntimeChecker.check_dracut_module_for_oem_install_in_package_list"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-736"><a href="#RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-736"><span class="linenos">736</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_dracut_module_for_oem_install_in_package_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-737"><a href="#RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-737"><span class="linenos">737</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-738"><a href="#RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-738"><span class="linenos">738</span></a><span class="sd">        OEM images if configured to use dracut as initrd system</span>
</span><span id="RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-739"><a href="#RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-739"><span class="linenos">739</span></a><span class="sd">        and configured with one of the installiso, installstick</span>
</span><span id="RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-740"><a href="#RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-740"><span class="linenos">740</span></a><span class="sd">        or installpxe attributes requires the KIWI provided</span>
</span><span id="RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-741"><a href="#RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-741"><span class="linenos">741</span></a><span class="sd">        dracut-kiwi-oem-dump module to be installed at the time</span>
</span><span id="RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-742"><a href="#RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-742"><span class="linenos">742</span></a><span class="sd">        dracut is called. Thus this runtime check examines if the</span>
</span><span id="RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-743"><a href="#RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-743"><span class="linenos">743</span></a><span class="sd">        required package is part of the package list in the</span>
</span><span id="RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-744"><a href="#RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-744"><span class="linenos">744</span></a><span class="sd">        image description.</span>
</span><span id="RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-745"><a href="#RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-745"><span class="linenos">745</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-746"><a href="#RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-746"><span class="linenos">746</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-747"><a href="#RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-747"><span class="linenos">747</span></a><span class="s1">            Required dracut module package missing in package list</span>
</span><span id="RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-748"><a href="#RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-748"><span class="linenos">748</span></a>
</span><span id="RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-749"><a href="#RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-749"><span class="linenos">749</span></a><span class="s1">            One of the packages &#39;</span><span class="si">{0}</span><span class="s1">&#39; is required</span>
</span><span id="RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-750"><a href="#RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-750"><span class="linenos">750</span></a><span class="s1">            to build an installation image for the selected oem image type.</span>
</span><span id="RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-751"><a href="#RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-751"><span class="linenos">751</span></a><span class="s1">            Depending on your distribution, add the following in the</span>
</span><span id="RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-752"><a href="#RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-752"><span class="linenos">752</span></a><span class="s1">            &lt;packages type=&quot;image&quot;&gt; section:</span>
</span><span id="RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-753"><a href="#RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-753"><span class="linenos">753</span></a>
</span><span id="RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-754"><a href="#RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-754"><span class="linenos">754</span></a><span class="s1">            &lt;package name=&quot;ONE_FROM_ABOVE&quot;/&gt;</span>
</span><span id="RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-755"><a href="#RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-755"><span class="linenos">755</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-756"><a href="#RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-756"><span class="linenos">756</span></a>        <span class="n">meta</span> <span class="o">=</span> <span class="n">Defaults</span><span class="o">.</span><span class="n">get_runtime_checker_metadata</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-757"><a href="#RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-757"><span class="linenos">757</span></a>        <span class="n">required_dracut_packages</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;package_names&#39;</span><span class="p">][</span><span class="s1">&#39;dracut_oem_dump&#39;</span><span class="p">]</span>
</span><span id="RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-758"><a href="#RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-758"><span class="linenos">758</span></a>        <span class="n">initrd_system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_initrd_system</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-759"><a href="#RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-759"><span class="linenos">759</span></a>        <span class="n">build_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_build_type_name</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-760"><a href="#RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-760"><span class="linenos">760</span></a>        <span class="k">if</span> <span class="n">build_type</span> <span class="o">==</span> <span class="s1">&#39;oem&#39;</span> <span class="ow">and</span> <span class="n">initrd_system</span> <span class="o">==</span> <span class="s1">&#39;dracut&#39;</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-761"><a href="#RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-761"><span class="linenos">761</span></a>            <span class="n">install_iso</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_installiso</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-762"><a href="#RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-762"><span class="linenos">762</span></a>            <span class="n">install_stick</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_installstick</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-763"><a href="#RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-763"><span class="linenos">763</span></a>            <span class="n">install_pxe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_installpxe</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-764"><a href="#RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-764"><span class="linenos">764</span></a>            <span class="k">if</span> <span class="n">install_iso</span> <span class="ow">or</span> <span class="n">install_stick</span> <span class="ow">or</span> <span class="n">install_pxe</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-765"><a href="#RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-765"><span class="linenos">765</span></a>                <span class="n">package_names</span> <span class="o">=</span> \
</span><span id="RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-766"><a href="#RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-766"><span class="linenos">766</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_bootstrap_packages</span><span class="p">()</span> <span class="o">+</span> \
</span><span id="RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-767"><a href="#RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-767"><span class="linenos">767</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_system_packages</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-768"><a href="#RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-768"><span class="linenos">768</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">RuntimeChecker</span><span class="o">.</span><span class="n">_package_in_list</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-769"><a href="#RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-769"><span class="linenos">769</span></a>                    <span class="n">package_names</span><span class="p">,</span> <span class="n">required_dracut_packages</span>
</span><span id="RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-770"><a href="#RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-770"><span class="linenos">770</span></a>                <span class="p">):</span>
</span><span id="RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-771"><a href="#RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-771"><span class="linenos">771</span></a>                    <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-772"><a href="#RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-772"><span class="linenos">772</span></a>                        <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">required_dracut_packages</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-773"><a href="#RuntimeChecker.check_dracut_module_for_oem_install_in_package_list-773"><span class="linenos">773</span></a>                    <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>OEM images if configured to use dracut as initrd system
and configured with one of the installiso, installstick
or installpxe attributes requires the KIWI provided
dracut-kiwi-oem-dump module to be installed at the time
dracut is called. Thus this runtime check examines if the
required package is part of the package list in the
image description.</p>
</div>


                            </div>
                            <div id="RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list" class="classattr">
                                        <input id="RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">check_dracut_module_for_disk_oem_in_package_list</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-775"><a href="#RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-775"><span class="linenos">775</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_dracut_module_for_disk_oem_in_package_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-776"><a href="#RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-776"><span class="linenos">776</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-777"><a href="#RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-777"><span class="linenos">777</span></a><span class="sd">        OEM images if configured to use dracut as initrd system</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-778"><a href="#RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-778"><span class="linenos">778</span></a><span class="sd">        requires the KIWI provided dracut-kiwi-oem-repart module</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-779"><a href="#RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-779"><span class="linenos">779</span></a><span class="sd">        to be installed at the time dracut is called. Thus this</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-780"><a href="#RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-780"><span class="linenos">780</span></a><span class="sd">        runtime check examines if the required package is part of</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-781"><a href="#RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-781"><span class="linenos">781</span></a><span class="sd">        the package list in the image description.</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-782"><a href="#RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-782"><span class="linenos">782</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-783"><a href="#RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-783"><span class="linenos">783</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-784"><a href="#RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-784"><span class="linenos">784</span></a><span class="s1">            Required dracut module package missing in package list</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-785"><a href="#RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-785"><span class="linenos">785</span></a>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-786"><a href="#RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-786"><span class="linenos">786</span></a><span class="s1">            One of the packages &#39;</span><span class="si">{0}</span><span class="s1">&#39; is required</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-787"><a href="#RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-787"><span class="linenos">787</span></a><span class="s1">            for the selected oem image type. Depending on your distribution,</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-788"><a href="#RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-788"><span class="linenos">788</span></a><span class="s1">            add the following in the &lt;packages type=&quot;image&quot;&gt; section:</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-789"><a href="#RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-789"><span class="linenos">789</span></a>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-790"><a href="#RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-790"><span class="linenos">790</span></a><span class="s1">            &lt;package name=&quot;ONE_FROM_ABOVE&quot;/&gt;</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-791"><a href="#RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-791"><span class="linenos">791</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-792"><a href="#RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-792"><span class="linenos">792</span></a>        <span class="n">meta</span> <span class="o">=</span> <span class="n">Defaults</span><span class="o">.</span><span class="n">get_runtime_checker_metadata</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-793"><a href="#RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-793"><span class="linenos">793</span></a>        <span class="n">required_dracut_packages</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;package_names&#39;</span><span class="p">][</span><span class="s1">&#39;dracut_oem_repart&#39;</span><span class="p">]</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-794"><a href="#RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-794"><span class="linenos">794</span></a>        <span class="n">initrd_system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_initrd_system</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-795"><a href="#RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-795"><span class="linenos">795</span></a>        <span class="n">disk_resize_requested</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_oemconfig_oem_resize</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-796"><a href="#RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-796"><span class="linenos">796</span></a>        <span class="n">build_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_build_type_name</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-797"><a href="#RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-797"><span class="linenos">797</span></a>        <span class="k">if</span> <span class="n">build_type</span> <span class="o">==</span> <span class="s1">&#39;oem&#39;</span> <span class="ow">and</span> <span class="n">initrd_system</span> <span class="o">==</span> <span class="s1">&#39;dracut&#39;</span> <span class="ow">and</span> \
</span><span id="RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-798"><a href="#RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-798"><span class="linenos">798</span></a>           <span class="n">disk_resize_requested</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-799"><a href="#RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-799"><span class="linenos">799</span></a>            <span class="n">package_names</span> <span class="o">=</span> \
</span><span id="RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-800"><a href="#RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-800"><span class="linenos">800</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_bootstrap_packages</span><span class="p">()</span> <span class="o">+</span> \
</span><span id="RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-801"><a href="#RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-801"><span class="linenos">801</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_system_packages</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-802"><a href="#RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-802"><span class="linenos">802</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">RuntimeChecker</span><span class="o">.</span><span class="n">_package_in_list</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-803"><a href="#RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-803"><span class="linenos">803</span></a>                <span class="n">package_names</span><span class="p">,</span> <span class="n">required_dracut_packages</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-804"><a href="#RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-804"><span class="linenos">804</span></a>            <span class="p">):</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-805"><a href="#RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-805"><span class="linenos">805</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-806"><a href="#RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-806"><span class="linenos">806</span></a>                    <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">required_dracut_packages</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-807"><a href="#RuntimeChecker.check_dracut_module_for_disk_oem_in_package_list-807"><span class="linenos">807</span></a>                <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>OEM images if configured to use dracut as initrd system
requires the KIWI provided dracut-kiwi-oem-repart module
to be installed at the time dracut is called. Thus this
runtime check examines if the required package is part of
the package list in the image description.</p>
</div>


                            </div>
                            <div id="RuntimeChecker.check_dracut_module_for_live_iso_in_package_list" class="classattr">
                                        <input id="RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">check_dracut_module_for_live_iso_in_package_list</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RuntimeChecker.check_dracut_module_for_live_iso_in_package_list"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-809"><a href="#RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-809"><span class="linenos">809</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_dracut_module_for_live_iso_in_package_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-810"><a href="#RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-810"><span class="linenos">810</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-811"><a href="#RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-811"><span class="linenos">811</span></a><span class="sd">        Live ISO images uses a dracut initrd to boot and requires</span>
</span><span id="RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-812"><a href="#RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-812"><span class="linenos">812</span></a><span class="sd">        the KIWI provided kiwi-live dracut module to be installed</span>
</span><span id="RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-813"><a href="#RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-813"><span class="linenos">813</span></a><span class="sd">        at the time dracut is called. Thus this runtime check</span>
</span><span id="RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-814"><a href="#RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-814"><span class="linenos">814</span></a><span class="sd">        examines if the required package is part of the package</span>
</span><span id="RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-815"><a href="#RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-815"><span class="linenos">815</span></a><span class="sd">        list in the image description.</span>
</span><span id="RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-816"><a href="#RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-816"><span class="linenos">816</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-817"><a href="#RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-817"><span class="linenos">817</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-818"><a href="#RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-818"><span class="linenos">818</span></a><span class="s1">            Required dracut module package missing in package list</span>
</span><span id="RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-819"><a href="#RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-819"><span class="linenos">819</span></a>
</span><span id="RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-820"><a href="#RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-820"><span class="linenos">820</span></a><span class="s1">            One of the packages &#39;</span><span class="si">{0}</span><span class="s1">&#39; is required</span>
</span><span id="RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-821"><a href="#RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-821"><span class="linenos">821</span></a><span class="s1">            for the selected live iso image type. Depending on your distribution,</span>
</span><span id="RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-822"><a href="#RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-822"><span class="linenos">822</span></a><span class="s1">            add the following in your &lt;packages type=&quot;image&quot;&gt; section:</span>
</span><span id="RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-823"><a href="#RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-823"><span class="linenos">823</span></a>
</span><span id="RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-824"><a href="#RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-824"><span class="linenos">824</span></a><span class="s1">            &lt;package name=&quot;ONE_FROM_ABOVE&quot;/&gt;</span>
</span><span id="RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-825"><a href="#RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-825"><span class="linenos">825</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-826"><a href="#RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-826"><span class="linenos">826</span></a>        <span class="n">meta</span> <span class="o">=</span> <span class="n">Defaults</span><span class="o">.</span><span class="n">get_runtime_checker_metadata</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-827"><a href="#RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-827"><span class="linenos">827</span></a>        <span class="n">required_dracut_packages</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;package_names&#39;</span><span class="p">][</span><span class="s1">&#39;dracut_live&#39;</span><span class="p">]</span>
</span><span id="RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-828"><a href="#RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-828"><span class="linenos">828</span></a>        <span class="n">type_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_build_type_name</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-829"><a href="#RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-829"><span class="linenos">829</span></a>        <span class="n">type_flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_flags</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-830"><a href="#RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-830"><span class="linenos">830</span></a>        <span class="k">if</span> <span class="n">type_name</span> <span class="o">==</span> <span class="s1">&#39;iso&#39;</span> <span class="ow">and</span> <span class="n">type_flag</span> <span class="o">!=</span> <span class="s1">&#39;dmsquash&#39;</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-831"><a href="#RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-831"><span class="linenos">831</span></a>            <span class="n">package_names</span> <span class="o">=</span> \
</span><span id="RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-832"><a href="#RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-832"><span class="linenos">832</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_bootstrap_packages</span><span class="p">()</span> <span class="o">+</span> \
</span><span id="RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-833"><a href="#RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-833"><span class="linenos">833</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_system_packages</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-834"><a href="#RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-834"><span class="linenos">834</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">RuntimeChecker</span><span class="o">.</span><span class="n">_package_in_list</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-835"><a href="#RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-835"><span class="linenos">835</span></a>                <span class="n">package_names</span><span class="p">,</span> <span class="n">required_dracut_packages</span>
</span><span id="RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-836"><a href="#RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-836"><span class="linenos">836</span></a>            <span class="p">):</span>
</span><span id="RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-837"><a href="#RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-837"><span class="linenos">837</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-838"><a href="#RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-838"><span class="linenos">838</span></a>                    <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">required_dracut_packages</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-839"><a href="#RuntimeChecker.check_dracut_module_for_live_iso_in_package_list-839"><span class="linenos">839</span></a>                <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Live ISO images uses a dracut initrd to boot and requires
the KIWI provided kiwi-live dracut module to be installed
at the time dracut is called. Thus this runtime check
examines if the required package is part of the package
list in the image description.</p>
</div>


                            </div>
                            <div id="RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list" class="classattr">
                                        <input id="RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">check_dracut_module_for_disk_overlay_in_package_list</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-841"><a href="#RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-841"><span class="linenos">841</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_dracut_module_for_disk_overlay_in_package_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-842"><a href="#RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-842"><span class="linenos">842</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-843"><a href="#RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-843"><span class="linenos">843</span></a><span class="sd">        Disk images configured to use a root filesystem overlay</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-844"><a href="#RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-844"><span class="linenos">844</span></a><span class="sd">        requires the KIWI provided kiwi-overlay dracut module to</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-845"><a href="#RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-845"><span class="linenos">845</span></a><span class="sd">        be installed at the time dracut is called. Thus this</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-846"><a href="#RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-846"><span class="linenos">846</span></a><span class="sd">        runtime check examines if the required package is part of</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-847"><a href="#RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-847"><span class="linenos">847</span></a><span class="sd">        the package list in the image description.</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-848"><a href="#RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-848"><span class="linenos">848</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-849"><a href="#RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-849"><span class="linenos">849</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-850"><a href="#RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-850"><span class="linenos">850</span></a><span class="s1">            Required dracut module package missing in package list</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-851"><a href="#RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-851"><span class="linenos">851</span></a>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-852"><a href="#RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-852"><span class="linenos">852</span></a><span class="s1">            The package &#39;</span><span class="si">{0}</span><span class="s1">&#39; is required</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-853"><a href="#RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-853"><span class="linenos">853</span></a><span class="s1">            for the selected overlayroot activated image type.</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-854"><a href="#RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-854"><span class="linenos">854</span></a><span class="s1">            Depending on your distribution, add the following in your</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-855"><a href="#RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-855"><span class="linenos">855</span></a><span class="s1">            &lt;packages type=&quot;image&quot;&gt; section:</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-856"><a href="#RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-856"><span class="linenos">856</span></a>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-857"><a href="#RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-857"><span class="linenos">857</span></a><span class="s1">            &lt;package name=&quot;ONE_FROM_ABOVE&quot;/&gt;</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-858"><a href="#RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-858"><span class="linenos">858</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-859"><a href="#RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-859"><span class="linenos">859</span></a>        <span class="n">initrd_system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_initrd_system</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-860"><a href="#RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-860"><span class="linenos">860</span></a>        <span class="n">meta</span> <span class="o">=</span> <span class="n">Defaults</span><span class="o">.</span><span class="n">get_runtime_checker_metadata</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-861"><a href="#RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-861"><span class="linenos">861</span></a>        <span class="n">required_dracut_packages</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;package_names&#39;</span><span class="p">][</span><span class="s1">&#39;dracut_overlay&#39;</span><span class="p">]</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-862"><a href="#RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-862"><span class="linenos">862</span></a>        <span class="k">if</span> <span class="n">initrd_system</span> <span class="o">==</span> <span class="s1">&#39;dracut&#39;</span> <span class="ow">and</span> \
</span><span id="RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-863"><a href="#RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-863"><span class="linenos">863</span></a>           <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_overlayroot</span><span class="p">():</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-864"><a href="#RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-864"><span class="linenos">864</span></a>            <span class="n">package_names</span> <span class="o">=</span> \
</span><span id="RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-865"><a href="#RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-865"><span class="linenos">865</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_bootstrap_packages</span><span class="p">()</span> <span class="o">+</span> \
</span><span id="RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-866"><a href="#RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-866"><span class="linenos">866</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_system_packages</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-867"><a href="#RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-867"><span class="linenos">867</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">RuntimeChecker</span><span class="o">.</span><span class="n">_package_in_list</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-868"><a href="#RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-868"><span class="linenos">868</span></a>                <span class="n">package_names</span><span class="p">,</span> <span class="n">required_dracut_packages</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-869"><a href="#RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-869"><span class="linenos">869</span></a>            <span class="p">):</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-870"><a href="#RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-870"><span class="linenos">870</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-871"><a href="#RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-871"><span class="linenos">871</span></a>                    <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">required_dracut_packages</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-872"><a href="#RuntimeChecker.check_dracut_module_for_disk_overlay_in_package_list-872"><span class="linenos">872</span></a>                <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Disk images configured to use a root filesystem overlay
requires the KIWI provided kiwi-overlay dracut module to
be installed at the time dracut is called. Thus this
runtime check examines if the required package is part of
the package list in the image description.</p>
</div>


                            </div>
                            <div id="RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest" class="classattr">
                                        <input id="RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">check_xen_uniquely_setup_as_server_or_guest</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-874"><a href="#RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-874"><span class="linenos">874</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_xen_uniquely_setup_as_server_or_guest</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-875"><a href="#RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-875"><span class="linenos">875</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-876"><a href="#RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-876"><span class="linenos">876</span></a><span class="sd">        If the image is classified to be used as Xen image, it can</span>
</span><span id="RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-877"><a href="#RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-877"><span class="linenos">877</span></a><span class="sd">        be either a Xen Server(dom0) or a Xen guest. The image</span>
</span><span id="RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-878"><a href="#RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-878"><span class="linenos">878</span></a><span class="sd">        configuration is checked if the information uniquely identifies</span>
</span><span id="RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-879"><a href="#RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-879"><span class="linenos">879</span></a><span class="sd">        the image as such</span>
</span><span id="RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-880"><a href="#RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-880"><span class="linenos">880</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-881"><a href="#RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-881"><span class="linenos">881</span></a>        <span class="n">xen_message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-882"><a href="#RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-882"><span class="linenos">882</span></a><span class="s1">            Inconsistent Xen setup found:</span>
</span><span id="RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-883"><a href="#RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-883"><span class="linenos">883</span></a>
</span><span id="RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-884"><a href="#RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-884"><span class="linenos">884</span></a><span class="s1">            The use of the &#39;xen_server&#39; or &#39;xen_loader&#39; attributes indicates</span>
</span><span id="RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-885"><a href="#RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-885"><span class="linenos">885</span></a><span class="s1">            the target system for this image is Xen. However the image</span>
</span><span id="RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-886"><a href="#RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-886"><span class="linenos">886</span></a><span class="s1">            specifies both attributes at the same time which classifies</span>
</span><span id="RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-887"><a href="#RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-887"><span class="linenos">887</span></a><span class="s1">            the image to be both, a Xen Server(dom0) and a Xen guest at</span>
</span><span id="RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-888"><a href="#RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-888"><span class="linenos">888</span></a><span class="s1">            the same time, which is not supported.</span>
</span><span id="RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-889"><a href="#RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-889"><span class="linenos">889</span></a>
</span><span id="RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-890"><a href="#RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-890"><span class="linenos">890</span></a><span class="s1">            Please cleanup your image description. Setup only one</span>
</span><span id="RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-891"><a href="#RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-891"><span class="linenos">891</span></a><span class="s1">            of &#39;xen_server&#39; or &#39;xen_loader&#39;.</span>
</span><span id="RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-892"><a href="#RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-892"><span class="linenos">892</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-893"><a href="#RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-893"><span class="linenos">893</span></a>        <span class="n">ec2_message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-894"><a href="#RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-894"><span class="linenos">894</span></a><span class="s1">            Inconsistent Amazon EC2 setup found:</span>
</span><span id="RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-895"><a href="#RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-895"><span class="linenos">895</span></a>
</span><span id="RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-896"><a href="#RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-896"><span class="linenos">896</span></a><span class="s1">            The firmware setup indicates the target system for this image</span>
</span><span id="RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-897"><a href="#RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-897"><span class="linenos">897</span></a><span class="s1">            is Amazon EC2, which uses a Xen based virtualisation technology.</span>
</span><span id="RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-898"><a href="#RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-898"><span class="linenos">898</span></a><span class="s1">            Therefore the image must be classified as a Xen guest and can</span>
</span><span id="RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-899"><a href="#RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-899"><span class="linenos">899</span></a><span class="s1">            not be a Xen server as indicated by the &#39;xen_server&#39; attribute</span>
</span><span id="RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-900"><a href="#RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-900"><span class="linenos">900</span></a>
</span><span id="RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-901"><a href="#RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-901"><span class="linenos">901</span></a><span class="s1">            Please cleanup your image description. Delete the &#39;xen_server&#39;</span>
</span><span id="RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-902"><a href="#RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-902"><span class="linenos">902</span></a><span class="s1">            attribute for images used with Amazon EC2.</span>
</span><span id="RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-903"><a href="#RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-903"><span class="linenos">903</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-904"><a href="#RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-904"><span class="linenos">904</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">is_xen_server</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">is_xen_guest</span><span class="p">():</span>
</span><span id="RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-905"><a href="#RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-905"><span class="linenos">905</span></a>            <span class="n">firmware</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_firmware</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-906"><a href="#RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-906"><span class="linenos">906</span></a>            <span class="n">ec2_firmware_names</span> <span class="o">=</span> <span class="n">Defaults</span><span class="o">.</span><span class="n">get_ec2_capable_firmware_names</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-907"><a href="#RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-907"><span class="linenos">907</span></a>            <span class="k">if</span> <span class="n">firmware</span> <span class="ow">and</span> <span class="n">firmware</span> <span class="ow">in</span> <span class="n">ec2_firmware_names</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-908"><a href="#RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-908"><span class="linenos">908</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span><span class="n">ec2_message</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-909"><a href="#RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-909"><span class="linenos">909</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-910"><a href="#RuntimeChecker.check_xen_uniquely_setup_as_server_or_guest-910"><span class="linenos">910</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span><span class="n">xen_message</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>If the image is classified to be used as Xen image, it can
be either a Xen Server(dom0) or a Xen guest. The image
configuration is checked if the information uniquely identifies
the image as such</p>
</div>


                            </div>
                            <div id="RuntimeChecker.check_mediacheck_installed" class="classattr">
                                        <input id="RuntimeChecker.check_mediacheck_installed-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">check_mediacheck_installed</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="RuntimeChecker.check_mediacheck_installed-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RuntimeChecker.check_mediacheck_installed"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RuntimeChecker.check_mediacheck_installed-912"><a href="#RuntimeChecker.check_mediacheck_installed-912"><span class="linenos">912</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_mediacheck_installed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_mediacheck_installed-913"><a href="#RuntimeChecker.check_mediacheck_installed-913"><span class="linenos">913</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_mediacheck_installed-914"><a href="#RuntimeChecker.check_mediacheck_installed-914"><span class="linenos">914</span></a><span class="sd">        If the image description enables the mediacheck attribute</span>
</span><span id="RuntimeChecker.check_mediacheck_installed-915"><a href="#RuntimeChecker.check_mediacheck_installed-915"><span class="linenos">915</span></a><span class="sd">        the required tools to run this check must be installed</span>
</span><span id="RuntimeChecker.check_mediacheck_installed-916"><a href="#RuntimeChecker.check_mediacheck_installed-916"><span class="linenos">916</span></a><span class="sd">        on the image build host</span>
</span><span id="RuntimeChecker.check_mediacheck_installed-917"><a href="#RuntimeChecker.check_mediacheck_installed-917"><span class="linenos">917</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_mediacheck_installed-918"><a href="#RuntimeChecker.check_mediacheck_installed-918"><span class="linenos">918</span></a>        <span class="n">message_tool_not_found</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker.check_mediacheck_installed-919"><a href="#RuntimeChecker.check_mediacheck_installed-919"><span class="linenos">919</span></a><span class="s1">            Required tool </span><span class="si">{name}</span><span class="s1"> not found in caller environment</span>
</span><span id="RuntimeChecker.check_mediacheck_installed-920"><a href="#RuntimeChecker.check_mediacheck_installed-920"><span class="linenos">920</span></a>
</span><span id="RuntimeChecker.check_mediacheck_installed-921"><a href="#RuntimeChecker.check_mediacheck_installed-921"><span class="linenos">921</span></a><span class="s1">            The attribute &#39;mediacheck&#39; is set to &#39;true&#39; which requires</span>
</span><span id="RuntimeChecker.check_mediacheck_installed-922"><a href="#RuntimeChecker.check_mediacheck_installed-922"><span class="linenos">922</span></a><span class="s1">            the above tool to be installed on the build system</span>
</span><span id="RuntimeChecker.check_mediacheck_installed-923"><a href="#RuntimeChecker.check_mediacheck_installed-923"><span class="linenos">923</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_mediacheck_installed-924"><a href="#RuntimeChecker.check_mediacheck_installed-924"><span class="linenos">924</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_mediacheck</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_mediacheck_installed-925"><a href="#RuntimeChecker.check_mediacheck_installed-925"><span class="linenos">925</span></a>            <span class="n">tool</span> <span class="o">=</span> <span class="s1">&#39;tagmedia&#39;</span>
</span><span id="RuntimeChecker.check_mediacheck_installed-926"><a href="#RuntimeChecker.check_mediacheck_installed-926"><span class="linenos">926</span></a>            <span class="n">media_tagger</span> <span class="o">=</span> <span class="n">RuntimeConfig</span><span class="p">()</span><span class="o">.</span><span class="n">get_iso_media_tag_tool</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_mediacheck_installed-927"><a href="#RuntimeChecker.check_mediacheck_installed-927"><span class="linenos">927</span></a>            <span class="k">if</span> <span class="n">media_tagger</span> <span class="o">==</span> <span class="s1">&#39;checkmedia&#39;</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_mediacheck_installed-928"><a href="#RuntimeChecker.check_mediacheck_installed-928"><span class="linenos">928</span></a>                <span class="n">tool</span> <span class="o">=</span> <span class="s1">&#39;tagmedia&#39;</span>
</span><span id="RuntimeChecker.check_mediacheck_installed-929"><a href="#RuntimeChecker.check_mediacheck_installed-929"><span class="linenos">929</span></a>            <span class="k">elif</span> <span class="n">media_tagger</span> <span class="o">==</span> <span class="s1">&#39;isomd5sum&#39;</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_mediacheck_installed-930"><a href="#RuntimeChecker.check_mediacheck_installed-930"><span class="linenos">930</span></a>                <span class="n">tool</span> <span class="o">=</span> <span class="s1">&#39;implantisomd5&#39;</span>
</span><span id="RuntimeChecker.check_mediacheck_installed-931"><a href="#RuntimeChecker.check_mediacheck_installed-931"><span class="linenos">931</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">Path</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">tool</span><span class="p">,</span> <span class="n">access_mode</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">X_OK</span><span class="p">):</span>
</span><span id="RuntimeChecker.check_mediacheck_installed-932"><a href="#RuntimeChecker.check_mediacheck_installed-932"><span class="linenos">932</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_mediacheck_installed-933"><a href="#RuntimeChecker.check_mediacheck_installed-933"><span class="linenos">933</span></a>                    <span class="n">message_tool_not_found</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">tool</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_mediacheck_installed-934"><a href="#RuntimeChecker.check_mediacheck_installed-934"><span class="linenos">934</span></a>                <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>If the image description enables the mediacheck attribute
the required tools to run this check must be installed
on the image build host</p>
</div>


                            </div>
                            <div id="RuntimeChecker.check_image_version_provided" class="classattr">
                                        <input id="RuntimeChecker.check_image_version_provided-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">check_image_version_provided</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="RuntimeChecker.check_image_version_provided-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RuntimeChecker.check_image_version_provided"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RuntimeChecker.check_image_version_provided-936"><a href="#RuntimeChecker.check_image_version_provided-936"><span class="linenos">936</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_image_version_provided</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_image_version_provided-937"><a href="#RuntimeChecker.check_image_version_provided-937"><span class="linenos">937</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_image_version_provided-938"><a href="#RuntimeChecker.check_image_version_provided-938"><span class="linenos">938</span></a><span class="sd">        Kiwi requires a &lt;version&gt; element to be specified as part</span>
</span><span id="RuntimeChecker.check_image_version_provided-939"><a href="#RuntimeChecker.check_image_version_provided-939"><span class="linenos">939</span></a><span class="sd">        of at least one &lt;preferences&gt; section.</span>
</span><span id="RuntimeChecker.check_image_version_provided-940"><a href="#RuntimeChecker.check_image_version_provided-940"><span class="linenos">940</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_image_version_provided-941"><a href="#RuntimeChecker.check_image_version_provided-941"><span class="linenos">941</span></a>        <span class="n">message_missing_version</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker.check_image_version_provided-942"><a href="#RuntimeChecker.check_image_version_provided-942"><span class="linenos">942</span></a><span class="s1">            No version is defined in any of the &lt;preferences&gt;</span>
</span><span id="RuntimeChecker.check_image_version_provided-943"><a href="#RuntimeChecker.check_image_version_provided-943"><span class="linenos">943</span></a><span class="s1">            sections. Please add</span>
</span><span id="RuntimeChecker.check_image_version_provided-944"><a href="#RuntimeChecker.check_image_version_provided-944"><span class="linenos">944</span></a>
</span><span id="RuntimeChecker.check_image_version_provided-945"><a href="#RuntimeChecker.check_image_version_provided-945"><span class="linenos">945</span></a><span class="s1">                &lt;version&gt;image_version&lt;version/&gt;</span>
</span><span id="RuntimeChecker.check_image_version_provided-946"><a href="#RuntimeChecker.check_image_version_provided-946"><span class="linenos">946</span></a>
</span><span id="RuntimeChecker.check_image_version_provided-947"><a href="#RuntimeChecker.check_image_version_provided-947"><span class="linenos">947</span></a><span class="s1">            inside the &lt;preferences&gt; section.</span>
</span><span id="RuntimeChecker.check_image_version_provided-948"><a href="#RuntimeChecker.check_image_version_provided-948"><span class="linenos">948</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_image_version_provided-949"><a href="#RuntimeChecker.check_image_version_provided-949"><span class="linenos">949</span></a>
</span><span id="RuntimeChecker.check_image_version_provided-950"><a href="#RuntimeChecker.check_image_version_provided-950"><span class="linenos">950</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_image_version</span><span class="p">():</span>
</span><span id="RuntimeChecker.check_image_version_provided-951"><a href="#RuntimeChecker.check_image_version_provided-951"><span class="linenos">951</span></a>            <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span><span class="n">message_missing_version</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Kiwi requires a <version> element to be specified as part
of at least one <preferences> section.</p>
</div>


                            </div>
                            <div id="RuntimeChecker.check_image_type_unique" class="classattr">
                                        <input id="RuntimeChecker.check_image_type_unique-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">check_image_type_unique</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="RuntimeChecker.check_image_type_unique-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RuntimeChecker.check_image_type_unique"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RuntimeChecker.check_image_type_unique-953"><a href="#RuntimeChecker.check_image_type_unique-953"><span class="linenos">953</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_image_type_unique</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_image_type_unique-954"><a href="#RuntimeChecker.check_image_type_unique-954"><span class="linenos">954</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_image_type_unique-955"><a href="#RuntimeChecker.check_image_type_unique-955"><span class="linenos">955</span></a><span class="sd">        Verify that the selected image type is unique within</span>
</span><span id="RuntimeChecker.check_image_type_unique-956"><a href="#RuntimeChecker.check_image_type_unique-956"><span class="linenos">956</span></a><span class="sd">        the range of the configured types and profiles.</span>
</span><span id="RuntimeChecker.check_image_type_unique-957"><a href="#RuntimeChecker.check_image_type_unique-957"><span class="linenos">957</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_image_type_unique-958"><a href="#RuntimeChecker.check_image_type_unique-958"><span class="linenos">958</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker.check_image_type_unique-959"><a href="#RuntimeChecker.check_image_type_unique-959"><span class="linenos">959</span></a><span class="s1">            Conflicting image type setup detected</span>
</span><span id="RuntimeChecker.check_image_type_unique-960"><a href="#RuntimeChecker.check_image_type_unique-960"><span class="linenos">960</span></a>
</span><span id="RuntimeChecker.check_image_type_unique-961"><a href="#RuntimeChecker.check_image_type_unique-961"><span class="linenos">961</span></a><span class="s1">            The selected image type &#39;</span><span class="si">{0}</span><span class="s1">&#39; in the </span><span class="si">{1}</span><span class="s1"> profile</span>
</span><span id="RuntimeChecker.check_image_type_unique-962"><a href="#RuntimeChecker.check_image_type_unique-962"><span class="linenos">962</span></a><span class="s1">            selection is not unique. There are the following type</span>
</span><span id="RuntimeChecker.check_image_type_unique-963"><a href="#RuntimeChecker.check_image_type_unique-963"><span class="linenos">963</span></a><span class="s1">            settings which overrides each other:</span>
</span><span id="RuntimeChecker.check_image_type_unique-964"><a href="#RuntimeChecker.check_image_type_unique-964"><span class="linenos">964</span></a><span class="s1">            </span><span class="si">{2}</span>
</span><span id="RuntimeChecker.check_image_type_unique-965"><a href="#RuntimeChecker.check_image_type_unique-965"><span class="linenos">965</span></a><span class="s1">            To solve this conflict please move the image type</span>
</span><span id="RuntimeChecker.check_image_type_unique-966"><a href="#RuntimeChecker.check_image_type_unique-966"><span class="linenos">966</span></a><span class="s1">            setup into its own profile and select them using</span>
</span><span id="RuntimeChecker.check_image_type_unique-967"><a href="#RuntimeChecker.check_image_type_unique-967"><span class="linenos">967</span></a><span class="s1">            the --profile option at call time.</span>
</span><span id="RuntimeChecker.check_image_type_unique-968"><a href="#RuntimeChecker.check_image_type_unique-968"><span class="linenos">968</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_image_type_unique-969"><a href="#RuntimeChecker.check_image_type_unique-969"><span class="linenos">969</span></a>        <span class="n">image_type_sections</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="RuntimeChecker.check_image_type_unique-970"><a href="#RuntimeChecker.check_image_type_unique-970"><span class="linenos">970</span></a>        <span class="n">type_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="RuntimeChecker.check_image_type_unique-971"><a href="#RuntimeChecker.check_image_type_unique-971"><span class="linenos">971</span></a>        <span class="k">for</span> <span class="n">preferences</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_preferences_sections</span><span class="p">():</span>
</span><span id="RuntimeChecker.check_image_type_unique-972"><a href="#RuntimeChecker.check_image_type_unique-972"><span class="linenos">972</span></a>            <span class="n">image_type_sections</span> <span class="o">+=</span> <span class="n">preferences</span><span class="o">.</span><span class="n">get_type</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_image_type_unique-973"><a href="#RuntimeChecker.check_image_type_unique-973"><span class="linenos">973</span></a>
</span><span id="RuntimeChecker.check_image_type_unique-974"><a href="#RuntimeChecker.check_image_type_unique-974"><span class="linenos">974</span></a>        <span class="k">for</span> <span class="n">image_type</span> <span class="ow">in</span> <span class="n">image_type_sections</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_image_type_unique-975"><a href="#RuntimeChecker.check_image_type_unique-975"><span class="linenos">975</span></a>            <span class="n">type_name</span> <span class="o">=</span> <span class="n">image_type</span><span class="o">.</span><span class="n">get_image</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_image_type_unique-976"><a href="#RuntimeChecker.check_image_type_unique-976"><span class="linenos">976</span></a>            <span class="k">if</span> <span class="n">type_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">type_name</span><span class="p">):</span>
</span><span id="RuntimeChecker.check_image_type_unique-977"><a href="#RuntimeChecker.check_image_type_unique-977"><span class="linenos">977</span></a>                <span class="n">type_dict</span><span class="p">[</span><span class="n">type_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image_type</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_image_type_unique-978"><a href="#RuntimeChecker.check_image_type_unique-978"><span class="linenos">978</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_image_type_unique-979"><a href="#RuntimeChecker.check_image_type_unique-979"><span class="linenos">979</span></a>                <span class="n">type_dict</span><span class="p">[</span><span class="n">type_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">image_type</span><span class="p">]</span>
</span><span id="RuntimeChecker.check_image_type_unique-980"><a href="#RuntimeChecker.check_image_type_unique-980"><span class="linenos">980</span></a>
</span><span id="RuntimeChecker.check_image_type_unique-981"><a href="#RuntimeChecker.check_image_type_unique-981"><span class="linenos">981</span></a>        <span class="k">for</span> <span class="n">type_name</span><span class="p">,</span> <span class="n">type_list</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">type_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
</span><span id="RuntimeChecker.check_image_type_unique-982"><a href="#RuntimeChecker.check_image_type_unique-982"><span class="linenos">982</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">type_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_image_type_unique-983"><a href="#RuntimeChecker.check_image_type_unique-983"><span class="linenos">983</span></a>                <span class="n">type_export</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_image_type_unique-984"><a href="#RuntimeChecker.check_image_type_unique-984"><span class="linenos">984</span></a>                <span class="k">for</span> <span class="n">image_type</span> <span class="ow">in</span> <span class="n">type_list</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_image_type_unique-985"><a href="#RuntimeChecker.check_image_type_unique-985"><span class="linenos">985</span></a>                    <span class="n">type_export</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_image_type_unique-986"><a href="#RuntimeChecker.check_image_type_unique-986"><span class="linenos">986</span></a>                    <span class="n">image_type</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">type_export</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_image_type_unique-987"><a href="#RuntimeChecker.check_image_type_unique-987"><span class="linenos">987</span></a>                <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_image_type_unique-988"><a href="#RuntimeChecker.check_image_type_unique-988"><span class="linenos">988</span></a>                    <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_image_type_unique-989"><a href="#RuntimeChecker.check_image_type_unique-989"><span class="linenos">989</span></a>                        <span class="n">type_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">profiles</span> <span class="ow">or</span> <span class="p">[</span><span class="s1">&#39;Default&#39;</span><span class="p">],</span>
</span><span id="RuntimeChecker.check_image_type_unique-990"><a href="#RuntimeChecker.check_image_type_unique-990"><span class="linenos">990</span></a>                        <span class="n">type_export</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_image_type_unique-991"><a href="#RuntimeChecker.check_image_type_unique-991"><span class="linenos">991</span></a>                    <span class="p">)</span>
</span><span id="RuntimeChecker.check_image_type_unique-992"><a href="#RuntimeChecker.check_image_type_unique-992"><span class="linenos">992</span></a>                <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Verify that the selected image type is unique within
the range of the configured types and profiles.</p>
</div>


                            </div>
                            <div id="RuntimeChecker.check_efi_fat_image_has_correct_size" class="classattr">
                                        <input id="RuntimeChecker.check_efi_fat_image_has_correct_size-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">check_efi_fat_image_has_correct_size</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="RuntimeChecker.check_efi_fat_image_has_correct_size-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RuntimeChecker.check_efi_fat_image_has_correct_size"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RuntimeChecker.check_efi_fat_image_has_correct_size-994"><a href="#RuntimeChecker.check_efi_fat_image_has_correct_size-994"><span class="linenos"> 994</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_efi_fat_image_has_correct_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_efi_fat_image_has_correct_size-995"><a href="#RuntimeChecker.check_efi_fat_image_has_correct_size-995"><span class="linenos"> 995</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_efi_fat_image_has_correct_size-996"><a href="#RuntimeChecker.check_efi_fat_image_has_correct_size-996"><span class="linenos"> 996</span></a><span class="sd">        Verify that the efifatimagesize does not exceed the max</span>
</span><span id="RuntimeChecker.check_efi_fat_image_has_correct_size-997"><a href="#RuntimeChecker.check_efi_fat_image_has_correct_size-997"><span class="linenos"> 997</span></a><span class="sd">        El Torito load size of 65535 * 512 bytes</span>
</span><span id="RuntimeChecker.check_efi_fat_image_has_correct_size-998"><a href="#RuntimeChecker.check_efi_fat_image_has_correct_size-998"><span class="linenos"> 998</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_efi_fat_image_has_correct_size-999"><a href="#RuntimeChecker.check_efi_fat_image_has_correct_size-999"><span class="linenos"> 999</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker.check_efi_fat_image_has_correct_size-1000"><a href="#RuntimeChecker.check_efi_fat_image_has_correct_size-1000"><span class="linenos">1000</span></a><span class="s1">            El Torito max load size exceeded</span>
</span><span id="RuntimeChecker.check_efi_fat_image_has_correct_size-1001"><a href="#RuntimeChecker.check_efi_fat_image_has_correct_size-1001"><span class="linenos">1001</span></a>
</span><span id="RuntimeChecker.check_efi_fat_image_has_correct_size-1002"><a href="#RuntimeChecker.check_efi_fat_image_has_correct_size-1002"><span class="linenos">1002</span></a><span class="s1">            The configured efifatimagesize of &#39;</span><span class="si">{0}</span><span class="s1">MB&#39; exceeds</span>
</span><span id="RuntimeChecker.check_efi_fat_image_has_correct_size-1003"><a href="#RuntimeChecker.check_efi_fat_image_has_correct_size-1003"><span class="linenos">1003</span></a><span class="s1">            the El Torito max load size of 65535 * 512 bytes (~31MB).</span>
</span><span id="RuntimeChecker.check_efi_fat_image_has_correct_size-1004"><a href="#RuntimeChecker.check_efi_fat_image_has_correct_size-1004"><span class="linenos">1004</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_efi_fat_image_has_correct_size-1005"><a href="#RuntimeChecker.check_efi_fat_image_has_correct_size-1005"><span class="linenos">1005</span></a>        <span class="n">fat_image_mbsize</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_efi_fat_image_has_correct_size-1006"><a href="#RuntimeChecker.check_efi_fat_image_has_correct_size-1006"><span class="linenos">1006</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">build_type</span>
</span><span id="RuntimeChecker.check_efi_fat_image_has_correct_size-1007"><a href="#RuntimeChecker.check_efi_fat_image_has_correct_size-1007"><span class="linenos">1007</span></a>                <span class="o">.</span><span class="n">get_efifatimagesize</span><span class="p">()</span> <span class="ow">or</span> <span class="n">defaults</span><span class="o">.</span><span class="n">EFI_FAT_IMAGE_SIZE</span>
</span><span id="RuntimeChecker.check_efi_fat_image_has_correct_size-1008"><a href="#RuntimeChecker.check_efi_fat_image_has_correct_size-1008"><span class="linenos">1008</span></a>        <span class="p">)</span>
</span><span id="RuntimeChecker.check_efi_fat_image_has_correct_size-1009"><a href="#RuntimeChecker.check_efi_fat_image_has_correct_size-1009"><span class="linenos">1009</span></a>        <span class="k">if</span> <span class="n">fat_image_mbsize</span> <span class="o">&gt;</span> <span class="mi">31</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_efi_fat_image_has_correct_size-1010"><a href="#RuntimeChecker.check_efi_fat_image_has_correct_size-1010"><span class="linenos">1010</span></a>            <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_efi_fat_image_has_correct_size-1011"><a href="#RuntimeChecker.check_efi_fat_image_has_correct_size-1011"><span class="linenos">1011</span></a>                <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fat_image_mbsize</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_efi_fat_image_has_correct_size-1012"><a href="#RuntimeChecker.check_efi_fat_image_has_correct_size-1012"><span class="linenos">1012</span></a>            <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Verify that the efifatimagesize does not exceed the max
El Torito load size of 65535 * 512 bytes</p>
</div>


                            </div>
                            <div id="RuntimeChecker.check_bootloader_env_compatible_with_loader" class="classattr">
                                        <input id="RuntimeChecker.check_bootloader_env_compatible_with_loader-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">check_bootloader_env_compatible_with_loader</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="RuntimeChecker.check_bootloader_env_compatible_with_loader-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RuntimeChecker.check_bootloader_env_compatible_with_loader"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RuntimeChecker.check_bootloader_env_compatible_with_loader-1014"><a href="#RuntimeChecker.check_bootloader_env_compatible_with_loader-1014"><span class="linenos">1014</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_bootloader_env_compatible_with_loader</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_bootloader_env_compatible_with_loader-1015"><a href="#RuntimeChecker.check_bootloader_env_compatible_with_loader-1015"><span class="linenos">1015</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_bootloader_env_compatible_with_loader-1016"><a href="#RuntimeChecker.check_bootloader_env_compatible_with_loader-1016"><span class="linenos">1016</span></a><span class="sd">        If there is an environment section as part of the bootloader</span>
</span><span id="RuntimeChecker.check_bootloader_env_compatible_with_loader-1017"><a href="#RuntimeChecker.check_bootloader_env_compatible_with_loader-1017"><span class="linenos">1017</span></a><span class="sd">        section, check if the selected loader supports custom</span>
</span><span id="RuntimeChecker.check_bootloader_env_compatible_with_loader-1018"><a href="#RuntimeChecker.check_bootloader_env_compatible_with_loader-1018"><span class="linenos">1018</span></a><span class="sd">        environment blobs</span>
</span><span id="RuntimeChecker.check_bootloader_env_compatible_with_loader-1019"><a href="#RuntimeChecker.check_bootloader_env_compatible_with_loader-1019"><span class="linenos">1019</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RuntimeChecker.check_bootloader_env_compatible_with_loader-1020"><a href="#RuntimeChecker.check_bootloader_env_compatible_with_loader-1020"><span class="linenos">1020</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span>
</span><span id="RuntimeChecker.check_bootloader_env_compatible_with_loader-1021"><a href="#RuntimeChecker.check_bootloader_env_compatible_with_loader-1021"><span class="linenos">1021</span></a><span class="s1">            Selected loader does not support custom environments</span>
</span><span id="RuntimeChecker.check_bootloader_env_compatible_with_loader-1022"><a href="#RuntimeChecker.check_bootloader_env_compatible_with_loader-1022"><span class="linenos">1022</span></a>
</span><span id="RuntimeChecker.check_bootloader_env_compatible_with_loader-1023"><a href="#RuntimeChecker.check_bootloader_env_compatible_with_loader-1023"><span class="linenos">1023</span></a><span class="s1">            The selected bootloader </span><span class="si">{}</span><span class="s1"> does not support custom</span>
</span><span id="RuntimeChecker.check_bootloader_env_compatible_with_loader-1024"><a href="#RuntimeChecker.check_bootloader_env_compatible_with_loader-1024"><span class="linenos">1024</span></a><span class="s1">            environment settings. Please drop the &lt;environment&gt;</span>
</span><span id="RuntimeChecker.check_bootloader_env_compatible_with_loader-1025"><a href="#RuntimeChecker.check_bootloader_env_compatible_with_loader-1025"><span class="linenos">1025</span></a><span class="s1">            setting from &lt;bootloadersettings&gt; for this loader</span>
</span><span id="RuntimeChecker.check_bootloader_env_compatible_with_loader-1026"><a href="#RuntimeChecker.check_bootloader_env_compatible_with_loader-1026"><span class="linenos">1026</span></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_bootloader_env_compatible_with_loader-1027"><a href="#RuntimeChecker.check_bootloader_env_compatible_with_loader-1027"><span class="linenos">1027</span></a>        <span class="n">env_supported_loaders</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="RuntimeChecker.check_bootloader_env_compatible_with_loader-1028"><a href="#RuntimeChecker.check_bootloader_env_compatible_with_loader-1028"><span class="linenos">1028</span></a>            <span class="s1">&#39;grub2&#39;</span><span class="p">,</span>
</span><span id="RuntimeChecker.check_bootloader_env_compatible_with_loader-1029"><a href="#RuntimeChecker.check_bootloader_env_compatible_with_loader-1029"><span class="linenos">1029</span></a>            <span class="s1">&#39;grub2_s390x_emu&#39;</span><span class="p">,</span>
</span><span id="RuntimeChecker.check_bootloader_env_compatible_with_loader-1030"><a href="#RuntimeChecker.check_bootloader_env_compatible_with_loader-1030"><span class="linenos">1030</span></a>            <span class="s1">&#39;custom&#39;</span>
</span><span id="RuntimeChecker.check_bootloader_env_compatible_with_loader-1031"><a href="#RuntimeChecker.check_bootloader_env_compatible_with_loader-1031"><span class="linenos">1031</span></a>        <span class="p">]</span>
</span><span id="RuntimeChecker.check_bootloader_env_compatible_with_loader-1032"><a href="#RuntimeChecker.check_bootloader_env_compatible_with_loader-1032"><span class="linenos">1032</span></a>        <span class="n">bootloader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span><span class="n">get_build_type_bootloader_name</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_bootloader_env_compatible_with_loader-1033"><a href="#RuntimeChecker.check_bootloader_env_compatible_with_loader-1033"><span class="linenos">1033</span></a>        <span class="n">variable_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_state</span><span class="o">.</span>\
</span><span id="RuntimeChecker.check_bootloader_env_compatible_with_loader-1034"><a href="#RuntimeChecker.check_bootloader_env_compatible_with_loader-1034"><span class="linenos">1034</span></a>            <span class="n">get_build_type_bootloader_environment_variables</span><span class="p">()</span>
</span><span id="RuntimeChecker.check_bootloader_env_compatible_with_loader-1035"><a href="#RuntimeChecker.check_bootloader_env_compatible_with_loader-1035"><span class="linenos">1035</span></a>        <span class="k">if</span> <span class="n">variable_list</span> <span class="ow">and</span> <span class="n">bootloader</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">env_supported_loaders</span><span class="p">:</span>
</span><span id="RuntimeChecker.check_bootloader_env_compatible_with_loader-1036"><a href="#RuntimeChecker.check_bootloader_env_compatible_with_loader-1036"><span class="linenos">1036</span></a>            <span class="k">raise</span> <span class="n">KiwiRuntimeError</span><span class="p">(</span>
</span><span id="RuntimeChecker.check_bootloader_env_compatible_with_loader-1037"><a href="#RuntimeChecker.check_bootloader_env_compatible_with_loader-1037"><span class="linenos">1037</span></a>                <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bootloader</span><span class="p">)</span>
</span><span id="RuntimeChecker.check_bootloader_env_compatible_with_loader-1038"><a href="#RuntimeChecker.check_bootloader_env_compatible_with_loader-1038"><span class="linenos">1038</span></a>            <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>If there is an environment section as part of the bootloader
section, check if the selected loader supports custom
environment blobs</p>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>