<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.4"/>
    <title>kiwi.volume_manager.base API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../volume_manager.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;kiwi.volume_manager</a>

            <img src="https://osinside.github.io/kiwi/_static/kiwi-logo.png" class="logo" alt="project logo"/>

            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="variable" href="#log">log</a>
            </li>
            <li>
                    <a class="class" href="#VolumeManagerBase">VolumeManagerBase</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#VolumeManagerBase.__init__">VolumeManagerBase</a>
                        </li>
                        <li>
                                <a class="variable" href="#VolumeManagerBase.temp_directories">temp_directories</a>
                        </li>
                        <li>
                                <a class="variable" href="#VolumeManagerBase.mountpoint">mountpoint</a>
                        </li>
                        <li>
                                <a class="variable" href="#VolumeManagerBase.device_map">device_map</a>
                        </li>
                        <li>
                                <a class="variable" href="#VolumeManagerBase.device_provider_root">device_provider_root</a>
                        </li>
                        <li>
                                <a class="variable" href="#VolumeManagerBase.root_dir">root_dir</a>
                        </li>
                        <li>
                                <a class="variable" href="#VolumeManagerBase.volumes">volumes</a>
                        </li>
                        <li>
                                <a class="variable" href="#VolumeManagerBase.volume_group">volume_group</a>
                        </li>
                        <li>
                                <a class="variable" href="#VolumeManagerBase.volume_map">volume_map</a>
                        </li>
                        <li>
                                <a class="variable" href="#VolumeManagerBase.mount_list">mount_list</a>
                        </li>
                        <li>
                                <a class="variable" href="#VolumeManagerBase.device">device</a>
                        </li>
                        <li>
                                <a class="variable" href="#VolumeManagerBase.custom_args">custom_args</a>
                        </li>
                        <li>
                                <a class="variable" href="#VolumeManagerBase.custom_filesystem_args">custom_filesystem_args</a>
                        </li>
                        <li>
                                <a class="function" href="#VolumeManagerBase.post_init">post_init</a>
                        </li>
                        <li>
                                <a class="function" href="#VolumeManagerBase.setup">setup</a>
                        </li>
                        <li>
                                <a class="function" href="#VolumeManagerBase.create_volumes">create_volumes</a>
                        </li>
                        <li>
                                <a class="function" href="#VolumeManagerBase.apply_attributes_on_volume">apply_attributes_on_volume</a>
                        </li>
                        <li>
                                <a class="function" href="#VolumeManagerBase.get_fstab">get_fstab</a>
                        </li>
                        <li>
                                <a class="function" href="#VolumeManagerBase.get_volumes">get_volumes</a>
                        </li>
                        <li>
                                <a class="function" href="#VolumeManagerBase.mount_volumes">mount_volumes</a>
                        </li>
                        <li>
                                <a class="function" href="#VolumeManagerBase.umount_volumes">umount_volumes</a>
                        </li>
                        <li>
                                <a class="function" href="#VolumeManagerBase.umount">umount</a>
                        </li>
                        <li>
                                <a class="function" href="#VolumeManagerBase.mount">mount</a>
                        </li>
                        <li>
                                <a class="function" href="#VolumeManagerBase.is_loop">is_loop</a>
                        </li>
                        <li>
                                <a class="function" href="#VolumeManagerBase.get_device">get_device</a>
                        </li>
                        <li>
                                <a class="function" href="#VolumeManagerBase.create_volume_paths_in_root_dir">create_volume_paths_in_root_dir</a>
                        </li>
                        <li>
                                <a class="function" href="#VolumeManagerBase.get_canonical_volume_list">get_canonical_volume_list</a>
                        </li>
                        <li>
                                <a class="function" href="#VolumeManagerBase.get_volume_mbsize">get_volume_mbsize</a>
                        </li>
                        <li>
                                <a class="function" href="#VolumeManagerBase.get_mountpoint">get_mountpoint</a>
                        </li>
                        <li>
                                <a class="function" href="#VolumeManagerBase.get_root_volume_name">get_root_volume_name</a>
                        </li>
                        <li>
                                <a class="function" href="#VolumeManagerBase.sync_data">sync_data</a>
                        </li>
                        <li>
                                <a class="function" href="#VolumeManagerBase.create_verity_layer">create_verity_layer</a>
                        </li>
                        <li>
                                <a class="function" href="#VolumeManagerBase.create_verification_metadata">create_verification_metadata</a>
                        </li>
                        <li>
                                <a class="function" href="#VolumeManagerBase.set_property_readonly_root">set_property_readonly_root</a>
                        </li>
                        <li>
                                <a class="function" href="#VolumeManagerBase.setup_mountpoint">setup_mountpoint</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../../kiwi.html">kiwi</a><wbr>.<a href="./../volume_manager.html">volume_manager</a><wbr>.base    </h1>

                
                        <input id="mod-base-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-base-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="c1"># Copyright (c) 2015 SUSE Linux GmbH.  All rights reserved.</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="c1">#</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="c1"># This file is part of kiwi.</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="c1">#</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="c1"># kiwi is free software: you can redistribute it and/or modify</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="c1"># it under the terms of the GNU General Public License as published by</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="c1"># the Free Software Foundation, either version 3 of the License, or</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="c1"># (at your option) any later version.</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="c1">#</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="c1"># kiwi is distributed in the hope that it will be useful,</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="c1"># GNU General Public License for more details.</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="c1">#</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="c1"># You should have received a copy of the GNU General Public License</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="c1"># along with kiwi.  If not, see &lt;http://www.gnu.org/licenses/&gt;</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="c1">#</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">namedtuple</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="c1"># project</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">kiwi.utils.temporary</span><span class="w"> </span><span class="kn">import</span> <span class="n">Temporary</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">kiwi.command</span><span class="w"> </span><span class="kn">import</span> <span class="n">Command</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">kiwi.storage.device_provider</span><span class="w"> </span><span class="kn">import</span> <span class="n">DeviceProvider</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">kiwi.mount_manager</span><span class="w"> </span><span class="kn">import</span> <span class="n">MountManager</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">kiwi.utils.sync</span><span class="w"> </span><span class="kn">import</span> <span class="n">DataSync</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">kiwi.path</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">kiwi.system.size</span><span class="w"> </span><span class="kn">import</span> <span class="n">SystemSize</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">kiwi.defaults</span><span class="w"> </span><span class="kn">import</span> <span class="n">Defaults</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">kiwi.xml_state</span><span class="w"> </span><span class="kn">import</span> <span class="n">volume_type</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">kiwi.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a>    <span class="n">KiwiVolumeManagerSetupError</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="p">)</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;kiwi&#39;</span><span class="p">)</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="k">class</span><span class="w"> </span><span class="nc">VolumeManagerBase</span><span class="p">(</span><span class="n">DeviceProvider</span><span class="p">):</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="sd">    **Implements base class for volume management interface**</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="sd">    :param object device_map:</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="sd">        dictionary of low level DeviceProvider intances</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="sd">    :param str root_dir: root directory path name</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="sd">    :param list volumes: list of volumes from :class:`XMLState::get_volumes()`</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="sd">    :param dict custom_args: custom volume manager arguments for all</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="sd">        volume manager and filesystem specific tasks</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="sd">    :raises KiwiVolumeManagerSetupError: if the given root_dir doesn&#39;t exist</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>        <span class="n">device_map</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DeviceProvider</span><span class="p">],</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>        <span class="n">root_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>        <span class="n">volumes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">volume_type</span><span class="p">],</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>        <span class="n">custom_args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">temp_directories</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Temporary</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>        <span class="c1">#: all volumes are combined into one mountpoint. This is</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>        <span class="c1">#: needed at sync_data time. How to mount the volumes is</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>        <span class="c1">#: special to the volume management class</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mountpoint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>        <span class="c1">#: dictionary of mapped DeviceProviders</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device_map</span> <span class="o">=</span> <span class="n">device_map</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>        <span class="c1">#: the underlaying device provider</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device_provider_root</span> <span class="o">=</span> <span class="n">device_map</span><span class="p">[</span><span class="s1">&#39;root&#39;</span><span class="p">]</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>        <span class="c1">#: root directory path name</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">root_dir</span> <span class="o">=</span> <span class="n">root_dir</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>        <span class="c1">#: list of volumes from :class:`XMLState::get_volumes()`</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">volumes</span> <span class="o">=</span> <span class="n">volumes</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>        <span class="c1">#: volume group name</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">volume_group</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>        <span class="c1">#: map volume name to device node</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">volume_map</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>        <span class="c1">#: list of volume MountManager&#39;s</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mount_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">MountManager</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>        <span class="c1">#: main storage device node name</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device_provider_root</span><span class="o">.</span><span class="n">get_device</span><span class="p">()</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">root_dir</span><span class="p">):</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>            <span class="k">raise</span> <span class="n">KiwiVolumeManagerSetupError</span><span class="p">(</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>                <span class="sa">f</span><span class="s1">&#39;given root directory </span><span class="si">{</span><span class="n">root_dir</span><span class="si">}</span><span class="s1"> does not exist&#39;</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>            <span class="p">)</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>        <span class="c1">#: custom arguments passed to setup the volumes</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">custom_args</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>        <span class="c1">#: custom filesystem creation and mount arguments, subset of the</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>        <span class="c1">#: custom_args information suitable to be passed to a</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>        <span class="c1">#: FileSystem instance</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">custom_filesystem_args</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>            <span class="s1">&#39;create_options&#39;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>            <span class="s1">&#39;mount_options&#39;</span><span class="p">:</span> <span class="p">[]</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>        <span class="p">}</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>        <span class="k">if</span> <span class="n">custom_args</span> <span class="ow">and</span> <span class="s1">&#39;fs_create_options&#39;</span> <span class="ow">in</span> <span class="n">custom_args</span><span class="p">:</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">custom_filesystem_args</span><span class="p">[</span><span class="s1">&#39;create_options&#39;</span><span class="p">]</span> <span class="o">=</span> \
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>                <span class="n">custom_args</span><span class="p">[</span><span class="s1">&#39;fs_create_options&#39;</span><span class="p">]</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>        <span class="k">if</span> <span class="n">custom_args</span> <span class="ow">and</span> <span class="s1">&#39;fs_mount_options&#39;</span> <span class="ow">in</span> <span class="n">custom_args</span><span class="p">:</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">custom_filesystem_args</span><span class="p">[</span><span class="s1">&#39;mount_options&#39;</span><span class="p">]</span> <span class="o">=</span> \
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>                <span class="n">custom_args</span><span class="p">[</span><span class="s1">&#39;fs_mount_options&#39;</span><span class="p">]</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>        <span class="k">if</span> <span class="n">custom_args</span> <span class="ow">and</span> <span class="s1">&#39;fs_create_options&#39;</span> <span class="ow">in</span> <span class="n">custom_args</span><span class="p">:</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">custom_filesystem_args</span><span class="p">[</span><span class="s1">&#39;create_options&#39;</span><span class="p">]</span> <span class="o">=</span> \
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>                <span class="n">custom_args</span><span class="p">[</span><span class="s1">&#39;fs_create_options&#39;</span><span class="p">]</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">post_init</span><span class="p">(</span><span class="n">custom_args</span><span class="p">)</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">post_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">custom_args</span><span class="p">):</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a><span class="sd">        Post initialization method</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a><span class="sd">        Implementation in specialized volume manager class if required</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a><span class="sd">        :param dict custom_args: unused</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>        <span class="k">pass</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a><span class="sd">        Implements setup required prior to the creation of volumes</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a><span class="sd">        Implementation in specialized volume manager class required</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a><span class="sd">        :param str name: unused</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filesystem_name</span><span class="p">):</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a><span class="sd">        Implements creation of volumes</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a><span class="sd">        Implementation in specialized volume manager class required</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a><span class="sd">        :param str filesystem_name: unused</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">apply_attributes_on_volume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">toplevel</span><span class="p">,</span> <span class="n">volume</span><span class="p">):</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>        <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">volume</span><span class="o">.</span><span class="n">attributes</span><span class="p">:</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>            <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s1">&#39;no-copy-on-write&#39;</span><span class="p">:</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>                    <span class="s1">&#39;--&gt; setting </span><span class="si">{0}</span><span class="s1"> for </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">volume</span><span class="o">.</span><span class="n">realpath</span><span class="p">)</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>                <span class="p">)</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>                <span class="n">Command</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>                    <span class="p">[</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>                        <span class="s1">&#39;chattr&#39;</span><span class="p">,</span> <span class="s1">&#39;+C&#39;</span><span class="p">,</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">toplevel</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">volume</span><span class="o">.</span><span class="n">realpath</span><span class="p">)</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>                    <span class="p">]</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>                <span class="p">)</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_fstab</span><span class="p">(</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">persistency_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filesystem_name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a><span class="sd">        Implements setup of the fstab entries. The method should</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a><span class="sd">        return a list of fstab compatible entries</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a><span class="sd">        :param str persistency_type: unused</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a><span class="sd">        :param str filesystem_name: unused</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a><span class="sd">        Implements return of dictionary of volumes and</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a><span class="sd">        their mount options</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">mount_volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a><span class="sd">        Implements mounting of all volumes below one master directory</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a><span class="sd">        Implementation in specialized volume manager class required</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">umount_volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a><span class="sd">        Implements umounting of all volumes</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a><span class="sd">        Implementation in specialized volume manager class required</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">umount</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a><span class="sd">        Consistency layer with regards to FileSystem classes</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a><span class="sd">        Invokes umount_volumes</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">umount_volumes</span><span class="p">()</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">mount</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a><span class="sd">        Consistency layer with regards to FileSystem classes</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a><span class="sd">        Invokes mount_volumes</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mount_volumes</span><span class="p">()</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a><span class="sd">        Check if storage provider is loop based</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a><span class="sd">        The information is taken from the storage provider. If</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a><span class="sd">        the storage provider is loop based the volume manager is it too</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a><span class="sd">        :return: True of False</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a><span class="sd">        :rtype: bool</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">device_provider_root</span><span class="o">.</span><span class="n">is_loop</span><span class="p">()</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_device</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a><span class="sd">        Return current DeviceProvider dictionary</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a><span class="sd">        :return: device_map</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a><span class="sd">        :rtype: dict</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">device_map</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_volume_paths_in_root_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a><span class="sd">        Implements creation of volume paths in the given root directory</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>        <span class="k">for</span> <span class="n">volume</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">volumes</span><span class="p">:</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>            <span class="k">if</span> <span class="n">volume</span><span class="o">.</span><span class="n">realpath</span> <span class="ow">and</span> <span class="n">volume</span><span class="o">.</span><span class="n">realpath</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;swap&#39;</span><span class="p">]:</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>                <span class="n">volume_image_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">root_dir</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">volume</span><span class="o">.</span><span class="n">realpath</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>                <span class="p">)</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">volume_image_path</span><span class="p">):</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>                    <span class="c1"># not existing volume paths will be created in the image</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>                    <span class="c1"># root directory. This happens hidden to the user but is</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>                    <span class="c1"># imho ok because the path is explicitly configured as a</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>                    <span class="c1"># volume</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>                    <span class="n">Path</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">volume_image_path</span><span class="p">)</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_canonical_volume_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a><span class="sd">        Implements hierarchical sorting of volumes according to their</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a><span class="sd">        paths and provides information about the volume configured as</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a><span class="sd">        the one eating all the rest space</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a><span class="sd">        :return: list of canonical_volume_type tuples</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a><span class="sd">        :rtype: list</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>        <span class="n">canonical_volume_type</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>            <span class="s1">&#39;canonical_volume_type&#39;</span><span class="p">,</span> <span class="p">[</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>                <span class="s1">&#39;volumes&#39;</span><span class="p">,</span> <span class="s1">&#39;full_size_volume&#39;</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>            <span class="p">]</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>        <span class="p">)</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>        <span class="n">volume_paths</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>        <span class="n">full_size_volume</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>        <span class="k">for</span> <span class="n">volume</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">volumes</span><span class="p">:</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>            <span class="k">if</span> <span class="n">volume</span><span class="o">.</span><span class="n">fullsize</span><span class="p">:</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>                <span class="n">full_size_volume</span> <span class="o">=</span> <span class="n">volume</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>            <span class="k">elif</span> <span class="n">volume</span><span class="o">.</span><span class="n">realpath</span><span class="p">:</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>                <span class="n">volume_paths</span><span class="p">[</span><span class="n">volume</span><span class="o">.</span><span class="n">realpath</span><span class="p">]</span> <span class="o">=</span> <span class="n">volume</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>        <span class="n">volume_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>        <span class="k">for</span> <span class="n">realpath</span> <span class="ow">in</span> <span class="n">Path</span><span class="o">.</span><span class="n">sort_by_hierarchy</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">volume_paths</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>            <span class="n">volume_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">volume_paths</span><span class="p">[</span><span class="n">realpath</span><span class="p">])</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>        <span class="k">return</span> <span class="n">canonical_volume_type</span><span class="p">(</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>            <span class="n">volumes</span><span class="o">=</span><span class="n">volume_list</span><span class="p">,</span> <span class="n">full_size_volume</span><span class="o">=</span><span class="n">full_size_volume</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>        <span class="p">)</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_volume_mbsize</span><span class="p">(</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">volume</span><span class="p">,</span> <span class="n">all_volumes</span><span class="p">,</span> <span class="n">filesystem_name</span><span class="p">,</span> <span class="n">resize_on_boot</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a><span class="sd">        Implements size lookup for the given path and desired</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a><span class="sd">        filesystem according to the specified size type</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a><span class="sd">        :param tuple volume: volume to check size for</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a><span class="sd">        :param list all_volumes: list of all volume tuples</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a><span class="sd">        :param str filesystem_name: filesystem name</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a><span class="sd">        :param resize_on_boot:</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a><span class="sd">            specify the time of the resize. If the resize happens at</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a><span class="sd">            boot time the volume size is only the minimum size to</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a><span class="sd">            just store the data. If the volume size is fixed and</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a><span class="sd">            does not change at boot time the returned size is the</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a><span class="sd">            requested size which can be greater than the minimum</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a><span class="sd">            needed size.</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a><span class="sd">        :return: mbsize</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a><span class="sd">        :rtype: int</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>        <span class="p">[</span><span class="n">size_type</span><span class="p">,</span> <span class="n">mbsize</span><span class="p">]</span> <span class="o">=</span> <span class="n">volume</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>        <span class="n">lookup_path</span> <span class="o">=</span> <span class="n">volume</span><span class="o">.</span><span class="n">realpath</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>        <span class="n">lookup_abspath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">root_dir</span><span class="p">,</span> <span class="n">lookup_path</span><span class="p">])</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>        <span class="p">)</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>        <span class="n">mbsize</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mbsize</span><span class="p">)</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>        <span class="k">if</span> <span class="n">resize_on_boot</span><span class="p">:</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>            <span class="c1"># If resize_on_boot is true, the disk is self expandable and</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>            <span class="c1"># will resize to the configured sizes on first boot</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>            <span class="c1"># Therefore the requested size is set to null and we add</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>            <span class="c1"># the required minimum size for just storing the data</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>            <span class="n">size_type</span> <span class="o">=</span> <span class="s1">&#39;freespace&#39;</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>            <span class="n">mbsize</span> <span class="o">=</span> <span class="n">Defaults</span><span class="o">.</span><span class="n">get_min_volume_mbytes</span><span class="p">(</span><span class="n">filesystem_name</span><span class="p">)</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>        <span class="k">if</span> <span class="n">size_type</span> <span class="o">==</span> <span class="s1">&#39;freespace&#39;</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">lookup_abspath</span><span class="p">):</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>            <span class="n">exclude_paths</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>            <span class="k">for</span> <span class="n">volume</span> <span class="ow">in</span> <span class="n">all_volumes</span><span class="p">:</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>                <span class="n">volume_path</span> <span class="o">=</span> <span class="n">volume</span><span class="o">.</span><span class="n">realpath</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>                <span class="k">if</span> <span class="n">lookup_path</span> <span class="o">==</span> <span class="n">volume_path</span><span class="p">:</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>                    <span class="k">continue</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>                <span class="k">if</span> <span class="n">lookup_path</span> <span class="o">==</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">:</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>                    <span class="c1"># exclude any sub volume path if lookup_path is /</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>                    <span class="n">exclude_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_dir</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">volume_path</span><span class="p">)</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>                    <span class="p">)</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>                <span class="k">elif</span> <span class="n">volume_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">lookup_path</span><span class="p">):</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>                    <span class="c1"># exclude any sub volume path below lookup_path</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>                    <span class="n">exclude_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_dir</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">volume_path</span><span class="p">)</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>                    <span class="p">)</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>            <span class="n">volume_size</span> <span class="o">=</span> <span class="n">SystemSize</span><span class="p">(</span><span class="n">lookup_abspath</span><span class="p">)</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>            <span class="k">if</span> <span class="n">mbsize</span> <span class="o">!=</span> <span class="n">Defaults</span><span class="o">.</span><span class="n">get_min_volume_mbytes</span><span class="p">(</span><span class="n">filesystem_name</span><span class="p">):</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>                <span class="n">mbsize</span> <span class="o">+=</span> <span class="n">Defaults</span><span class="o">.</span><span class="n">get_min_volume_mbytes</span><span class="p">(</span><span class="n">filesystem_name</span><span class="p">)</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>            <span class="n">mbsize</span> <span class="o">+=</span> <span class="n">volume_size</span><span class="o">.</span><span class="n">customize</span><span class="p">(</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>                <span class="n">volume_size</span><span class="o">.</span><span class="n">accumulate_mbyte_file_sizes</span><span class="p">(</span><span class="n">exclude_paths</span><span class="p">),</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>                <span class="n">filesystem_name</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>            <span class="p">)</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>        <span class="k">return</span> <span class="n">mbsize</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_mountpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a><span class="sd">        Provides mount point directory</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a><span class="sd">        Effective use of the directory is guaranteed only after sync_data</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a><span class="sd">        :return: directory path name</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a><span class="sd">        :rtype: string</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mountpoint</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_root_volume_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a><span class="sd">        Provides name of the root volume</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a><span class="sd">        This is by default set to &#39;/&#39;. Volume Managers that supports</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a><span class="sd">        the concept of sub-volumes overrides this method</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a><span class="sd">        :return: directory path name</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a><span class="sd">        :rtype: string</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>        <span class="k">return</span> <span class="s1">&#39;/&#39;</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">sync_data</span><span class="p">(</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">MountManager</span><span class="p">]:</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a><span class="sd">        Implements sync of root directory to mounted volumes</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a><span class="sd">        :param list exclude: file patterns to exclude</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a><span class="sd">        :return: If a mount was created, then a context manager implementing the</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a><span class="sd">            unmount is returned.</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mountpoint</span><span class="p">:</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>        <span class="n">root_mount</span> <span class="o">=</span> <span class="n">MountManager</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">mountpoint</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mountpoint</span><span class="p">)</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">root_mount</span><span class="o">.</span><span class="n">is_mounted</span><span class="p">():</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mount_volumes</span><span class="p">()</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">DataSync</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mountpoint</span><span class="p">)</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>        <span class="n">data</span><span class="o">.</span><span class="n">sync_data</span><span class="p">(</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>            <span class="n">options</span><span class="o">=</span><span class="n">Defaults</span><span class="o">.</span><span class="n">get_sync_options</span><span class="p">(),</span> <span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span> <span class="ow">or</span> <span class="p">[]</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>        <span class="p">)</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>        <span class="k">return</span> <span class="n">root_mount</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_verity_layer</span><span class="p">(</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">blocks</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>    <span class="p">):</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a><span class="sd">        veritysetup on LVM devices is not supported</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_verification_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device_node</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a><span class="sd">        Write verification block on LVM devices is not supported</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_property_readonly_root</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a><span class="sd">        Implements setup of read-only root property</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>        <span class="k">raise</span> <span class="n">KiwiVolumeManagerSetupError</span><span class="p">(</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>            <span class="s1">&#39;read only property not supported&#39;</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>        <span class="p">)</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">setup_mountpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a><span class="sd">        Implements creation of a master directory holding</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a><span class="sd">        the mounts of all volumes</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mountpoint_tempdir</span> <span class="o">=</span> <span class="n">Temporary</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;kiwi_volumes.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">new_dir</span><span class="p">()</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mountpoint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mountpoint_tempdir</span><span class="o">.</span><span class="n">name</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">temp_directories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mountpoint_tempdir</span><span class="p">)</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>        <span class="k">pass</span>
</span></pre></div>


            </section>
                <section id="log">
                    <div class="attr variable">
            <span class="name">log</span>        =
<span class="default_value">&lt;Logger kiwi (DEBUG)&gt;</span>

        
    </div>
    <a class="headerlink" href="#log"></a>
    
    

                </section>
                <section id="VolumeManagerBase">
                            <input id="VolumeManagerBase-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">VolumeManagerBase</span><wbr>(<span class="base"><a href="../storage/device_provider.html#DeviceProvider">kiwi.storage.device_provider.DeviceProvider</a></span>):

                <label class="view-source-button" for="VolumeManagerBase-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#VolumeManagerBase"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="VolumeManagerBase-42"><a href="#VolumeManagerBase-42"><span class="linenos"> 42</span></a><span class="k">class</span><span class="w"> </span><span class="nc">VolumeManagerBase</span><span class="p">(</span><span class="n">DeviceProvider</span><span class="p">):</span>
</span><span id="VolumeManagerBase-43"><a href="#VolumeManagerBase-43"><span class="linenos"> 43</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase-44"><a href="#VolumeManagerBase-44"><span class="linenos"> 44</span></a><span class="sd">    **Implements base class for volume management interface**</span>
</span><span id="VolumeManagerBase-45"><a href="#VolumeManagerBase-45"><span class="linenos"> 45</span></a>
</span><span id="VolumeManagerBase-46"><a href="#VolumeManagerBase-46"><span class="linenos"> 46</span></a><span class="sd">    :param object device_map:</span>
</span><span id="VolumeManagerBase-47"><a href="#VolumeManagerBase-47"><span class="linenos"> 47</span></a><span class="sd">        dictionary of low level DeviceProvider intances</span>
</span><span id="VolumeManagerBase-48"><a href="#VolumeManagerBase-48"><span class="linenos"> 48</span></a><span class="sd">    :param str root_dir: root directory path name</span>
</span><span id="VolumeManagerBase-49"><a href="#VolumeManagerBase-49"><span class="linenos"> 49</span></a><span class="sd">    :param list volumes: list of volumes from :class:`XMLState::get_volumes()`</span>
</span><span id="VolumeManagerBase-50"><a href="#VolumeManagerBase-50"><span class="linenos"> 50</span></a><span class="sd">    :param dict custom_args: custom volume manager arguments for all</span>
</span><span id="VolumeManagerBase-51"><a href="#VolumeManagerBase-51"><span class="linenos"> 51</span></a><span class="sd">        volume manager and filesystem specific tasks</span>
</span><span id="VolumeManagerBase-52"><a href="#VolumeManagerBase-52"><span class="linenos"> 52</span></a>
</span><span id="VolumeManagerBase-53"><a href="#VolumeManagerBase-53"><span class="linenos"> 53</span></a><span class="sd">    :raises KiwiVolumeManagerSetupError: if the given root_dir doesn&#39;t exist</span>
</span><span id="VolumeManagerBase-54"><a href="#VolumeManagerBase-54"><span class="linenos"> 54</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase-55"><a href="#VolumeManagerBase-55"><span class="linenos"> 55</span></a>
</span><span id="VolumeManagerBase-56"><a href="#VolumeManagerBase-56"><span class="linenos"> 56</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="VolumeManagerBase-57"><a href="#VolumeManagerBase-57"><span class="linenos"> 57</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="VolumeManagerBase-58"><a href="#VolumeManagerBase-58"><span class="linenos"> 58</span></a>        <span class="n">device_map</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DeviceProvider</span><span class="p">],</span>
</span><span id="VolumeManagerBase-59"><a href="#VolumeManagerBase-59"><span class="linenos"> 59</span></a>        <span class="n">root_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="VolumeManagerBase-60"><a href="#VolumeManagerBase-60"><span class="linenos"> 60</span></a>        <span class="n">volumes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">volume_type</span><span class="p">],</span>
</span><span id="VolumeManagerBase-61"><a href="#VolumeManagerBase-61"><span class="linenos"> 61</span></a>        <span class="n">custom_args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="VolumeManagerBase-62"><a href="#VolumeManagerBase-62"><span class="linenos"> 62</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="VolumeManagerBase-63"><a href="#VolumeManagerBase-63"><span class="linenos"> 63</span></a>
</span><span id="VolumeManagerBase-64"><a href="#VolumeManagerBase-64"><span class="linenos"> 64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">temp_directories</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Temporary</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="VolumeManagerBase-65"><a href="#VolumeManagerBase-65"><span class="linenos"> 65</span></a>        <span class="c1">#: all volumes are combined into one mountpoint. This is</span>
</span><span id="VolumeManagerBase-66"><a href="#VolumeManagerBase-66"><span class="linenos"> 66</span></a>        <span class="c1">#: needed at sync_data time. How to mount the volumes is</span>
</span><span id="VolumeManagerBase-67"><a href="#VolumeManagerBase-67"><span class="linenos"> 67</span></a>        <span class="c1">#: special to the volume management class</span>
</span><span id="VolumeManagerBase-68"><a href="#VolumeManagerBase-68"><span class="linenos"> 68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mountpoint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="VolumeManagerBase-69"><a href="#VolumeManagerBase-69"><span class="linenos"> 69</span></a>
</span><span id="VolumeManagerBase-70"><a href="#VolumeManagerBase-70"><span class="linenos"> 70</span></a>        <span class="c1">#: dictionary of mapped DeviceProviders</span>
</span><span id="VolumeManagerBase-71"><a href="#VolumeManagerBase-71"><span class="linenos"> 71</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device_map</span> <span class="o">=</span> <span class="n">device_map</span>
</span><span id="VolumeManagerBase-72"><a href="#VolumeManagerBase-72"><span class="linenos"> 72</span></a>
</span><span id="VolumeManagerBase-73"><a href="#VolumeManagerBase-73"><span class="linenos"> 73</span></a>        <span class="c1">#: the underlaying device provider</span>
</span><span id="VolumeManagerBase-74"><a href="#VolumeManagerBase-74"><span class="linenos"> 74</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device_provider_root</span> <span class="o">=</span> <span class="n">device_map</span><span class="p">[</span><span class="s1">&#39;root&#39;</span><span class="p">]</span>
</span><span id="VolumeManagerBase-75"><a href="#VolumeManagerBase-75"><span class="linenos"> 75</span></a>
</span><span id="VolumeManagerBase-76"><a href="#VolumeManagerBase-76"><span class="linenos"> 76</span></a>        <span class="c1">#: root directory path name</span>
</span><span id="VolumeManagerBase-77"><a href="#VolumeManagerBase-77"><span class="linenos"> 77</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">root_dir</span> <span class="o">=</span> <span class="n">root_dir</span>
</span><span id="VolumeManagerBase-78"><a href="#VolumeManagerBase-78"><span class="linenos"> 78</span></a>        <span class="c1">#: list of volumes from :class:`XMLState::get_volumes()`</span>
</span><span id="VolumeManagerBase-79"><a href="#VolumeManagerBase-79"><span class="linenos"> 79</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">volumes</span> <span class="o">=</span> <span class="n">volumes</span>
</span><span id="VolumeManagerBase-80"><a href="#VolumeManagerBase-80"><span class="linenos"> 80</span></a>        <span class="c1">#: volume group name</span>
</span><span id="VolumeManagerBase-81"><a href="#VolumeManagerBase-81"><span class="linenos"> 81</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">volume_group</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="VolumeManagerBase-82"><a href="#VolumeManagerBase-82"><span class="linenos"> 82</span></a>        <span class="c1">#: map volume name to device node</span>
</span><span id="VolumeManagerBase-83"><a href="#VolumeManagerBase-83"><span class="linenos"> 83</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">volume_map</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="VolumeManagerBase-84"><a href="#VolumeManagerBase-84"><span class="linenos"> 84</span></a>        <span class="c1">#: list of volume MountManager&#39;s</span>
</span><span id="VolumeManagerBase-85"><a href="#VolumeManagerBase-85"><span class="linenos"> 85</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mount_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">MountManager</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="VolumeManagerBase-86"><a href="#VolumeManagerBase-86"><span class="linenos"> 86</span></a>
</span><span id="VolumeManagerBase-87"><a href="#VolumeManagerBase-87"><span class="linenos"> 87</span></a>        <span class="c1">#: main storage device node name</span>
</span><span id="VolumeManagerBase-88"><a href="#VolumeManagerBase-88"><span class="linenos"> 88</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device_provider_root</span><span class="o">.</span><span class="n">get_device</span><span class="p">()</span>
</span><span id="VolumeManagerBase-89"><a href="#VolumeManagerBase-89"><span class="linenos"> 89</span></a>
</span><span id="VolumeManagerBase-90"><a href="#VolumeManagerBase-90"><span class="linenos"> 90</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">root_dir</span><span class="p">):</span>
</span><span id="VolumeManagerBase-91"><a href="#VolumeManagerBase-91"><span class="linenos"> 91</span></a>            <span class="k">raise</span> <span class="n">KiwiVolumeManagerSetupError</span><span class="p">(</span>
</span><span id="VolumeManagerBase-92"><a href="#VolumeManagerBase-92"><span class="linenos"> 92</span></a>                <span class="sa">f</span><span class="s1">&#39;given root directory </span><span class="si">{</span><span class="n">root_dir</span><span class="si">}</span><span class="s1"> does not exist&#39;</span>
</span><span id="VolumeManagerBase-93"><a href="#VolumeManagerBase-93"><span class="linenos"> 93</span></a>            <span class="p">)</span>
</span><span id="VolumeManagerBase-94"><a href="#VolumeManagerBase-94"><span class="linenos"> 94</span></a>
</span><span id="VolumeManagerBase-95"><a href="#VolumeManagerBase-95"><span class="linenos"> 95</span></a>        <span class="c1">#: custom arguments passed to setup the volumes</span>
</span><span id="VolumeManagerBase-96"><a href="#VolumeManagerBase-96"><span class="linenos"> 96</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">custom_args</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="VolumeManagerBase-97"><a href="#VolumeManagerBase-97"><span class="linenos"> 97</span></a>
</span><span id="VolumeManagerBase-98"><a href="#VolumeManagerBase-98"><span class="linenos"> 98</span></a>        <span class="c1">#: custom filesystem creation and mount arguments, subset of the</span>
</span><span id="VolumeManagerBase-99"><a href="#VolumeManagerBase-99"><span class="linenos"> 99</span></a>        <span class="c1">#: custom_args information suitable to be passed to a</span>
</span><span id="VolumeManagerBase-100"><a href="#VolumeManagerBase-100"><span class="linenos">100</span></a>        <span class="c1">#: FileSystem instance</span>
</span><span id="VolumeManagerBase-101"><a href="#VolumeManagerBase-101"><span class="linenos">101</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">custom_filesystem_args</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="VolumeManagerBase-102"><a href="#VolumeManagerBase-102"><span class="linenos">102</span></a>            <span class="s1">&#39;create_options&#39;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="VolumeManagerBase-103"><a href="#VolumeManagerBase-103"><span class="linenos">103</span></a>            <span class="s1">&#39;mount_options&#39;</span><span class="p">:</span> <span class="p">[]</span>
</span><span id="VolumeManagerBase-104"><a href="#VolumeManagerBase-104"><span class="linenos">104</span></a>        <span class="p">}</span>
</span><span id="VolumeManagerBase-105"><a href="#VolumeManagerBase-105"><span class="linenos">105</span></a>
</span><span id="VolumeManagerBase-106"><a href="#VolumeManagerBase-106"><span class="linenos">106</span></a>        <span class="k">if</span> <span class="n">custom_args</span> <span class="ow">and</span> <span class="s1">&#39;fs_create_options&#39;</span> <span class="ow">in</span> <span class="n">custom_args</span><span class="p">:</span>
</span><span id="VolumeManagerBase-107"><a href="#VolumeManagerBase-107"><span class="linenos">107</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">custom_filesystem_args</span><span class="p">[</span><span class="s1">&#39;create_options&#39;</span><span class="p">]</span> <span class="o">=</span> \
</span><span id="VolumeManagerBase-108"><a href="#VolumeManagerBase-108"><span class="linenos">108</span></a>                <span class="n">custom_args</span><span class="p">[</span><span class="s1">&#39;fs_create_options&#39;</span><span class="p">]</span>
</span><span id="VolumeManagerBase-109"><a href="#VolumeManagerBase-109"><span class="linenos">109</span></a>
</span><span id="VolumeManagerBase-110"><a href="#VolumeManagerBase-110"><span class="linenos">110</span></a>        <span class="k">if</span> <span class="n">custom_args</span> <span class="ow">and</span> <span class="s1">&#39;fs_mount_options&#39;</span> <span class="ow">in</span> <span class="n">custom_args</span><span class="p">:</span>
</span><span id="VolumeManagerBase-111"><a href="#VolumeManagerBase-111"><span class="linenos">111</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">custom_filesystem_args</span><span class="p">[</span><span class="s1">&#39;mount_options&#39;</span><span class="p">]</span> <span class="o">=</span> \
</span><span id="VolumeManagerBase-112"><a href="#VolumeManagerBase-112"><span class="linenos">112</span></a>                <span class="n">custom_args</span><span class="p">[</span><span class="s1">&#39;fs_mount_options&#39;</span><span class="p">]</span>
</span><span id="VolumeManagerBase-113"><a href="#VolumeManagerBase-113"><span class="linenos">113</span></a>
</span><span id="VolumeManagerBase-114"><a href="#VolumeManagerBase-114"><span class="linenos">114</span></a>        <span class="k">if</span> <span class="n">custom_args</span> <span class="ow">and</span> <span class="s1">&#39;fs_create_options&#39;</span> <span class="ow">in</span> <span class="n">custom_args</span><span class="p">:</span>
</span><span id="VolumeManagerBase-115"><a href="#VolumeManagerBase-115"><span class="linenos">115</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">custom_filesystem_args</span><span class="p">[</span><span class="s1">&#39;create_options&#39;</span><span class="p">]</span> <span class="o">=</span> \
</span><span id="VolumeManagerBase-116"><a href="#VolumeManagerBase-116"><span class="linenos">116</span></a>                <span class="n">custom_args</span><span class="p">[</span><span class="s1">&#39;fs_create_options&#39;</span><span class="p">]</span>
</span><span id="VolumeManagerBase-117"><a href="#VolumeManagerBase-117"><span class="linenos">117</span></a>
</span><span id="VolumeManagerBase-118"><a href="#VolumeManagerBase-118"><span class="linenos">118</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">post_init</span><span class="p">(</span><span class="n">custom_args</span><span class="p">)</span>
</span><span id="VolumeManagerBase-119"><a href="#VolumeManagerBase-119"><span class="linenos">119</span></a>
</span><span id="VolumeManagerBase-120"><a href="#VolumeManagerBase-120"><span class="linenos">120</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="VolumeManagerBase-121"><a href="#VolumeManagerBase-121"><span class="linenos">121</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="VolumeManagerBase-122"><a href="#VolumeManagerBase-122"><span class="linenos">122</span></a>
</span><span id="VolumeManagerBase-123"><a href="#VolumeManagerBase-123"><span class="linenos">123</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">post_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">custom_args</span><span class="p">):</span>
</span><span id="VolumeManagerBase-124"><a href="#VolumeManagerBase-124"><span class="linenos">124</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase-125"><a href="#VolumeManagerBase-125"><span class="linenos">125</span></a><span class="sd">        Post initialization method</span>
</span><span id="VolumeManagerBase-126"><a href="#VolumeManagerBase-126"><span class="linenos">126</span></a>
</span><span id="VolumeManagerBase-127"><a href="#VolumeManagerBase-127"><span class="linenos">127</span></a><span class="sd">        Implementation in specialized volume manager class if required</span>
</span><span id="VolumeManagerBase-128"><a href="#VolumeManagerBase-128"><span class="linenos">128</span></a>
</span><span id="VolumeManagerBase-129"><a href="#VolumeManagerBase-129"><span class="linenos">129</span></a><span class="sd">        :param dict custom_args: unused</span>
</span><span id="VolumeManagerBase-130"><a href="#VolumeManagerBase-130"><span class="linenos">130</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase-131"><a href="#VolumeManagerBase-131"><span class="linenos">131</span></a>        <span class="k">pass</span>
</span><span id="VolumeManagerBase-132"><a href="#VolumeManagerBase-132"><span class="linenos">132</span></a>
</span><span id="VolumeManagerBase-133"><a href="#VolumeManagerBase-133"><span class="linenos">133</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="VolumeManagerBase-134"><a href="#VolumeManagerBase-134"><span class="linenos">134</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase-135"><a href="#VolumeManagerBase-135"><span class="linenos">135</span></a><span class="sd">        Implements setup required prior to the creation of volumes</span>
</span><span id="VolumeManagerBase-136"><a href="#VolumeManagerBase-136"><span class="linenos">136</span></a>
</span><span id="VolumeManagerBase-137"><a href="#VolumeManagerBase-137"><span class="linenos">137</span></a><span class="sd">        Implementation in specialized volume manager class required</span>
</span><span id="VolumeManagerBase-138"><a href="#VolumeManagerBase-138"><span class="linenos">138</span></a>
</span><span id="VolumeManagerBase-139"><a href="#VolumeManagerBase-139"><span class="linenos">139</span></a><span class="sd">        :param str name: unused</span>
</span><span id="VolumeManagerBase-140"><a href="#VolumeManagerBase-140"><span class="linenos">140</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase-141"><a href="#VolumeManagerBase-141"><span class="linenos">141</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="VolumeManagerBase-142"><a href="#VolumeManagerBase-142"><span class="linenos">142</span></a>
</span><span id="VolumeManagerBase-143"><a href="#VolumeManagerBase-143"><span class="linenos">143</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filesystem_name</span><span class="p">):</span>
</span><span id="VolumeManagerBase-144"><a href="#VolumeManagerBase-144"><span class="linenos">144</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase-145"><a href="#VolumeManagerBase-145"><span class="linenos">145</span></a><span class="sd">        Implements creation of volumes</span>
</span><span id="VolumeManagerBase-146"><a href="#VolumeManagerBase-146"><span class="linenos">146</span></a>
</span><span id="VolumeManagerBase-147"><a href="#VolumeManagerBase-147"><span class="linenos">147</span></a><span class="sd">        Implementation in specialized volume manager class required</span>
</span><span id="VolumeManagerBase-148"><a href="#VolumeManagerBase-148"><span class="linenos">148</span></a>
</span><span id="VolumeManagerBase-149"><a href="#VolumeManagerBase-149"><span class="linenos">149</span></a><span class="sd">        :param str filesystem_name: unused</span>
</span><span id="VolumeManagerBase-150"><a href="#VolumeManagerBase-150"><span class="linenos">150</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase-151"><a href="#VolumeManagerBase-151"><span class="linenos">151</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="VolumeManagerBase-152"><a href="#VolumeManagerBase-152"><span class="linenos">152</span></a>
</span><span id="VolumeManagerBase-153"><a href="#VolumeManagerBase-153"><span class="linenos">153</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">apply_attributes_on_volume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">toplevel</span><span class="p">,</span> <span class="n">volume</span><span class="p">):</span>
</span><span id="VolumeManagerBase-154"><a href="#VolumeManagerBase-154"><span class="linenos">154</span></a>        <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">volume</span><span class="o">.</span><span class="n">attributes</span><span class="p">:</span>
</span><span id="VolumeManagerBase-155"><a href="#VolumeManagerBase-155"><span class="linenos">155</span></a>            <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s1">&#39;no-copy-on-write&#39;</span><span class="p">:</span>
</span><span id="VolumeManagerBase-156"><a href="#VolumeManagerBase-156"><span class="linenos">156</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="VolumeManagerBase-157"><a href="#VolumeManagerBase-157"><span class="linenos">157</span></a>                    <span class="s1">&#39;--&gt; setting </span><span class="si">{0}</span><span class="s1"> for </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">volume</span><span class="o">.</span><span class="n">realpath</span><span class="p">)</span>
</span><span id="VolumeManagerBase-158"><a href="#VolumeManagerBase-158"><span class="linenos">158</span></a>                <span class="p">)</span>
</span><span id="VolumeManagerBase-159"><a href="#VolumeManagerBase-159"><span class="linenos">159</span></a>                <span class="n">Command</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
</span><span id="VolumeManagerBase-160"><a href="#VolumeManagerBase-160"><span class="linenos">160</span></a>                    <span class="p">[</span>
</span><span id="VolumeManagerBase-161"><a href="#VolumeManagerBase-161"><span class="linenos">161</span></a>                        <span class="s1">&#39;chattr&#39;</span><span class="p">,</span> <span class="s1">&#39;+C&#39;</span><span class="p">,</span>
</span><span id="VolumeManagerBase-162"><a href="#VolumeManagerBase-162"><span class="linenos">162</span></a>                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">toplevel</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">volume</span><span class="o">.</span><span class="n">realpath</span><span class="p">)</span>
</span><span id="VolumeManagerBase-163"><a href="#VolumeManagerBase-163"><span class="linenos">163</span></a>                    <span class="p">]</span>
</span><span id="VolumeManagerBase-164"><a href="#VolumeManagerBase-164"><span class="linenos">164</span></a>                <span class="p">)</span>
</span><span id="VolumeManagerBase-165"><a href="#VolumeManagerBase-165"><span class="linenos">165</span></a>
</span><span id="VolumeManagerBase-166"><a href="#VolumeManagerBase-166"><span class="linenos">166</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_fstab</span><span class="p">(</span>
</span><span id="VolumeManagerBase-167"><a href="#VolumeManagerBase-167"><span class="linenos">167</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">persistency_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filesystem_name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="VolumeManagerBase-168"><a href="#VolumeManagerBase-168"><span class="linenos">168</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="VolumeManagerBase-169"><a href="#VolumeManagerBase-169"><span class="linenos">169</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase-170"><a href="#VolumeManagerBase-170"><span class="linenos">170</span></a><span class="sd">        Implements setup of the fstab entries. The method should</span>
</span><span id="VolumeManagerBase-171"><a href="#VolumeManagerBase-171"><span class="linenos">171</span></a><span class="sd">        return a list of fstab compatible entries</span>
</span><span id="VolumeManagerBase-172"><a href="#VolumeManagerBase-172"><span class="linenos">172</span></a>
</span><span id="VolumeManagerBase-173"><a href="#VolumeManagerBase-173"><span class="linenos">173</span></a><span class="sd">        :param str persistency_type: unused</span>
</span><span id="VolumeManagerBase-174"><a href="#VolumeManagerBase-174"><span class="linenos">174</span></a><span class="sd">        :param str filesystem_name: unused</span>
</span><span id="VolumeManagerBase-175"><a href="#VolumeManagerBase-175"><span class="linenos">175</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase-176"><a href="#VolumeManagerBase-176"><span class="linenos">176</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="VolumeManagerBase-177"><a href="#VolumeManagerBase-177"><span class="linenos">177</span></a>
</span><span id="VolumeManagerBase-178"><a href="#VolumeManagerBase-178"><span class="linenos">178</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="VolumeManagerBase-179"><a href="#VolumeManagerBase-179"><span class="linenos">179</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase-180"><a href="#VolumeManagerBase-180"><span class="linenos">180</span></a><span class="sd">        Implements return of dictionary of volumes and</span>
</span><span id="VolumeManagerBase-181"><a href="#VolumeManagerBase-181"><span class="linenos">181</span></a><span class="sd">        their mount options</span>
</span><span id="VolumeManagerBase-182"><a href="#VolumeManagerBase-182"><span class="linenos">182</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase-183"><a href="#VolumeManagerBase-183"><span class="linenos">183</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="VolumeManagerBase-184"><a href="#VolumeManagerBase-184"><span class="linenos">184</span></a>
</span><span id="VolumeManagerBase-185"><a href="#VolumeManagerBase-185"><span class="linenos">185</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">mount_volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="VolumeManagerBase-186"><a href="#VolumeManagerBase-186"><span class="linenos">186</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase-187"><a href="#VolumeManagerBase-187"><span class="linenos">187</span></a><span class="sd">        Implements mounting of all volumes below one master directory</span>
</span><span id="VolumeManagerBase-188"><a href="#VolumeManagerBase-188"><span class="linenos">188</span></a>
</span><span id="VolumeManagerBase-189"><a href="#VolumeManagerBase-189"><span class="linenos">189</span></a><span class="sd">        Implementation in specialized volume manager class required</span>
</span><span id="VolumeManagerBase-190"><a href="#VolumeManagerBase-190"><span class="linenos">190</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase-191"><a href="#VolumeManagerBase-191"><span class="linenos">191</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="VolumeManagerBase-192"><a href="#VolumeManagerBase-192"><span class="linenos">192</span></a>
</span><span id="VolumeManagerBase-193"><a href="#VolumeManagerBase-193"><span class="linenos">193</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">umount_volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="VolumeManagerBase-194"><a href="#VolumeManagerBase-194"><span class="linenos">194</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase-195"><a href="#VolumeManagerBase-195"><span class="linenos">195</span></a><span class="sd">        Implements umounting of all volumes</span>
</span><span id="VolumeManagerBase-196"><a href="#VolumeManagerBase-196"><span class="linenos">196</span></a>
</span><span id="VolumeManagerBase-197"><a href="#VolumeManagerBase-197"><span class="linenos">197</span></a><span class="sd">        Implementation in specialized volume manager class required</span>
</span><span id="VolumeManagerBase-198"><a href="#VolumeManagerBase-198"><span class="linenos">198</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase-199"><a href="#VolumeManagerBase-199"><span class="linenos">199</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="VolumeManagerBase-200"><a href="#VolumeManagerBase-200"><span class="linenos">200</span></a>
</span><span id="VolumeManagerBase-201"><a href="#VolumeManagerBase-201"><span class="linenos">201</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">umount</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="VolumeManagerBase-202"><a href="#VolumeManagerBase-202"><span class="linenos">202</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase-203"><a href="#VolumeManagerBase-203"><span class="linenos">203</span></a><span class="sd">        Consistency layer with regards to FileSystem classes</span>
</span><span id="VolumeManagerBase-204"><a href="#VolumeManagerBase-204"><span class="linenos">204</span></a>
</span><span id="VolumeManagerBase-205"><a href="#VolumeManagerBase-205"><span class="linenos">205</span></a><span class="sd">        Invokes umount_volumes</span>
</span><span id="VolumeManagerBase-206"><a href="#VolumeManagerBase-206"><span class="linenos">206</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase-207"><a href="#VolumeManagerBase-207"><span class="linenos">207</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">umount_volumes</span><span class="p">()</span>
</span><span id="VolumeManagerBase-208"><a href="#VolumeManagerBase-208"><span class="linenos">208</span></a>
</span><span id="VolumeManagerBase-209"><a href="#VolumeManagerBase-209"><span class="linenos">209</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">mount</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="VolumeManagerBase-210"><a href="#VolumeManagerBase-210"><span class="linenos">210</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase-211"><a href="#VolumeManagerBase-211"><span class="linenos">211</span></a><span class="sd">        Consistency layer with regards to FileSystem classes</span>
</span><span id="VolumeManagerBase-212"><a href="#VolumeManagerBase-212"><span class="linenos">212</span></a>
</span><span id="VolumeManagerBase-213"><a href="#VolumeManagerBase-213"><span class="linenos">213</span></a><span class="sd">        Invokes mount_volumes</span>
</span><span id="VolumeManagerBase-214"><a href="#VolumeManagerBase-214"><span class="linenos">214</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase-215"><a href="#VolumeManagerBase-215"><span class="linenos">215</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mount_volumes</span><span class="p">()</span>
</span><span id="VolumeManagerBase-216"><a href="#VolumeManagerBase-216"><span class="linenos">216</span></a>
</span><span id="VolumeManagerBase-217"><a href="#VolumeManagerBase-217"><span class="linenos">217</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="VolumeManagerBase-218"><a href="#VolumeManagerBase-218"><span class="linenos">218</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase-219"><a href="#VolumeManagerBase-219"><span class="linenos">219</span></a><span class="sd">        Check if storage provider is loop based</span>
</span><span id="VolumeManagerBase-220"><a href="#VolumeManagerBase-220"><span class="linenos">220</span></a>
</span><span id="VolumeManagerBase-221"><a href="#VolumeManagerBase-221"><span class="linenos">221</span></a><span class="sd">        The information is taken from the storage provider. If</span>
</span><span id="VolumeManagerBase-222"><a href="#VolumeManagerBase-222"><span class="linenos">222</span></a><span class="sd">        the storage provider is loop based the volume manager is it too</span>
</span><span id="VolumeManagerBase-223"><a href="#VolumeManagerBase-223"><span class="linenos">223</span></a>
</span><span id="VolumeManagerBase-224"><a href="#VolumeManagerBase-224"><span class="linenos">224</span></a><span class="sd">        :return: True of False</span>
</span><span id="VolumeManagerBase-225"><a href="#VolumeManagerBase-225"><span class="linenos">225</span></a>
</span><span id="VolumeManagerBase-226"><a href="#VolumeManagerBase-226"><span class="linenos">226</span></a><span class="sd">        :rtype: bool</span>
</span><span id="VolumeManagerBase-227"><a href="#VolumeManagerBase-227"><span class="linenos">227</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase-228"><a href="#VolumeManagerBase-228"><span class="linenos">228</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">device_provider_root</span><span class="o">.</span><span class="n">is_loop</span><span class="p">()</span>
</span><span id="VolumeManagerBase-229"><a href="#VolumeManagerBase-229"><span class="linenos">229</span></a>
</span><span id="VolumeManagerBase-230"><a href="#VolumeManagerBase-230"><span class="linenos">230</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_device</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="VolumeManagerBase-231"><a href="#VolumeManagerBase-231"><span class="linenos">231</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase-232"><a href="#VolumeManagerBase-232"><span class="linenos">232</span></a><span class="sd">        Return current DeviceProvider dictionary</span>
</span><span id="VolumeManagerBase-233"><a href="#VolumeManagerBase-233"><span class="linenos">233</span></a>
</span><span id="VolumeManagerBase-234"><a href="#VolumeManagerBase-234"><span class="linenos">234</span></a><span class="sd">        :return: device_map</span>
</span><span id="VolumeManagerBase-235"><a href="#VolumeManagerBase-235"><span class="linenos">235</span></a>
</span><span id="VolumeManagerBase-236"><a href="#VolumeManagerBase-236"><span class="linenos">236</span></a><span class="sd">        :rtype: dict</span>
</span><span id="VolumeManagerBase-237"><a href="#VolumeManagerBase-237"><span class="linenos">237</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase-238"><a href="#VolumeManagerBase-238"><span class="linenos">238</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">device_map</span>
</span><span id="VolumeManagerBase-239"><a href="#VolumeManagerBase-239"><span class="linenos">239</span></a>
</span><span id="VolumeManagerBase-240"><a href="#VolumeManagerBase-240"><span class="linenos">240</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_volume_paths_in_root_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="VolumeManagerBase-241"><a href="#VolumeManagerBase-241"><span class="linenos">241</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase-242"><a href="#VolumeManagerBase-242"><span class="linenos">242</span></a><span class="sd">        Implements creation of volume paths in the given root directory</span>
</span><span id="VolumeManagerBase-243"><a href="#VolumeManagerBase-243"><span class="linenos">243</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase-244"><a href="#VolumeManagerBase-244"><span class="linenos">244</span></a>        <span class="k">for</span> <span class="n">volume</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">volumes</span><span class="p">:</span>
</span><span id="VolumeManagerBase-245"><a href="#VolumeManagerBase-245"><span class="linenos">245</span></a>            <span class="k">if</span> <span class="n">volume</span><span class="o">.</span><span class="n">realpath</span> <span class="ow">and</span> <span class="n">volume</span><span class="o">.</span><span class="n">realpath</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;swap&#39;</span><span class="p">]:</span>
</span><span id="VolumeManagerBase-246"><a href="#VolumeManagerBase-246"><span class="linenos">246</span></a>                <span class="n">volume_image_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span>
</span><span id="VolumeManagerBase-247"><a href="#VolumeManagerBase-247"><span class="linenos">247</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">root_dir</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">volume</span><span class="o">.</span><span class="n">realpath</span>
</span><span id="VolumeManagerBase-248"><a href="#VolumeManagerBase-248"><span class="linenos">248</span></a>                <span class="p">)</span>
</span><span id="VolumeManagerBase-249"><a href="#VolumeManagerBase-249"><span class="linenos">249</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">volume_image_path</span><span class="p">):</span>
</span><span id="VolumeManagerBase-250"><a href="#VolumeManagerBase-250"><span class="linenos">250</span></a>                    <span class="c1"># not existing volume paths will be created in the image</span>
</span><span id="VolumeManagerBase-251"><a href="#VolumeManagerBase-251"><span class="linenos">251</span></a>                    <span class="c1"># root directory. This happens hidden to the user but is</span>
</span><span id="VolumeManagerBase-252"><a href="#VolumeManagerBase-252"><span class="linenos">252</span></a>                    <span class="c1"># imho ok because the path is explicitly configured as a</span>
</span><span id="VolumeManagerBase-253"><a href="#VolumeManagerBase-253"><span class="linenos">253</span></a>                    <span class="c1"># volume</span>
</span><span id="VolumeManagerBase-254"><a href="#VolumeManagerBase-254"><span class="linenos">254</span></a>                    <span class="n">Path</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">volume_image_path</span><span class="p">)</span>
</span><span id="VolumeManagerBase-255"><a href="#VolumeManagerBase-255"><span class="linenos">255</span></a>
</span><span id="VolumeManagerBase-256"><a href="#VolumeManagerBase-256"><span class="linenos">256</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_canonical_volume_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="VolumeManagerBase-257"><a href="#VolumeManagerBase-257"><span class="linenos">257</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase-258"><a href="#VolumeManagerBase-258"><span class="linenos">258</span></a><span class="sd">        Implements hierarchical sorting of volumes according to their</span>
</span><span id="VolumeManagerBase-259"><a href="#VolumeManagerBase-259"><span class="linenos">259</span></a><span class="sd">        paths and provides information about the volume configured as</span>
</span><span id="VolumeManagerBase-260"><a href="#VolumeManagerBase-260"><span class="linenos">260</span></a><span class="sd">        the one eating all the rest space</span>
</span><span id="VolumeManagerBase-261"><a href="#VolumeManagerBase-261"><span class="linenos">261</span></a>
</span><span id="VolumeManagerBase-262"><a href="#VolumeManagerBase-262"><span class="linenos">262</span></a><span class="sd">        :return: list of canonical_volume_type tuples</span>
</span><span id="VolumeManagerBase-263"><a href="#VolumeManagerBase-263"><span class="linenos">263</span></a>
</span><span id="VolumeManagerBase-264"><a href="#VolumeManagerBase-264"><span class="linenos">264</span></a><span class="sd">        :rtype: list</span>
</span><span id="VolumeManagerBase-265"><a href="#VolumeManagerBase-265"><span class="linenos">265</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase-266"><a href="#VolumeManagerBase-266"><span class="linenos">266</span></a>        <span class="n">canonical_volume_type</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span>
</span><span id="VolumeManagerBase-267"><a href="#VolumeManagerBase-267"><span class="linenos">267</span></a>            <span class="s1">&#39;canonical_volume_type&#39;</span><span class="p">,</span> <span class="p">[</span>
</span><span id="VolumeManagerBase-268"><a href="#VolumeManagerBase-268"><span class="linenos">268</span></a>                <span class="s1">&#39;volumes&#39;</span><span class="p">,</span> <span class="s1">&#39;full_size_volume&#39;</span>
</span><span id="VolumeManagerBase-269"><a href="#VolumeManagerBase-269"><span class="linenos">269</span></a>            <span class="p">]</span>
</span><span id="VolumeManagerBase-270"><a href="#VolumeManagerBase-270"><span class="linenos">270</span></a>        <span class="p">)</span>
</span><span id="VolumeManagerBase-271"><a href="#VolumeManagerBase-271"><span class="linenos">271</span></a>        <span class="n">volume_paths</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="VolumeManagerBase-272"><a href="#VolumeManagerBase-272"><span class="linenos">272</span></a>        <span class="n">full_size_volume</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="VolumeManagerBase-273"><a href="#VolumeManagerBase-273"><span class="linenos">273</span></a>        <span class="k">for</span> <span class="n">volume</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">volumes</span><span class="p">:</span>
</span><span id="VolumeManagerBase-274"><a href="#VolumeManagerBase-274"><span class="linenos">274</span></a>            <span class="k">if</span> <span class="n">volume</span><span class="o">.</span><span class="n">fullsize</span><span class="p">:</span>
</span><span id="VolumeManagerBase-275"><a href="#VolumeManagerBase-275"><span class="linenos">275</span></a>                <span class="n">full_size_volume</span> <span class="o">=</span> <span class="n">volume</span>
</span><span id="VolumeManagerBase-276"><a href="#VolumeManagerBase-276"><span class="linenos">276</span></a>            <span class="k">elif</span> <span class="n">volume</span><span class="o">.</span><span class="n">realpath</span><span class="p">:</span>
</span><span id="VolumeManagerBase-277"><a href="#VolumeManagerBase-277"><span class="linenos">277</span></a>                <span class="n">volume_paths</span><span class="p">[</span><span class="n">volume</span><span class="o">.</span><span class="n">realpath</span><span class="p">]</span> <span class="o">=</span> <span class="n">volume</span>
</span><span id="VolumeManagerBase-278"><a href="#VolumeManagerBase-278"><span class="linenos">278</span></a>
</span><span id="VolumeManagerBase-279"><a href="#VolumeManagerBase-279"><span class="linenos">279</span></a>        <span class="n">volume_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="VolumeManagerBase-280"><a href="#VolumeManagerBase-280"><span class="linenos">280</span></a>        <span class="k">for</span> <span class="n">realpath</span> <span class="ow">in</span> <span class="n">Path</span><span class="o">.</span><span class="n">sort_by_hierarchy</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">volume_paths</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
</span><span id="VolumeManagerBase-281"><a href="#VolumeManagerBase-281"><span class="linenos">281</span></a>            <span class="n">volume_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">volume_paths</span><span class="p">[</span><span class="n">realpath</span><span class="p">])</span>
</span><span id="VolumeManagerBase-282"><a href="#VolumeManagerBase-282"><span class="linenos">282</span></a>        <span class="k">return</span> <span class="n">canonical_volume_type</span><span class="p">(</span>
</span><span id="VolumeManagerBase-283"><a href="#VolumeManagerBase-283"><span class="linenos">283</span></a>            <span class="n">volumes</span><span class="o">=</span><span class="n">volume_list</span><span class="p">,</span> <span class="n">full_size_volume</span><span class="o">=</span><span class="n">full_size_volume</span>
</span><span id="VolumeManagerBase-284"><a href="#VolumeManagerBase-284"><span class="linenos">284</span></a>        <span class="p">)</span>
</span><span id="VolumeManagerBase-285"><a href="#VolumeManagerBase-285"><span class="linenos">285</span></a>
</span><span id="VolumeManagerBase-286"><a href="#VolumeManagerBase-286"><span class="linenos">286</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_volume_mbsize</span><span class="p">(</span>
</span><span id="VolumeManagerBase-287"><a href="#VolumeManagerBase-287"><span class="linenos">287</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">volume</span><span class="p">,</span> <span class="n">all_volumes</span><span class="p">,</span> <span class="n">filesystem_name</span><span class="p">,</span> <span class="n">resize_on_boot</span><span class="o">=</span><span class="kc">False</span>
</span><span id="VolumeManagerBase-288"><a href="#VolumeManagerBase-288"><span class="linenos">288</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="VolumeManagerBase-289"><a href="#VolumeManagerBase-289"><span class="linenos">289</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase-290"><a href="#VolumeManagerBase-290"><span class="linenos">290</span></a><span class="sd">        Implements size lookup for the given path and desired</span>
</span><span id="VolumeManagerBase-291"><a href="#VolumeManagerBase-291"><span class="linenos">291</span></a><span class="sd">        filesystem according to the specified size type</span>
</span><span id="VolumeManagerBase-292"><a href="#VolumeManagerBase-292"><span class="linenos">292</span></a>
</span><span id="VolumeManagerBase-293"><a href="#VolumeManagerBase-293"><span class="linenos">293</span></a><span class="sd">        :param tuple volume: volume to check size for</span>
</span><span id="VolumeManagerBase-294"><a href="#VolumeManagerBase-294"><span class="linenos">294</span></a><span class="sd">        :param list all_volumes: list of all volume tuples</span>
</span><span id="VolumeManagerBase-295"><a href="#VolumeManagerBase-295"><span class="linenos">295</span></a><span class="sd">        :param str filesystem_name: filesystem name</span>
</span><span id="VolumeManagerBase-296"><a href="#VolumeManagerBase-296"><span class="linenos">296</span></a><span class="sd">        :param resize_on_boot:</span>
</span><span id="VolumeManagerBase-297"><a href="#VolumeManagerBase-297"><span class="linenos">297</span></a><span class="sd">            specify the time of the resize. If the resize happens at</span>
</span><span id="VolumeManagerBase-298"><a href="#VolumeManagerBase-298"><span class="linenos">298</span></a><span class="sd">            boot time the volume size is only the minimum size to</span>
</span><span id="VolumeManagerBase-299"><a href="#VolumeManagerBase-299"><span class="linenos">299</span></a><span class="sd">            just store the data. If the volume size is fixed and</span>
</span><span id="VolumeManagerBase-300"><a href="#VolumeManagerBase-300"><span class="linenos">300</span></a><span class="sd">            does not change at boot time the returned size is the</span>
</span><span id="VolumeManagerBase-301"><a href="#VolumeManagerBase-301"><span class="linenos">301</span></a><span class="sd">            requested size which can be greater than the minimum</span>
</span><span id="VolumeManagerBase-302"><a href="#VolumeManagerBase-302"><span class="linenos">302</span></a><span class="sd">            needed size.</span>
</span><span id="VolumeManagerBase-303"><a href="#VolumeManagerBase-303"><span class="linenos">303</span></a>
</span><span id="VolumeManagerBase-304"><a href="#VolumeManagerBase-304"><span class="linenos">304</span></a><span class="sd">        :return: mbsize</span>
</span><span id="VolumeManagerBase-305"><a href="#VolumeManagerBase-305"><span class="linenos">305</span></a>
</span><span id="VolumeManagerBase-306"><a href="#VolumeManagerBase-306"><span class="linenos">306</span></a><span class="sd">        :rtype: int</span>
</span><span id="VolumeManagerBase-307"><a href="#VolumeManagerBase-307"><span class="linenos">307</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase-308"><a href="#VolumeManagerBase-308"><span class="linenos">308</span></a>        <span class="p">[</span><span class="n">size_type</span><span class="p">,</span> <span class="n">mbsize</span><span class="p">]</span> <span class="o">=</span> <span class="n">volume</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
</span><span id="VolumeManagerBase-309"><a href="#VolumeManagerBase-309"><span class="linenos">309</span></a>        <span class="n">lookup_path</span> <span class="o">=</span> <span class="n">volume</span><span class="o">.</span><span class="n">realpath</span>
</span><span id="VolumeManagerBase-310"><a href="#VolumeManagerBase-310"><span class="linenos">310</span></a>        <span class="n">lookup_abspath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span>
</span><span id="VolumeManagerBase-311"><a href="#VolumeManagerBase-311"><span class="linenos">311</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">root_dir</span><span class="p">,</span> <span class="n">lookup_path</span><span class="p">])</span>
</span><span id="VolumeManagerBase-312"><a href="#VolumeManagerBase-312"><span class="linenos">312</span></a>        <span class="p">)</span>
</span><span id="VolumeManagerBase-313"><a href="#VolumeManagerBase-313"><span class="linenos">313</span></a>        <span class="n">mbsize</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mbsize</span><span class="p">)</span>
</span><span id="VolumeManagerBase-314"><a href="#VolumeManagerBase-314"><span class="linenos">314</span></a>
</span><span id="VolumeManagerBase-315"><a href="#VolumeManagerBase-315"><span class="linenos">315</span></a>        <span class="k">if</span> <span class="n">resize_on_boot</span><span class="p">:</span>
</span><span id="VolumeManagerBase-316"><a href="#VolumeManagerBase-316"><span class="linenos">316</span></a>            <span class="c1"># If resize_on_boot is true, the disk is self expandable and</span>
</span><span id="VolumeManagerBase-317"><a href="#VolumeManagerBase-317"><span class="linenos">317</span></a>            <span class="c1"># will resize to the configured sizes on first boot</span>
</span><span id="VolumeManagerBase-318"><a href="#VolumeManagerBase-318"><span class="linenos">318</span></a>            <span class="c1"># Therefore the requested size is set to null and we add</span>
</span><span id="VolumeManagerBase-319"><a href="#VolumeManagerBase-319"><span class="linenos">319</span></a>            <span class="c1"># the required minimum size for just storing the data</span>
</span><span id="VolumeManagerBase-320"><a href="#VolumeManagerBase-320"><span class="linenos">320</span></a>            <span class="n">size_type</span> <span class="o">=</span> <span class="s1">&#39;freespace&#39;</span>
</span><span id="VolumeManagerBase-321"><a href="#VolumeManagerBase-321"><span class="linenos">321</span></a>            <span class="n">mbsize</span> <span class="o">=</span> <span class="n">Defaults</span><span class="o">.</span><span class="n">get_min_volume_mbytes</span><span class="p">(</span><span class="n">filesystem_name</span><span class="p">)</span>
</span><span id="VolumeManagerBase-322"><a href="#VolumeManagerBase-322"><span class="linenos">322</span></a>
</span><span id="VolumeManagerBase-323"><a href="#VolumeManagerBase-323"><span class="linenos">323</span></a>        <span class="k">if</span> <span class="n">size_type</span> <span class="o">==</span> <span class="s1">&#39;freespace&#39;</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">lookup_abspath</span><span class="p">):</span>
</span><span id="VolumeManagerBase-324"><a href="#VolumeManagerBase-324"><span class="linenos">324</span></a>            <span class="n">exclude_paths</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="VolumeManagerBase-325"><a href="#VolumeManagerBase-325"><span class="linenos">325</span></a>            <span class="k">for</span> <span class="n">volume</span> <span class="ow">in</span> <span class="n">all_volumes</span><span class="p">:</span>
</span><span id="VolumeManagerBase-326"><a href="#VolumeManagerBase-326"><span class="linenos">326</span></a>                <span class="n">volume_path</span> <span class="o">=</span> <span class="n">volume</span><span class="o">.</span><span class="n">realpath</span>
</span><span id="VolumeManagerBase-327"><a href="#VolumeManagerBase-327"><span class="linenos">327</span></a>                <span class="k">if</span> <span class="n">lookup_path</span> <span class="o">==</span> <span class="n">volume_path</span><span class="p">:</span>
</span><span id="VolumeManagerBase-328"><a href="#VolumeManagerBase-328"><span class="linenos">328</span></a>                    <span class="k">continue</span>
</span><span id="VolumeManagerBase-329"><a href="#VolumeManagerBase-329"><span class="linenos">329</span></a>                <span class="k">if</span> <span class="n">lookup_path</span> <span class="o">==</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">:</span>
</span><span id="VolumeManagerBase-330"><a href="#VolumeManagerBase-330"><span class="linenos">330</span></a>                    <span class="c1"># exclude any sub volume path if lookup_path is /</span>
</span><span id="VolumeManagerBase-331"><a href="#VolumeManagerBase-331"><span class="linenos">331</span></a>                    <span class="n">exclude_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="VolumeManagerBase-332"><a href="#VolumeManagerBase-332"><span class="linenos">332</span></a>                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_dir</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">volume_path</span><span class="p">)</span>
</span><span id="VolumeManagerBase-333"><a href="#VolumeManagerBase-333"><span class="linenos">333</span></a>                    <span class="p">)</span>
</span><span id="VolumeManagerBase-334"><a href="#VolumeManagerBase-334"><span class="linenos">334</span></a>                <span class="k">elif</span> <span class="n">volume_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">lookup_path</span><span class="p">):</span>
</span><span id="VolumeManagerBase-335"><a href="#VolumeManagerBase-335"><span class="linenos">335</span></a>                    <span class="c1"># exclude any sub volume path below lookup_path</span>
</span><span id="VolumeManagerBase-336"><a href="#VolumeManagerBase-336"><span class="linenos">336</span></a>                    <span class="n">exclude_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="VolumeManagerBase-337"><a href="#VolumeManagerBase-337"><span class="linenos">337</span></a>                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_dir</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">volume_path</span><span class="p">)</span>
</span><span id="VolumeManagerBase-338"><a href="#VolumeManagerBase-338"><span class="linenos">338</span></a>                    <span class="p">)</span>
</span><span id="VolumeManagerBase-339"><a href="#VolumeManagerBase-339"><span class="linenos">339</span></a>
</span><span id="VolumeManagerBase-340"><a href="#VolumeManagerBase-340"><span class="linenos">340</span></a>            <span class="n">volume_size</span> <span class="o">=</span> <span class="n">SystemSize</span><span class="p">(</span><span class="n">lookup_abspath</span><span class="p">)</span>
</span><span id="VolumeManagerBase-341"><a href="#VolumeManagerBase-341"><span class="linenos">341</span></a>            <span class="k">if</span> <span class="n">mbsize</span> <span class="o">!=</span> <span class="n">Defaults</span><span class="o">.</span><span class="n">get_min_volume_mbytes</span><span class="p">(</span><span class="n">filesystem_name</span><span class="p">):</span>
</span><span id="VolumeManagerBase-342"><a href="#VolumeManagerBase-342"><span class="linenos">342</span></a>                <span class="n">mbsize</span> <span class="o">+=</span> <span class="n">Defaults</span><span class="o">.</span><span class="n">get_min_volume_mbytes</span><span class="p">(</span><span class="n">filesystem_name</span><span class="p">)</span>
</span><span id="VolumeManagerBase-343"><a href="#VolumeManagerBase-343"><span class="linenos">343</span></a>            <span class="n">mbsize</span> <span class="o">+=</span> <span class="n">volume_size</span><span class="o">.</span><span class="n">customize</span><span class="p">(</span>
</span><span id="VolumeManagerBase-344"><a href="#VolumeManagerBase-344"><span class="linenos">344</span></a>                <span class="n">volume_size</span><span class="o">.</span><span class="n">accumulate_mbyte_file_sizes</span><span class="p">(</span><span class="n">exclude_paths</span><span class="p">),</span>
</span><span id="VolumeManagerBase-345"><a href="#VolumeManagerBase-345"><span class="linenos">345</span></a>                <span class="n">filesystem_name</span>
</span><span id="VolumeManagerBase-346"><a href="#VolumeManagerBase-346"><span class="linenos">346</span></a>            <span class="p">)</span>
</span><span id="VolumeManagerBase-347"><a href="#VolumeManagerBase-347"><span class="linenos">347</span></a>        <span class="k">return</span> <span class="n">mbsize</span>
</span><span id="VolumeManagerBase-348"><a href="#VolumeManagerBase-348"><span class="linenos">348</span></a>
</span><span id="VolumeManagerBase-349"><a href="#VolumeManagerBase-349"><span class="linenos">349</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_mountpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="VolumeManagerBase-350"><a href="#VolumeManagerBase-350"><span class="linenos">350</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase-351"><a href="#VolumeManagerBase-351"><span class="linenos">351</span></a><span class="sd">        Provides mount point directory</span>
</span><span id="VolumeManagerBase-352"><a href="#VolumeManagerBase-352"><span class="linenos">352</span></a>
</span><span id="VolumeManagerBase-353"><a href="#VolumeManagerBase-353"><span class="linenos">353</span></a><span class="sd">        Effective use of the directory is guaranteed only after sync_data</span>
</span><span id="VolumeManagerBase-354"><a href="#VolumeManagerBase-354"><span class="linenos">354</span></a>
</span><span id="VolumeManagerBase-355"><a href="#VolumeManagerBase-355"><span class="linenos">355</span></a><span class="sd">        :return: directory path name</span>
</span><span id="VolumeManagerBase-356"><a href="#VolumeManagerBase-356"><span class="linenos">356</span></a>
</span><span id="VolumeManagerBase-357"><a href="#VolumeManagerBase-357"><span class="linenos">357</span></a><span class="sd">        :rtype: string</span>
</span><span id="VolumeManagerBase-358"><a href="#VolumeManagerBase-358"><span class="linenos">358</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase-359"><a href="#VolumeManagerBase-359"><span class="linenos">359</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mountpoint</span>
</span><span id="VolumeManagerBase-360"><a href="#VolumeManagerBase-360"><span class="linenos">360</span></a>
</span><span id="VolumeManagerBase-361"><a href="#VolumeManagerBase-361"><span class="linenos">361</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_root_volume_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="VolumeManagerBase-362"><a href="#VolumeManagerBase-362"><span class="linenos">362</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase-363"><a href="#VolumeManagerBase-363"><span class="linenos">363</span></a><span class="sd">        Provides name of the root volume</span>
</span><span id="VolumeManagerBase-364"><a href="#VolumeManagerBase-364"><span class="linenos">364</span></a>
</span><span id="VolumeManagerBase-365"><a href="#VolumeManagerBase-365"><span class="linenos">365</span></a><span class="sd">        This is by default set to &#39;/&#39;. Volume Managers that supports</span>
</span><span id="VolumeManagerBase-366"><a href="#VolumeManagerBase-366"><span class="linenos">366</span></a><span class="sd">        the concept of sub-volumes overrides this method</span>
</span><span id="VolumeManagerBase-367"><a href="#VolumeManagerBase-367"><span class="linenos">367</span></a>
</span><span id="VolumeManagerBase-368"><a href="#VolumeManagerBase-368"><span class="linenos">368</span></a><span class="sd">        :return: directory path name</span>
</span><span id="VolumeManagerBase-369"><a href="#VolumeManagerBase-369"><span class="linenos">369</span></a>
</span><span id="VolumeManagerBase-370"><a href="#VolumeManagerBase-370"><span class="linenos">370</span></a><span class="sd">        :rtype: string</span>
</span><span id="VolumeManagerBase-371"><a href="#VolumeManagerBase-371"><span class="linenos">371</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase-372"><a href="#VolumeManagerBase-372"><span class="linenos">372</span></a>        <span class="k">return</span> <span class="s1">&#39;/&#39;</span>
</span><span id="VolumeManagerBase-373"><a href="#VolumeManagerBase-373"><span class="linenos">373</span></a>
</span><span id="VolumeManagerBase-374"><a href="#VolumeManagerBase-374"><span class="linenos">374</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">sync_data</span><span class="p">(</span>
</span><span id="VolumeManagerBase-375"><a href="#VolumeManagerBase-375"><span class="linenos">375</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="VolumeManagerBase-376"><a href="#VolumeManagerBase-376"><span class="linenos">376</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">MountManager</span><span class="p">]:</span>
</span><span id="VolumeManagerBase-377"><a href="#VolumeManagerBase-377"><span class="linenos">377</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase-378"><a href="#VolumeManagerBase-378"><span class="linenos">378</span></a><span class="sd">        Implements sync of root directory to mounted volumes</span>
</span><span id="VolumeManagerBase-379"><a href="#VolumeManagerBase-379"><span class="linenos">379</span></a>
</span><span id="VolumeManagerBase-380"><a href="#VolumeManagerBase-380"><span class="linenos">380</span></a><span class="sd">        :param list exclude: file patterns to exclude</span>
</span><span id="VolumeManagerBase-381"><a href="#VolumeManagerBase-381"><span class="linenos">381</span></a>
</span><span id="VolumeManagerBase-382"><a href="#VolumeManagerBase-382"><span class="linenos">382</span></a><span class="sd">        :return: If a mount was created, then a context manager implementing the</span>
</span><span id="VolumeManagerBase-383"><a href="#VolumeManagerBase-383"><span class="linenos">383</span></a><span class="sd">            unmount is returned.</span>
</span><span id="VolumeManagerBase-384"><a href="#VolumeManagerBase-384"><span class="linenos">384</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase-385"><a href="#VolumeManagerBase-385"><span class="linenos">385</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mountpoint</span><span class="p">:</span>
</span><span id="VolumeManagerBase-386"><a href="#VolumeManagerBase-386"><span class="linenos">386</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="VolumeManagerBase-387"><a href="#VolumeManagerBase-387"><span class="linenos">387</span></a>
</span><span id="VolumeManagerBase-388"><a href="#VolumeManagerBase-388"><span class="linenos">388</span></a>        <span class="n">root_mount</span> <span class="o">=</span> <span class="n">MountManager</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">mountpoint</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mountpoint</span><span class="p">)</span>
</span><span id="VolumeManagerBase-389"><a href="#VolumeManagerBase-389"><span class="linenos">389</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">root_mount</span><span class="o">.</span><span class="n">is_mounted</span><span class="p">():</span>
</span><span id="VolumeManagerBase-390"><a href="#VolumeManagerBase-390"><span class="linenos">390</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mount_volumes</span><span class="p">()</span>
</span><span id="VolumeManagerBase-391"><a href="#VolumeManagerBase-391"><span class="linenos">391</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">DataSync</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mountpoint</span><span class="p">)</span>
</span><span id="VolumeManagerBase-392"><a href="#VolumeManagerBase-392"><span class="linenos">392</span></a>        <span class="n">data</span><span class="o">.</span><span class="n">sync_data</span><span class="p">(</span>
</span><span id="VolumeManagerBase-393"><a href="#VolumeManagerBase-393"><span class="linenos">393</span></a>            <span class="n">options</span><span class="o">=</span><span class="n">Defaults</span><span class="o">.</span><span class="n">get_sync_options</span><span class="p">(),</span> <span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span> <span class="ow">or</span> <span class="p">[]</span>
</span><span id="VolumeManagerBase-394"><a href="#VolumeManagerBase-394"><span class="linenos">394</span></a>        <span class="p">)</span>
</span><span id="VolumeManagerBase-395"><a href="#VolumeManagerBase-395"><span class="linenos">395</span></a>        <span class="k">return</span> <span class="n">root_mount</span>
</span><span id="VolumeManagerBase-396"><a href="#VolumeManagerBase-396"><span class="linenos">396</span></a>
</span><span id="VolumeManagerBase-397"><a href="#VolumeManagerBase-397"><span class="linenos">397</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_verity_layer</span><span class="p">(</span>
</span><span id="VolumeManagerBase-398"><a href="#VolumeManagerBase-398"><span class="linenos">398</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">blocks</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="VolumeManagerBase-399"><a href="#VolumeManagerBase-399"><span class="linenos">399</span></a>    <span class="p">):</span>
</span><span id="VolumeManagerBase-400"><a href="#VolumeManagerBase-400"><span class="linenos">400</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase-401"><a href="#VolumeManagerBase-401"><span class="linenos">401</span></a><span class="sd">        veritysetup on LVM devices is not supported</span>
</span><span id="VolumeManagerBase-402"><a href="#VolumeManagerBase-402"><span class="linenos">402</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase-403"><a href="#VolumeManagerBase-403"><span class="linenos">403</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="VolumeManagerBase-404"><a href="#VolumeManagerBase-404"><span class="linenos">404</span></a>
</span><span id="VolumeManagerBase-405"><a href="#VolumeManagerBase-405"><span class="linenos">405</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_verification_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device_node</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="VolumeManagerBase-406"><a href="#VolumeManagerBase-406"><span class="linenos">406</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase-407"><a href="#VolumeManagerBase-407"><span class="linenos">407</span></a><span class="sd">        Write verification block on LVM devices is not supported</span>
</span><span id="VolumeManagerBase-408"><a href="#VolumeManagerBase-408"><span class="linenos">408</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase-409"><a href="#VolumeManagerBase-409"><span class="linenos">409</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="VolumeManagerBase-410"><a href="#VolumeManagerBase-410"><span class="linenos">410</span></a>
</span><span id="VolumeManagerBase-411"><a href="#VolumeManagerBase-411"><span class="linenos">411</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_property_readonly_root</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="VolumeManagerBase-412"><a href="#VolumeManagerBase-412"><span class="linenos">412</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase-413"><a href="#VolumeManagerBase-413"><span class="linenos">413</span></a><span class="sd">        Implements setup of read-only root property</span>
</span><span id="VolumeManagerBase-414"><a href="#VolumeManagerBase-414"><span class="linenos">414</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase-415"><a href="#VolumeManagerBase-415"><span class="linenos">415</span></a>        <span class="k">raise</span> <span class="n">KiwiVolumeManagerSetupError</span><span class="p">(</span>
</span><span id="VolumeManagerBase-416"><a href="#VolumeManagerBase-416"><span class="linenos">416</span></a>            <span class="s1">&#39;read only property not supported&#39;</span>
</span><span id="VolumeManagerBase-417"><a href="#VolumeManagerBase-417"><span class="linenos">417</span></a>        <span class="p">)</span>
</span><span id="VolumeManagerBase-418"><a href="#VolumeManagerBase-418"><span class="linenos">418</span></a>
</span><span id="VolumeManagerBase-419"><a href="#VolumeManagerBase-419"><span class="linenos">419</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">setup_mountpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="VolumeManagerBase-420"><a href="#VolumeManagerBase-420"><span class="linenos">420</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase-421"><a href="#VolumeManagerBase-421"><span class="linenos">421</span></a><span class="sd">        Implements creation of a master directory holding</span>
</span><span id="VolumeManagerBase-422"><a href="#VolumeManagerBase-422"><span class="linenos">422</span></a><span class="sd">        the mounts of all volumes</span>
</span><span id="VolumeManagerBase-423"><a href="#VolumeManagerBase-423"><span class="linenos">423</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase-424"><a href="#VolumeManagerBase-424"><span class="linenos">424</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mountpoint_tempdir</span> <span class="o">=</span> <span class="n">Temporary</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;kiwi_volumes.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">new_dir</span><span class="p">()</span>
</span><span id="VolumeManagerBase-425"><a href="#VolumeManagerBase-425"><span class="linenos">425</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mountpoint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mountpoint_tempdir</span><span class="o">.</span><span class="n">name</span>
</span><span id="VolumeManagerBase-426"><a href="#VolumeManagerBase-426"><span class="linenos">426</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">temp_directories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mountpoint_tempdir</span><span class="p">)</span>
</span><span id="VolumeManagerBase-427"><a href="#VolumeManagerBase-427"><span class="linenos">427</span></a>
</span><span id="VolumeManagerBase-428"><a href="#VolumeManagerBase-428"><span class="linenos">428</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
</span><span id="VolumeManagerBase-429"><a href="#VolumeManagerBase-429"><span class="linenos">429</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p><strong>Implements base class for volume management interface</strong></p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>object device_map</strong>: 
dictionary of low level DeviceProvider intances</li>
<li><strong>str root_dir</strong>:  root directory path name</li>
<li>**list volumes: list of volumes from <code>XMLState:**: get_volumes()</code></li>
<li><strong>dict custom_args</strong>:  custom volume manager arguments for all
volume manager and filesystem specific tasks</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>KiwiVolumeManagerSetupError</strong>:  if the given root_dir doesn't exist</li>
</ul>
</div>


                            <div id="VolumeManagerBase.__init__" class="classattr">
                                        <input id="VolumeManagerBase.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">VolumeManagerBase</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">device_map</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n"><a href="../storage/device_provider.html#DeviceProvider">kiwi.storage.device_provider.DeviceProvider</a></span><span class="p">]</span>,</span><span class="param">	<span class="n">root_dir</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">volumes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n"><a href="../xml_state.html#volume_type">kiwi.xml_state.volume_type</a></span><span class="p">]</span>,</span><span class="param">	<span class="n">custom_args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="VolumeManagerBase.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#VolumeManagerBase.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="VolumeManagerBase.__init__-56"><a href="#VolumeManagerBase.__init__-56"><span class="linenos"> 56</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="VolumeManagerBase.__init__-57"><a href="#VolumeManagerBase.__init__-57"><span class="linenos"> 57</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="VolumeManagerBase.__init__-58"><a href="#VolumeManagerBase.__init__-58"><span class="linenos"> 58</span></a>        <span class="n">device_map</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DeviceProvider</span><span class="p">],</span>
</span><span id="VolumeManagerBase.__init__-59"><a href="#VolumeManagerBase.__init__-59"><span class="linenos"> 59</span></a>        <span class="n">root_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="VolumeManagerBase.__init__-60"><a href="#VolumeManagerBase.__init__-60"><span class="linenos"> 60</span></a>        <span class="n">volumes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">volume_type</span><span class="p">],</span>
</span><span id="VolumeManagerBase.__init__-61"><a href="#VolumeManagerBase.__init__-61"><span class="linenos"> 61</span></a>        <span class="n">custom_args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="VolumeManagerBase.__init__-62"><a href="#VolumeManagerBase.__init__-62"><span class="linenos"> 62</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="VolumeManagerBase.__init__-63"><a href="#VolumeManagerBase.__init__-63"><span class="linenos"> 63</span></a>
</span><span id="VolumeManagerBase.__init__-64"><a href="#VolumeManagerBase.__init__-64"><span class="linenos"> 64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">temp_directories</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Temporary</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="VolumeManagerBase.__init__-65"><a href="#VolumeManagerBase.__init__-65"><span class="linenos"> 65</span></a>        <span class="c1">#: all volumes are combined into one mountpoint. This is</span>
</span><span id="VolumeManagerBase.__init__-66"><a href="#VolumeManagerBase.__init__-66"><span class="linenos"> 66</span></a>        <span class="c1">#: needed at sync_data time. How to mount the volumes is</span>
</span><span id="VolumeManagerBase.__init__-67"><a href="#VolumeManagerBase.__init__-67"><span class="linenos"> 67</span></a>        <span class="c1">#: special to the volume management class</span>
</span><span id="VolumeManagerBase.__init__-68"><a href="#VolumeManagerBase.__init__-68"><span class="linenos"> 68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mountpoint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="VolumeManagerBase.__init__-69"><a href="#VolumeManagerBase.__init__-69"><span class="linenos"> 69</span></a>
</span><span id="VolumeManagerBase.__init__-70"><a href="#VolumeManagerBase.__init__-70"><span class="linenos"> 70</span></a>        <span class="c1">#: dictionary of mapped DeviceProviders</span>
</span><span id="VolumeManagerBase.__init__-71"><a href="#VolumeManagerBase.__init__-71"><span class="linenos"> 71</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device_map</span> <span class="o">=</span> <span class="n">device_map</span>
</span><span id="VolumeManagerBase.__init__-72"><a href="#VolumeManagerBase.__init__-72"><span class="linenos"> 72</span></a>
</span><span id="VolumeManagerBase.__init__-73"><a href="#VolumeManagerBase.__init__-73"><span class="linenos"> 73</span></a>        <span class="c1">#: the underlaying device provider</span>
</span><span id="VolumeManagerBase.__init__-74"><a href="#VolumeManagerBase.__init__-74"><span class="linenos"> 74</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device_provider_root</span> <span class="o">=</span> <span class="n">device_map</span><span class="p">[</span><span class="s1">&#39;root&#39;</span><span class="p">]</span>
</span><span id="VolumeManagerBase.__init__-75"><a href="#VolumeManagerBase.__init__-75"><span class="linenos"> 75</span></a>
</span><span id="VolumeManagerBase.__init__-76"><a href="#VolumeManagerBase.__init__-76"><span class="linenos"> 76</span></a>        <span class="c1">#: root directory path name</span>
</span><span id="VolumeManagerBase.__init__-77"><a href="#VolumeManagerBase.__init__-77"><span class="linenos"> 77</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">root_dir</span> <span class="o">=</span> <span class="n">root_dir</span>
</span><span id="VolumeManagerBase.__init__-78"><a href="#VolumeManagerBase.__init__-78"><span class="linenos"> 78</span></a>        <span class="c1">#: list of volumes from :class:`XMLState::get_volumes()`</span>
</span><span id="VolumeManagerBase.__init__-79"><a href="#VolumeManagerBase.__init__-79"><span class="linenos"> 79</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">volumes</span> <span class="o">=</span> <span class="n">volumes</span>
</span><span id="VolumeManagerBase.__init__-80"><a href="#VolumeManagerBase.__init__-80"><span class="linenos"> 80</span></a>        <span class="c1">#: volume group name</span>
</span><span id="VolumeManagerBase.__init__-81"><a href="#VolumeManagerBase.__init__-81"><span class="linenos"> 81</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">volume_group</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="VolumeManagerBase.__init__-82"><a href="#VolumeManagerBase.__init__-82"><span class="linenos"> 82</span></a>        <span class="c1">#: map volume name to device node</span>
</span><span id="VolumeManagerBase.__init__-83"><a href="#VolumeManagerBase.__init__-83"><span class="linenos"> 83</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">volume_map</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="VolumeManagerBase.__init__-84"><a href="#VolumeManagerBase.__init__-84"><span class="linenos"> 84</span></a>        <span class="c1">#: list of volume MountManager&#39;s</span>
</span><span id="VolumeManagerBase.__init__-85"><a href="#VolumeManagerBase.__init__-85"><span class="linenos"> 85</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mount_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">MountManager</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="VolumeManagerBase.__init__-86"><a href="#VolumeManagerBase.__init__-86"><span class="linenos"> 86</span></a>
</span><span id="VolumeManagerBase.__init__-87"><a href="#VolumeManagerBase.__init__-87"><span class="linenos"> 87</span></a>        <span class="c1">#: main storage device node name</span>
</span><span id="VolumeManagerBase.__init__-88"><a href="#VolumeManagerBase.__init__-88"><span class="linenos"> 88</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device_provider_root</span><span class="o">.</span><span class="n">get_device</span><span class="p">()</span>
</span><span id="VolumeManagerBase.__init__-89"><a href="#VolumeManagerBase.__init__-89"><span class="linenos"> 89</span></a>
</span><span id="VolumeManagerBase.__init__-90"><a href="#VolumeManagerBase.__init__-90"><span class="linenos"> 90</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">root_dir</span><span class="p">):</span>
</span><span id="VolumeManagerBase.__init__-91"><a href="#VolumeManagerBase.__init__-91"><span class="linenos"> 91</span></a>            <span class="k">raise</span> <span class="n">KiwiVolumeManagerSetupError</span><span class="p">(</span>
</span><span id="VolumeManagerBase.__init__-92"><a href="#VolumeManagerBase.__init__-92"><span class="linenos"> 92</span></a>                <span class="sa">f</span><span class="s1">&#39;given root directory </span><span class="si">{</span><span class="n">root_dir</span><span class="si">}</span><span class="s1"> does not exist&#39;</span>
</span><span id="VolumeManagerBase.__init__-93"><a href="#VolumeManagerBase.__init__-93"><span class="linenos"> 93</span></a>            <span class="p">)</span>
</span><span id="VolumeManagerBase.__init__-94"><a href="#VolumeManagerBase.__init__-94"><span class="linenos"> 94</span></a>
</span><span id="VolumeManagerBase.__init__-95"><a href="#VolumeManagerBase.__init__-95"><span class="linenos"> 95</span></a>        <span class="c1">#: custom arguments passed to setup the volumes</span>
</span><span id="VolumeManagerBase.__init__-96"><a href="#VolumeManagerBase.__init__-96"><span class="linenos"> 96</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">custom_args</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="VolumeManagerBase.__init__-97"><a href="#VolumeManagerBase.__init__-97"><span class="linenos"> 97</span></a>
</span><span id="VolumeManagerBase.__init__-98"><a href="#VolumeManagerBase.__init__-98"><span class="linenos"> 98</span></a>        <span class="c1">#: custom filesystem creation and mount arguments, subset of the</span>
</span><span id="VolumeManagerBase.__init__-99"><a href="#VolumeManagerBase.__init__-99"><span class="linenos"> 99</span></a>        <span class="c1">#: custom_args information suitable to be passed to a</span>
</span><span id="VolumeManagerBase.__init__-100"><a href="#VolumeManagerBase.__init__-100"><span class="linenos">100</span></a>        <span class="c1">#: FileSystem instance</span>
</span><span id="VolumeManagerBase.__init__-101"><a href="#VolumeManagerBase.__init__-101"><span class="linenos">101</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">custom_filesystem_args</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="VolumeManagerBase.__init__-102"><a href="#VolumeManagerBase.__init__-102"><span class="linenos">102</span></a>            <span class="s1">&#39;create_options&#39;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="VolumeManagerBase.__init__-103"><a href="#VolumeManagerBase.__init__-103"><span class="linenos">103</span></a>            <span class="s1">&#39;mount_options&#39;</span><span class="p">:</span> <span class="p">[]</span>
</span><span id="VolumeManagerBase.__init__-104"><a href="#VolumeManagerBase.__init__-104"><span class="linenos">104</span></a>        <span class="p">}</span>
</span><span id="VolumeManagerBase.__init__-105"><a href="#VolumeManagerBase.__init__-105"><span class="linenos">105</span></a>
</span><span id="VolumeManagerBase.__init__-106"><a href="#VolumeManagerBase.__init__-106"><span class="linenos">106</span></a>        <span class="k">if</span> <span class="n">custom_args</span> <span class="ow">and</span> <span class="s1">&#39;fs_create_options&#39;</span> <span class="ow">in</span> <span class="n">custom_args</span><span class="p">:</span>
</span><span id="VolumeManagerBase.__init__-107"><a href="#VolumeManagerBase.__init__-107"><span class="linenos">107</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">custom_filesystem_args</span><span class="p">[</span><span class="s1">&#39;create_options&#39;</span><span class="p">]</span> <span class="o">=</span> \
</span><span id="VolumeManagerBase.__init__-108"><a href="#VolumeManagerBase.__init__-108"><span class="linenos">108</span></a>                <span class="n">custom_args</span><span class="p">[</span><span class="s1">&#39;fs_create_options&#39;</span><span class="p">]</span>
</span><span id="VolumeManagerBase.__init__-109"><a href="#VolumeManagerBase.__init__-109"><span class="linenos">109</span></a>
</span><span id="VolumeManagerBase.__init__-110"><a href="#VolumeManagerBase.__init__-110"><span class="linenos">110</span></a>        <span class="k">if</span> <span class="n">custom_args</span> <span class="ow">and</span> <span class="s1">&#39;fs_mount_options&#39;</span> <span class="ow">in</span> <span class="n">custom_args</span><span class="p">:</span>
</span><span id="VolumeManagerBase.__init__-111"><a href="#VolumeManagerBase.__init__-111"><span class="linenos">111</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">custom_filesystem_args</span><span class="p">[</span><span class="s1">&#39;mount_options&#39;</span><span class="p">]</span> <span class="o">=</span> \
</span><span id="VolumeManagerBase.__init__-112"><a href="#VolumeManagerBase.__init__-112"><span class="linenos">112</span></a>                <span class="n">custom_args</span><span class="p">[</span><span class="s1">&#39;fs_mount_options&#39;</span><span class="p">]</span>
</span><span id="VolumeManagerBase.__init__-113"><a href="#VolumeManagerBase.__init__-113"><span class="linenos">113</span></a>
</span><span id="VolumeManagerBase.__init__-114"><a href="#VolumeManagerBase.__init__-114"><span class="linenos">114</span></a>        <span class="k">if</span> <span class="n">custom_args</span> <span class="ow">and</span> <span class="s1">&#39;fs_create_options&#39;</span> <span class="ow">in</span> <span class="n">custom_args</span><span class="p">:</span>
</span><span id="VolumeManagerBase.__init__-115"><a href="#VolumeManagerBase.__init__-115"><span class="linenos">115</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">custom_filesystem_args</span><span class="p">[</span><span class="s1">&#39;create_options&#39;</span><span class="p">]</span> <span class="o">=</span> \
</span><span id="VolumeManagerBase.__init__-116"><a href="#VolumeManagerBase.__init__-116"><span class="linenos">116</span></a>                <span class="n">custom_args</span><span class="p">[</span><span class="s1">&#39;fs_create_options&#39;</span><span class="p">]</span>
</span><span id="VolumeManagerBase.__init__-117"><a href="#VolumeManagerBase.__init__-117"><span class="linenos">117</span></a>
</span><span id="VolumeManagerBase.__init__-118"><a href="#VolumeManagerBase.__init__-118"><span class="linenos">118</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">post_init</span><span class="p">(</span><span class="n">custom_args</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="VolumeManagerBase.temp_directories" class="classattr">
                                <div class="attr variable">
            <span class="name">temp_directories</span><span class="annotation">: List[<a href="../utils/temporary.html#Temporary">kiwi.utils.temporary.Temporary</a>]</span>

        
    </div>
    <a class="headerlink" href="#VolumeManagerBase.temp_directories"></a>
    
    

                            </div>
                            <div id="VolumeManagerBase.mountpoint" class="classattr">
                                <div class="attr variable">
            <span class="name">mountpoint</span><span class="annotation">: Optional[str]</span>

        
    </div>
    <a class="headerlink" href="#VolumeManagerBase.mountpoint"></a>
    
    

                            </div>
                            <div id="VolumeManagerBase.device_map" class="classattr">
                                <div class="attr variable">
            <span class="name">device_map</span>

        
    </div>
    <a class="headerlink" href="#VolumeManagerBase.device_map"></a>
    
    

                            </div>
                            <div id="VolumeManagerBase.device_provider_root" class="classattr">
                                <div class="attr variable">
            <span class="name">device_provider_root</span>

        
    </div>
    <a class="headerlink" href="#VolumeManagerBase.device_provider_root"></a>
    
    

                            </div>
                            <div id="VolumeManagerBase.root_dir" class="classattr">
                                <div class="attr variable">
            <span class="name">root_dir</span>

        
    </div>
    <a class="headerlink" href="#VolumeManagerBase.root_dir"></a>
    
    

                            </div>
                            <div id="VolumeManagerBase.volumes" class="classattr">
                                <div class="attr variable">
            <span class="name">volumes</span>

        
    </div>
    <a class="headerlink" href="#VolumeManagerBase.volumes"></a>
    
    

                            </div>
                            <div id="VolumeManagerBase.volume_group" class="classattr">
                                <div class="attr variable">
            <span class="name">volume_group</span>

        
    </div>
    <a class="headerlink" href="#VolumeManagerBase.volume_group"></a>
    
    

                            </div>
                            <div id="VolumeManagerBase.volume_map" class="classattr">
                                <div class="attr variable">
            <span class="name">volume_map</span><span class="annotation">: Dict[str, str]</span>

        
    </div>
    <a class="headerlink" href="#VolumeManagerBase.volume_map"></a>
    
    

                            </div>
                            <div id="VolumeManagerBase.mount_list" class="classattr">
                                <div class="attr variable">
            <span class="name">mount_list</span><span class="annotation">: List[<a href="../mount_manager.html#MountManager">kiwi.mount_manager.MountManager</a>]</span>

        
    </div>
    <a class="headerlink" href="#VolumeManagerBase.mount_list"></a>
    
    

                            </div>
                            <div id="VolumeManagerBase.device" class="classattr">
                                <div class="attr variable">
            <span class="name">device</span>

        
    </div>
    <a class="headerlink" href="#VolumeManagerBase.device"></a>
    
    

                            </div>
                            <div id="VolumeManagerBase.custom_args" class="classattr">
                                <div class="attr variable">
            <span class="name">custom_args</span><span class="annotation">: Dict[str, Any]</span>

        
    </div>
    <a class="headerlink" href="#VolumeManagerBase.custom_args"></a>
    
    

                            </div>
                            <div id="VolumeManagerBase.custom_filesystem_args" class="classattr">
                                <div class="attr variable">
            <span class="name">custom_filesystem_args</span><span class="annotation">: Dict[str, Any]</span>

        
    </div>
    <a class="headerlink" href="#VolumeManagerBase.custom_filesystem_args"></a>
    
    

                            </div>
                            <div id="VolumeManagerBase.post_init" class="classattr">
                                        <input id="VolumeManagerBase.post_init-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">post_init</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">custom_args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="VolumeManagerBase.post_init-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#VolumeManagerBase.post_init"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="VolumeManagerBase.post_init-123"><a href="#VolumeManagerBase.post_init-123"><span class="linenos">123</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">post_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">custom_args</span><span class="p">):</span>
</span><span id="VolumeManagerBase.post_init-124"><a href="#VolumeManagerBase.post_init-124"><span class="linenos">124</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase.post_init-125"><a href="#VolumeManagerBase.post_init-125"><span class="linenos">125</span></a><span class="sd">        Post initialization method</span>
</span><span id="VolumeManagerBase.post_init-126"><a href="#VolumeManagerBase.post_init-126"><span class="linenos">126</span></a>
</span><span id="VolumeManagerBase.post_init-127"><a href="#VolumeManagerBase.post_init-127"><span class="linenos">127</span></a><span class="sd">        Implementation in specialized volume manager class if required</span>
</span><span id="VolumeManagerBase.post_init-128"><a href="#VolumeManagerBase.post_init-128"><span class="linenos">128</span></a>
</span><span id="VolumeManagerBase.post_init-129"><a href="#VolumeManagerBase.post_init-129"><span class="linenos">129</span></a><span class="sd">        :param dict custom_args: unused</span>
</span><span id="VolumeManagerBase.post_init-130"><a href="#VolumeManagerBase.post_init-130"><span class="linenos">130</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase.post_init-131"><a href="#VolumeManagerBase.post_init-131"><span class="linenos">131</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Post initialization method</p>

<p>Implementation in specialized volume manager class if required</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>dict custom_args</strong>:  unused</li>
</ul>
</div>


                            </div>
                            <div id="VolumeManagerBase.setup" class="classattr">
                                        <input id="VolumeManagerBase.setup-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">setup</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="VolumeManagerBase.setup-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#VolumeManagerBase.setup"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="VolumeManagerBase.setup-133"><a href="#VolumeManagerBase.setup-133"><span class="linenos">133</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="VolumeManagerBase.setup-134"><a href="#VolumeManagerBase.setup-134"><span class="linenos">134</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase.setup-135"><a href="#VolumeManagerBase.setup-135"><span class="linenos">135</span></a><span class="sd">        Implements setup required prior to the creation of volumes</span>
</span><span id="VolumeManagerBase.setup-136"><a href="#VolumeManagerBase.setup-136"><span class="linenos">136</span></a>
</span><span id="VolumeManagerBase.setup-137"><a href="#VolumeManagerBase.setup-137"><span class="linenos">137</span></a><span class="sd">        Implementation in specialized volume manager class required</span>
</span><span id="VolumeManagerBase.setup-138"><a href="#VolumeManagerBase.setup-138"><span class="linenos">138</span></a>
</span><span id="VolumeManagerBase.setup-139"><a href="#VolumeManagerBase.setup-139"><span class="linenos">139</span></a><span class="sd">        :param str name: unused</span>
</span><span id="VolumeManagerBase.setup-140"><a href="#VolumeManagerBase.setup-140"><span class="linenos">140</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase.setup-141"><a href="#VolumeManagerBase.setup-141"><span class="linenos">141</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span></pre></div>


            <div class="docstring"><p>Implements setup required prior to the creation of volumes</p>

<p>Implementation in specialized volume manager class required</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>str name</strong>:  unused</li>
</ul>
</div>


                            </div>
                            <div id="VolumeManagerBase.create_volumes" class="classattr">
                                        <input id="VolumeManagerBase.create_volumes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_volumes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">filesystem_name</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="VolumeManagerBase.create_volumes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#VolumeManagerBase.create_volumes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="VolumeManagerBase.create_volumes-143"><a href="#VolumeManagerBase.create_volumes-143"><span class="linenos">143</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filesystem_name</span><span class="p">):</span>
</span><span id="VolumeManagerBase.create_volumes-144"><a href="#VolumeManagerBase.create_volumes-144"><span class="linenos">144</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase.create_volumes-145"><a href="#VolumeManagerBase.create_volumes-145"><span class="linenos">145</span></a><span class="sd">        Implements creation of volumes</span>
</span><span id="VolumeManagerBase.create_volumes-146"><a href="#VolumeManagerBase.create_volumes-146"><span class="linenos">146</span></a>
</span><span id="VolumeManagerBase.create_volumes-147"><a href="#VolumeManagerBase.create_volumes-147"><span class="linenos">147</span></a><span class="sd">        Implementation in specialized volume manager class required</span>
</span><span id="VolumeManagerBase.create_volumes-148"><a href="#VolumeManagerBase.create_volumes-148"><span class="linenos">148</span></a>
</span><span id="VolumeManagerBase.create_volumes-149"><a href="#VolumeManagerBase.create_volumes-149"><span class="linenos">149</span></a><span class="sd">        :param str filesystem_name: unused</span>
</span><span id="VolumeManagerBase.create_volumes-150"><a href="#VolumeManagerBase.create_volumes-150"><span class="linenos">150</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase.create_volumes-151"><a href="#VolumeManagerBase.create_volumes-151"><span class="linenos">151</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span></pre></div>


            <div class="docstring"><p>Implements creation of volumes</p>

<p>Implementation in specialized volume manager class required</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>str filesystem_name</strong>:  unused</li>
</ul>
</div>


                            </div>
                            <div id="VolumeManagerBase.apply_attributes_on_volume" class="classattr">
                                        <input id="VolumeManagerBase.apply_attributes_on_volume-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">apply_attributes_on_volume</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">toplevel</span>, </span><span class="param"><span class="n">volume</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="VolumeManagerBase.apply_attributes_on_volume-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#VolumeManagerBase.apply_attributes_on_volume"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="VolumeManagerBase.apply_attributes_on_volume-153"><a href="#VolumeManagerBase.apply_attributes_on_volume-153"><span class="linenos">153</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">apply_attributes_on_volume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">toplevel</span><span class="p">,</span> <span class="n">volume</span><span class="p">):</span>
</span><span id="VolumeManagerBase.apply_attributes_on_volume-154"><a href="#VolumeManagerBase.apply_attributes_on_volume-154"><span class="linenos">154</span></a>        <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">volume</span><span class="o">.</span><span class="n">attributes</span><span class="p">:</span>
</span><span id="VolumeManagerBase.apply_attributes_on_volume-155"><a href="#VolumeManagerBase.apply_attributes_on_volume-155"><span class="linenos">155</span></a>            <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s1">&#39;no-copy-on-write&#39;</span><span class="p">:</span>
</span><span id="VolumeManagerBase.apply_attributes_on_volume-156"><a href="#VolumeManagerBase.apply_attributes_on_volume-156"><span class="linenos">156</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="VolumeManagerBase.apply_attributes_on_volume-157"><a href="#VolumeManagerBase.apply_attributes_on_volume-157"><span class="linenos">157</span></a>                    <span class="s1">&#39;--&gt; setting </span><span class="si">{0}</span><span class="s1"> for </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">volume</span><span class="o">.</span><span class="n">realpath</span><span class="p">)</span>
</span><span id="VolumeManagerBase.apply_attributes_on_volume-158"><a href="#VolumeManagerBase.apply_attributes_on_volume-158"><span class="linenos">158</span></a>                <span class="p">)</span>
</span><span id="VolumeManagerBase.apply_attributes_on_volume-159"><a href="#VolumeManagerBase.apply_attributes_on_volume-159"><span class="linenos">159</span></a>                <span class="n">Command</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
</span><span id="VolumeManagerBase.apply_attributes_on_volume-160"><a href="#VolumeManagerBase.apply_attributes_on_volume-160"><span class="linenos">160</span></a>                    <span class="p">[</span>
</span><span id="VolumeManagerBase.apply_attributes_on_volume-161"><a href="#VolumeManagerBase.apply_attributes_on_volume-161"><span class="linenos">161</span></a>                        <span class="s1">&#39;chattr&#39;</span><span class="p">,</span> <span class="s1">&#39;+C&#39;</span><span class="p">,</span>
</span><span id="VolumeManagerBase.apply_attributes_on_volume-162"><a href="#VolumeManagerBase.apply_attributes_on_volume-162"><span class="linenos">162</span></a>                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">toplevel</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">volume</span><span class="o">.</span><span class="n">realpath</span><span class="p">)</span>
</span><span id="VolumeManagerBase.apply_attributes_on_volume-163"><a href="#VolumeManagerBase.apply_attributes_on_volume-163"><span class="linenos">163</span></a>                    <span class="p">]</span>
</span><span id="VolumeManagerBase.apply_attributes_on_volume-164"><a href="#VolumeManagerBase.apply_attributes_on_volume-164"><span class="linenos">164</span></a>                <span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="VolumeManagerBase.get_fstab" class="classattr">
                                        <input id="VolumeManagerBase.get_fstab-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_fstab</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">persistency_type</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">filesystem_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="VolumeManagerBase.get_fstab-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#VolumeManagerBase.get_fstab"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="VolumeManagerBase.get_fstab-166"><a href="#VolumeManagerBase.get_fstab-166"><span class="linenos">166</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_fstab</span><span class="p">(</span>
</span><span id="VolumeManagerBase.get_fstab-167"><a href="#VolumeManagerBase.get_fstab-167"><span class="linenos">167</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">persistency_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filesystem_name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="VolumeManagerBase.get_fstab-168"><a href="#VolumeManagerBase.get_fstab-168"><span class="linenos">168</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="VolumeManagerBase.get_fstab-169"><a href="#VolumeManagerBase.get_fstab-169"><span class="linenos">169</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase.get_fstab-170"><a href="#VolumeManagerBase.get_fstab-170"><span class="linenos">170</span></a><span class="sd">        Implements setup of the fstab entries. The method should</span>
</span><span id="VolumeManagerBase.get_fstab-171"><a href="#VolumeManagerBase.get_fstab-171"><span class="linenos">171</span></a><span class="sd">        return a list of fstab compatible entries</span>
</span><span id="VolumeManagerBase.get_fstab-172"><a href="#VolumeManagerBase.get_fstab-172"><span class="linenos">172</span></a>
</span><span id="VolumeManagerBase.get_fstab-173"><a href="#VolumeManagerBase.get_fstab-173"><span class="linenos">173</span></a><span class="sd">        :param str persistency_type: unused</span>
</span><span id="VolumeManagerBase.get_fstab-174"><a href="#VolumeManagerBase.get_fstab-174"><span class="linenos">174</span></a><span class="sd">        :param str filesystem_name: unused</span>
</span><span id="VolumeManagerBase.get_fstab-175"><a href="#VolumeManagerBase.get_fstab-175"><span class="linenos">175</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase.get_fstab-176"><a href="#VolumeManagerBase.get_fstab-176"><span class="linenos">176</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span></pre></div>


            <div class="docstring"><p>Implements setup of the fstab entries. The method should
return a list of fstab compatible entries</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>str persistency_type</strong>:  unused</li>
<li><strong>str filesystem_name</strong>:  unused</li>
</ul>
</div>


                            </div>
                            <div id="VolumeManagerBase.get_volumes" class="classattr">
                                        <input id="VolumeManagerBase.get_volumes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_volumes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="VolumeManagerBase.get_volumes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#VolumeManagerBase.get_volumes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="VolumeManagerBase.get_volumes-178"><a href="#VolumeManagerBase.get_volumes-178"><span class="linenos">178</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="VolumeManagerBase.get_volumes-179"><a href="#VolumeManagerBase.get_volumes-179"><span class="linenos">179</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase.get_volumes-180"><a href="#VolumeManagerBase.get_volumes-180"><span class="linenos">180</span></a><span class="sd">        Implements return of dictionary of volumes and</span>
</span><span id="VolumeManagerBase.get_volumes-181"><a href="#VolumeManagerBase.get_volumes-181"><span class="linenos">181</span></a><span class="sd">        their mount options</span>
</span><span id="VolumeManagerBase.get_volumes-182"><a href="#VolumeManagerBase.get_volumes-182"><span class="linenos">182</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase.get_volumes-183"><a href="#VolumeManagerBase.get_volumes-183"><span class="linenos">183</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span></pre></div>


            <div class="docstring"><p>Implements return of dictionary of volumes and
their mount options</p>
</div>


                            </div>
                            <div id="VolumeManagerBase.mount_volumes" class="classattr">
                                        <input id="VolumeManagerBase.mount_volumes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mount_volumes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="VolumeManagerBase.mount_volumes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#VolumeManagerBase.mount_volumes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="VolumeManagerBase.mount_volumes-185"><a href="#VolumeManagerBase.mount_volumes-185"><span class="linenos">185</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">mount_volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="VolumeManagerBase.mount_volumes-186"><a href="#VolumeManagerBase.mount_volumes-186"><span class="linenos">186</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase.mount_volumes-187"><a href="#VolumeManagerBase.mount_volumes-187"><span class="linenos">187</span></a><span class="sd">        Implements mounting of all volumes below one master directory</span>
</span><span id="VolumeManagerBase.mount_volumes-188"><a href="#VolumeManagerBase.mount_volumes-188"><span class="linenos">188</span></a>
</span><span id="VolumeManagerBase.mount_volumes-189"><a href="#VolumeManagerBase.mount_volumes-189"><span class="linenos">189</span></a><span class="sd">        Implementation in specialized volume manager class required</span>
</span><span id="VolumeManagerBase.mount_volumes-190"><a href="#VolumeManagerBase.mount_volumes-190"><span class="linenos">190</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase.mount_volumes-191"><a href="#VolumeManagerBase.mount_volumes-191"><span class="linenos">191</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span></pre></div>


            <div class="docstring"><p>Implements mounting of all volumes below one master directory</p>

<p>Implementation in specialized volume manager class required</p>
</div>


                            </div>
                            <div id="VolumeManagerBase.umount_volumes" class="classattr">
                                        <input id="VolumeManagerBase.umount_volumes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">umount_volumes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="VolumeManagerBase.umount_volumes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#VolumeManagerBase.umount_volumes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="VolumeManagerBase.umount_volumes-193"><a href="#VolumeManagerBase.umount_volumes-193"><span class="linenos">193</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">umount_volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="VolumeManagerBase.umount_volumes-194"><a href="#VolumeManagerBase.umount_volumes-194"><span class="linenos">194</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase.umount_volumes-195"><a href="#VolumeManagerBase.umount_volumes-195"><span class="linenos">195</span></a><span class="sd">        Implements umounting of all volumes</span>
</span><span id="VolumeManagerBase.umount_volumes-196"><a href="#VolumeManagerBase.umount_volumes-196"><span class="linenos">196</span></a>
</span><span id="VolumeManagerBase.umount_volumes-197"><a href="#VolumeManagerBase.umount_volumes-197"><span class="linenos">197</span></a><span class="sd">        Implementation in specialized volume manager class required</span>
</span><span id="VolumeManagerBase.umount_volumes-198"><a href="#VolumeManagerBase.umount_volumes-198"><span class="linenos">198</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase.umount_volumes-199"><a href="#VolumeManagerBase.umount_volumes-199"><span class="linenos">199</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span></pre></div>


            <div class="docstring"><p>Implements umounting of all volumes</p>

<p>Implementation in specialized volume manager class required</p>
</div>


                            </div>
                            <div id="VolumeManagerBase.umount" class="classattr">
                                        <input id="VolumeManagerBase.umount-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">umount</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="VolumeManagerBase.umount-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#VolumeManagerBase.umount"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="VolumeManagerBase.umount-201"><a href="#VolumeManagerBase.umount-201"><span class="linenos">201</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">umount</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="VolumeManagerBase.umount-202"><a href="#VolumeManagerBase.umount-202"><span class="linenos">202</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase.umount-203"><a href="#VolumeManagerBase.umount-203"><span class="linenos">203</span></a><span class="sd">        Consistency layer with regards to FileSystem classes</span>
</span><span id="VolumeManagerBase.umount-204"><a href="#VolumeManagerBase.umount-204"><span class="linenos">204</span></a>
</span><span id="VolumeManagerBase.umount-205"><a href="#VolumeManagerBase.umount-205"><span class="linenos">205</span></a><span class="sd">        Invokes umount_volumes</span>
</span><span id="VolumeManagerBase.umount-206"><a href="#VolumeManagerBase.umount-206"><span class="linenos">206</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase.umount-207"><a href="#VolumeManagerBase.umount-207"><span class="linenos">207</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">umount_volumes</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Consistency layer with regards to FileSystem classes</p>

<p>Invokes umount_volumes</p>
</div>


                            </div>
                            <div id="VolumeManagerBase.mount" class="classattr">
                                        <input id="VolumeManagerBase.mount-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mount</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="VolumeManagerBase.mount-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#VolumeManagerBase.mount"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="VolumeManagerBase.mount-209"><a href="#VolumeManagerBase.mount-209"><span class="linenos">209</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">mount</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="VolumeManagerBase.mount-210"><a href="#VolumeManagerBase.mount-210"><span class="linenos">210</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase.mount-211"><a href="#VolumeManagerBase.mount-211"><span class="linenos">211</span></a><span class="sd">        Consistency layer with regards to FileSystem classes</span>
</span><span id="VolumeManagerBase.mount-212"><a href="#VolumeManagerBase.mount-212"><span class="linenos">212</span></a>
</span><span id="VolumeManagerBase.mount-213"><a href="#VolumeManagerBase.mount-213"><span class="linenos">213</span></a><span class="sd">        Invokes mount_volumes</span>
</span><span id="VolumeManagerBase.mount-214"><a href="#VolumeManagerBase.mount-214"><span class="linenos">214</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase.mount-215"><a href="#VolumeManagerBase.mount-215"><span class="linenos">215</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mount_volumes</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Consistency layer with regards to FileSystem classes</p>

<p>Invokes mount_volumes</p>
</div>


                            </div>
                            <div id="VolumeManagerBase.is_loop" class="classattr">
                                        <input id="VolumeManagerBase.is_loop-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_loop</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="VolumeManagerBase.is_loop-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#VolumeManagerBase.is_loop"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="VolumeManagerBase.is_loop-217"><a href="#VolumeManagerBase.is_loop-217"><span class="linenos">217</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="VolumeManagerBase.is_loop-218"><a href="#VolumeManagerBase.is_loop-218"><span class="linenos">218</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase.is_loop-219"><a href="#VolumeManagerBase.is_loop-219"><span class="linenos">219</span></a><span class="sd">        Check if storage provider is loop based</span>
</span><span id="VolumeManagerBase.is_loop-220"><a href="#VolumeManagerBase.is_loop-220"><span class="linenos">220</span></a>
</span><span id="VolumeManagerBase.is_loop-221"><a href="#VolumeManagerBase.is_loop-221"><span class="linenos">221</span></a><span class="sd">        The information is taken from the storage provider. If</span>
</span><span id="VolumeManagerBase.is_loop-222"><a href="#VolumeManagerBase.is_loop-222"><span class="linenos">222</span></a><span class="sd">        the storage provider is loop based the volume manager is it too</span>
</span><span id="VolumeManagerBase.is_loop-223"><a href="#VolumeManagerBase.is_loop-223"><span class="linenos">223</span></a>
</span><span id="VolumeManagerBase.is_loop-224"><a href="#VolumeManagerBase.is_loop-224"><span class="linenos">224</span></a><span class="sd">        :return: True of False</span>
</span><span id="VolumeManagerBase.is_loop-225"><a href="#VolumeManagerBase.is_loop-225"><span class="linenos">225</span></a>
</span><span id="VolumeManagerBase.is_loop-226"><a href="#VolumeManagerBase.is_loop-226"><span class="linenos">226</span></a><span class="sd">        :rtype: bool</span>
</span><span id="VolumeManagerBase.is_loop-227"><a href="#VolumeManagerBase.is_loop-227"><span class="linenos">227</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase.is_loop-228"><a href="#VolumeManagerBase.is_loop-228"><span class="linenos">228</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">device_provider_root</span><span class="o">.</span><span class="n">is_loop</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Check if storage provider is loop based</p>

<p>The information is taken from the storage provider. If
the storage provider is loop based the volume manager is it too</p>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>True of False</p>
</blockquote>
</div>


                            </div>
                            <div id="VolumeManagerBase.get_device" class="classattr">
                                        <input id="VolumeManagerBase.get_device-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_device</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="VolumeManagerBase.get_device-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#VolumeManagerBase.get_device"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="VolumeManagerBase.get_device-230"><a href="#VolumeManagerBase.get_device-230"><span class="linenos">230</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_device</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="VolumeManagerBase.get_device-231"><a href="#VolumeManagerBase.get_device-231"><span class="linenos">231</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase.get_device-232"><a href="#VolumeManagerBase.get_device-232"><span class="linenos">232</span></a><span class="sd">        Return current DeviceProvider dictionary</span>
</span><span id="VolumeManagerBase.get_device-233"><a href="#VolumeManagerBase.get_device-233"><span class="linenos">233</span></a>
</span><span id="VolumeManagerBase.get_device-234"><a href="#VolumeManagerBase.get_device-234"><span class="linenos">234</span></a><span class="sd">        :return: device_map</span>
</span><span id="VolumeManagerBase.get_device-235"><a href="#VolumeManagerBase.get_device-235"><span class="linenos">235</span></a>
</span><span id="VolumeManagerBase.get_device-236"><a href="#VolumeManagerBase.get_device-236"><span class="linenos">236</span></a><span class="sd">        :rtype: dict</span>
</span><span id="VolumeManagerBase.get_device-237"><a href="#VolumeManagerBase.get_device-237"><span class="linenos">237</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase.get_device-238"><a href="#VolumeManagerBase.get_device-238"><span class="linenos">238</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">device_map</span>
</span></pre></div>


            <div class="docstring"><p>Return current DeviceProvider dictionary</p>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>device_map</p>
</blockquote>
</div>


                            </div>
                            <div id="VolumeManagerBase.create_volume_paths_in_root_dir" class="classattr">
                                        <input id="VolumeManagerBase.create_volume_paths_in_root_dir-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_volume_paths_in_root_dir</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="VolumeManagerBase.create_volume_paths_in_root_dir-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#VolumeManagerBase.create_volume_paths_in_root_dir"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="VolumeManagerBase.create_volume_paths_in_root_dir-240"><a href="#VolumeManagerBase.create_volume_paths_in_root_dir-240"><span class="linenos">240</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_volume_paths_in_root_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="VolumeManagerBase.create_volume_paths_in_root_dir-241"><a href="#VolumeManagerBase.create_volume_paths_in_root_dir-241"><span class="linenos">241</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase.create_volume_paths_in_root_dir-242"><a href="#VolumeManagerBase.create_volume_paths_in_root_dir-242"><span class="linenos">242</span></a><span class="sd">        Implements creation of volume paths in the given root directory</span>
</span><span id="VolumeManagerBase.create_volume_paths_in_root_dir-243"><a href="#VolumeManagerBase.create_volume_paths_in_root_dir-243"><span class="linenos">243</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase.create_volume_paths_in_root_dir-244"><a href="#VolumeManagerBase.create_volume_paths_in_root_dir-244"><span class="linenos">244</span></a>        <span class="k">for</span> <span class="n">volume</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">volumes</span><span class="p">:</span>
</span><span id="VolumeManagerBase.create_volume_paths_in_root_dir-245"><a href="#VolumeManagerBase.create_volume_paths_in_root_dir-245"><span class="linenos">245</span></a>            <span class="k">if</span> <span class="n">volume</span><span class="o">.</span><span class="n">realpath</span> <span class="ow">and</span> <span class="n">volume</span><span class="o">.</span><span class="n">realpath</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;swap&#39;</span><span class="p">]:</span>
</span><span id="VolumeManagerBase.create_volume_paths_in_root_dir-246"><a href="#VolumeManagerBase.create_volume_paths_in_root_dir-246"><span class="linenos">246</span></a>                <span class="n">volume_image_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span>
</span><span id="VolumeManagerBase.create_volume_paths_in_root_dir-247"><a href="#VolumeManagerBase.create_volume_paths_in_root_dir-247"><span class="linenos">247</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">root_dir</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">volume</span><span class="o">.</span><span class="n">realpath</span>
</span><span id="VolumeManagerBase.create_volume_paths_in_root_dir-248"><a href="#VolumeManagerBase.create_volume_paths_in_root_dir-248"><span class="linenos">248</span></a>                <span class="p">)</span>
</span><span id="VolumeManagerBase.create_volume_paths_in_root_dir-249"><a href="#VolumeManagerBase.create_volume_paths_in_root_dir-249"><span class="linenos">249</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">volume_image_path</span><span class="p">):</span>
</span><span id="VolumeManagerBase.create_volume_paths_in_root_dir-250"><a href="#VolumeManagerBase.create_volume_paths_in_root_dir-250"><span class="linenos">250</span></a>                    <span class="c1"># not existing volume paths will be created in the image</span>
</span><span id="VolumeManagerBase.create_volume_paths_in_root_dir-251"><a href="#VolumeManagerBase.create_volume_paths_in_root_dir-251"><span class="linenos">251</span></a>                    <span class="c1"># root directory. This happens hidden to the user but is</span>
</span><span id="VolumeManagerBase.create_volume_paths_in_root_dir-252"><a href="#VolumeManagerBase.create_volume_paths_in_root_dir-252"><span class="linenos">252</span></a>                    <span class="c1"># imho ok because the path is explicitly configured as a</span>
</span><span id="VolumeManagerBase.create_volume_paths_in_root_dir-253"><a href="#VolumeManagerBase.create_volume_paths_in_root_dir-253"><span class="linenos">253</span></a>                    <span class="c1"># volume</span>
</span><span id="VolumeManagerBase.create_volume_paths_in_root_dir-254"><a href="#VolumeManagerBase.create_volume_paths_in_root_dir-254"><span class="linenos">254</span></a>                    <span class="n">Path</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">volume_image_path</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Implements creation of volume paths in the given root directory</p>
</div>


                            </div>
                            <div id="VolumeManagerBase.get_canonical_volume_list" class="classattr">
                                        <input id="VolumeManagerBase.get_canonical_volume_list-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_canonical_volume_list</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="VolumeManagerBase.get_canonical_volume_list-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#VolumeManagerBase.get_canonical_volume_list"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="VolumeManagerBase.get_canonical_volume_list-256"><a href="#VolumeManagerBase.get_canonical_volume_list-256"><span class="linenos">256</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_canonical_volume_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="VolumeManagerBase.get_canonical_volume_list-257"><a href="#VolumeManagerBase.get_canonical_volume_list-257"><span class="linenos">257</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase.get_canonical_volume_list-258"><a href="#VolumeManagerBase.get_canonical_volume_list-258"><span class="linenos">258</span></a><span class="sd">        Implements hierarchical sorting of volumes according to their</span>
</span><span id="VolumeManagerBase.get_canonical_volume_list-259"><a href="#VolumeManagerBase.get_canonical_volume_list-259"><span class="linenos">259</span></a><span class="sd">        paths and provides information about the volume configured as</span>
</span><span id="VolumeManagerBase.get_canonical_volume_list-260"><a href="#VolumeManagerBase.get_canonical_volume_list-260"><span class="linenos">260</span></a><span class="sd">        the one eating all the rest space</span>
</span><span id="VolumeManagerBase.get_canonical_volume_list-261"><a href="#VolumeManagerBase.get_canonical_volume_list-261"><span class="linenos">261</span></a>
</span><span id="VolumeManagerBase.get_canonical_volume_list-262"><a href="#VolumeManagerBase.get_canonical_volume_list-262"><span class="linenos">262</span></a><span class="sd">        :return: list of canonical_volume_type tuples</span>
</span><span id="VolumeManagerBase.get_canonical_volume_list-263"><a href="#VolumeManagerBase.get_canonical_volume_list-263"><span class="linenos">263</span></a>
</span><span id="VolumeManagerBase.get_canonical_volume_list-264"><a href="#VolumeManagerBase.get_canonical_volume_list-264"><span class="linenos">264</span></a><span class="sd">        :rtype: list</span>
</span><span id="VolumeManagerBase.get_canonical_volume_list-265"><a href="#VolumeManagerBase.get_canonical_volume_list-265"><span class="linenos">265</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase.get_canonical_volume_list-266"><a href="#VolumeManagerBase.get_canonical_volume_list-266"><span class="linenos">266</span></a>        <span class="n">canonical_volume_type</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span>
</span><span id="VolumeManagerBase.get_canonical_volume_list-267"><a href="#VolumeManagerBase.get_canonical_volume_list-267"><span class="linenos">267</span></a>            <span class="s1">&#39;canonical_volume_type&#39;</span><span class="p">,</span> <span class="p">[</span>
</span><span id="VolumeManagerBase.get_canonical_volume_list-268"><a href="#VolumeManagerBase.get_canonical_volume_list-268"><span class="linenos">268</span></a>                <span class="s1">&#39;volumes&#39;</span><span class="p">,</span> <span class="s1">&#39;full_size_volume&#39;</span>
</span><span id="VolumeManagerBase.get_canonical_volume_list-269"><a href="#VolumeManagerBase.get_canonical_volume_list-269"><span class="linenos">269</span></a>            <span class="p">]</span>
</span><span id="VolumeManagerBase.get_canonical_volume_list-270"><a href="#VolumeManagerBase.get_canonical_volume_list-270"><span class="linenos">270</span></a>        <span class="p">)</span>
</span><span id="VolumeManagerBase.get_canonical_volume_list-271"><a href="#VolumeManagerBase.get_canonical_volume_list-271"><span class="linenos">271</span></a>        <span class="n">volume_paths</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="VolumeManagerBase.get_canonical_volume_list-272"><a href="#VolumeManagerBase.get_canonical_volume_list-272"><span class="linenos">272</span></a>        <span class="n">full_size_volume</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="VolumeManagerBase.get_canonical_volume_list-273"><a href="#VolumeManagerBase.get_canonical_volume_list-273"><span class="linenos">273</span></a>        <span class="k">for</span> <span class="n">volume</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">volumes</span><span class="p">:</span>
</span><span id="VolumeManagerBase.get_canonical_volume_list-274"><a href="#VolumeManagerBase.get_canonical_volume_list-274"><span class="linenos">274</span></a>            <span class="k">if</span> <span class="n">volume</span><span class="o">.</span><span class="n">fullsize</span><span class="p">:</span>
</span><span id="VolumeManagerBase.get_canonical_volume_list-275"><a href="#VolumeManagerBase.get_canonical_volume_list-275"><span class="linenos">275</span></a>                <span class="n">full_size_volume</span> <span class="o">=</span> <span class="n">volume</span>
</span><span id="VolumeManagerBase.get_canonical_volume_list-276"><a href="#VolumeManagerBase.get_canonical_volume_list-276"><span class="linenos">276</span></a>            <span class="k">elif</span> <span class="n">volume</span><span class="o">.</span><span class="n">realpath</span><span class="p">:</span>
</span><span id="VolumeManagerBase.get_canonical_volume_list-277"><a href="#VolumeManagerBase.get_canonical_volume_list-277"><span class="linenos">277</span></a>                <span class="n">volume_paths</span><span class="p">[</span><span class="n">volume</span><span class="o">.</span><span class="n">realpath</span><span class="p">]</span> <span class="o">=</span> <span class="n">volume</span>
</span><span id="VolumeManagerBase.get_canonical_volume_list-278"><a href="#VolumeManagerBase.get_canonical_volume_list-278"><span class="linenos">278</span></a>
</span><span id="VolumeManagerBase.get_canonical_volume_list-279"><a href="#VolumeManagerBase.get_canonical_volume_list-279"><span class="linenos">279</span></a>        <span class="n">volume_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="VolumeManagerBase.get_canonical_volume_list-280"><a href="#VolumeManagerBase.get_canonical_volume_list-280"><span class="linenos">280</span></a>        <span class="k">for</span> <span class="n">realpath</span> <span class="ow">in</span> <span class="n">Path</span><span class="o">.</span><span class="n">sort_by_hierarchy</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">volume_paths</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
</span><span id="VolumeManagerBase.get_canonical_volume_list-281"><a href="#VolumeManagerBase.get_canonical_volume_list-281"><span class="linenos">281</span></a>            <span class="n">volume_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">volume_paths</span><span class="p">[</span><span class="n">realpath</span><span class="p">])</span>
</span><span id="VolumeManagerBase.get_canonical_volume_list-282"><a href="#VolumeManagerBase.get_canonical_volume_list-282"><span class="linenos">282</span></a>        <span class="k">return</span> <span class="n">canonical_volume_type</span><span class="p">(</span>
</span><span id="VolumeManagerBase.get_canonical_volume_list-283"><a href="#VolumeManagerBase.get_canonical_volume_list-283"><span class="linenos">283</span></a>            <span class="n">volumes</span><span class="o">=</span><span class="n">volume_list</span><span class="p">,</span> <span class="n">full_size_volume</span><span class="o">=</span><span class="n">full_size_volume</span>
</span><span id="VolumeManagerBase.get_canonical_volume_list-284"><a href="#VolumeManagerBase.get_canonical_volume_list-284"><span class="linenos">284</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Implements hierarchical sorting of volumes according to their
paths and provides information about the volume configured as
the one eating all the rest space</p>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>list of canonical_volume_type tuples</p>
</blockquote>
</div>


                            </div>
                            <div id="VolumeManagerBase.get_volume_mbsize" class="classattr">
                                        <input id="VolumeManagerBase.get_volume_mbsize-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_volume_mbsize</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">volume</span>, </span><span class="param"><span class="n">all_volumes</span>, </span><span class="param"><span class="n">filesystem_name</span>, </span><span class="param"><span class="n">resize_on_boot</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="VolumeManagerBase.get_volume_mbsize-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#VolumeManagerBase.get_volume_mbsize"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="VolumeManagerBase.get_volume_mbsize-286"><a href="#VolumeManagerBase.get_volume_mbsize-286"><span class="linenos">286</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_volume_mbsize</span><span class="p">(</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-287"><a href="#VolumeManagerBase.get_volume_mbsize-287"><span class="linenos">287</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">volume</span><span class="p">,</span> <span class="n">all_volumes</span><span class="p">,</span> <span class="n">filesystem_name</span><span class="p">,</span> <span class="n">resize_on_boot</span><span class="o">=</span><span class="kc">False</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-288"><a href="#VolumeManagerBase.get_volume_mbsize-288"><span class="linenos">288</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-289"><a href="#VolumeManagerBase.get_volume_mbsize-289"><span class="linenos">289</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-290"><a href="#VolumeManagerBase.get_volume_mbsize-290"><span class="linenos">290</span></a><span class="sd">        Implements size lookup for the given path and desired</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-291"><a href="#VolumeManagerBase.get_volume_mbsize-291"><span class="linenos">291</span></a><span class="sd">        filesystem according to the specified size type</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-292"><a href="#VolumeManagerBase.get_volume_mbsize-292"><span class="linenos">292</span></a>
</span><span id="VolumeManagerBase.get_volume_mbsize-293"><a href="#VolumeManagerBase.get_volume_mbsize-293"><span class="linenos">293</span></a><span class="sd">        :param tuple volume: volume to check size for</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-294"><a href="#VolumeManagerBase.get_volume_mbsize-294"><span class="linenos">294</span></a><span class="sd">        :param list all_volumes: list of all volume tuples</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-295"><a href="#VolumeManagerBase.get_volume_mbsize-295"><span class="linenos">295</span></a><span class="sd">        :param str filesystem_name: filesystem name</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-296"><a href="#VolumeManagerBase.get_volume_mbsize-296"><span class="linenos">296</span></a><span class="sd">        :param resize_on_boot:</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-297"><a href="#VolumeManagerBase.get_volume_mbsize-297"><span class="linenos">297</span></a><span class="sd">            specify the time of the resize. If the resize happens at</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-298"><a href="#VolumeManagerBase.get_volume_mbsize-298"><span class="linenos">298</span></a><span class="sd">            boot time the volume size is only the minimum size to</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-299"><a href="#VolumeManagerBase.get_volume_mbsize-299"><span class="linenos">299</span></a><span class="sd">            just store the data. If the volume size is fixed and</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-300"><a href="#VolumeManagerBase.get_volume_mbsize-300"><span class="linenos">300</span></a><span class="sd">            does not change at boot time the returned size is the</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-301"><a href="#VolumeManagerBase.get_volume_mbsize-301"><span class="linenos">301</span></a><span class="sd">            requested size which can be greater than the minimum</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-302"><a href="#VolumeManagerBase.get_volume_mbsize-302"><span class="linenos">302</span></a><span class="sd">            needed size.</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-303"><a href="#VolumeManagerBase.get_volume_mbsize-303"><span class="linenos">303</span></a>
</span><span id="VolumeManagerBase.get_volume_mbsize-304"><a href="#VolumeManagerBase.get_volume_mbsize-304"><span class="linenos">304</span></a><span class="sd">        :return: mbsize</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-305"><a href="#VolumeManagerBase.get_volume_mbsize-305"><span class="linenos">305</span></a>
</span><span id="VolumeManagerBase.get_volume_mbsize-306"><a href="#VolumeManagerBase.get_volume_mbsize-306"><span class="linenos">306</span></a><span class="sd">        :rtype: int</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-307"><a href="#VolumeManagerBase.get_volume_mbsize-307"><span class="linenos">307</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-308"><a href="#VolumeManagerBase.get_volume_mbsize-308"><span class="linenos">308</span></a>        <span class="p">[</span><span class="n">size_type</span><span class="p">,</span> <span class="n">mbsize</span><span class="p">]</span> <span class="o">=</span> <span class="n">volume</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-309"><a href="#VolumeManagerBase.get_volume_mbsize-309"><span class="linenos">309</span></a>        <span class="n">lookup_path</span> <span class="o">=</span> <span class="n">volume</span><span class="o">.</span><span class="n">realpath</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-310"><a href="#VolumeManagerBase.get_volume_mbsize-310"><span class="linenos">310</span></a>        <span class="n">lookup_abspath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-311"><a href="#VolumeManagerBase.get_volume_mbsize-311"><span class="linenos">311</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">root_dir</span><span class="p">,</span> <span class="n">lookup_path</span><span class="p">])</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-312"><a href="#VolumeManagerBase.get_volume_mbsize-312"><span class="linenos">312</span></a>        <span class="p">)</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-313"><a href="#VolumeManagerBase.get_volume_mbsize-313"><span class="linenos">313</span></a>        <span class="n">mbsize</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mbsize</span><span class="p">)</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-314"><a href="#VolumeManagerBase.get_volume_mbsize-314"><span class="linenos">314</span></a>
</span><span id="VolumeManagerBase.get_volume_mbsize-315"><a href="#VolumeManagerBase.get_volume_mbsize-315"><span class="linenos">315</span></a>        <span class="k">if</span> <span class="n">resize_on_boot</span><span class="p">:</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-316"><a href="#VolumeManagerBase.get_volume_mbsize-316"><span class="linenos">316</span></a>            <span class="c1"># If resize_on_boot is true, the disk is self expandable and</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-317"><a href="#VolumeManagerBase.get_volume_mbsize-317"><span class="linenos">317</span></a>            <span class="c1"># will resize to the configured sizes on first boot</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-318"><a href="#VolumeManagerBase.get_volume_mbsize-318"><span class="linenos">318</span></a>            <span class="c1"># Therefore the requested size is set to null and we add</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-319"><a href="#VolumeManagerBase.get_volume_mbsize-319"><span class="linenos">319</span></a>            <span class="c1"># the required minimum size for just storing the data</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-320"><a href="#VolumeManagerBase.get_volume_mbsize-320"><span class="linenos">320</span></a>            <span class="n">size_type</span> <span class="o">=</span> <span class="s1">&#39;freespace&#39;</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-321"><a href="#VolumeManagerBase.get_volume_mbsize-321"><span class="linenos">321</span></a>            <span class="n">mbsize</span> <span class="o">=</span> <span class="n">Defaults</span><span class="o">.</span><span class="n">get_min_volume_mbytes</span><span class="p">(</span><span class="n">filesystem_name</span><span class="p">)</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-322"><a href="#VolumeManagerBase.get_volume_mbsize-322"><span class="linenos">322</span></a>
</span><span id="VolumeManagerBase.get_volume_mbsize-323"><a href="#VolumeManagerBase.get_volume_mbsize-323"><span class="linenos">323</span></a>        <span class="k">if</span> <span class="n">size_type</span> <span class="o">==</span> <span class="s1">&#39;freespace&#39;</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">lookup_abspath</span><span class="p">):</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-324"><a href="#VolumeManagerBase.get_volume_mbsize-324"><span class="linenos">324</span></a>            <span class="n">exclude_paths</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-325"><a href="#VolumeManagerBase.get_volume_mbsize-325"><span class="linenos">325</span></a>            <span class="k">for</span> <span class="n">volume</span> <span class="ow">in</span> <span class="n">all_volumes</span><span class="p">:</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-326"><a href="#VolumeManagerBase.get_volume_mbsize-326"><span class="linenos">326</span></a>                <span class="n">volume_path</span> <span class="o">=</span> <span class="n">volume</span><span class="o">.</span><span class="n">realpath</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-327"><a href="#VolumeManagerBase.get_volume_mbsize-327"><span class="linenos">327</span></a>                <span class="k">if</span> <span class="n">lookup_path</span> <span class="o">==</span> <span class="n">volume_path</span><span class="p">:</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-328"><a href="#VolumeManagerBase.get_volume_mbsize-328"><span class="linenos">328</span></a>                    <span class="k">continue</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-329"><a href="#VolumeManagerBase.get_volume_mbsize-329"><span class="linenos">329</span></a>                <span class="k">if</span> <span class="n">lookup_path</span> <span class="o">==</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">:</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-330"><a href="#VolumeManagerBase.get_volume_mbsize-330"><span class="linenos">330</span></a>                    <span class="c1"># exclude any sub volume path if lookup_path is /</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-331"><a href="#VolumeManagerBase.get_volume_mbsize-331"><span class="linenos">331</span></a>                    <span class="n">exclude_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-332"><a href="#VolumeManagerBase.get_volume_mbsize-332"><span class="linenos">332</span></a>                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_dir</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">volume_path</span><span class="p">)</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-333"><a href="#VolumeManagerBase.get_volume_mbsize-333"><span class="linenos">333</span></a>                    <span class="p">)</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-334"><a href="#VolumeManagerBase.get_volume_mbsize-334"><span class="linenos">334</span></a>                <span class="k">elif</span> <span class="n">volume_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">lookup_path</span><span class="p">):</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-335"><a href="#VolumeManagerBase.get_volume_mbsize-335"><span class="linenos">335</span></a>                    <span class="c1"># exclude any sub volume path below lookup_path</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-336"><a href="#VolumeManagerBase.get_volume_mbsize-336"><span class="linenos">336</span></a>                    <span class="n">exclude_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-337"><a href="#VolumeManagerBase.get_volume_mbsize-337"><span class="linenos">337</span></a>                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_dir</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">volume_path</span><span class="p">)</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-338"><a href="#VolumeManagerBase.get_volume_mbsize-338"><span class="linenos">338</span></a>                    <span class="p">)</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-339"><a href="#VolumeManagerBase.get_volume_mbsize-339"><span class="linenos">339</span></a>
</span><span id="VolumeManagerBase.get_volume_mbsize-340"><a href="#VolumeManagerBase.get_volume_mbsize-340"><span class="linenos">340</span></a>            <span class="n">volume_size</span> <span class="o">=</span> <span class="n">SystemSize</span><span class="p">(</span><span class="n">lookup_abspath</span><span class="p">)</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-341"><a href="#VolumeManagerBase.get_volume_mbsize-341"><span class="linenos">341</span></a>            <span class="k">if</span> <span class="n">mbsize</span> <span class="o">!=</span> <span class="n">Defaults</span><span class="o">.</span><span class="n">get_min_volume_mbytes</span><span class="p">(</span><span class="n">filesystem_name</span><span class="p">):</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-342"><a href="#VolumeManagerBase.get_volume_mbsize-342"><span class="linenos">342</span></a>                <span class="n">mbsize</span> <span class="o">+=</span> <span class="n">Defaults</span><span class="o">.</span><span class="n">get_min_volume_mbytes</span><span class="p">(</span><span class="n">filesystem_name</span><span class="p">)</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-343"><a href="#VolumeManagerBase.get_volume_mbsize-343"><span class="linenos">343</span></a>            <span class="n">mbsize</span> <span class="o">+=</span> <span class="n">volume_size</span><span class="o">.</span><span class="n">customize</span><span class="p">(</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-344"><a href="#VolumeManagerBase.get_volume_mbsize-344"><span class="linenos">344</span></a>                <span class="n">volume_size</span><span class="o">.</span><span class="n">accumulate_mbyte_file_sizes</span><span class="p">(</span><span class="n">exclude_paths</span><span class="p">),</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-345"><a href="#VolumeManagerBase.get_volume_mbsize-345"><span class="linenos">345</span></a>                <span class="n">filesystem_name</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-346"><a href="#VolumeManagerBase.get_volume_mbsize-346"><span class="linenos">346</span></a>            <span class="p">)</span>
</span><span id="VolumeManagerBase.get_volume_mbsize-347"><a href="#VolumeManagerBase.get_volume_mbsize-347"><span class="linenos">347</span></a>        <span class="k">return</span> <span class="n">mbsize</span>
</span></pre></div>


            <div class="docstring"><p>Implements size lookup for the given path and desired
filesystem according to the specified size type</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>tuple volume</strong>:  volume to check size for</li>
<li><strong>list all_volumes</strong>:  list of all volume tuples</li>
<li><strong>str filesystem_name</strong>:  filesystem name</li>
<li><strong>resize_on_boot</strong>: 
specify the time of the resize. If the resize happens at
boot time the volume size is only the minimum size to
just store the data. If the volume size is fixed and
does not change at boot time the returned size is the
requested size which can be greater than the minimum
needed size.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>mbsize</p>
</blockquote>
</div>


                            </div>
                            <div id="VolumeManagerBase.get_mountpoint" class="classattr">
                                        <input id="VolumeManagerBase.get_mountpoint-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_mountpoint</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="VolumeManagerBase.get_mountpoint-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#VolumeManagerBase.get_mountpoint"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="VolumeManagerBase.get_mountpoint-349"><a href="#VolumeManagerBase.get_mountpoint-349"><span class="linenos">349</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_mountpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="VolumeManagerBase.get_mountpoint-350"><a href="#VolumeManagerBase.get_mountpoint-350"><span class="linenos">350</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase.get_mountpoint-351"><a href="#VolumeManagerBase.get_mountpoint-351"><span class="linenos">351</span></a><span class="sd">        Provides mount point directory</span>
</span><span id="VolumeManagerBase.get_mountpoint-352"><a href="#VolumeManagerBase.get_mountpoint-352"><span class="linenos">352</span></a>
</span><span id="VolumeManagerBase.get_mountpoint-353"><a href="#VolumeManagerBase.get_mountpoint-353"><span class="linenos">353</span></a><span class="sd">        Effective use of the directory is guaranteed only after sync_data</span>
</span><span id="VolumeManagerBase.get_mountpoint-354"><a href="#VolumeManagerBase.get_mountpoint-354"><span class="linenos">354</span></a>
</span><span id="VolumeManagerBase.get_mountpoint-355"><a href="#VolumeManagerBase.get_mountpoint-355"><span class="linenos">355</span></a><span class="sd">        :return: directory path name</span>
</span><span id="VolumeManagerBase.get_mountpoint-356"><a href="#VolumeManagerBase.get_mountpoint-356"><span class="linenos">356</span></a>
</span><span id="VolumeManagerBase.get_mountpoint-357"><a href="#VolumeManagerBase.get_mountpoint-357"><span class="linenos">357</span></a><span class="sd">        :rtype: string</span>
</span><span id="VolumeManagerBase.get_mountpoint-358"><a href="#VolumeManagerBase.get_mountpoint-358"><span class="linenos">358</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase.get_mountpoint-359"><a href="#VolumeManagerBase.get_mountpoint-359"><span class="linenos">359</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mountpoint</span>
</span></pre></div>


            <div class="docstring"><p>Provides mount point directory</p>

<p>Effective use of the directory is guaranteed only after sync_data</p>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>directory path name</p>
</blockquote>
</div>


                            </div>
                            <div id="VolumeManagerBase.get_root_volume_name" class="classattr">
                                        <input id="VolumeManagerBase.get_root_volume_name-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_root_volume_name</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="VolumeManagerBase.get_root_volume_name-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#VolumeManagerBase.get_root_volume_name"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="VolumeManagerBase.get_root_volume_name-361"><a href="#VolumeManagerBase.get_root_volume_name-361"><span class="linenos">361</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_root_volume_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="VolumeManagerBase.get_root_volume_name-362"><a href="#VolumeManagerBase.get_root_volume_name-362"><span class="linenos">362</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase.get_root_volume_name-363"><a href="#VolumeManagerBase.get_root_volume_name-363"><span class="linenos">363</span></a><span class="sd">        Provides name of the root volume</span>
</span><span id="VolumeManagerBase.get_root_volume_name-364"><a href="#VolumeManagerBase.get_root_volume_name-364"><span class="linenos">364</span></a>
</span><span id="VolumeManagerBase.get_root_volume_name-365"><a href="#VolumeManagerBase.get_root_volume_name-365"><span class="linenos">365</span></a><span class="sd">        This is by default set to &#39;/&#39;. Volume Managers that supports</span>
</span><span id="VolumeManagerBase.get_root_volume_name-366"><a href="#VolumeManagerBase.get_root_volume_name-366"><span class="linenos">366</span></a><span class="sd">        the concept of sub-volumes overrides this method</span>
</span><span id="VolumeManagerBase.get_root_volume_name-367"><a href="#VolumeManagerBase.get_root_volume_name-367"><span class="linenos">367</span></a>
</span><span id="VolumeManagerBase.get_root_volume_name-368"><a href="#VolumeManagerBase.get_root_volume_name-368"><span class="linenos">368</span></a><span class="sd">        :return: directory path name</span>
</span><span id="VolumeManagerBase.get_root_volume_name-369"><a href="#VolumeManagerBase.get_root_volume_name-369"><span class="linenos">369</span></a>
</span><span id="VolumeManagerBase.get_root_volume_name-370"><a href="#VolumeManagerBase.get_root_volume_name-370"><span class="linenos">370</span></a><span class="sd">        :rtype: string</span>
</span><span id="VolumeManagerBase.get_root_volume_name-371"><a href="#VolumeManagerBase.get_root_volume_name-371"><span class="linenos">371</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase.get_root_volume_name-372"><a href="#VolumeManagerBase.get_root_volume_name-372"><span class="linenos">372</span></a>        <span class="k">return</span> <span class="s1">&#39;/&#39;</span>
</span></pre></div>


            <div class="docstring"><p>Provides name of the root volume</p>

<p>This is by default set to '/'. Volume Managers that supports
the concept of sub-volumes overrides this method</p>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>directory path name</p>
</blockquote>
</div>


                            </div>
                            <div id="VolumeManagerBase.sync_data" class="classattr">
                                        <input id="VolumeManagerBase.sync_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sync_data</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">exclude</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Optional</span><span class="p">[</span><span class="n"><a href="../mount_manager.html#MountManager">kiwi.mount_manager.MountManager</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="VolumeManagerBase.sync_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#VolumeManagerBase.sync_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="VolumeManagerBase.sync_data-374"><a href="#VolumeManagerBase.sync_data-374"><span class="linenos">374</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">sync_data</span><span class="p">(</span>
</span><span id="VolumeManagerBase.sync_data-375"><a href="#VolumeManagerBase.sync_data-375"><span class="linenos">375</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="VolumeManagerBase.sync_data-376"><a href="#VolumeManagerBase.sync_data-376"><span class="linenos">376</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">MountManager</span><span class="p">]:</span>
</span><span id="VolumeManagerBase.sync_data-377"><a href="#VolumeManagerBase.sync_data-377"><span class="linenos">377</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase.sync_data-378"><a href="#VolumeManagerBase.sync_data-378"><span class="linenos">378</span></a><span class="sd">        Implements sync of root directory to mounted volumes</span>
</span><span id="VolumeManagerBase.sync_data-379"><a href="#VolumeManagerBase.sync_data-379"><span class="linenos">379</span></a>
</span><span id="VolumeManagerBase.sync_data-380"><a href="#VolumeManagerBase.sync_data-380"><span class="linenos">380</span></a><span class="sd">        :param list exclude: file patterns to exclude</span>
</span><span id="VolumeManagerBase.sync_data-381"><a href="#VolumeManagerBase.sync_data-381"><span class="linenos">381</span></a>
</span><span id="VolumeManagerBase.sync_data-382"><a href="#VolumeManagerBase.sync_data-382"><span class="linenos">382</span></a><span class="sd">        :return: If a mount was created, then a context manager implementing the</span>
</span><span id="VolumeManagerBase.sync_data-383"><a href="#VolumeManagerBase.sync_data-383"><span class="linenos">383</span></a><span class="sd">            unmount is returned.</span>
</span><span id="VolumeManagerBase.sync_data-384"><a href="#VolumeManagerBase.sync_data-384"><span class="linenos">384</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase.sync_data-385"><a href="#VolumeManagerBase.sync_data-385"><span class="linenos">385</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mountpoint</span><span class="p">:</span>
</span><span id="VolumeManagerBase.sync_data-386"><a href="#VolumeManagerBase.sync_data-386"><span class="linenos">386</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="VolumeManagerBase.sync_data-387"><a href="#VolumeManagerBase.sync_data-387"><span class="linenos">387</span></a>
</span><span id="VolumeManagerBase.sync_data-388"><a href="#VolumeManagerBase.sync_data-388"><span class="linenos">388</span></a>        <span class="n">root_mount</span> <span class="o">=</span> <span class="n">MountManager</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">mountpoint</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mountpoint</span><span class="p">)</span>
</span><span id="VolumeManagerBase.sync_data-389"><a href="#VolumeManagerBase.sync_data-389"><span class="linenos">389</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">root_mount</span><span class="o">.</span><span class="n">is_mounted</span><span class="p">():</span>
</span><span id="VolumeManagerBase.sync_data-390"><a href="#VolumeManagerBase.sync_data-390"><span class="linenos">390</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mount_volumes</span><span class="p">()</span>
</span><span id="VolumeManagerBase.sync_data-391"><a href="#VolumeManagerBase.sync_data-391"><span class="linenos">391</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">DataSync</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mountpoint</span><span class="p">)</span>
</span><span id="VolumeManagerBase.sync_data-392"><a href="#VolumeManagerBase.sync_data-392"><span class="linenos">392</span></a>        <span class="n">data</span><span class="o">.</span><span class="n">sync_data</span><span class="p">(</span>
</span><span id="VolumeManagerBase.sync_data-393"><a href="#VolumeManagerBase.sync_data-393"><span class="linenos">393</span></a>            <span class="n">options</span><span class="o">=</span><span class="n">Defaults</span><span class="o">.</span><span class="n">get_sync_options</span><span class="p">(),</span> <span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span> <span class="ow">or</span> <span class="p">[]</span>
</span><span id="VolumeManagerBase.sync_data-394"><a href="#VolumeManagerBase.sync_data-394"><span class="linenos">394</span></a>        <span class="p">)</span>
</span><span id="VolumeManagerBase.sync_data-395"><a href="#VolumeManagerBase.sync_data-395"><span class="linenos">395</span></a>        <span class="k">return</span> <span class="n">root_mount</span>
</span></pre></div>


            <div class="docstring"><p>Implements sync of root directory to mounted volumes</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>list exclude</strong>:  file patterns to exclude</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>If a mount was created, then a context manager implementing the
      unmount is returned.</p>
</blockquote>
</div>


                            </div>
                            <div id="VolumeManagerBase.create_verity_layer" class="classattr">
                                        <input id="VolumeManagerBase.create_verity_layer-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_verity_layer</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">blocks</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>, </span><span class="param"><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="VolumeManagerBase.create_verity_layer-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#VolumeManagerBase.create_verity_layer"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="VolumeManagerBase.create_verity_layer-397"><a href="#VolumeManagerBase.create_verity_layer-397"><span class="linenos">397</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_verity_layer</span><span class="p">(</span>
</span><span id="VolumeManagerBase.create_verity_layer-398"><a href="#VolumeManagerBase.create_verity_layer-398"><span class="linenos">398</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">blocks</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="VolumeManagerBase.create_verity_layer-399"><a href="#VolumeManagerBase.create_verity_layer-399"><span class="linenos">399</span></a>    <span class="p">):</span>
</span><span id="VolumeManagerBase.create_verity_layer-400"><a href="#VolumeManagerBase.create_verity_layer-400"><span class="linenos">400</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase.create_verity_layer-401"><a href="#VolumeManagerBase.create_verity_layer-401"><span class="linenos">401</span></a><span class="sd">        veritysetup on LVM devices is not supported</span>
</span><span id="VolumeManagerBase.create_verity_layer-402"><a href="#VolumeManagerBase.create_verity_layer-402"><span class="linenos">402</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase.create_verity_layer-403"><a href="#VolumeManagerBase.create_verity_layer-403"><span class="linenos">403</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span></pre></div>


            <div class="docstring"><p>veritysetup on LVM devices is not supported</p>
</div>


                            </div>
                            <div id="VolumeManagerBase.create_verification_metadata" class="classattr">
                                        <input id="VolumeManagerBase.create_verification_metadata-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_verification_metadata</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">device_node</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="VolumeManagerBase.create_verification_metadata-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#VolumeManagerBase.create_verification_metadata"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="VolumeManagerBase.create_verification_metadata-405"><a href="#VolumeManagerBase.create_verification_metadata-405"><span class="linenos">405</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_verification_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device_node</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="VolumeManagerBase.create_verification_metadata-406"><a href="#VolumeManagerBase.create_verification_metadata-406"><span class="linenos">406</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase.create_verification_metadata-407"><a href="#VolumeManagerBase.create_verification_metadata-407"><span class="linenos">407</span></a><span class="sd">        Write verification block on LVM devices is not supported</span>
</span><span id="VolumeManagerBase.create_verification_metadata-408"><a href="#VolumeManagerBase.create_verification_metadata-408"><span class="linenos">408</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase.create_verification_metadata-409"><a href="#VolumeManagerBase.create_verification_metadata-409"><span class="linenos">409</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span></pre></div>


            <div class="docstring"><p>Write verification block on LVM devices is not supported</p>
</div>


                            </div>
                            <div id="VolumeManagerBase.set_property_readonly_root" class="classattr">
                                        <input id="VolumeManagerBase.set_property_readonly_root-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_property_readonly_root</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="VolumeManagerBase.set_property_readonly_root-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#VolumeManagerBase.set_property_readonly_root"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="VolumeManagerBase.set_property_readonly_root-411"><a href="#VolumeManagerBase.set_property_readonly_root-411"><span class="linenos">411</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_property_readonly_root</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="VolumeManagerBase.set_property_readonly_root-412"><a href="#VolumeManagerBase.set_property_readonly_root-412"><span class="linenos">412</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase.set_property_readonly_root-413"><a href="#VolumeManagerBase.set_property_readonly_root-413"><span class="linenos">413</span></a><span class="sd">        Implements setup of read-only root property</span>
</span><span id="VolumeManagerBase.set_property_readonly_root-414"><a href="#VolumeManagerBase.set_property_readonly_root-414"><span class="linenos">414</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase.set_property_readonly_root-415"><a href="#VolumeManagerBase.set_property_readonly_root-415"><span class="linenos">415</span></a>        <span class="k">raise</span> <span class="n">KiwiVolumeManagerSetupError</span><span class="p">(</span>
</span><span id="VolumeManagerBase.set_property_readonly_root-416"><a href="#VolumeManagerBase.set_property_readonly_root-416"><span class="linenos">416</span></a>            <span class="s1">&#39;read only property not supported&#39;</span>
</span><span id="VolumeManagerBase.set_property_readonly_root-417"><a href="#VolumeManagerBase.set_property_readonly_root-417"><span class="linenos">417</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Implements setup of read-only root property</p>
</div>


                            </div>
                            <div id="VolumeManagerBase.setup_mountpoint" class="classattr">
                                        <input id="VolumeManagerBase.setup_mountpoint-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">setup_mountpoint</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="VolumeManagerBase.setup_mountpoint-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#VolumeManagerBase.setup_mountpoint"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="VolumeManagerBase.setup_mountpoint-419"><a href="#VolumeManagerBase.setup_mountpoint-419"><span class="linenos">419</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">setup_mountpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="VolumeManagerBase.setup_mountpoint-420"><a href="#VolumeManagerBase.setup_mountpoint-420"><span class="linenos">420</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase.setup_mountpoint-421"><a href="#VolumeManagerBase.setup_mountpoint-421"><span class="linenos">421</span></a><span class="sd">        Implements creation of a master directory holding</span>
</span><span id="VolumeManagerBase.setup_mountpoint-422"><a href="#VolumeManagerBase.setup_mountpoint-422"><span class="linenos">422</span></a><span class="sd">        the mounts of all volumes</span>
</span><span id="VolumeManagerBase.setup_mountpoint-423"><a href="#VolumeManagerBase.setup_mountpoint-423"><span class="linenos">423</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="VolumeManagerBase.setup_mountpoint-424"><a href="#VolumeManagerBase.setup_mountpoint-424"><span class="linenos">424</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mountpoint_tempdir</span> <span class="o">=</span> <span class="n">Temporary</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;kiwi_volumes.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">new_dir</span><span class="p">()</span>
</span><span id="VolumeManagerBase.setup_mountpoint-425"><a href="#VolumeManagerBase.setup_mountpoint-425"><span class="linenos">425</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mountpoint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mountpoint_tempdir</span><span class="o">.</span><span class="n">name</span>
</span><span id="VolumeManagerBase.setup_mountpoint-426"><a href="#VolumeManagerBase.setup_mountpoint-426"><span class="linenos">426</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">temp_directories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mountpoint_tempdir</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Implements creation of a master directory holding
the mounts of all volumes</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="../storage/device_provider.html#DeviceProvider">kiwi.storage.device_provider.DeviceProvider</a></dt>
                                <dd id="VolumeManagerBase.get_uuid" class="function"><a href="../storage/device_provider.html#DeviceProvider.get_uuid">get_uuid</a></dd>
                <dd id="VolumeManagerBase.get_byte_size" class="function"><a href="../storage/device_provider.html#DeviceProvider.get_byte_size">get_byte_size</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>